{"file_contents":{"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.SUPABASE_DATABASE_URL) {\n  throw new Error(\"SUPABASE_DATABASE_URL must be set\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.SUPABASE_DATABASE_URL,\n  },\n});","path":null,"size_bytes":327,"size_tokens":null},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","path":null,"size_bytes":329,"size_tokens":null},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","path":null,"size_bytes":1527,"size_tokens":null},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","path":null,"size_bytes":4845,"size_tokens":null},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","path":null,"size_bytes":756,"size_tokens":null},"client/src/components/examples/ProductGrid.tsx":{"content":"import ProductGrid from '../ProductGrid';\n\nexport default function ProductGridExample() {\n  return <ProductGrid />;\n}","path":null,"size_bytes":117,"size_tokens":null},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","path":null,"size_bytes":2712,"size_tokens":null},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","path":null,"size_bytes":1139,"size_tokens":null},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    // h-9 to match icon buttons and default buttons.\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","path":null,"size_bytes":844,"size_tokens":null},"client/src/components/ShippingCalculator.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card } from \"@/components/ui/card\";\nimport { Truck, Clock, MapPin } from \"lucide-react\";\nimport { useState, useEffect } from \"react\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\n\ninterface ShippingOption {\n  id: string;\n  name: string;\n  price: number;\n  estimatedDays: string;\n  icon: React.ReactNode;\n}\n\ninterface ShippingCalculatorProps {\n  onShippingSelect?: (option: ShippingOption) => void;\n  className?: string;\n}\n\nexport default function ShippingCalculator({ \n  onShippingSelect,\n  className \n}: ShippingCalculatorProps) {\n  const { zipCode, setZipCode } = useMochila();\n  const [cep, setCep] = useState(zipCode || \"\");\n  const [loading, setLoading] = useState(false);\n  const [shippingOptions, setShippingOptions] = useState<ShippingOption[]>([]);\n  const [selectedOption, setSelectedOption] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (zipCode && zipCode.length === 9) {\n      setCep(zipCode);\n      calculateShipping(zipCode);\n    }\n  }, [zipCode]);\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  const calculateShipping = async (zipToCalculate?: string) => {\n    const targetCep = zipToCalculate || cep;\n    const cleanCep = targetCep.replace(/\\D/g, '');\n    if (cleanCep.length !== 8) return;\n    \n    setLoading(true);\n    \n    // Update context/cookies when manual calculation is triggered\n    if (!zipToCalculate) {\n      let formatted = cleanCep;\n      if (cleanCep.length > 5) formatted = `${cleanCep.slice(0, 5)}-${cleanCep.slice(5)}`;\n      setZipCode(formatted);\n    }\n\n    // Simular API call\n    setTimeout(() => {\n      //todo: remove mock functionality\n      const mockOptions: ShippingOption[] = [\n        {\n          id: 'standard',\n          name: 'entrega padr√£o',\n          price: 19.99,\n          estimatedDays: '5-8 dias √∫teis',\n          icon: <Truck className=\"h-4 w-4\" />\n        }\n      ];\n      \n      setShippingOptions(mockOptions);\n      setLoading(false);\n    }, 1000);\n  };\n\n  const handleCepChange = (value: string) => {\n    const numericValue = value.replace(/\\D/g, '');\n    setCep(numericValue);\n    \n    if (numericValue.length === 8) {\n      calculateShipping();\n    } else {\n      setShippingOptions([]);\n      setSelectedOption(null);\n    }\n  };\n\n  const selectOption = (option: ShippingOption) => {\n    setSelectedOption(option.id);\n    onShippingSelect?.(option);\n  };\n\n  return (\n    <div className={className}>\n      <div className=\"space-y-4\">\n        <div className=\"space-y-2\">\n          <Label htmlFor=\"cep\">calcular frete</Label>\n          <div className=\"flex gap-2\">\n            <Input\n              id=\"cep\"\n              type=\"text\"\n              value={cep}\n              onChange={(e) => handleCepChange(e.target.value)}\n              placeholder=\"digite seu cep\"\n              maxLength={8}\n              data-testid=\"input-cep\"\n            />\n            <Button \n              onClick={() => calculateShipping()}\n              disabled={cep.length !== 8 || loading}\n              data-testid=\"button-calculate-shipping\"\n            >\n              {loading ? 'calculando...' : 'calcular'}\n            </Button>\n          </div>\n        </div>\n        \n        {shippingOptions.length > 0 && (\n          <div className=\"space-y-3\">\n            <h4 className=\"text-sm font-medium\">op√ß√µes de entrega:</h4>\n            {shippingOptions.map((option) => (\n              <Card\n                key={option.id}\n                className={`p-3 cursor-pointer hover-elevate transition-colors ${\n                  selectedOption === option.id \n                    ? 'border-primary bg-primary/5' \n                    : 'hover:border-muted-foreground'\n                }`}\n                onClick={() => selectOption(option)}\n                data-testid={`card-shipping-${option.id}`}\n              >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    {option.icon}\n                    <div>\n                      <div className=\"font-medium text-sm\">{option.name}</div>\n                      <div className=\"text-xs text-muted-foreground\">{option.estimatedDays}</div>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <div className=\"font-medium\">\n                      {option.price === 0 ? 'gr√°tis' : formatPrice(option.price)}\n                    </div>\n                    {option.price === 0 && (\n                      <div className=\"text-xs text-muted-foreground\">\n                        compras acima de <span className=\"normal-case\">R$ 200</span>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":5077,"size_tokens":null},"client/src/components/examples/DailyVerse.tsx":{"content":"import DailyVerse from '../DailyVerse';\n\nexport default function DailyVerseExample() {\n  return (\n    <div className=\"p-8 bg-background\">\n      <DailyVerse />\n    </div>\n  );\n}","path":null,"size_bytes":176,"size_tokens":null},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","path":null,"size_bytes":791,"size_tokens":null},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport session from \"express-session\";\nimport createMemoryStore from \"memorystore\";\nimport compression from \"compression\";\nimport { registerRoutes } from \"./routes\";\nimport { serveStatic, log } from \"./prod\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { initSEO } from \"./seo-inject\";\n\nconst app = express();\n\napp.use(compression());\n\nconst behindProxy = !!(process.env.REPL_ID || process.env.TRUST_PROXY === 'true' || process.env.NODE_ENV === 'production');\nif (behindProxy) {\n  app.set('trust proxy', 1);\n}\n\napp.use(express.json({ limit: '1mb' }));\napp.use(express.urlencoded({ extended: false, limit: '1mb' }));\n\n// Validate critical environment variables\nif (!process.env.SESSION_SECRET || process.env.SESSION_SECRET.length < 32) {\n  console.error('‚ùå ERRO CR√çTICO: SESSION_SECRET n√£o configurado ou muito fraco (m√≠nimo 32 caracteres)');\n  process.exit(1);\n}\n\n// Configure session middleware with MemoryStore\nconst MemoryStore = createMemoryStore(session);\n\nconst isProduction = process.env.NODE_ENV === 'production';\n\napp.use(\n  session({\n    name: 'connect.sid',\n    secret: process.env.SESSION_SECRET,\n    resave: false,\n    saveUninitialized: false,\n    rolling: true,\n    store: new MemoryStore({\n      checkPeriod: 86400000\n    }),\n    cookie: {\n      secure: isProduction,\n      httpOnly: true,\n      maxAge: 2 * 60 * 60 * 1000, // 2 hours\n      sameSite: 'lax',\n      path: '/'\n    }\n  })\n);\n\napp.use('/attached_assets', express.static(path.resolve(import.meta.dirname, '../attached_assets'), {\n  maxAge: '7d',\n  etag: true,\n  lastModified: true\n}));\napp.use('/uploads', express.static(path.resolve(import.meta.dirname, '../public/uploads'), {\n  maxAge: '7d',\n  etag: true,\n  lastModified: true\n}));\napp.use('/reviews', express.static(path.resolve(import.meta.dirname, '../public/reviews'), {\n  maxAge: '7d',\n  etag: true,\n  lastModified: true\n}));\n\n// Request logging middleware (without sensitive data)\napp.use((req, res, next) => {\n  if (req.path.startsWith('/api/admin') && process.env.NODE_ENV === 'development') {\n    console.log(\"üîµ Admin Request:\", req.method, req.path, {\n      sessionID: req.sessionID.substring(0, 8) + '...',\n      hasSession: !!req.session,\n      isAdmin: req.session?.isAdmin\n    });\n  }\n  next();\n});\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"‚Ä¶\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  await initSEO();\n\n  // Product OG middleware - intercepts product URLs for social media crawlers\n  const { injectProductOG } = await import(\"./seo-inject\");\n\n  app.use(async (req, res, next) => {\n    const url = req.path;\n    const productMatch = url.match(/^\\/produto\\/([^/]+)\\/?$/);\n    if (!productMatch) return next();\n\n    const productId = productMatch[1];\n    try {\n      let templatePath: string;\n      if (app.get(\"env\") === \"development\") {\n        templatePath = path.resolve(import.meta.dirname, \"..\", \"client\", \"index.html\");\n      } else {\n        templatePath = path.resolve(import.meta.dirname, \"public\", \"index.html\");\n      }\n\n      if (!fs.existsSync(templatePath)) return next();\n\n      let html = fs.readFileSync(templatePath, \"utf-8\");\n      const modified = await injectProductOG(html, productId);\n      if (!modified) return next();\n\n      if (app.get(\"env\") === \"development\") {\n        const viteMod = \"./vite\";\n        try {\n          const viteInstance = (app as any).__viteDevServer;\n          if (viteInstance) {\n            const page = await viteInstance.transformIndexHtml(url, modified);\n            return res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n          }\n        } catch {}\n      }\n\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(modified);\n    } catch (err) {\n      console.error(\"Product OG middleware error:\", err);\n      next();\n    }\n  });\n\n  if (app.get(\"env\") === \"development\") {\n    const viteMod = \"./vite\";\n    const { setupVite } = await import(viteMod);\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","path":null,"size_bytes":5472,"size_tokens":null},"client/src/components/BannerCarousel.tsx":{"content":"import { useState, useEffect, useRef, useCallback, memo } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Link } from \"wouter\";\n\ninterface Banner {\n  id: string;\n  title: string;\n  subtitle: string;\n  ctaText: string | null;\n  ctaLink: string | null;\n  productId: string | null;\n  imageUrl: string;\n  position: string;\n  showText: boolean;\n  sortOrder: number;\n  isActive: boolean;\n}\n\nfunction BannerCarouselComponent() {\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [touchStart, setTouchStart] = useState(0);\n  const [touchEnd, setTouchEnd] = useState(0);\n  const [isDragging, setIsDragging] = useState(false);\n  const [isAutoPlayEnabled, setIsAutoPlayEnabled] = useState(true);\n  const [progress, setProgress] = useState(0);\n  const progressRef = useRef<number>(0);\n  const animFrameRef = useRef<number>(0);\n  const lastTimeRef = useRef<number>(0);\n\n  const SLIDE_DURATION = 5000;\n\n  const { data: bannersData } = useQuery<{ banners: Banner[] }>({\n    queryKey: ['/api/banners'],\n  });\n\n  const activeBanners = bannersData?.banners?.filter(b => b.isActive) || [];\n\n  const advanceSlide = useCallback(() => {\n    setCurrentIndex((prev) => (prev + 1) % activeBanners.length);\n    progressRef.current = 0;\n    setProgress(0);\n    lastTimeRef.current = 0;\n  }, [activeBanners.length]);\n\n  useEffect(() => {\n    if (activeBanners.length <= 1 || !isAutoPlayEnabled) return;\n\n    const tick = (timestamp: number) => {\n      if (!lastTimeRef.current) lastTimeRef.current = timestamp;\n      const delta = timestamp - lastTimeRef.current;\n      lastTimeRef.current = timestamp;\n\n      progressRef.current += delta;\n      const pct = Math.min(progressRef.current / SLIDE_DURATION, 1);\n      setProgress(pct);\n\n      if (pct >= 1) {\n        advanceSlide();\n      } else {\n        animFrameRef.current = requestAnimationFrame(tick);\n      }\n    };\n\n    animFrameRef.current = requestAnimationFrame(tick);\n\n    return () => cancelAnimationFrame(animFrameRef.current);\n  }, [activeBanners.length, isAutoPlayEnabled, currentIndex, advanceSlide]);\n\n  const resetProgress = () => {\n    progressRef.current = 0;\n    setProgress(0);\n    lastTimeRef.current = 0;\n  };\n\n  const goToPrevious = () => {\n    resetProgress();\n    setIsAutoPlayEnabled(true);\n    setCurrentIndex((prev) => (prev - 1 + activeBanners.length) % activeBanners.length);\n  };\n\n  const goToNext = () => {\n    resetProgress();\n    setIsAutoPlayEnabled(true);\n    setCurrentIndex((prev) => (prev + 1) % activeBanners.length);\n  };\n\n  const handleBarClick = (index: number) => {\n    resetProgress();\n    setIsAutoPlayEnabled(true);\n    setCurrentIndex(index);\n  };\n\n  const handleTouchStart = (e: React.TouchEvent) => {\n    setTouchStart(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchMove = (e: React.TouchEvent) => {\n    setTouchEnd(e.targetTouches[0].clientX);\n  };\n\n  const handleTouchEnd = () => {\n    if (!touchStart || !touchEnd) return;\n    \n    const distance = touchStart - touchEnd;\n    const minSwipeDistance = 50;\n    \n    if (distance > minSwipeDistance) {\n      goToNext();\n    }\n    \n    if (distance < -minSwipeDistance) {\n      goToPrevious();\n    }\n    \n    setTouchStart(0);\n    setTouchEnd(0);\n  };\n\n  const handleMouseDown = (e: React.MouseEvent) => {\n    setIsDragging(true);\n    setTouchStart(e.clientX);\n  };\n\n  const handleMouseMove = (e: React.MouseEvent) => {\n    if (!isDragging) return;\n    setTouchEnd(e.clientX);\n  };\n\n  const handleMouseUp = () => {\n    if (!isDragging) return;\n    setIsDragging(false);\n    \n    if (!touchStart || !touchEnd) return;\n    \n    const distance = touchStart - touchEnd;\n    const minSwipeDistance = 50;\n    \n    if (distance > minSwipeDistance) {\n      goToNext();\n    }\n    \n    if (distance < -minSwipeDistance) {\n      goToPrevious();\n    }\n    \n    setTouchStart(0);\n    setTouchEnd(0);\n  };\n\n  const handleMouseLeave = () => {\n    if (isDragging) {\n      setIsDragging(false);\n      setTouchStart(0);\n      setTouchEnd(0);\n    }\n  };\n\n  if (activeBanners.length === 0) {\n    return null;\n  }\n\n  const currentBanner = activeBanners[currentIndex];\n  \n  // Determinar o link correto baseado em productId ou ctaLink\n  const bannerLink = currentBanner.productId \n    ? `/produto/${currentBanner.productId}` \n    : currentBanner.ctaLink || \"#\";\n\n  const isExternalLink = bannerLink.startsWith('http');\n\n  return (\n    <section \n      className=\"relative h-[70vh] overflow-hidden cursor-grab active:cursor-grabbing select-none\"\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n      onMouseDown={handleMouseDown}\n      onMouseMove={handleMouseMove}\n      onMouseUp={handleMouseUp}\n      onMouseLeave={handleMouseLeave}\n    >\n      {/* Background Image */}\n      <div \n        className=\"absolute inset-0 bg-cover bg-center transition-all duration-700 ease-in-out\"\n        style={{ backgroundImage: `url(${currentBanner.imageUrl})` } as any}\n      />\n      <div className=\"absolute inset-0 bg-gradient-to-r from-black/50 via-transparent to-black/50\" />\n      \n      {/* Content */}\n      {currentBanner.showText && (\n        <div className=\"absolute inset-0 z-[15] flex items-center justify-center pointer-events-none\">\n          <div className=\"container px-4\">\n            <div className={`max-w-lg w-full ${\n              currentBanner.position === 'right' \n                ? 'ml-auto text-right' \n                : currentBanner.position === 'center' \n                  ? 'mx-auto text-center' \n                  : 'mr-auto text-left'\n            }`}>\n              <h2 className=\"font-serif text-4xl md:text-6xl text-white mb-4 lowercase\" data-testid=\"text-banner-title\" style={{ textShadow: '0 2px 4px rgba(0,0,0,0.5), 0 0 40px rgba(0,0,0,0.3)' }}>\n                {currentBanner.title}\n              </h2>\n              <p className=\"text-white/90 text-lg md:text-xl mb-8 lowercase\" data-testid=\"text-banner-subtitle\" style={{ textShadow: '0 1px 2px rgba(0,0,0,0.5)' }}>\n                {currentBanner.subtitle}\n              </p>\n              {currentBanner.ctaText && (\n                <Button \n                  asChild\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"bg-white/10 backdrop-blur border-white/20 text-white hover:bg-white/20 lowercase pointer-events-auto\"\n                  data-testid={`button-banner-cta-${currentBanner.id}`}\n                >\n                  {isExternalLink ? (\n                    <a href={bannerLink} target=\"_blank\" rel=\"noopener noreferrer\">\n                      {currentBanner.ctaText}\n                    </a>\n                  ) : (\n                    <Link href={bannerLink}>\n                      {currentBanner.ctaText}\n                    </Link>\n                  )}\n                </Button>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Tap zones: left = previous, right = next */}\n      {activeBanners.length > 1 && (\n        <div className=\"absolute inset-0 z-10 flex\">\n          <button\n            className=\"w-1/2 h-full cursor-pointer\"\n            onClick={goToPrevious}\n            data-testid=\"button-banner-tap-left\"\n          />\n          <button\n            className=\"w-1/2 h-full cursor-pointer\"\n            onClick={goToNext}\n            data-testid=\"button-banner-tap-right\"\n          />\n        </div>\n      )}\n\n      {/* Story-style progress bars */}\n      {activeBanners.length > 1 && (\n        <div className=\"absolute bottom-4 left-4 right-4 z-20 flex gap-1\">\n          {activeBanners.map((_, index) => (\n            <button\n              key={index}\n              onClick={() => handleBarClick(index)}\n              className=\"relative flex-1 h-[3px] rounded-full overflow-hidden bg-white/30 cursor-pointer\"\n              data-testid={`button-banner-bar-${index}`}\n            >\n              <div\n                className=\"absolute inset-y-0 left-0 bg-white rounded-full\"\n                style={{\n                  width: index < currentIndex\n                    ? '100%'\n                    : index === currentIndex\n                      ? `${progress * 100}%`\n                      : '0%',\n                  transition: index === currentIndex ? 'none' : 'width 0.3s ease',\n                }}\n              />\n            </button>\n          ))}\n        </div>\n      )}\n    </section>\n  );\n}\n\nexport const BannerCarousel = memo(BannerCarouselComponent);\nexport default BannerCarousel;\n","path":null,"size_bytes":8590,"size_tokens":null},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","path":null,"size_bytes":1883,"size_tokens":null},"client/src/components/MochilaToast.tsx":{"content":"import { motion, AnimatePresence } from \"framer-motion\";\nimport { X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport type { MochilaItem } from \"@/contexts/MochilaContext\";\n\ninterface MochilaToastProps {\n  item: MochilaItem | null;\n  isVisible: boolean;\n  onClose: () => void;\n  onOpenDrawer: () => void;\n}\n\nexport default function MochilaToast({ item, isVisible, onClose, onOpenDrawer }: MochilaToastProps) {\n  if (!item) return null;\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  const handleToastClick = () => {\n    onOpenDrawer();\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, x: 80 }}\n          animate={{ opacity: 1, x: 0 }}\n          exit={{ opacity: 0, x: 80 }}\n          drag=\"x\"\n          dragConstraints={{ left: 0, right: 0 }}\n          dragElastic={{ left: 0.6, right: 0.6 }}\n          onDragEnd={(_, info) => {\n            if (Math.abs(info.offset.x) > 30) {\n              onClose();\n            }\n          }}\n          transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n          className=\"fixed top-20 right-4 z-50 w-80 max-w-[calc(100vw-2rem)] touch-none\"\n          data-testid=\"toast-mochila\"\n        >\n          <div \n            className=\"bg-background border rounded-lg shadow-lg p-6 flex gap-4 items-start relative cursor-pointer hover-elevate\"\n            onClick={handleToastClick}\n          >\n            <div className=\"flex-shrink-0\">\n              <img\n                src={item.image}\n                alt={item.name}\n                className=\"w-20 h-20 object-cover rounded-lg\"\n                loading=\"lazy\"\n                decoding=\"async\"\n              />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-base font-medium lowercase mb-2\">adicionado na mochila</p>\n              <div className=\"flex-1 min-w-0\">\n                <p className=\"text-sm lowercase truncate font-medium mb-1\">{item.name}</p>\n                <div className=\"flex items-center gap-2.5 mt-1 flex-wrap\">\n                  <span className=\"text-sm text-muted-foreground\">{formatPrice(item.price)}</span>\n                  {item.color && (\n                    <div\n                      className=\"w-4 h-4 rounded-full border\"\n                      style={{ backgroundColor: item.color.hex }}\n                    />\n                  )}\n                  {item.size && (\n                    <span className=\"text-sm uppercase font-medium\">{item.size}</span>\n                  )}\n                  {item.printPosition && (\n                    <span className=\"text-xs text-muted-foreground lowercase\">\n                      {item.printPosition}\n                    </span>\n                  )}\n                </div>\n              </div>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onClose();\n              }}\n              className=\"h-6 w-6 absolute -top-1 -right-1\"\n              data-testid=\"button-close-toast\"\n            >\n              <X className=\"h-3 w-3\" />\n            </Button>\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":3401,"size_tokens":null},"client/src/pages/ProductsPage.tsx":{"content":"import { useState, useEffect, useMemo, useCallback } from \"react\";\nimport { Search, SlidersHorizontal, X, ChevronDown } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport ProductCard from \"@/components/ProductCard\";\nimport Footer from \"@/components/Footer\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport { useQuery } from \"@tanstack/react-query\";\n\nconst sizeOptions = [\"P\", \"M\", \"G\", \"GG\", \"XG\"];\n\nfunction ProductSkeleton() {\n  return (\n    <Card className=\"overflow-hidden border-0 shadow-none bg-transparent\">\n      <div className=\"aspect-[3/4] bg-muted/40 animate-pulse rounded-md\" />\n      <div className=\"pt-4 space-y-2\">\n        <div className=\"h-4 bg-muted/40 animate-pulse rounded w-3/4\" />\n        <div className=\"h-5 bg-muted/40 animate-pulse rounded w-1/3\" />\n      </div>\n    </Card>\n  );\n}\n\nexport default function ProductsPage() {\n  const [searchTerm, setSearchTerm] = useState(() => {\n    const params = new URLSearchParams(window.location.search);\n    return params.get('q') || \"\";\n  });\n  const [selectedSizes, setSelectedSizes] = useState<Set<string>>(new Set());\n\n  const [selectedCategory, setSelectedCategory] = useState<string>(\"todos\");\n  const [sortBy, setSortBy] = useState<string>(\"relevancia\");\n  const [priceRange, setPriceRange] = useState<[number, number]>([0, 200]);\n  const [showFilters, setShowFilters] = useState(false);\n  const [showSearch, setShowSearch] = useState(false);\n  const { isFavorito, toggleFavorito, triggerFavoritoToast } = useFavoritos();\n\n  const { data: apiData, isLoading } = useQuery<{products: any[]}>({\n    queryKey: ['/api/products'],\n  });\n  \n  const allProducts = apiData?.products || [];\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, []);\n\n  const toggleSize = useCallback((size: string) => {\n    setSelectedSizes(prev => {\n      const newSizes = new Set(prev);\n      if (newSizes.has(size)) {\n        newSizes.delete(size);\n      } else {\n        newSizes.add(size);\n      }\n      return newSizes;\n    });\n  }, []);\n\n  const handleMinPriceChange = useCallback((value: string) => {\n    const numValue = parseFloat(value);\n    if (value === \"\" || isNaN(numValue)) {\n      setPriceRange(prev => [0, prev[1]]);\n    } else {\n      const validMin = Math.max(0, numValue);\n      setPriceRange(prev => [validMin, Math.max(validMin, prev[1])]);\n    }\n  }, []);\n\n  const handleMaxPriceChange = useCallback((value: string) => {\n    const numValue = parseFloat(value);\n    if (value === \"\" || isNaN(numValue)) {\n      setPriceRange(prev => [prev[0], 200]);\n    } else {\n      const validMax = Math.max(0, numValue);\n      setPriceRange(prev => [Math.min(prev[0], validMax), validMax]);\n    }\n  }, []);\n\n  const clearFilters = useCallback(() => {\n    setSelectedSizes(new Set());\n    setSelectedCategory(\"todos\");\n    setSortBy(\"relevancia\");\n    setPriceRange([0, 200]);\n    setSearchTerm(\"\");\n  }, []);\n\n\n  const filteredProducts = useMemo(() => {\n    let results = allProducts.filter((product: any) => {\n      const matchesSearch = product.name.toLowerCase().includes(searchTerm.toLowerCase());\n      const matchesSize = selectedSizes.size === 0 || product.sizes?.some((size: string) => selectedSizes.has(size));\n      const matchesPrice = product.price >= priceRange[0] && product.price <= priceRange[1];\n      const matchesCategory = selectedCategory === \"todos\" || product.productType === selectedCategory;\n      \n      return matchesSearch && matchesSize && matchesPrice && matchesCategory;\n    });\n\n    if (sortBy === \"preco_asc\") {\n      results.sort((a: any, b: any) => a.price - b.price);\n    } else if (sortBy === \"preco_desc\") {\n      results.sort((a: any, b: any) => b.price - a.price);\n    } else if (sortBy === \"novo\") {\n      results.sort((a: any, b: any) => (b.createdAt ? new Date(b.createdAt).getTime() : 0) - (a.createdAt ? new Date(a.createdAt).getTime() : 0));\n    }\n\n    return results;\n  }, [allProducts, searchTerm, selectedSizes, priceRange, selectedCategory, sortBy]);\n\n  const activeFiltersCount = useMemo(() => \n    selectedSizes.size + (priceRange[0] > 0 || priceRange[1] < 200 ? 1 : 0) + (selectedCategory !== \"todos\" ? 1 : 0),\n    [selectedSizes.size, priceRange, selectedCategory]\n  );\n\n  const sortOptions = [\n    { value: \"relevancia\", label: \"relev√¢ncia\" },\n    { value: \"preco_asc\", label: \"menor pre√ßo\" },\n    { value: \"preco_desc\", label: \"maior pre√ßo\" },\n    { value: \"novo\", label: \"mais novo\" },\n  ];\n\n  const categoryOptions = [\n    { value: \"todos\", label: \"todos\" },\n    { value: \"clothing\", label: \"roupas\" },\n    { value: \"accessory\", label: \"acess√≥rios\" },\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Apple-style sticky toolbar */}\n      <div className=\"sticky top-0 z-30 bg-background/80 backdrop-blur-xl\">\n        <div className=\"max-w-7xl mx-auto px-4 md:px-8\">\n          {/* Main bar */}\n          <div className=\"flex items-center justify-between h-14 gap-4\">\n            {/* Left: sort + active filters */}\n            <div className=\"flex items-center gap-3 min-w-0 overflow-x-auto no-scrollbar\">\n              <Select value={sortBy} onValueChange={setSortBy}>\n                <SelectTrigger\n                  className=\"w-auto h-8 px-4 rounded-full border-0 bg-muted/60 text-[13px] font-medium text-muted-foreground gap-1.5 shadow-none focus:ring-0 shrink-0\"\n                  data-testid=\"select-sort\"\n                >\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent align=\"start\">\n                  {sortOptions.map(opt => (\n                    <SelectItem key={opt.value} value={opt.value} className=\"text-[13px] lowercase\">\n                      {opt.label}\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              {activeFiltersCount > 0 && (\n                <div className=\"flex items-center gap-1.5 shrink-0\">\n                  {Array.from(selectedSizes).map(size => (\n                    <button\n                      key={size}\n                      onClick={() => toggleSize(size)}\n                      className=\"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-foreground text-background text-[11px] font-medium transition-colors\"\n                      data-testid={`badge-active-size-${size}`}\n                    >\n                      {size}\n                      <X className=\"h-3 w-3 opacity-60\" />\n                    </button>\n                  ))}\n                  {selectedCategory !== \"todos\" && (\n                    <button\n                      onClick={() => setSelectedCategory(\"todos\")}\n                      className=\"inline-flex items-center gap-1 h-7 px-2.5 rounded-full bg-foreground text-background text-[11px] font-medium transition-colors\"\n                    >\n                      {categoryOptions.find(c => c.value === selectedCategory)?.label}\n                      <X className=\"h-3 w-3 opacity-60\" />\n                    </button>\n                  )}\n                  <button\n                    onClick={clearFilters}\n                    className=\"text-[11px] text-muted-foreground/60 ml-1 shrink-0\"\n                    data-testid=\"button-clear-filters\"\n                  >\n                    limpar\n                  </button>\n                </div>\n              )}\n            </div>\n\n            {/* Right: actions */}\n            <div className=\"flex items-center gap-1 shrink-0\">\n              <button\n                onClick={() => { setShowSearch(!showSearch); if (showFilters) setShowFilters(false); }}\n                className={`h-8 w-8 rounded-full flex items-center justify-center transition-colors ${\n                  showSearch ? 'bg-foreground text-background' : 'text-muted-foreground'\n                }`}\n                data-testid=\"button-toggle-search\"\n              >\n                <Search className=\"h-[15px] w-[15px]\" />\n              </button>\n              <button\n                onClick={() => { setShowFilters(!showFilters); if (showSearch) setShowSearch(false); }}\n                className={`relative h-8 w-8 rounded-full flex items-center justify-center transition-colors ${\n                  showFilters ? 'bg-foreground text-background' : 'text-muted-foreground'\n                }`}\n                data-testid=\"button-toggle-filters\"\n              >\n                <SlidersHorizontal className=\"h-[15px] w-[15px]\" />\n                {activeFiltersCount > 0 && !showFilters && (\n                  <span className=\"absolute -top-0.5 -right-0.5 w-[14px] h-[14px] bg-blue-500 text-white text-[9px] rounded-full flex items-center justify-center font-semibold\">\n                    {activeFiltersCount}\n                  </span>\n                )}\n              </button>\n            </div>\n          </div>\n\n          {/* Search - Apple-style slide down */}\n          {showSearch && (\n            <div className=\"pb-3\">\n              <div className=\"relative\">\n                <Search className=\"absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/50\" />\n                <Input\n                  placeholder=\"buscar produtos...\"\n                  value={searchTerm}\n                  onChange={(e) => setSearchTerm(e.target.value)}\n                  className=\"pl-10 h-10 bg-muted/40 border-0 rounded-xl text-[15px] focus-visible:ring-1 focus-visible:ring-foreground/10\"\n                  autoFocus\n                  data-testid=\"input-search\"\n                />\n                {searchTerm && (\n                  <button\n                    onClick={() => setSearchTerm(\"\")}\n                    className=\"absolute right-3 top-1/2 -translate-y-1/2 h-5 w-5 rounded-full bg-muted-foreground/20 flex items-center justify-center\"\n                  >\n                    <X className=\"h-3 w-3 text-muted-foreground\" />\n                  </button>\n                )}\n              </div>\n            </div>\n          )}\n\n          {/* Filters panel - Apple-style */}\n          {showFilters && (\n            <div className=\"pb-5 pt-1 space-y-5\" data-testid=\"card-filters\">\n              {/* Category */}\n              <div>\n                <p className=\"text-[11px] text-muted-foreground/60 uppercase tracking-widest mb-2.5 font-medium\">tipo</p>\n                <div className=\"flex gap-1.5\">\n                  {categoryOptions.map(cat => (\n                    <button\n                      key={cat.value}\n                      onClick={() => setSelectedCategory(cat.value)}\n                      className={`h-8 px-4 rounded-full text-[13px] font-medium transition-all ${\n                        selectedCategory === cat.value\n                          ? 'bg-foreground text-background'\n                          : 'bg-muted/60 text-muted-foreground'\n                      }`}\n                      data-testid={`button-category-${cat.value}`}\n                    >\n                      {cat.label}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Sizes */}\n              <div>\n                <p className=\"text-[11px] text-muted-foreground/60 uppercase tracking-widest mb-2.5 font-medium\">tamanho</p>\n                <div className=\"flex gap-1.5\">\n                  {sizeOptions.map(size => (\n                    <button\n                      key={size}\n                      onClick={() => toggleSize(size)}\n                      className={`h-8 w-10 rounded-full text-[13px] font-medium transition-all ${\n                        selectedSizes.has(size)\n                          ? 'bg-foreground text-background'\n                          : 'bg-muted/60 text-muted-foreground'\n                      }`}\n                      data-testid={`button-size-${size}`}\n                    >\n                      {size}\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Price */}\n              <div>\n                <p className=\"text-[11px] text-muted-foreground/60 uppercase tracking-widest mb-2.5 font-medium\">pre√ßo</p>\n                <div className=\"flex items-center gap-2 max-w-xs\">\n                  <div className=\"relative flex-1\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-[13px] text-muted-foreground/40\">R$</span>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"0\"\n                      value={priceRange[0] || \"\"}\n                      onChange={(e) => handleMinPriceChange(e.target.value)}\n                      min={0}\n                      className=\"pl-9 h-9 bg-muted/40 border-0 rounded-xl text-[13px] focus-visible:ring-1 focus-visible:ring-foreground/10\"\n                      data-testid=\"input-price-min\"\n                    />\n                  </div>\n                  <span className=\"text-muted-foreground/30 text-xs\">‚Äî</span>\n                  <div className=\"relative flex-1\">\n                    <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-[13px] text-muted-foreground/40\">R$</span>\n                    <Input\n                      type=\"number\"\n                      placeholder=\"200\"\n                      value={priceRange[1] >= 200 ? \"\" : priceRange[1]}\n                      onChange={(e) => handleMaxPriceChange(e.target.value)}\n                      min={0}\n                      className=\"pl-9 h-9 bg-muted/40 border-0 rounded-xl text-[13px] focus-visible:ring-1 focus-visible:ring-foreground/10\"\n                      data-testid=\"input-price-max\"\n                    />\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n        <div className=\"h-px bg-border/40\" />\n      </div>\n\n      {/* Products Grid */}\n      <div className=\"max-w-7xl mx-auto px-4 md:px-8 py-8 md:py-12\">\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6\">\n          {isLoading ? (\n            <>\n              {[...Array(8)].map((_, i) => (\n                <ProductSkeleton key={i} />\n              ))}\n            </>\n          ) : (\n            filteredProducts.map((product) => (\n              <ProductCard\n                key={product.id}\n                {...product}\n                isFavorite={isFavorito(product.id)}\n                onFavoriteToggle={(id, productInfo) => {\n                  if (!isFavorito(id)) {\n                    triggerFavoritoToast({ id, ...productInfo });\n                  }\n                  toggleFavorito(id);\n                }}\n                showInstallments={false}\n              />\n            ))\n          )}\n        </div>\n\n        {!isLoading && filteredProducts.length === 0 && (\n          <div className=\"text-center py-24\">\n            <p className=\"text-2xl font-light text-muted-foreground mb-2\">nenhum resultado</p>\n            <p className=\"text-sm text-muted-foreground/60 mb-6\">tente ajustar seus filtros</p>\n            <Button variant=\"outline\" onClick={clearFilters} data-testid=\"button-clear-no-results\">\n              limpar filtros\n            </Button>\n          </div>\n        )}\n      </div>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":15372,"size_tokens":null},"client/src/App.tsx":{"content":"import { Switch, Route, useLocation } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { MochilaProvider } from \"@/contexts/MochilaContext\";\nimport { FavoritosProvider } from \"@/contexts/FavoritosContext\";\nimport { PixelProvider } from \"@/components/PixelProvider\";\nimport MochilaDrawer from \"@/components/MochilaDrawer\";\nimport FavoritosDrawer from \"@/components/FavoritosDrawer\";\nimport Header from \"@/components/Header\";\nimport { useEffect, lazy, Suspense } from \"react\";\nimport Home from \"@/pages/Home\";\nconst ProductsPage = lazy(() => import(\"@/pages/ProductsPage\"));\nconst ProductPage = lazy(() => import(\"@/pages/ProductPage\"));\nconst Checkout = lazy(() => import(\"@/pages/Checkout\"));\nconst CheckoutSuccess = lazy(() => import(\"@/pages/CheckoutSuccess\"));\nconst CheckoutPending = lazy(() => import(\"@/pages/CheckoutPending\"));\nconst CheckoutFailure = lazy(() => import(\"@/pages/CheckoutFailure\"));\n// P√°ginas de retorno do Mercado Pago\nconst PaymentSuccess = lazy(() => import(\"@/pages/PaymentSuccess\"));\nconst PaymentPending = lazy(() => import(\"@/pages/PaymentPending\"));\nconst PaymentFailure = lazy(() => import(\"@/pages/PaymentFailure\"));\nconst OrderTracking = lazy(() => import(\"@/pages/OrderTracking\"));\nconst TrocasDevolucoes = lazy(() => import(\"@/pages/TrocasDevolucoes\"));\nconst Privacidade = lazy(() => import(\"@/pages/Privacidade\"));\nconst Termos = lazy(() => import(\"@/pages/Termos\"));\nconst FAQ = lazy(() => import(\"@/pages/FAQ\"));\nconst About = lazy(() => import(\"@/pages/About\"));\nconst AdminLogin = lazy(() => import(\"@/pages/AdminLogin\"));\nconst Admin = lazy(() => import(\"@/pages/Admin\"));\nconst LeleliPage = lazy(() => import(\"@/pages/LeleliPage\"));\nconst NotFound = lazy(() => import(\"@/pages/not-found\"));\nimport CookieBanner from \"@/components/CookieBanner\";\n\nfunction ScrollToTop() {\n  const [location] = useLocation();\n\n  useEffect(() => {\n    window.scrollTo(0, 0);\n  }, [location]);\n\n  return null;\n}\n\nfunction PageLoader() {\n  return (\n    <div className=\"flex items-center justify-center min-h-[60vh]\">\n      <div className=\"animate-pulse space-y-4\">\n        <div className=\"h-8 w-64 bg-muted rounded\" />\n        <div className=\"h-4 w-48 bg-muted rounded\" />\n      </div>\n    </div>\n  );\n}\n\nfunction Router() {\n  const [location] = useLocation();\n  const isAdminRoute = location.startsWith(\"/admin\");\n\n  return (\n    <>\n      <ScrollToTop />\n      <Suspense fallback={<PageLoader />}>\n        <Switch>\n          <Route path=\"/admin/login\" component={AdminLogin} />\n          <Route path=\"/admin\" component={Admin} />\n          <Route path=\"/\" component={Home} />\n          <Route path=\"/produtos\" component={ProductsPage} />\n          <Route path=\"/produto/:id\" component={ProductPage} />\n          <Route path=\"/checkout\" component={Checkout} />\n          <Route path=\"/checkout/success\" component={CheckoutSuccess} />\n          <Route path=\"/checkout/pending\" component={CheckoutPending} />\n          <Route path=\"/checkout/failure\" component={CheckoutFailure} />\n          {/* Rotas de retorno do Mercado Pago */}\n          <Route path=\"/pagamento/sucesso\" component={PaymentSuccess} />\n          <Route path=\"/pagamento/pendente\" component={PaymentPending} />\n          <Route path=\"/pagamento/falha\" component={PaymentFailure} />\n          <Route path=\"/rastreio\" component={OrderTracking} />\n          <Route path=\"/trocas-devolucoes\" component={TrocasDevolucoes} />\n          <Route path=\"/privacidade\" component={Privacidade} />\n          <Route path=\"/termos\" component={Termos} />\n          <Route path=\"/faq\" component={FAQ} />\n          <Route path=\"/sobre\" component={About} />\n          <Route path=\"/leleli\" component={LeleliPage} />\n          <Route path=\"/:id\" component={ProductPage} />\n          <Route component={NotFound} />\n        </Switch>\n      </Suspense>\n    </>\n  );\n}\n\nfunction App() {\n  const [location] = useLocation();\n\n  useEffect(() => {\n    const stored = localStorage.getItem('theme');\n    const theme = stored || 'dark';\n    document.documentElement.classList.toggle('dark', theme === 'dark');\n    document.documentElement.style.colorScheme = theme as string;\n    document.body.style.backgroundColor = theme === 'dark' ? '#141517' : '#fafafa';\n    if (!stored) {\n      localStorage.setItem('theme', 'dark');\n    }\n  }, []);\n\n  const isAdminRoute = location.startsWith(\"/admin\");\n  const isCheckoutRoute = location.startsWith(\"/checkout\");\n\n  const isLeleliRoute = location === \"/leleli\";\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      {/* PixelProvider fica fora do Router para rastrear navega√ß√£o entre p√°ginas */}\n      <PixelProvider>\n        <TooltipProvider>\n          <FavoritosProvider>\n            <MochilaProvider>\n              <Toaster />\n              {!isAdminRoute && !isCheckoutRoute && !isLeleliRoute && <Header />}\n              <Router />\n              {!isAdminRoute && !isCheckoutRoute && !isLeleliRoute && (\n                <>\n                  <MochilaDrawer />\n                  <FavoritosDrawer />\n                  <CookieBanner />\n                </>\n              )}\n            </MochilaProvider>\n          </FavoritosProvider>\n        </TooltipProvider>\n      </PixelProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","path":null,"size_bytes":5449,"size_tokens":null},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","path":null,"size_bytes":8605,"size_tokens":null},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  // Whitespace-nowrap: Badges should never wrap.\n  \"whitespace-nowrap inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\" +\n  \" hover-elevate \" ,\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow-xs\",\n        secondary: \"border-transparent bg-secondary text-secondary-foreground\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow-xs\",\n\n        outline: \" border [border-color:var(--badge-outline)] shadow-xs\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  },\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  );\n}\n\nexport { Badge, badgeVariants }\n","path":null,"size_bytes":1202,"size_tokens":null},"client/src/components/DailyVerse.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\n\ninterface Verse {\n  id: string;\n  text: string;\n  reference: string;\n}\n\nexport default function DailyVerse() {\n  const { data: verseData, isLoading } = useQuery<{ verse: Verse | null }>({\n    queryKey: ['/api/verse'],\n  });\n\n  if (isLoading || !verseData?.verse) {\n    return (\n      <Card className=\"max-w-4xl mx-auto p-12 md:p-16 lg:p-20\" data-testid=\"card-daily-verse\">\n        <div className=\"text-center space-y-8\">\n          <div className=\"flex items-center justify-center gap-4\">\n            <Separator className=\"w-12 md:w-20\" />\n            <span className=\"text-xs uppercase tracking-[0.2em] text-muted-foreground font-light\">\n              assim diz o soberano\n            </span>\n            <Separator className=\"w-12 md:w-20\" />\n          </div>\n          <div className=\"h-32 flex items-center justify-center\">\n            <div className=\"animate-pulse text-muted-foreground\">carregando...</div>\n          </div>\n        </div>\n      </Card>\n    );\n  }\n\n  const currentVerse = verseData?.verse;\n\n  return (\n    <Card className=\"max-w-4xl mx-auto p-12 md:p-16 lg:p-20\" data-testid=\"card-daily-verse\">\n      <div className=\"text-center flex flex-col items-center justify-center\">\n        <div className=\"flex items-center justify-center gap-4\">\n          <Separator className=\"w-12 md:w-20\" />\n          <span className=\"text-xs uppercase tracking-[0.2em] text-muted-foreground font-light\">\n            assim diz o soberano\n          </span>\n          <Separator className=\"w-12 md:w-20\" />\n        </div>\n        \n        <blockquote className=\"text-2xl md:text-3xl lg:text-4xl font-light lowercase text-foreground leading-relaxed px-4 md:px-8 py-8\">\n          \"{currentVerse.text}\"\n        </blockquote>\n        \n        <cite className=\"block text-sm uppercase tracking-[0.15em] text-muted-foreground font-light\">\n          {currentVerse.reference}\n        </cite>\n      </div>\n    </Card>\n  );\n}\n","path":null,"size_bytes":2065,"size_tokens":null},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","path":null,"size_bytes":3848,"size_tokens":null},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","path":null,"size_bytes":1251,"size_tokens":null},"postcss.config.js":{"content":"import tailwindcss from 'tailwindcss';\nimport autoprefixer from 'autoprefixer';\n\nexport default {\n  plugins: [\n    tailwindcss,\n    autoprefixer,\n  ],\n};\n","path":null,"size_bytes":154,"size_tokens":null},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { eq, desc } from \"drizzle-orm\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { orders } from \"@shared/schema\";\nimport { rateLimit } from 'express-rate-limit';\nimport { cache, CACHE_TTL } from \"./cache\";\nimport { \n  insertProductSchema, \n  insertReviewSchema,\n  insertReviewImageSchema,\n  insertReviewLikeSchema,\n  insertReviewQASchema,\n  insertProductImageSchema,\n  insertAdminProductReviewSchema,\n  insertProductCouponSchema,\n  insertGlobalCouponSchema,\n  insertSiteBannerSchema,\n  insertContentCardSchema,\n  insertSiteContentSchema,\n  insertSiteSettingSchema,\n  insertSiteVerseSchema,\n  insertFaqSchema,\n  insertProductMeasurementFieldSchema,\n  insertProductSizeMeasurementSchema,\n  insertNewsletterSubscriberSchema,\n  insertNewsletterSettingsSchema,\n  insertTrackingPixelsSchema,\n  insertEmailTemplateSchema\n} from \"@shared/schema\";\nimport { requireAdmin, loginAdmin, setAdminSession, clearAdminSession } from \"./admin-middleware\";\nimport { invalidateSEOCache, writeHardcodedSEO } from \"./seo-inject\";\nimport bcrypt from \"bcrypt\";\nimport multer from \"multer\";\nimport sharp from \"sharp\";\nimport path from \"path\";\nimport fs from \"fs/promises\";\nimport { randomUUID } from \"crypto\";\n\n// Newsletter rate limiter: max 3 requests per IP per 15 minutes\nconst newsletterLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 3,\n  message: { error: \"muitos cadastros realizados. tente novamente mais tarde.\" },\n  standardHeaders: true,\n  legacyHeaders: false,\n});\n\n// Configure multer for file uploads\nconst upload = multer({\n  storage: multer.memoryStorage(),\n  limits: {\n    fileSize: 10 * 1024 * 1024, // 10MB limit\n  },\n  fileFilter: (req, file, cb) => {\n    const allowedMimes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];\n    if (allowedMimes.includes(file.mimetype)) {\n      cb(null, true);\n    } else {\n      cb(new Error('Tipo de arquivo inv√°lido. Use JPEG, PNG, GIF ou WebP.'));\n    }\n  }\n});\n\nasync function initializeAdminUser() {\n  // ‚ùå REMOVED: Temporary admin user with weak credentials\n  // Admin users must be created securely via database management tools\n  console.log('‚úÖ Admin initialization: Use secure credentials only');\n}\n\nimport checkoutRoutes from \"./checkout-routes\";\nimport { sendOrderConfirmationEmail, sendTrackingCodeEmail, sendNewsletterWelcomeEmail } from \"./email\";\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  await initializeAdminUser();\n\n  // Newsletter routes\n  app.get(\"/api/newsletter/settings\", async (_req, res) => {\n    try {\n      let settings = await storage.getNewsletterSettings();\n      if (!settings) {\n        settings = await storage.upsertNewsletterSettings({\n          title: \"fique por dentro\",\n          description: \"inscreva-se para receber novidades, lan√ßamentos e conte√∫dos exclusivos.\",\n          buttonText: \"inscrever\"\n        });\n      }\n      res.json(settings);\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√µes da newsletter\" });\n    }\n  });\n\n  app.post(\"/api/newsletter/subscribe\", newsletterLimiter, async (req, res) => {\n    try {\n      console.log(\"üì• [NEWSLETTER] Tentativa de cadastro:\", req.body);\n      const data = insertNewsletterSubscriberSchema.parse(req.body);\n      const ip = req.ip || req.headers['x-forwarded-for']?.toString() || \"unknown\";\n      \n      const subscriber = await storage.addNewsletterSubscriber({\n        ...data,\n        ipAddress: ip\n      });\n      console.log(\"‚úÖ [NEWSLETTER] Cadastro realizado:\", subscriber.email);\n\n      // Send welcome email (non-blocking)\n      try {\n        await sendNewsletterWelcomeEmail(subscriber.email);\n        console.log(\"‚úÖ [EMAIL] Email de boas-vindas newsletter enviado para\", subscriber.email);\n      } catch (emailError) {\n        console.error(\"‚ùå [EMAIL] Falha ao enviar email de boas-vindas:\", emailError);\n      }\n\n      res.json(subscriber);\n    } catch (error: any) {\n      console.error(\"‚ùå [NEWSLETTER] Erro no cadastro:\", error);\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ \n          error: \"dados inv√°lidos.\", \n          details: error.errors.map((e: any) => e.message) \n        });\n      }\n      if (error.code === '23505') { // Unique violation\n        return res.status(400).json({ error: \"este e-mail j√° est√° cadastrado.\" });\n      }\n      res.status(400).json({ error: \"e-mail inv√°lido ou erro no cadastro.\" });\n    }\n  });\n\n  // Protected Admin Newsletter routes\n  app.get(\"/api/admin/newsletter/subscribers\", requireAdmin, async (req, res) => {\n    try {\n      const subscribers = await storage.getNewsletterSubscribers();\n      res.json({ subscribers });\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar inscritos\" });\n    }\n  });\n\n  app.get(\"/api/admin/orders\", requireAdmin, async (req, res) => {\n    try {\n      const { search, status, filter, sortField, sortDirection, includeAll } = req.query;\n      console.log(\"üì¶ [ADMIN_ORDERS] Buscando pedidos com filtros:\", { search, status, filter, sortField, sortDirection, includeAll });\n      \n      if (includeAll === 'true') {\n        const allOrders = await db.select().from(orders).orderBy(desc(orders.createdAt));\n        return res.json(allOrders);\n      }\n      \n      const result = await storage.getOrders({\n        search: search as string,\n        status: status as string,\n        filter: filter as 'all' | 'archived' | 'deleted' | 'shipped' | 'delivered' | 'refunded',\n        sortField: sortField as string,\n        sortDirection: sortDirection as 'asc' | 'desc'\n      });\n      \n      res.json(result);\n    } catch (error) {\n      console.error(\"Get orders error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/newsletter/subscribers/:id\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const { status } = req.body;\n      const updated = await storage.updateNewsletterSubscriberStatus(id, status);\n      res.json(updated);\n    } catch (error) {\n      res.status(400).json({ error: \"erro ao atualizar status\" });\n    }\n  });\n\n  app.delete(\"/api/admin/newsletter/subscribers/:id\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      await storage.deleteNewsletterSubscriber(id);\n      res.status(204).end();\n    } catch (error) {\n      res.status(400).json({ error: \"erro ao deletar inscrito\" });\n    }\n  });\n\n  app.patch(\"/api/admin/newsletter/settings\", requireAdmin, async (req, res) => {\n    try {\n      const data = insertNewsletterSettingsSchema.partial().parse(req.body);\n      const settings = await storage.upsertNewsletterSettings(data);\n      res.json(settings);\n    } catch (error) {\n      res.status(400).json({ error: \"erro ao atualizar configura√ß√µes\" });\n    }\n  });\n\n  // ===== ROTAS DE TRACKING PIXELS =====\n  \n  // Rota P√öBLICA para buscar configura√ß√£o dos pixels de rastreamento\n  // Usada pelo frontend para carregar os scripts de tracking (Facebook Pixel, Google Analytics, etc.)\n  app.get(\"/api/tracking-pixels\", async (_req, res) => {\n    try {\n      const config = await storage.getTrackingPixels();\n      \n      // Se n√£o existir configura√ß√£o, retorna objeto vazio com valores padr√£o\n      if (!config) {\n        return res.json({\n          facebookPixelId: null,\n          facebookPixelEnabled: false,\n          facebookTestEventCode: null,\n          googleAdsConversionId: null,\n          googleAdsConversionLabel: null,\n          googleAdsEnabled: false,\n          googleAnalyticsId: null,\n          googleAnalyticsEnabled: false,\n          tiktokPixelId: null,\n          tiktokPixelEnabled: false,\n          headerScripts: null,\n          bodyScripts: null,\n          mercadoPagoTrackingEnabled: true\n        });\n      }\n      \n      res.json(config);\n    } catch (error) {\n      console.error(\"‚ùå [TRACKING_PIXELS] Erro ao buscar configura√ß√£o:\", error);\n      res.status(500).json({ error: \"Erro ao buscar configura√ß√£o de tracking\" });\n    }\n  });\n\n  // Rota PROTEGIDA (admin) para atualizar configura√ß√£o dos pixels de rastreamento\n  // Apenas administradores podem alterar os IDs dos pixels e scripts\n  app.put(\"/api/tracking-pixels\", requireAdmin, async (req, res) => {\n    try {\n      // Valida os dados de entrada usando o schema Zod\n      const data = insertTrackingPixelsSchema.partial().parse(req.body);\n      \n      // Atualiza ou cria a configura√ß√£o no banco de dados\n      const config = await storage.updateTrackingPixels(data);\n      \n      console.log(\"‚úÖ [TRACKING_PIXELS] Configura√ß√£o atualizada via API\");\n      res.json(config);\n    } catch (error: any) {\n      console.error(\"‚ùå [TRACKING_PIXELS] Erro ao atualizar configura√ß√£o:\", error);\n      \n      // Trata erros de valida√ß√£o do Zod\n      if (error.name === 'ZodError') {\n        return res.status(400).json({ \n          error: \"Dados inv√°lidos\",\n          details: error.errors.map((e: any) => e.message)\n        });\n      }\n      \n      res.status(500).json({ error: \"Erro ao atualizar configura√ß√£o de tracking\" });\n    }\n  });\n\n  // ===== COOKIE SETTINGS ROUTES =====\n  app.get(\"/api/cookie-settings\", async (_req, res) => {\n    try {\n      const settings = await storage.getCookieSettings();\n      res.json(settings || { enabled: true, title: \"usamos cookies\", description: \"utilizamos cookies para melhorar sua experi√™ncia de navega√ß√£o, personalizar conte√∫do e analisar nosso tr√°fego.\", buttonAcceptText: \"aceitar todos\", buttonRejectText: \"recusar\", buttonCustomizeText: \"personalizar\", showCustomizeButton: false, privacyPolicyUrl: \"/privacidade\" });\n    } catch (error) {\n      console.error(\"Cookie settings error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar configura√ß√µes de cookies\" });\n    }\n  });\n\n  app.put(\"/api/admin/cookie-settings\", requireAdmin, async (req, res) => {\n    try {\n      const { enabled, title, description, buttonAcceptText, buttonRejectText, buttonCustomizeText, showCustomizeButton, privacyPolicyUrl } = req.body;\n      const settings = await storage.updateCookieSettings({ enabled, title, description, buttonAcceptText, buttonRejectText, buttonCustomizeText, showCustomizeButton, privacyPolicyUrl });\n      res.json(settings);\n    } catch (error) {\n      console.error(\"Update cookie settings error:\", error);\n      res.status(500).json({ error: \"Erro ao atualizar configura√ß√µes de cookies\" });\n    }\n  });\n\n  // ===== EMAIL TEMPLATE ROUTES =====\n  \n  app.get(\"/api/admin/email-templates\", requireAdmin, async (_req, res) => {\n    try {\n      const templates = await storage.getEmailTemplates();\n      res.json({ templates });\n    } catch (error) {\n      console.error(\"Get email templates error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar templates de email\" });\n    }\n  });\n\n  app.get(\"/api/admin/email-templates/:key\", requireAdmin, async (req, res) => {\n    try {\n      const template = await storage.getEmailTemplateByKey(req.params.key);\n      if (!template) {\n        return res.status(404).json({ error: \"Template n√£o encontrado\" });\n      }\n      res.json(template);\n    } catch (error) {\n      console.error(\"Get email template error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar template\" });\n    }\n  });\n\n  app.put(\"/api/admin/email-templates/:key\", requireAdmin, async (req, res) => {\n    try {\n      const { name, subject, htmlContent, enabled } = req.body;\n      const template = await storage.upsertEmailTemplate(req.params.key, {\n        name,\n        subject,\n        htmlContent,\n        enabled,\n      });\n      res.json(template);\n    } catch (error) {\n      console.error(\"Update email template error:\", error);\n      res.status(500).json({ error: \"Erro ao atualizar template\" });\n    }\n  });\n\n  app.post(\"/api/admin/email-templates/:key/test\", requireAdmin, async (req, res) => {\n    try {\n      const { to } = req.body;\n      if (!to) {\n        return res.status(400).json({ error: \"Email de destino √© obrigat√≥rio\" });\n      }\n      \n      const template = await storage.getEmailTemplateByKey(req.params.key);\n      if (!template) {\n        return res.status(404).json({ error: \"Template n√£o encontrado\" });\n      }\n\n      const { sendEmail, replaceTemplateVariables } = await import(\"./email\");\n      \n      const testVariables: Record<string, string> = {\n        nome: \"Jo√£o da Silva\",\n        email: \"joao@exemplo.com\",\n        cpf: \"123.456.789-00\",\n        telefone: \"(11) 99999-9999\",\n        endereco: \"Rua Exemplo, 123\\nCentro\\nS√£o Paulo - SP\\nCEP: 01001-000\",\n        numero_pedido: \"OUDLA-20250212-0001\",\n        subtotal: \"R$ 199,90\",\n        frete: \"R$ 19,90\",\n        total: \"R$ 219,80\",\n        metodo_pagamento: \"Cart√£o de Cr√©dito\",\n        codigo_rastreio: \"BR123456789BR\",\n        data_pedido: new Date().toLocaleDateString(\"pt-BR\"),\n        itens: '<table style=\"width: 100%; border-collapse: collapse;\"><thead><tr style=\"border-bottom: 2px solid #ddd;\"><th style=\"padding: 8px 0; text-align: left;\">Produto</th><th style=\"padding: 8px 0; text-align: center;\">Qtd</th><th style=\"padding: 8px 0; text-align: right;\">Pre√ßo</th><th style=\"padding: 8px 0; text-align: right;\">Subtotal</th></tr></thead><tbody><tr style=\"border-bottom: 1px solid #eee;\"><td style=\"padding: 12px 0;\"><strong>Camiseta OUDLA Premium</strong><br/><span style=\"color: #666; font-size: 13px;\">Tam: M | Cor: Preto</span></td><td style=\"padding: 12px 0; text-align: center;\">1</td><td style=\"padding: 12px 0; text-align: right;\">R$ 99,90</td><td style=\"padding: 12px 0; text-align: right; font-weight: bold;\">R$ 99,90</td></tr><tr style=\"border-bottom: 1px solid #eee;\"><td style=\"padding: 12px 0;\"><strong>Camiseta OUDLA Classic</strong><br/><span style=\"color: #666; font-size: 13px;\">Tam: G | Cor: Branco</span></td><td style=\"padding: 12px 0; text-align: center;\">1</td><td style=\"padding: 12px 0; text-align: right;\">R$ 99,90</td><td style=\"padding: 12px 0; text-align: right; font-weight: bold;\">R$ 99,90</td></tr></tbody></table>',\n      };\n\n      const subject = replaceTemplateVariables(template.subject, testVariables);\n      const html = replaceTemplateVariables(template.htmlContent, testVariables);\n      \n      const success = await sendEmail(to, `[TESTE] ${subject}`, html);\n      \n      if (success) {\n        res.json({ success: true, message: \"Email de teste enviado com sucesso\" });\n      } else {\n        res.status(500).json({ error: \"Falha ao enviar email de teste\" });\n      }\n    } catch (error) {\n      console.error(\"Test email error:\", error);\n      res.status(500).json({ error: \"Erro ao enviar email de teste\" });\n    }\n  });\n  \n  // Public banner route\n  app.get(\"/api/banners\", async (req, res) => {\n    try {\n      const cacheKey = \"banners:active\";\n      const cached = cache.get<{ banners: any[] }>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const allBanners = await storage.getSiteBanners();\n      const banners = allBanners.filter(b => b.isActive);\n      const response = { banners };\n      cache.set(cacheKey, response, CACHE_TTL.BANNERS);\n      res.json(response);\n    } catch (error) {\n      console.error(\"Get banners error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n  \n  // Product routes\n  app.get(\"/api/products\", async (req, res) => {\n    try {\n      const cacheKey = \"products:list\";\n      const cached = cache.get<{ products: any[] }>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const productsWithImages = await storage.getProductsWithPresentationImages();\n      const response = { products: productsWithImages };\n      cache.set(cacheKey, response, CACHE_TTL.PRODUCTS);\n      res.json(response);\n    } catch (error) {\n      console.error(\"Get products error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin route to get all products (for selects in forms) - includes drafts\n  app.get(\"/api/admin/products\", requireAdmin, async (req, res) => {\n    try {\n      const products = await storage.getAllProducts();\n      \n      // Add first presentation image to each product (for product selectors)\n      const productsWithImages = await Promise.all(\n        products.map(async (product) => {\n          const images = await storage.getProductPresentationImages(product.id);\n          return {\n            ...product,\n            imageUrl: images.length > 0 ? images[0].imageUrl : null\n          };\n        })\n      );\n      \n      res.json({ products: productsWithImages });\n    } catch (error) {\n      console.error(\"Get admin products error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin route to get single product by ID (includes drafts)\n  app.get(\"/api/admin/products/:id\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      const product = await storage.getProductById(id);\n      \n      if (!product) {\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n\n      const images = await storage.getProductImages(product.id);\n      res.json({ product: { ...product, images } });\n    } catch (error) {\n      console.error(\"Get admin product error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/products/:id\", async (req, res) => {\n    try {\n      const { id } = req.params;\n      console.log(`üîç [GET_PRODUCT] Buscando produto: \"${id}\"`);\n      \n      // Get all products to check for Slug or SKU match\n      const allProducts = await storage.getProducts();\n      \n      // 1. Try by Slug (highest priority)\n      let product = allProducts.find(p => p.slug?.trim().toLowerCase() === id.trim().toLowerCase());\n      \n      // 2. Try by SKU (fallback)\n      if (!product) {\n        product = allProducts.find(p => p.sku?.trim().toLowerCase() === id.trim().toLowerCase());\n      }\n      \n      // 3. Try by internal ID (UUID fallback)\n      if (!product) {\n        const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n        if (uuidRegex.test(id)) {\n          product = await storage.getProduct(id);\n        }\n      }\n      \n      if (!product) {\n        console.log(`‚ùå [GET_PRODUCT] Produto n√£o encontrado para o ID: \"${id}\"`);\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n\n      const images = await storage.getProductImages(product.id);\n      res.json({ product: { ...product, images } });\n    } catch (error) {\n      console.error(\"Get product error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Product creation\n  app.post(\"/api/products\", async (req, res) => {\n    try {\n      const productData = insertProductSchema.parse(req.body);\n      const product = await storage.createProduct(productData);\n      res.status(201).json({ product });\n    } catch (error) {\n      console.error(\"Create product error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/products/:id/images\", async (req, res) => {\n    try {\n      const imageData = insertProductImageSchema.parse({\n        ...req.body,\n        productId: req.params.id\n      });\n      \n      const image = await storage.addProductImage(imageData);\n      res.status(201).json({ image });\n    } catch (error) {\n      console.error(\"Add product image error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n\n\n  // Review routes\n  app.get(\"/api/products/:productId/reviews\", async (req, res) => {\n    try {\n      const reviews = await storage.getReviews(req.params.productId);\n      res.json({ reviews });\n    } catch (error) {\n      console.error(\"Get reviews error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/products/:productId/reviews\", async (req, res) => {\n    try {\n      const reviewData = insertReviewSchema.parse({\n        ...req.body,\n        productId: req.params.productId\n      });\n\n      const review = await storage.createReview(reviewData);\n      res.status(201).json({ review });\n    } catch (error) {\n      console.error(\"Create review error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/reviews/:reviewId/images\", async (req, res) => {\n    try {\n      const imageData = insertReviewImageSchema.parse({\n        ...req.body,\n        reviewId: req.params.reviewId\n      });\n      \n      const image = await storage.addReviewImage(imageData);\n      res.status(201).json({ image });\n    } catch (error) {\n      console.error(\"Add review image error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/reviews/:reviewId/like\", async (req, res) => {\n    try {\n      const likeData = insertReviewLikeSchema.parse({\n        ...req.body,\n        reviewId: req.params.reviewId\n      });\n      const like = await storage.likeReview(likeData);\n      res.status(201).json({ like });\n    } catch (error) {\n      console.error(\"Like review error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/reviews/:reviewId/like\", async (req, res) => {\n    try {\n      if (!req.body.userId) {\n        return res.status(400).json({ error: \"userId √© obrigat√≥rio\" });\n      }\n      const success = await storage.unlikeReview(req.body.userId, req.params.reviewId);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Unlike review error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/reviews/:reviewId/qa\", async (req, res) => {\n    try {\n      const qaData = insertReviewQASchema.parse({\n        ...req.body,\n        reviewId: req.params.reviewId\n      });\n\n      const qa = await storage.addReviewQA(qaData);\n      res.status(201).json({ qa });\n    } catch (error) {\n      console.error(\"Add review QA error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/reviews/:reviewId/qa\", async (req, res) => {\n    try {\n      const qa = await storage.getReviewQA(req.params.reviewId);\n      res.json({ qa });\n    } catch (error) {\n      console.error(\"Get review QA error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/settings/free_shipping\", async (req, res) => {\n    try {\n      const cacheKey = \"settings:free_shipping\";\n      const cached = cache.get<any>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const system = await storage.getSiteSettingByKey(\"free_shipping_system\");\n      const threshold = await storage.getSiteSettingByKey(\"free_shipping_threshold\");\n      const defaultShippingValue = await storage.getSiteSettingByKey(\"default_shipping_value\");\n      const minDays = await storage.getSiteSettingByKey(\"shipping_min_days\");\n      const maxDays = await storage.getSiteSettingByKey(\"shipping_max_days\");\n      const response = {\n        system: system?.value || \"threshold\",\n        threshold: threshold?.value || \"200\",\n        shippingValue: defaultShippingValue?.value || \"19.99\",\n        shippingMinDays: minDays?.value || \"9\",\n        shippingMaxDays: maxDays?.value || \"15\"\n      };\n      cache.set(cacheKey, response, CACHE_TTL.FREE_SHIPPING);\n      res.json(response);\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√µes de frete\" });\n    }\n  });\n\n  app.get(\"/api/settings/cta\", async (req, res) => {\n    try {\n      const cacheKey = \"settings:cta\";\n      const cached = cache.get<any>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const shippingLabel = await storage.getSiteSettingByKey(\"cta_shipping_label\");\n      const buyNowText = await storage.getSiteSettingByKey(\"cta_buy_now_text\");\n      const buyNowBg = await storage.getSiteSettingByKey(\"cta_buy_now_bg\");\n      const buyNowTextColor = await storage.getSiteSettingByKey(\"cta_buy_now_text_color\");\n      const addToCartText = await storage.getSiteSettingByKey(\"cta_add_to_cart_text\");\n      const addToCartBorder = await storage.getSiteSettingByKey(\"cta_add_to_cart_border\");\n      const addToCartTextColor = await storage.getSiteSettingByKey(\"cta_add_to_cart_text_color\");\n      const trustText = await storage.getSiteSettingByKey(\"cta_trust_text\");\n      const trustIcon = await storage.getSiteSettingByKey(\"cta_trust_icon\");\n      const ctaShippingFreeText = await storage.getSiteSettingByKey(\"cta_shipping_free_text\");\n      const ctaShippingPaidText = await storage.getSiteSettingByKey(\"cta_shipping_paid_text\");\n      const mochilaShippingFreeText = await storage.getSiteSettingByKey(\"mochila_shipping_free_text\");\n      const mochilaShippingPaidText = await storage.getSiteSettingByKey(\"mochila_shipping_paid_text\");\n      \n      const response = {\n        shippingLabel: shippingLabel?.value || \"frete padr√£o\",\n        buyNowText: buyNowText?.value || \"comprar agora\",\n        buyNowBg: buyNowBg?.value || \"#ffffff\",\n        buyNowTextColor: buyNowTextColor?.value || \"#1d1d1f\",\n        addToCartText: addToCartText?.value || \"adicionar √† mochila\",\n        addToCartBorder: addToCartBorder?.value || \"rgba(255,255,255,0.12)\",\n        addToCartTextColor: addToCartTextColor?.value || \"rgba(255,255,255,0.9)\",\n        trustText: trustText?.value || \"pagamento seguro via mercado pago\",\n        trustIcon: trustIcon?.value || \"lock\",\n        ctaShippingFreeText: ctaShippingFreeText?.value || \"chegar√° gr√°tis\",\n        ctaShippingPaidText: ctaShippingPaidText?.value || \"chegar√° por\",\n        mochilaShippingFreeText: mochilaShippingFreeText?.value || \"entrega gr√°tis\",\n        mochilaShippingPaidText: mochilaShippingPaidText?.value || \"entrega por\",\n      };\n      cache.set(cacheKey, response, 300000);\n      res.json(response);\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√µes de cta\" });\n    }\n  });\n\n  app.get(\"/api/settings/seo\", async (req, res) => {\n    try {\n      const cacheKey = \"settings:seo\";\n      const cached = cache.get<any>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n\n      const seoTitle = await storage.getSiteSettingByKey(\"seo_title\");\n      const seoDescription = await storage.getSiteSettingByKey(\"seo_description\");\n      const seoKeywords = await storage.getSiteSettingByKey(\"seo_keywords\");\n      const ogTitle = await storage.getSiteSettingByKey(\"seo_og_title\");\n      const ogDescription = await storage.getSiteSettingByKey(\"seo_og_description\");\n      const ogType = await storage.getSiteSettingByKey(\"seo_og_type\");\n      const ogSiteName = await storage.getSiteSettingByKey(\"seo_og_site_name\");\n\n      const response = {\n        seoTitle: seoTitle?.value || \"oudla\",\n        seoDescription: seoDescription?.value || \"oudla √© uma marca focada no p√∫blico jovem e descolado. camisetas premium com design minimalista e est√©tica sofisticada.\",\n        seoKeywords: seoKeywords?.value || \"oudla, camisetas, moda crist√£, roupas premium, moda jovem\",\n        ogTitle: ogTitle?.value || \"oudla\",\n        ogDescription: ogDescription?.value || \"camisetas de luxo para jovens descolados. design minimalista, qualidade premium.\",\n        ogType: ogType?.value || \"website\",\n        ogSiteName: ogSiteName?.value || \"oudla\",\n      };\n      cache.set(cacheKey, response, 300000);\n      res.json(response);\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√µes de seo\" });\n    }\n  });\n\n  // Admin authentication routes\n  app.post(\"/api/admin/login\", async (req, res) => {\n    try {\n      const { username, password } = req.body;\n      \n      if (!username || !password) {\n        return res.status(400).json({ error: \"Usu√°rio e senha s√£o obrigat√≥rios\" });\n      }\n\n      const isValid = await loginAdmin(username, password);\n      \n      if (!isValid) {\n        return res.status(401).json({ error: \"Credenciais inv√°lidas\" });\n      }\n\n      setAdminSession(req, username);\n      \n      // Force session to regenerate with new data\n      req.session.regenerate((err) => {\n        if (err) {\n          console.error(\"Session regenerate error:\", err);\n          return res.status(500).json({ error: \"Erro ao criar sess√£o\" });\n        }\n        \n        // Set admin session again after regeneration\n        setAdminSession(req, username);\n        \n        // Force save and send cookie\n        req.session.save((saveErr) => {\n          if (saveErr) {\n            console.error(\"Session save error:\", saveErr);\n            return res.status(500).json({ error: \"Erro ao salvar sess√£o\" });\n          }\n          \n          // Manually set cookie to ensure it's sent\n          res.cookie('connect.sid', req.sessionID, {\n            httpOnly: true,\n            maxAge: 60 * 60 * 1000, // 60 minutes\n            sameSite: 'lax',\n            path: '/',\n            secure: process.env.NODE_ENV === 'production'\n          });\n          \n          console.log(\"‚úÖ Sess√£o salva com sucesso. SessionID:\", req.sessionID);\n          console.log(\"üç™ Set-Cookie header:\", res.getHeader('Set-Cookie'));\n          console.log(\"üìã Session data:\", req.session);\n          \n          res.json({ \n            success: true, \n            message: \"Login realizado com sucesso\",\n            sessionId: req.sessionID\n          });\n        });\n      });\n    } catch (error) {\n      console.error(\"Admin login error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/logout\", (req, res) => {\n    clearAdminSession(req);\n    res.json({ success: true, message: \"Logout realizado com sucesso\" });\n  });\n\n  app.get(\"/api/admin/check\", (req, res) => {\n    console.log(\"üîç Admin check:\", {\n      hasSession: !!req.session,\n      isAdmin: req.session?.isAdmin,\n      sessionID: req.sessionID,\n      cookies: req.headers.cookie,\n      cookie: req.session?.cookie\n    });\n    \n    // Prevent caching of admin check\n    res.set({\n      'Cache-Control': 'no-store, no-cache, must-revalidate, private',\n      'Pragma': 'no-cache',\n      'Expires': '0'\n    });\n    \n    res.json({ isAdmin: !!req.session?.isAdmin });\n  });\n\n  app.get(\"/api/admin/settings/:key\", requireAdmin, async (req, res) => {\n    try {\n      const setting = await storage.getSiteSettingByKey(req.params.key);\n      res.json(setting || { value: \"\" });\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√£o\" });\n    }\n  });\n\n  app.post(\"/api/admin/settings\", requireAdmin, async (req, res) => {\n    try {\n      const data = insertSiteSettingSchema.parse(req.body);\n      const setting = await storage.upsertSiteSetting(data);\n      \n      // Invalidate cache for free_shipping related settings\n      if (data.key && (data.key === \"free_shipping_system\" || \n          data.key === \"free_shipping_threshold\" || \n          data.key === \"default_shipping_value\" ||\n          data.key === \"shipping_min_days\" ||\n          data.key === \"shipping_max_days\")) {\n        cache.invalidate(\"settings:free_shipping\");\n      }\n      \n      if (data.key && data.key.startsWith(\"cta_\")) {\n        cache.invalidate(\"settings:cta\");\n      }\n\n      if (data.key && data.key.startsWith(\"seo_\")) {\n        cache.invalidate(\"settings:seo\");\n        invalidateSEOCache();\n        writeHardcodedSEO().catch(err => console.error(\"SEO write error:\", err));\n      }\n      \n      res.json(setting);\n    } catch (error) {\n      res.status(400).json({ error: \"erro ao salvar configura√ß√£o\" });\n    }\n  });\n\n  app.get(\"/api/settings/:key\", async (req, res) => {\n    try {\n      const setting = await storage.getSiteSettingByKey(req.params.key);\n      res.json(setting || { value: \"\" });\n    } catch (error) {\n      res.status(500).json({ error: \"erro ao buscar configura√ß√£o\" });\n    }\n  });\n  app.get(\"/api/admin/banners\", requireAdmin, async (req, res) => {\n    try {\n      const banners = await storage.getSiteBanners();\n      res.json({ banners });\n    } catch (error) {\n      console.error(\"Get banners error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/banners\", requireAdmin, async (req, res) => {\n    try {\n      const bannerData = insertSiteBannerSchema.parse(req.body);\n      const banner = await storage.createSiteBanner(bannerData);\n      cache.invalidate(\"banners:active\");\n      res.status(201).json({ banner });\n    } catch (error) {\n      console.error(\"Create banner error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/banners/:id\", requireAdmin, async (req, res) => {\n    try {\n      const banner = await storage.updateSiteBanner(req.params.id, req.body);\n      if (!banner) {\n        return res.status(404).json({ error: \"Banner n√£o encontrado\" });\n      }\n      cache.invalidate(\"banners:active\");\n      res.json({ banner });\n    } catch (error) {\n      console.error(\"Update banner error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/banners/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteSiteBanner(req.params.id);\n      cache.invalidate(\"banners:active\");\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete banner error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Upload banner image with WebP conversion\n  app.post(\"/api/admin/upload-banner\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Nenhum arquivo enviado\" });\n      }\n\n      // Create unique filename\n      const filename = `banner-${randomUUID()}.webp`;\n      const uploadDir = path.join(process.cwd(), 'public', 'uploads', 'banners');\n      const uploadPath = path.join(uploadDir, filename);\n\n      // Create directory if it doesn't exist\n      await fs.mkdir(uploadDir, { recursive: true });\n\n      // Convert and optimize image to WebP\n      await sharp(req.file.buffer)\n        .resize(1920, 800, {\n          fit: 'cover',\n          position: 'center'\n        })\n        .webp({ quality: 85 })\n        .toFile(uploadPath);\n\n      const imageUrl = `/uploads/banners/${filename}`;\n      res.json({ imageUrl });\n    } catch (error) {\n      console.error(\"Upload banner image error:\", error);\n      res.status(500).json({ error: \"Erro ao fazer upload da imagem\" });\n    }\n  });\n\n  // Admin - Content Cards routes\n  app.get(\"/api/admin/content-cards\", requireAdmin, async (req, res) => {\n    try {\n      const cards = await storage.getContentCards();\n      res.json({ cards });\n    } catch (error) {\n      console.error(\"Get content cards error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Public verse route - returns the single current verse\n  app.get(\"/api/verse\", async (req, res) => {\n    try {\n      const cacheKey = \"verse:current\";\n      const cached = cache.get<{ verse: any }>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const allVerses = await storage.getSiteVerses();\n      const activeVerses = allVerses.filter(v => v.isActive);\n      \n      // Return the most recently updated verse, or null if none exist\n      const verse = activeVerses.length > 0 \n        ? activeVerses.sort((a, b) => {\n            const dateA = a.updatedAt ? new Date(a.updatedAt).getTime() : 0;\n            const dateB = b.updatedAt ? new Date(b.updatedAt).getTime() : 0;\n            return dateB - dateA;\n          })[0]\n        : null;\n      \n      const response = { verse };\n      cache.set(cacheKey, response, CACHE_TTL.VERSE);\n      res.json(response);\n    } catch (error) {\n      console.error(\"Get verse error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Legacy public verses route - returns single verse for backward compatibility\n  app.get(\"/api/verses\", async (req, res) => {\n    try {\n      const allVerses = await storage.getSiteVerses();\n      const activeVerses = allVerses.filter(v => v.isActive);\n      \n      // Return the most recently updated verse as an array for backward compatibility\n      const verse = activeVerses.length > 0 \n        ? activeVerses.sort((a, b) => {\n            const dateA = a.updatedAt ? new Date(a.updatedAt).getTime() : 0;\n            const dateB = b.updatedAt ? new Date(b.updatedAt).getTime() : 0;\n            return dateB - dateA;\n          })[0]\n        : null;\n      \n      res.json({ verses: verse ? [verse] : [] });\n    } catch (error) {\n      console.error(\"Get verses error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/content-cards\", async (req, res) => {\n    try {\n      const allCards = await storage.getContentCards();\n      const cards = allCards.filter(c => c.isActive);\n      \n      // Add images to each card\n      const cardsWithImages = await Promise.all(\n        cards.map(async (card) => {\n          const images = await storage.getContentCardImages(card.id);\n          return {\n            ...card,\n            images: images.map(img => img.imageUrl)\n          };\n        })\n      );\n      \n      res.json({ cards: cardsWithImages });\n    } catch (error) {\n      console.error(\"Get public content cards error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Public CTA Banner route\n  app.get(\"/api/cta-banner\", async (req, res) => {\n    try {\n      const config = await storage.getCtaBannerConfig();\n      res.json({ config });\n    } catch (error) {\n      console.error(\"Get CTA banner config error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/content-cards\", requireAdmin, async (req, res) => {\n    try {\n      const cardData = insertContentCardSchema.parse(req.body);\n      const card = await storage.createContentCard(cardData);\n      res.status(201).json({ card });\n    } catch (error) {\n      console.error(\"Create content card error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/content-cards/:id\", requireAdmin, async (req, res) => {\n    try {\n      const card = await storage.updateContentCard(req.params.id, req.body);\n      if (!card) {\n        return res.status(404).json({ error: \"Card n√£o encontrado\" });\n      }\n      res.json({ card });\n    } catch (error) {\n      console.error(\"Update content card error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/content-cards/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteContentCard(req.params.id);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete content card error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Content card images routes\n  app.get(\"/api/admin/content-cards/:cardId/images\", requireAdmin, async (req, res) => {\n    try {\n      const images = await storage.getContentCardImages(req.params.cardId);\n      res.json({ images });\n    } catch (error) {\n      console.error(\"Get content card images error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/content-cards/:cardId/images\", requireAdmin, upload.single(\"image\"), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Nenhuma imagem enviada\" });\n      }\n\n      const cardId = req.params.cardId;\n      const imageFileName = `card-${cardId}-${randomUUID()}.webp`;\n      const imagePath = path.join(process.cwd(), \"public\", \"uploads\", \"cards\", imageFileName);\n      \n      await fs.mkdir(path.dirname(imagePath), { recursive: true });\n      \n      await sharp(req.file.buffer)\n        .resize(1920, 1080, { fit: \"cover\", position: \"center\" })\n        .webp({ quality: 85 })\n        .toFile(imagePath);\n\n      const imageUrl = `/uploads/cards/${imageFileName}`;\n      \n      const sortOrder = parseInt(req.body.sortOrder || \"0\", 10);\n      const image = await storage.addContentCardImage({\n        cardId,\n        imageUrl,\n        sortOrder\n      });\n\n      res.status(201).json({ image });\n    } catch (error) {\n      console.error(\"Upload content card image error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/content-cards/images/:imageId\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteContentCardImage(req.params.imageId);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete content card image error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin - Site Content routes\n  app.get(\"/api/admin/content\", requireAdmin, async (req, res) => {\n    try {\n      const content = await storage.getSiteContent();\n      res.json({ content });\n    } catch (error) {\n      console.error(\"Get content error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/content\", requireAdmin, async (req, res) => {\n    try {\n      const contentData = insertSiteContentSchema.parse(req.body);\n      const content = await storage.upsertSiteContent(contentData);\n      res.json({ content });\n    } catch (error) {\n      console.error(\"Upsert content error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin - Site Settings routes\n  app.get(\"/api/admin/settings\", requireAdmin, async (req, res) => {\n    try {\n      const settings = await storage.getSiteSettings();\n      res.json({ settings });\n    } catch (error) {\n      console.error(\"Get settings error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/settings\", requireAdmin, async (req, res) => {\n    try {\n      const settingData = insertSiteSettingSchema.parse(req.body);\n      const setting = await storage.upsertSiteSetting(settingData);\n      if (settingData.key && settingData.key.startsWith(\"seo_\")) {\n        cache.invalidate(\"settings:seo\");\n        invalidateSEOCache();\n      }\n      res.json({ setting });\n    } catch (error) {\n      console.error(\"Upsert setting error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin - Site Verses routes\n  app.get(\"/api/admin/verses\", requireAdmin, async (req, res) => {\n    try {\n      const verses = await storage.getSiteVerses();\n      res.json({ verses });\n    } catch (error) {\n      console.error(\"Get verses error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/verses\", requireAdmin, async (req, res) => {\n    try {\n      const verseData = insertSiteVerseSchema.parse(req.body);\n      const verse = await storage.createSiteVerse(verseData);\n      cache.invalidate(\"verse:current\");\n      res.status(201).json({ verse });\n    } catch (error) {\n      console.error(\"Create verse error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/verses/:id\", requireAdmin, async (req, res) => {\n    try {\n      const verse = await storage.updateSiteVerse(req.params.id, req.body);\n      if (!verse) {\n        return res.status(404).json({ error: \"Verso n√£o encontrado\" });\n      }\n      cache.invalidate(\"verse:current\");\n      res.json({ verse });\n    } catch (error) {\n      console.error(\"Update verse error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/verses/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteSiteVerse(req.params.id);\n      cache.invalidate(\"verse:current\");\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete verse error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin - Single verse management\n  app.post(\"/api/admin/verse\", requireAdmin, async (req, res) => {\n    try {\n      const { text, reference } = req.body;\n      \n      if (!text || !reference) {\n        return res.status(400).json({ error: \"Texto e refer√™ncia s√£o obrigat√≥rios\" });\n      }\n\n      // Get all verses\n      const allVerses = await storage.getSiteVerses();\n      \n      if (allVerses.length > 0) {\n        // Update the most recent verse\n        const mostRecent = allVerses.sort((a, b) => {\n          const dateA = a.updatedAt ? new Date(a.updatedAt).getTime() : 0;\n          const dateB = b.updatedAt ? new Date(b.updatedAt).getTime() : 0;\n          return dateB - dateA;\n        })[0];\n        \n        const verse = await storage.updateSiteVerse(mostRecent.id, { text, reference, isActive: true });\n        cache.invalidate(\"verse:current\");\n        res.json({ verse });\n      } else {\n        // Create new verse if none exists\n        const verseData = insertSiteVerseSchema.parse({ text, reference, isActive: true });\n        const verse = await storage.createSiteVerse(verseData);\n        cache.invalidate(\"verse:current\");\n        res.status(201).json({ verse });\n      }\n    } catch (error) {\n      console.error(\"Save verse error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin - CTA Banner config routes\n  app.get(\"/api/admin/cta-banner\", requireAdmin, async (req, res) => {\n    try {\n      const config = await storage.getCtaBannerConfig();\n      res.json({ config });\n    } catch (error) {\n      console.error(\"Get CTA banner config error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.put(\"/api/admin/cta-banner\", requireAdmin, async (req, res) => {\n    try {\n      const config = await storage.upsertCtaBannerConfig(req.body);\n      res.json({ config });\n    } catch (error) {\n      console.error(\"Upsert CTA banner config error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Public FAQ routes\n  app.get(\"/api/faqs\", async (req, res) => {\n    try {\n      const faqs = await storage.getActiveFaqs();\n      res.json({ faqs });\n    } catch (error) {\n      console.error(\"Get FAQs error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin FAQ routes\n  app.get(\"/api/admin/faqs\", requireAdmin, async (req, res) => {\n    try {\n      const faqs = await storage.getFaqs();\n      res.json({ faqs });\n    } catch (error) {\n      console.error(\"Get admin FAQs error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/faqs\", requireAdmin, async (req, res) => {\n    try {\n      const faqData = insertFaqSchema.parse(req.body);\n      const faq = await storage.createFaq(faqData);\n      res.status(201).json({ faq });\n    } catch (error) {\n      console.error(\"Create FAQ error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/faqs/:id\", requireAdmin, async (req, res) => {\n    try {\n      // Validate partial update data\n      const partialFaqSchema = insertFaqSchema.partial();\n      const validatedData = partialFaqSchema.parse(req.body);\n      \n      const faq = await storage.updateFaq(req.params.id, validatedData);\n      if (!faq) {\n        return res.status(404).json({ error: \"FAQ n√£o encontrado\" });\n      }\n      res.json({ faq });\n    } catch (error) {\n      console.error(\"Update FAQ error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\" });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/faqs/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteFaq(req.params.id);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete FAQ error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/cta-banner/image\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Nenhum arquivo enviado\" });\n      }\n\n      // Create unique filename\n      const filename = `${randomUUID()}.webp`;\n      const uploadDir = path.join(process.cwd(), 'public', 'uploads', 'cta-banner');\n      const uploadPath = path.join(uploadDir, filename);\n      \n      // Ensure upload directory exists\n      await fs.mkdir(uploadDir, { recursive: true });\n      \n      // Convert to WebP with compression - 16:9 aspect ratio optimized\n      await sharp(req.file.buffer)\n        .resize(1920, 800, {\n          fit: 'cover',\n          position: 'center'\n        })\n        .webp({ quality: 85 })\n        .toFile(uploadPath);\n\n      const imageUrl = `/uploads/cta-banner/${filename}`;\n      \n      // Update the banner config with the new image\n      const config = await storage.upsertCtaBannerConfig({\n        backgroundImageUrl: imageUrl\n      });\n      \n      res.json({ imageUrl, config });\n    } catch (error) {\n      console.error(\"Upload CTA banner image error:\", error);\n      res.status(500).json({ error: \"Erro ao fazer upload da imagem\" });\n    }\n  });\n\n  // Admin - Product management routes\n  \n  // Upload product image with WebP conversion\n  app.post(\"/api/admin/products/:id/upload\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Nenhum arquivo enviado\" });\n      }\n\n      const productId = req.params.id;\n      const product = await storage.getProductById(productId);\n      if (!product) {\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n\n      // Create unique filename\n      const filename = `${randomUUID()}.webp`;\n      const uploadDir = path.join(process.cwd(), 'public', 'uploads', 'products');\n      const uploadPath = path.join(uploadDir, filename);\n      \n      // Ensure upload directory exists\n      await fs.mkdir(uploadDir, { recursive: true });\n      \n      // Convert to WebP with compression\n      await sharp(req.file.buffer)\n        .webp({ quality: 85 })\n        .resize(1200, 1200, { \n          fit: 'inside',\n          withoutEnlargement: true\n        })\n        .toFile(uploadPath);\n\n      // Get current max sort order\n      const existingImages = await storage.getProductImages(productId);\n      const maxOrder = existingImages.length > 0 \n        ? Math.max(...existingImages.map(img => img.sortOrder || 0))\n        : -1;\n\n      // Save image reference in database\n      const imageData = {\n        productId,\n        imageUrl: `/uploads/products/${filename}`,\n        altText: req.body.altText || product.name,\n        color: req.body.color || null,\n        sortOrder: maxOrder + 1,\n      };\n\n      const image = await storage.addProductImage(imageData);\n      res.status(201).json({ image });\n    } catch (error) {\n      console.error(\"Upload image error:\", error);\n      res.status(500).json({ error: \"Erro ao fazer upload da imagem\" });\n    }\n  });\n\n  // Upload size chart image for product\n  app.post(\"/api/admin/products/:id/upload-size-chart\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"Nenhum arquivo enviado\" });\n      }\n\n      const productId = req.params.id;\n      const product = await storage.getProductById(productId);\n      if (!product) {\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n\n      // Create unique filename\n      const filename = `size-chart-${randomUUID()}.webp`;\n      const uploadDir = path.join(process.cwd(), 'public', 'uploads', 'size-charts');\n      const uploadPath = path.join(uploadDir, filename);\n      \n      // Ensure upload directory exists\n      await fs.mkdir(uploadDir, { recursive: true });\n      \n      // Convert to WebP with compression (larger size for readability)\n      await sharp(req.file.buffer)\n        .webp({ quality: 90 })\n        .resize(1920, 1920, { \n          fit: 'inside',\n          withoutEnlargement: true\n        })\n        .toFile(uploadPath);\n\n      const sizeChartImage = `/uploads/size-charts/${filename}`;\n      \n      // Update product with size chart image\n      await storage.updateProduct(productId, { sizeChartImage });\n      \n      res.status(201).json({ sizeChartImage });\n    } catch (error) {\n      console.error(\"Upload size chart error:\", error);\n      res.status(500).json({ error: \"Erro ao fazer upload da tabela de medidas\" });\n    }\n  });\n\n  // Update product image (reorder, change color, etc)\n  app.patch(\"/api/admin/products/images/:id\", requireAdmin, async (req, res) => {\n    try {\n      const image = await storage.updateProductImage(req.params.id, req.body);\n      if (!image) {\n        return res.status(404).json({ error: \"Imagem n√£o encontrada\" });\n      }\n      res.json({ image });\n    } catch (error) {\n      console.error(\"Update image error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Delete product image\n  app.delete(\"/api/admin/products/images/:id\", requireAdmin, async (req, res) => {\n    try {\n      const image = await storage.getProductImages(req.params.id);\n      const success = await storage.deleteProductImage(req.params.id);\n      \n      // Delete file from disk if exists\n      if (success && image.length > 0) {\n        try {\n          const filepath = path.join(process.cwd(), 'public', image[0].imageUrl);\n          await fs.unlink(filepath);\n        } catch (err) {\n          console.error(\"Error deleting file:\", err);\n        }\n      }\n      \n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete image error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Public endpoint to get admin reviews for a product\n  app.get(\"/api/products/:productId/admin-reviews\", async (req, res) => {\n    try {\n      const reviews = await storage.getAdminProductReviews(req.params.productId);\n      res.json({ reviews });\n    } catch (error) {\n      console.error(\"Get admin reviews error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Admin product review routes\n  app.get(\"/api/admin/products/:productId/reviews\", requireAdmin, async (req, res) => {\n    try {\n      const reviews = await storage.getAdminProductReviews(req.params.productId);\n      res.json({ reviews });\n    } catch (error) {\n      console.error(\"Get admin reviews error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/products/:productId/reviews\", requireAdmin, async (req, res) => {\n    try {\n      const { productId } = req.params;\n      if (!productId || productId === 'undefined') {\n        return res.status(400).json({ error: \"ID do produto inv√°lido\" });\n      }\n\n      const reviewData = insertAdminProductReviewSchema.parse({\n        ...req.body,\n        productId\n      });\n      const review = await storage.createAdminProductReview(reviewData);\n      const allReviews = await storage.getAdminProductReviews(productId);\n      const avgRating = allReviews.length > 0\n        ? (allReviews.reduce((sum, r) => sum + r.rating, 0) / allReviews.length).toFixed(1)\n        : \"4.5\";\n      \n      await storage.updateProduct(productId, { rating: parseFloat(avgRating), reviewsCount: allReviews.length });\n      res.status(201).json({ review });\n    } catch (error) {\n      console.error(\"Create admin review error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/products/:productId/reviews/:reviewId\", requireAdmin, async (req, res) => {\n    try {\n      const { productId, reviewId } = req.params;\n      const partialSchema = insertAdminProductReviewSchema.partial();\n      const reviewData = partialSchema.parse(req.body);\n      const review = await storage.updateAdminProductReview(reviewId, reviewData);\n      if (!review) return res.status(404).json({ error: \"Avalia√ß√£o n√£o encontrada\" });\n      \n      const allReviews = await storage.getAdminProductReviews(productId);\n      const avgRating = allReviews.length > 0 \n        ? (allReviews.reduce((sum, r) => sum + r.rating, 0) / allReviews.length).toFixed(1)\n        : \"4.5\";\n      \n      await storage.updateProduct(productId, { rating: parseFloat(avgRating), reviewsCount: allReviews.length });\n      res.json({ review });\n    } catch (error) {\n      console.error(\"Update admin review error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/products/:productId/reviews/:reviewId/reorder\", requireAdmin, async (req, res) => {\n    try {\n      const { reviewId } = req.params;\n      const { sortOrder } = req.body;\n      if (typeof sortOrder !== 'number') return res.status(400).json({ error: \"sortOrder inv√°lido\" });\n      const review = await storage.updateAdminProductReview(reviewId, { sortOrder } as any);\n      if (!review) return res.status(404).json({ error: \"Avalia√ß√£o n√£o encontrada\" });\n      res.json({ review });\n    } catch (error) {\n      console.error(\"Reorder admin review error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/products/:productId/reviews/:reviewId\", requireAdmin, async (req, res) => {\n    try {\n      const { productId, reviewId } = req.params;\n      const success = await storage.deleteAdminProductReview(reviewId);\n      if (!success) return res.status(404).json({ error: \"Avalia√ß√£o n√£o encontrada\" });\n      \n      const allReviews = await storage.getAdminProductReviews(productId);\n      const avgRating = allReviews.length > 0 \n        ? (allReviews.reduce((sum, r) => sum + r.rating, 0) / allReviews.length).toFixed(1)\n        : \"4.5\";\n      \n      await storage.updateProduct(productId, { rating: parseFloat(avgRating), reviewsCount: allReviews.length });\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete admin review error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Upload review user image\n  app.post(\"/api/admin/reviews/upload-user-image\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"nenhum arquivo foi enviado\" });\n      }\n\n      const filename = `user-${randomUUID()}.webp`;\n      const filepath = path.join(process.cwd(), 'public', 'reviews', filename);\n      \n      await fs.mkdir(path.dirname(filepath), { recursive: true });\n      \n      await sharp(req.file.buffer)\n        .webp({ quality: 80 })\n        .toFile(filepath);\n\n      res.json({ userImage: `/reviews/${filename}` });\n    } catch (error) {\n      console.error(\"Upload user image error:\", error);\n      res.status(500).json({ error: \"erro ao fazer upload da imagem\" });\n    }\n  });\n\n  // Upload review image\n  app.post(\"/api/admin/reviews/upload-review-image\", requireAdmin, upload.single('image'), async (req, res) => {\n    try {\n      if (!req.file) {\n        return res.status(400).json({ error: \"nenhum arquivo foi enviado\" });\n      }\n\n      const filename = `review-${randomUUID()}.webp`;\n      const filepath = path.join(process.cwd(), 'public', 'reviews', filename);\n      \n      await fs.mkdir(path.dirname(filepath), { recursive: true });\n      \n      await sharp(req.file.buffer)\n        .webp({ quality: 80 })\n        .toFile(filepath);\n\n      res.json({ reviewImage: `/reviews/${filename}` });\n    } catch (error) {\n      console.error(\"Upload review image error:\", error);\n      res.status(500).json({ error: \"erro ao fazer upload da imagem\" });\n    }\n  });\n\n  // Coupon endpoints\n  app.get(\"/api/products/:productId/coupon\", async (req, res) => {\n    try {\n      const coupon = await storage.getProductCoupon(req.params.productId);\n      res.json({ coupon });\n    } catch (error) {\n      console.error(\"Get coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/admin/products/:productId/coupons\", requireAdmin, async (req, res) => {\n    try {\n      const coupons = await storage.getProductCoupons(req.params.productId);\n      res.json({ coupons });\n    } catch (error) {\n      console.error(\"Get coupons error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/products/:productId/coupons\", requireAdmin, async (req, res) => {\n    try {\n      const couponData = insertProductCouponSchema.parse({\n        ...req.body,\n        productId: req.params.productId\n      });\n      const coupon = await storage.createProductCoupon(couponData);\n      res.status(201).json({ coupon });\n    } catch (error) {\n      console.error(\"Create coupon error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/coupons/:couponId\", requireAdmin, async (req, res) => {\n    try {\n      const partialSchema = insertProductCouponSchema.partial();\n      const couponData = partialSchema.parse(req.body);\n      const coupon = await storage.updateProductCoupon(req.params.couponId, couponData);\n      if (!coupon) return res.status(404).json({ error: \"Cupom n√£o encontrado\" });\n      res.json({ coupon });\n    } catch (error) {\n      console.error(\"Update coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/coupons/:couponId\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteProductCoupon(req.params.couponId);\n      if (!success) return res.status(404).json({ error: \"Cupom n√£o encontrado\" });\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Global coupon endpoints\n  app.get(\"/api/global-coupon\", async (req, res) => {\n    try {\n      const coupon = await storage.getGlobalCoupon();\n      res.json({ coupon });\n    } catch (error) {\n      console.error(\"Get global coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/coupons/validate\", async (req, res) => {\n    try {\n      const { code } = req.body;\n      if (!code) {\n        return res.status(400).json({ error: \"C√≥digo do cupom √© obrigat√≥rio\" });\n      }\n\n      const coupon = await storage.getCouponByCode(code);\n      if (coupon) {\n        return res.json({ valid: true, coupon });\n      }\n\n      res.status(404).json({ valid: false, error: \"cupom inv√°lido ou expirado\" });\n    } catch (error) {\n      console.error(\"Validate coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/admin/global-coupons\", requireAdmin, async (req, res) => {\n    try {\n      const coupons = await storage.getAllGlobalCoupons();\n      res.json({ coupons });\n    } catch (error) {\n      console.error(\"Get global coupons error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/global-coupons\", requireAdmin, async (req, res) => {\n    try {\n      const { fromZodError } = await import(\"zod-validation-error\");\n      const z = (await import(\"zod\")).z;\n      const { globalCoupon } = await import(\"@shared/schema\");\n      const { createInsertSchema } = await import(\"drizzle-zod\");\n      \n      const insertGlobalCouponSchema = createInsertSchema(globalCoupon).omit({\n        id: true,\n        createdAt: true,\n        updatedAt: true\n      }).extend({\n        discountValue: z.coerce.number().min(0, \"o desconto n√£o pode ser negativo\").max(90, \"o desconto m√°ximo √© 90%\"),\n      });\n\n      const validatedData = insertGlobalCouponSchema.safeParse(req.body);\n      if (!validatedData.success) {\n        return res.status(400).json({ error: fromZodError(validatedData.error).message });\n      }\n\n      const coupon = await storage.createGlobalCoupon(validatedData.data);\n      res.status(201).json({ coupon });\n    } catch (error) {\n      console.error(\"Create global coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/global-coupons/:couponId\", requireAdmin, async (req, res) => {\n    try {\n      const { fromZodError } = await import(\"zod-validation-error\");\n      const z = (await import(\"zod\")).z;\n      const { globalCoupon } = await import(\"@shared/schema\");\n      const { createInsertSchema } = await import(\"drizzle-zod\");\n\n      const updateGlobalCouponSchema = createInsertSchema(globalCoupon).omit({\n        id: true,\n        createdAt: true,\n        updatedAt: true\n      }).extend({\n        discountValue: z.coerce.number().min(0, \"o desconto n√£o pode ser negativo\").max(90, \"o desconto m√°ximo √© 90%\").optional(),\n      }).partial();\n\n      const validatedData = updateGlobalCouponSchema.safeParse(req.body);\n      if (!validatedData.success) {\n        return res.status(400).json({ error: fromZodError(validatedData.error).message });\n      }\n\n      const coupon = await storage.updateGlobalCoupon(req.params.couponId, validatedData.data);\n      if (!coupon) return res.status(404).json({ error: \"Cupom global n√£o encontrado\" });\n      res.json({ coupon });\n    } catch (error) {\n      console.error(\"Update global coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/global-coupons/:couponId\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteGlobalCoupon(req.params.couponId);\n      if (!success) return res.status(404).json({ error: \"Cupom global n√£o encontrado\" });\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete global coupon error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Update product\n  app.patch(\"/api/admin/products/:id\", requireAdmin, async (req, res) => {\n    try {\n      console.log(\"=\".repeat(80));\n      console.log(\"üìù [PATCH /api/admin/products/:id] Recebendo requisi√ß√£o de atualiza√ß√£o\");\n      console.log(\"üìù [PATCH] Product ID:\", req.params.id);\n      console.log(\"üìù [PATCH] Body recebido:\", JSON.stringify(req.body, null, 2));\n      console.log(\"üìù [PATCH] Colors no body:\", req.body.colors);\n      console.log(\"üìù [PATCH] Colors √© array?\", Array.isArray(req.body.colors));\n      \n      if (req.body.colors && Array.isArray(req.body.colors)) {\n        req.body.colors = JSON.stringify(req.body.colors);\n      }\n      if (req.body.fabrics && Array.isArray(req.body.fabrics)) {\n        req.body.fabrics = JSON.stringify(req.body.fabrics);\n      }\n      const numericFields = ['price', 'originalPrice', 'rating', 'reviewsCount', 'displayOrder', 'installmentsMax', 'installmentsValue'];\n      for (const field of numericFields) {\n        if (req.body[field] === '' || req.body[field] === undefined) {\n          delete req.body[field];\n        }\n      }\n      const optionalStringFields = ['category', 'sectionLabel', 'sectionTitle', 'sectionSubtitle'];\n      for (const field of optionalStringFields) {\n        if (req.body[field] === '') {\n          req.body[field] = null;\n        }\n      }\n      if (req.body.fabricDescription === '') {\n        req.body.fabricDescription = null;\n      }\n      if (req.body.careInstructions === '') {\n        req.body.careInstructions = null;\n      }\n      \n      console.log(\"‚úÖ [PATCH] Iniciando parsing do schema\");\n      const productData = insertProductSchema.partial().parse(req.body);\n      console.log(\"‚úÖ [PATCH] Schema parseado com sucesso:\", JSON.stringify(productData, null, 2));\n      console.log(\"‚úÖ [PATCH] Colors no productData:\", productData.colors);\n      \n      console.log(\"üíæ [PATCH] Chamando storage.updateProduct...\");\n      const product = await storage.updateProduct(req.params.id, productData);\n      console.log(\"üíæ [PATCH] Produto retornado do storage:\", JSON.stringify(product, null, 2));\n      console.log(\"üíæ [PATCH] Colors no produto retornado:\", product?.colors);\n      \n      if (!product) {\n        console.log(\"‚ùå [PATCH] Produto n√£o encontrado\");\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n      \n      cache.invalidate(\"products:list\");\n      console.log(\"‚úÖ [PATCH] Enviando resposta de sucesso\");\n      console.log(\"=\".repeat(80));\n      res.json({ product });\n    } catch (error) {\n      console.error(\"‚ùå [PATCH] Erro ao atualizar produto:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Create new product\n  app.post(\"/api/admin/products\", requireAdmin, async (req, res) => {\n    try {\n      console.log(\"=\".repeat(80));\n      console.log(\"üì¶ [POST /api/admin/products] Recebendo requisi√ß√£o de cria√ß√£o\");\n      console.log(\"üì¶ [POST] Body recebido:\", JSON.stringify(req.body, null, 2));\n      console.log(\"üì¶ [POST] Colors no body:\", req.body.colors);\n      console.log(\"üì¶ [POST] Colors √© array?\", Array.isArray(req.body.colors));\n      \n      if (req.body.colors && Array.isArray(req.body.colors)) {\n        req.body.colors = JSON.stringify(req.body.colors);\n      }\n      if (req.body.fabrics && Array.isArray(req.body.fabrics)) {\n        req.body.fabrics = JSON.stringify(req.body.fabrics);\n      }\n      const numericFields = ['price', 'originalPrice', 'rating', 'reviewsCount', 'displayOrder', 'installmentsMax', 'installmentsValue'];\n      for (const field of numericFields) {\n        if (req.body[field] === '' || req.body[field] === undefined) {\n          delete req.body[field];\n        }\n      }\n      const optionalStringFields = ['category', 'sectionLabel', 'sectionTitle', 'sectionSubtitle'];\n      for (const field of optionalStringFields) {\n        if (req.body[field] === '') {\n          req.body[field] = null;\n        }\n      }\n      if (req.body.fabricDescription === '') {\n        req.body.fabricDescription = null;\n      }\n      if (req.body.careInstructions === '') {\n        req.body.careInstructions = null;\n      }\n      \n      console.log(\"‚úÖ [POST] Iniciando parsing do schema\");\n      const productData = insertProductSchema.parse(req.body);\n      console.log(\"‚úÖ [POST] Schema parseado com sucesso:\", JSON.stringify(productData, null, 2));\n      console.log(\"‚úÖ [POST] Colors no productData:\", productData.colors);\n      \n      console.log(\"üíæ [POST] Chamando storage.createProduct...\");\n      const product = await storage.createProduct(productData);\n      console.log(\"üíæ [POST] Produto criado e retornado do storage:\", JSON.stringify(product, null, 2));\n      console.log(\"üíæ [POST] Colors no produto criado:\", product?.colors);\n      \n      cache.invalidate(\"products:list\");\n      console.log(\"‚úÖ [POST] Enviando resposta de sucesso\");\n      console.log(\"=\".repeat(80));\n      res.status(201).json({ product });\n    } catch (error: any) {\n      console.error(\"‚ùå [POST] Erro ao criar produto:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      // Verifica erro de constraint unique (slug ou sku duplicado)\n      if (error?.code === '23505') {\n        if (error?.constraint?.includes('slug')) {\n          return res.status(400).json({ error: \"J√° existe um produto com este slug. Por favor, escolha outro.\" });\n        }\n        if (error?.constraint?.includes('sku')) {\n          return res.status(400).json({ error: \"J√° existe um produto com este SKU. Por favor, escolha outro.\" });\n        }\n        return res.status(400).json({ error: \"J√° existe um produto com estes dados. Por favor, verifique.\" });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Delete product\n  app.delete(\"/api/admin/products/:id\", requireAdmin, async (req, res) => {\n    try {\n      // Get product images to delete files\n      const images = await storage.getProductImages(req.params.id);\n      \n      // Delete product (will cascade delete images from DB)\n      const success = await storage.deleteProduct(req.params.id);\n      \n      // Delete image files from disk\n      if (success) {\n        for (const img of images) {\n          try {\n            const filepath = path.join(process.cwd(), 'public', img.imageUrl);\n            await fs.unlink(filepath);\n          } catch (err) {\n            console.error(\"Error deleting file:\", err);\n          }\n        }\n        cache.invalidate(\"products:list\");\n      }\n      \n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete product error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.use(\"/api/checkout\", checkoutRoutes);\n\n  // Admin orders routes\n  app.get(\"/api/admin/orders\", requireAdmin, async (req, res) => {\n    try {\n      const { search, status, filter, sortField, sortDirection } = req.query;\n      console.log(`[GET_ORDERS] Filter: ${filter}, Search: ${search}, Status: ${status}`);\n      \n      const orders = await storage.getOrders({\n        search: search as string,\n        status: status as string,\n        filter: (filter as any) || 'all',\n        sortField: sortField as string,\n        sortDirection: sortDirection as 'asc' | 'desc'\n      });\n      res.json(orders);\n    } catch (error) {\n      console.error(\"Get orders error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/admin/orders/:id\", requireAdmin, async (req, res) => {\n    try {\n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      res.json(order);\n    } catch (error) {\n      console.error(\"Get order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id\", requireAdmin, async (req, res) => {\n    try {\n      const updatedOrder = await storage.updateOrder(req.params.id, req.body);\n      if (!updatedOrder) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Update order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/archive\", requireAdmin, async (req, res) => {\n    try {\n      const updatedOrder = await storage.archiveOrder(req.params.id);\n      if (!updatedOrder) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Archive order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/unarchive\", requireAdmin, async (req, res) => {\n    try {\n      const updatedOrder = await storage.unarchiveOrder(req.params.id);\n      if (!updatedOrder) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Unarchive order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/orders/:id/status\", requireAdmin, async (req, res) => {\n    try {\n      const { status, trackingCode, refundReason } = req.body;\n      if (!status) {\n        return res.status(400).json({ error: \"Status √© obrigat√≥rio\" });\n      }\n\n      console.log(`[ORDER_STATUS] Updating order ${req.params.id} to ${status}`);\n      \n      const updateData: any = { orderStatus: status };\n      \n      if (status === 'shipped' && trackingCode) {\n        updateData.trackingCode = trackingCode;\n      }\n\n      if (status === 'refunded' && refundReason) {\n        updateData.refundReason = refundReason;\n      }\n      \n      // Set delivery date if status is delivered\n      if (status === 'delivered') {\n        updateData.actualDeliveryDate = new Date();\n      }\n\n      const updatedOrder = await storage.updateOrder(req.params.id, updateData);\n      \n      if (!updatedOrder) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n\n      console.log(`[ORDER_STATUS] Order ${req.params.id} updated successfully`);\n\n      if (status === 'shipped' && trackingCode && updatedOrder) {\n        try {\n          await sendTrackingCodeEmail(updatedOrder);\n          console.log(`‚úÖ [EMAIL] Email de rastreio enviado para pedido ${req.params.id}`);\n        } catch (emailError) {\n          console.error(`‚ùå [EMAIL] Falha ao enviar email de rastreio:`, emailError);\n        }\n      }\n\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Update order status error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/status\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds, status, refundReason } = req.body;\n      if (!Array.isArray(orderIds) || !status) {\n        return res.status(400).json({ error: \"Dados inv√°lidos\" });\n      }\n\n      console.log(`[ORDER_STATUS] Bulk updating ${orderIds.length} orders to ${status}`);\n      \n      const updateData: any = { orderStatus: status };\n      if (status === 'delivered') {\n        updateData.actualDeliveryDate = new Date();\n      }\n      if (status === 'refunded' && refundReason) {\n        updateData.refundReason = refundReason;\n      }\n      \n      const results = await Promise.all(\n        orderIds.map(id => storage.updateOrder(id, updateData))\n      );\n      \n      const successCount = results.filter(Boolean).length;\n      console.log(`[ORDER_STATUS] Bulk update completed. ${successCount}/${orderIds.length} successful`);\n      \n      res.json({ success: true, count: successCount });\n    } catch (error) {\n      console.error(\"Bulk status update error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/orders/:id\", requireAdmin, async (req, res) => {\n    try {\n      const updatedOrder = await storage.softDeleteOrder(req.params.id);\n      if (!updatedOrder) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      res.json(updatedOrder);\n    } catch (error) {\n      console.error(\"Delete order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/orders/:id/permanent\", requireAdmin, async (req, res) => {\n    try {\n      const order = await storage.getOrder(req.params.id);\n      if (!order) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n      if (!order.deletedAt) {\n        return res.status(400).json({ error: \"Pedido precisa estar removido antes de deletar permanentemente\" });\n      }\n      await storage.hardDeleteOrder(req.params.id);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Hard delete order error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/archive\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds } = req.body;\n      if (!Array.isArray(orderIds) || orderIds.length === 0) {\n        return res.status(400).json({ error: \"IDs de pedidos inv√°lidos\" });\n      }\n      \n      const results = await Promise.all(\n        orderIds.map(id => storage.archiveOrder(id))\n      );\n      \n      res.json({ \n        success: true, \n        count: results.filter(r => r !== null).length \n      });\n    } catch (error) {\n      console.error(\"Bulk archive error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/unarchive\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds } = req.body;\n      if (!Array.isArray(orderIds) || orderIds.length === 0) {\n        return res.status(400).json({ error: \"IDs de pedidos inv√°lidos\" });\n      }\n      \n      const results = await Promise.all(\n        orderIds.map(id => storage.unarchiveOrder(id))\n      );\n      \n      res.json({ \n        success: true, \n        count: results.filter(r => r !== null).length \n      });\n    } catch (error) {\n      console.error(\"Bulk unarchive error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/delete\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds } = req.body;\n      if (!Array.isArray(orderIds) || orderIds.length === 0) {\n        return res.status(400).json({ error: \"IDs de pedidos inv√°lidos\" });\n      }\n      \n      const results = await Promise.all(\n        orderIds.map(id => storage.softDeleteOrder(id))\n      );\n      \n      res.json({ \n        success: true, \n        count: results.filter(r => r !== null).length \n      });\n    } catch (error) {\n      console.error(\"Bulk delete error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/restore\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds } = req.body;\n      if (!Array.isArray(orderIds) || orderIds.length === 0) {\n        return res.status(400).json({ error: \"IDs de pedidos inv√°lidos\" });\n      }\n      \n      const results = await Promise.all(\n        orderIds.map(id => storage.restoreOrder(id))\n      );\n      \n      res.json({ \n        success: true, \n        count: results.filter(r => r !== null).length \n      });\n    } catch (error) {\n      console.error(\"Bulk restore error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/orders/bulk/permanent-delete\", requireAdmin, async (req, res) => {\n    try {\n      const { orderIds } = req.body;\n      if (!Array.isArray(orderIds) || orderIds.length === 0) {\n        return res.status(400).json({ error: \"IDs de pedidos inv√°lidos\" });\n      }\n      \n      // Check all orders are deleted before hard deleting\n      const orders = await Promise.all(\n        orderIds.map(id => storage.getOrder(id))\n      );\n      \n      const notDeleted = orders.filter(order => order && !order.deletedAt);\n      if (notDeleted.length > 0) {\n        return res.status(400).json({ \n          error: \"Todos os pedidos precisam estar removidos antes de deletar permanentemente\" \n        });\n      }\n      \n      await Promise.all(\n        orderIds.map(id => storage.hardDeleteOrder(id))\n      );\n      \n      res.json({ \n        success: true, \n        count: orderIds.length \n      });\n    } catch (error) {\n      console.error(\"Bulk permanent delete error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/tracking/:identifier\", async (req, res) => {\n    try {\n      const { identifier } = req.params;\n      \n      if (!identifier || identifier.trim().length === 0) {\n        return res.status(400).json({ error: \"C√≥digo de rastreio ou n√∫mero do pedido √© obrigat√≥rio\" });\n      }\n\n      const order = await storage.getOrderByNumberOrTracking(identifier.trim());\n      \n      if (!order) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n\n      if (order.deletedAt) {\n        return res.status(404).json({ error: \"Pedido n√£o encontrado\" });\n      }\n\n      res.json({ order });\n    } catch (error) {\n      console.error(\"Tracking error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar informa√ß√µes do pedido\" });\n    }\n  });\n\n  // Product Measurement Routes (Public)\n  app.get(\"/api/products/:productId/measurements\", async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const fields = await storage.getProductMeasurementFields(productId);\n      const measurements = await storage.getProductSizeMeasurements(productId);\n      res.json({ fields, measurements });\n    } catch (error) {\n      console.error(\"Get product measurements error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/products/:productId/measurement-fields\", async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const fields = await storage.getProductMeasurementFields(productId);\n      res.json({ fields });\n    } catch (error) {\n      console.error(\"Get measurement fields error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/products/:productId/size-measurements\", async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const measurements = await storage.getProductSizeMeasurements(productId);\n      res.json({ measurements });\n    } catch (error) {\n      console.error(\"Get size measurements error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Product Measurement Routes (Admin)\n  app.get(\"/api/admin/products/:productId/measurement-fields\", requireAdmin, async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const fields = await storage.getProductMeasurementFields(productId);\n      res.json({ fields });\n    } catch (error) {\n      console.error(\"Get measurement fields error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/products/:productId/measurement-fields\", requireAdmin, async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const fieldData = insertProductMeasurementFieldSchema.parse({\n        ...req.body,\n        productId\n      });\n      const field = await storage.createProductMeasurementField(fieldData);\n      res.status(201).json({ field });\n    } catch (error) {\n      console.error(\"Create measurement field error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.patch(\"/api/admin/measurement-fields/:id\", requireAdmin, async (req, res) => {\n    try {\n      const field = await storage.updateProductMeasurementField(req.params.id, req.body);\n      if (!field) {\n        return res.status(404).json({ error: \"Campo n√£o encontrado\" });\n      }\n      res.json({ field });\n    } catch (error) {\n      console.error(\"Update measurement field error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/measurement-fields/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteProductMeasurementField(req.params.id);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete measurement field error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.get(\"/api/admin/products/:productId/size-measurements\", requireAdmin, async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const measurements = await storage.getProductSizeMeasurements(productId);\n      res.json({ measurements });\n    } catch (error) {\n      console.error(\"Get size measurements error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.post(\"/api/admin/products/:productId/size-measurements\", requireAdmin, async (req, res) => {\n    try {\n      const { productId } = req.params;\n      const measurementData = insertProductSizeMeasurementSchema.parse({\n        ...req.body,\n        productId\n      });\n      const measurement = await storage.upsertProductSizeMeasurement(measurementData);\n      res.status(201).json({ measurement });\n    } catch (error) {\n      console.error(\"Create size measurement error:\", error);\n      if (error instanceof Error && error.name === 'ZodError') {\n        return res.status(400).json({ error: \"Dados inv√°lidos\", details: error.message });\n      }\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  app.delete(\"/api/admin/size-measurements/:id\", requireAdmin, async (req, res) => {\n    try {\n      const success = await storage.deleteProductSizeMeasurement(req.params.id);\n      res.json({ success });\n    } catch (error) {\n      console.error(\"Delete size measurement error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Footer pages routes - public read\n  app.get(\"/api/footer-page/:slug\", async (req, res) => {\n    try {\n      const { slug } = req.params;\n      const { db } = await import('./db');\n      const { footerPages } = await import('@shared/schema');\n      const page = await db.query.footerPages.findFirst({\n        where: (fp: any) => eq(fp.slug, slug),\n      });\n      if (!page) {\n        return res.status(404).json({ error: \"p√°gina n√£o encontrada\" });\n      }\n      res.json(page);\n    } catch (error) {\n      console.error(\"Get footer page error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Footer pages routes - admin edit\n  app.post(\"/api/footer-page/:slug\", requireAdmin, async (req, res) => {\n    try {\n      const { slug } = req.params;\n      const { title, content, description } = req.body;\n      \n      if (!title || !content) {\n        return res.status(400).json({ error: \"t√≠tulo e conte√∫do s√£o obrigat√≥rios\" });\n      }\n\n      const { db } = await import('./db');\n      const { footerPages } = await import('@shared/schema');\n      const { eq } = await import('drizzle-orm');\n\n      const existing = await db.query.footerPages.findFirst({\n        where: (fp: any) => eq(fp.slug, slug),\n      });\n\n      let result;\n      if (existing) {\n        result = await db.update(footerPages)\n          .set({\n            title,\n            content,\n            description,\n            updatedAt: new Date(),\n          })\n          .where(eq(footerPages.slug, slug))\n          .returning();\n      } else {\n        result = await db.insert(footerPages)\n          .values({\n            slug,\n            title,\n            content,\n            description,\n          })\n          .returning();\n      }\n\n      res.json(result[0] || {});\n    } catch (error) {\n      console.error(\"Update footer page error:\", error);\n      res.status(500).json({ error: \"Erro interno do servidor\" });\n    }\n  });\n\n  // Public company info endpoint\n  app.get(\"/api/company-info\", async (req, res) => {\n    try {\n      const cacheKey = \"company:info\";\n      const cached = cache.get<{ company: any }>(cacheKey);\n      if (cached) {\n        return res.json(cached);\n      }\n      \n      const company = await storage.getCompanyInfo();\n      const response = { company: company || null };\n      cache.set(cacheKey, response, CACHE_TTL.COMPANY_INFO);\n      res.json(response);\n    } catch (error) {\n      console.error(\"Get company info error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar informa√ß√µes da empresa\" });\n    }\n  });\n\n  // Admin company info endpoint\n  app.get(\"/api/admin/company-info\", requireAdmin, async (req, res) => {\n    try {\n      const company = await storage.getCompanyInfo();\n      res.json({ company: company || null });\n    } catch (error) {\n      console.error(\"Get admin company info error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar informa√ß√µes da empresa\" });\n    }\n  });\n\n  // Admin update company info endpoint\n  app.post(\"/api/admin/company-info\", requireAdmin, async (req, res) => {\n    try {\n      const companyData = req.body;\n      const { insertCompanyInfoSchema } = await import(\"@shared/schema\");\n      const validatedData = insertCompanyInfoSchema.parse(companyData);\n      const company = await storage.updateCompanyInfo(validatedData);\n      cache.invalidate(\"company:info\");\n      res.json({ company });\n    } catch (error) {\n      console.error(\"Update company info error:\", error);\n      if (error instanceof Error && error.message.includes(\"validation\")) {\n        res.status(400).json({ error: \"Dados inv√°lidos\" });\n      } else {\n        res.status(500).json({ error: \"Erro ao atualizar informa√ß√µes da empresa\" });\n      }\n    }\n  });\n\n  // Installment Options endpoints\n  app.get(\"/api/products/:id/installments\", async (req, res) => {\n    try {\n      const product = await storage.getProductById(req.params.id);\n      if (!product) {\n        return res.status(404).json({ error: \"Produto n√£o encontrado\" });\n      }\n      \n      const options = await storage.getInstallmentOptions(req.params.id);\n      const productPrice = parseFloat(product.price) || 0;\n      \n      // Transform options to include calculated values\n      const transformedOptions = options.map(opt => {\n        const customValue = opt.customValue ? parseFloat(opt.customValue) : null;\n        const installmentValue = customValue || (productPrice / opt.installments);\n        const totalPrice = installmentValue * opt.installments;\n        \n        return {\n          installments: opt.installments,\n          installmentValue: installmentValue,\n          totalPrice: totalPrice,\n          isInterestFree: opt.isInterestFree,\n          customValue: opt.customValue\n        };\n      });\n      \n      res.json(transformedOptions);\n    } catch (error) {\n      console.error(\"Get installment options error:\", error);\n      res.status(500).json({ error: \"Erro ao buscar op√ß√µes de parcelamento\" });\n    }\n  });\n\n  app.post(\"/api/admin/products/:id/installments\", requireAdmin, async (req, res) => {\n    try {\n      const { id } = req.params;\n      if (!id || id === 'undefined') {\n        return res.status(400).json({ error: \"ID do produto inv√°lido\" });\n      }\n      const options = req.body;\n      if (!Array.isArray(options)) {\n        return res.status(400).json({ error: \"Dados inv√°lidos: esperado um array\" });\n      }\n      await storage.updateInstallmentOptions(id, options);\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Update installment options error:\", error);\n      res.status(500).json({ error: \"Erro ao atualizar op√ß√µes de parcelamento\" });\n    }\n  });\n\n  app.post(\"/api/webhooks/mailgun\", async (req, res) => {\n    try {\n      const { signature, \"event-data\": eventData } = req.body;\n      \n      const signingKey = process.env.MAILGUN_WEBHOOK_SIGNING_KEY;\n      if (!signingKey) {\n        console.log(\"‚ùå [MAILGUN WEBHOOK] MAILGUN_WEBHOOK_SIGNING_KEY not configured\");\n        return res.status(403).json({ error: \"Webhook signing key not configured\" });\n      }\n      if (signature) {\n        const crypto = await import(\"crypto\");\n        const encodedToken = crypto.default\n          .createHmac(\"sha256\", signingKey)\n          .update(signature.timestamp.concat(signature.token))\n          .digest(\"hex\");\n        \n        if (encodedToken !== signature.signature) {\n          console.log(\"‚ùå [MAILGUN WEBHOOK] Invalid signature\");\n          return res.status(406).json({ error: \"Invalid signature\" });\n        }\n      }\n\n      if (!eventData) {\n        return res.status(400).json({ error: \"No event data\" });\n      }\n\n      const event = eventData.event;\n      const recipientEmail = eventData.recipient;\n      \n      console.log(`üìß [MAILGUN WEBHOOK] Event: ${event}, Recipient: ${recipientEmail}`);\n\n      const allOrders = await storage.getOrders({ search: recipientEmail });\n      const order = allOrders\n        .filter(o => o.customerEmail === recipientEmail)\n        .sort((a, b) => new Date(b.createdAt!).getTime() - new Date(a.createdAt!).getTime())[0];\n\n      if (!order) {\n        console.log(`‚ö†Ô∏è [MAILGUN WEBHOOK] No order found for ${recipientEmail}`);\n        return res.json({ status: \"ok\", message: \"No matching order\" });\n      }\n\n      const updateData: any = {};\n\n      switch (event) {\n        case \"delivered\":\n          updateData.emailDeliveredAt = new Date();\n          break;\n        case \"opened\":\n          updateData.emailOpenedAt = new Date();\n          break;\n        case \"complained\":\n          updateData.emailComplainedAt = new Date();\n          break;\n        case \"failed\":\n          updateData.emailFailedAt = new Date();\n          updateData.emailFailureReason = eventData[\"delivery-status\"]?.message || eventData[\"delivery-status\"]?.description || \"Unknown failure\";\n          break;\n        case \"rejected\":\n          updateData.emailFailedAt = new Date();\n          updateData.emailFailureReason = eventData.reject?.reason || \"Rejected by Mailgun\";\n          break;\n        default:\n          console.log(`‚ÑπÔ∏è [MAILGUN WEBHOOK] Unhandled event type: ${event}`);\n          return res.json({ status: \"ok\", message: \"Event type not tracked\" });\n      }\n\n      await storage.updateOrder(order.id, updateData);\n      console.log(`‚úÖ [MAILGUN WEBHOOK] Order ${order.orderNumber} updated with ${event} event`);\n\n      res.json({ status: \"ok\" });\n    } catch (error) {\n      console.error(\"‚ùå [MAILGUN WEBHOOK] Error:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","path":null,"size_bytes":99346,"size_tokens":null},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","path":null,"size_bytes":140,"size_tokens":null},"client/src/pages/ProductPage.tsx":{"content":"import { \n  SiVisa, \n  SiMastercard, \n  SiAmericanexpress,\n  SiPix\n} from \"react-icons/si\";\nimport { X } from \"lucide-react\";\nimport { useParams, useLocation } from \"wouter\";\nimport { useState, useEffect, useMemo, useRef } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { \n  ChevronLeft, \n  ChevronRight,\n  Share2, \n  Star,\n  Truck,\n  Shield,\n  Lock,\n  CheckCircle,\n  Award,\n  Sparkles,\n  Circle,\n  ArrowRight,\n  MapPin,\n  Droplet,\n  Zap,\n  Feather,\n  Heart,\n  Ruler,\n  CreditCard,\n  ChevronDown,\n  Search,\n  ArrowLeft\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { Collapsible, CollapsibleContent, CollapsibleTrigger } from \"@/components/ui/collapsible\";\nimport { \n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { \n  Carousel, \n  CarouselContent, \n  CarouselItem,\n  CarouselApi \n} from \"@/components/ui/carousel\";\nimport { Input } from \"@/components/ui/input\";\nimport { Link } from \"wouter\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport MochilaToast from \"@/components/MochilaToast\";\n// Importa o hook do Facebook Pixel para rastreamento de eventos\nimport { usePixel } from \"@/hooks/usePixel\";\nimport RelatedProducts from \"@/components/RelatedProducts\";\nimport SizeChartModal from \"@/components/SizeChartModal\";\nimport ReviewsModal from \"@/components/ReviewsModal\";\nimport type { MochilaItem } from \"@/contexts/MochilaContext\";\n\nconst FALLBACK_IMAGE = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='533' viewBox='0 0 400 533'%3E%3Crect width='400' height='533' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='system-ui, sans-serif' font-size='18' fill='%239ca3af'%3Eimagem indispon√≠vel%3C/text%3E%3C/svg%3E\";\n\nfunction ProductPageSkeleton() {\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-6xl mx-auto px-4\">\n        <div className=\"mb-8 h-9 w-24 bg-muted animate-pulse rounded\" />\n        \n        <div className=\"space-y-8\">\n          <div className=\"aspect-[3/4] bg-muted animate-pulse rounded-xl\" />\n          \n          <div className=\"space-y-6 pb-32\">\n            <div className=\"space-y-4\">\n              <div className=\"h-10 bg-muted animate-pulse rounded w-3/4\" />\n              <div className=\"h-8 bg-muted animate-pulse rounded w-40\" />\n              <div className=\"h-16 bg-muted animate-pulse rounded\" />\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function ProductPage() {\n  const { id } = useParams();\n  const [, navigate] = useLocation();\n  const [searchParams] = useState(() => new URLSearchParams(window.location.search));\n  const previewToken = searchParams.get(\"preview\");\n  const { addItem, setIsDrawerOpen } = useMochila();\n  const [showReviewsModal, setShowReviewsModal] = useState(false);\n  const { toggleFavorito, isFavorito, triggerFavoritoToast } = useFavoritos();\n  \n  // Inicializa o hook do Facebook Pixel para rastreamento de eventos\n  const { trackViewContent, trackAddToCart, trackAddToWishlist } = usePixel();\n  \n  const { data: apiProduct, isLoading } = useQuery<{product: any}>({\n    queryKey: ['/api/products', id],\n    enabled: !!id,\n  });\n\n  const product = apiProduct?.product;\n  \n  const colors = useMemo(() => {\n    if (!product?.colors) return [];\n    if (typeof product.colors === 'string') {\n      try {\n        const parsed = JSON.parse(product.colors);\n        return Array.isArray(parsed) ? parsed : [];\n      } catch {\n        return [];\n      }\n    }\n    if (Array.isArray(product.colors) && product.colors[0]?.name && product.colors[0]?.hex) {\n      return product.colors;\n    }\n    if (Array.isArray(product.colors) && typeof product.colors[0] === 'string') {\n      return product.colors.map((hex: string) => ({ \n        hex, \n        name: hex, \n        isPopular: hex === '#000000' || hex === '#ffffff' \n      }));\n    }\n    return [];\n  }, [product]);\n  \n  const sizes = useMemo(() => {\n    if (!product?.sizes) return [];\n    if (Array.isArray(product.sizes) && typeof product.sizes[0] === 'string') {\n      return product.sizes.map((size: string) => ({ \n        name: size, \n        available: true\n      }));\n    }\n    return product.sizes || [];\n  }, [product]);\n\n  const fabrics = useMemo(() => {\n    if (!product?.fabrics) return [];\n    if (typeof product.fabrics === 'string') {\n      try {\n        return JSON.parse(product.fabrics);\n      } catch {\n        return [];\n      }\n    }\n    return Array.isArray(product.fabrics) ? product.fabrics : [];\n  }, [product]);\n  \n  \n  const [cep, setCep] = useState(\"\");\n  const [shippingResult, setShippingResult] = useState<{ price: number; days: string; address?: string; options?: any[] } | null>(null);\n  const [isCalculatingShipping, setIsCalculatingShipping] = useState(false);\n  const [shippingError, setShippingError] = useState<string | null>(null);\n\n  const handleCepChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const value = e.target.value.replace(/\\D/g, \"\").slice(0, 8);\n    let formattedCep = value;\n    if (value.length > 5) {\n      formattedCep = `${value.slice(0, 5)}-${value.slice(5)}`;\n    }\n    setCep(formattedCep);\n    setShippingError(null);\n\n    if (formattedCep.replace(/\\D/g, \"\").length === 8) {\n      calculateShipping(formattedCep);\n      setZipCode(formattedCep);\n      setShippingPrice(defaultShippingValue);\n    }\n  };\n\n  const { setZipCode, setShippingPrice, zipCode: storedZip } = useMochila();\n\n  useEffect(() => {\n    if (storedZip && !cep) {\n      setCep(storedZip);\n      calculateShipping(storedZip, false);\n    }\n  }, [storedZip]);\n\n  const calculateShipping = async (zipCode: string, shouldAdvanceStep = true) => {\n    const cleanCep = zipCode.replace(/\\D/g, \"\");\n    if (cleanCep.length !== 8) return;\n    \n    setIsCalculatingShipping(true);\n    setShippingResult(null);\n\n    try {\n      const addressResponse = await fetch(`https://viacep.com.br/ws/${cleanCep}/json/`);\n      const addressData = await addressResponse.json();\n\n      if (addressData.erro) {\n        setShippingError(\"cep n√£o encontrado\");\n        setIsCalculatingShipping(false);\n        return;\n      }\n      \n      setShippingError(null);\n\n      await new Promise(resolve => setTimeout(resolve, 800));\n      \n      // Verificar se frete √© gr√°tis para todo o site\n      const isFreeForAll = freeShippingConfig?.system === \"all\";\n      const price = isFreeForAll ? 0 : defaultShippingValue;\n      \n      // Calculate delivery dates (9 to 15 business days)\n      const today = new Date();\n      const addBusinessDays = (date: Date, days: number) => {\n        const result = new Date(date);\n        let added = 0;\n        while (added < days) {\n          result.setDate(result.getDate() + 1);\n          if (result.getDay() !== 0 && result.getDay() !== 6) added++;\n        }\n        return result;\n      };\n\n      const minDaysVal = parseInt(freeShippingConfig?.shippingMinDays || \"9\");\n      const maxDaysVal = parseInt(freeShippingConfig?.shippingMaxDays || \"15\");\n      const dateMin = addBusinessDays(today, minDaysVal);\n      const dateMax = addBusinessDays(today, maxDaysVal);\n      \n      const formatDate = (date: Date) => {\n        const day = date.getDate().toString().padStart(2, '0');\n        const month = (date.getMonth() + 1).toString().padStart(2, '0');\n        return `${day}/${month}`;\n      };\n\n      const days = `entre ${formatDate(dateMin)} a ${formatDate(dateMax)}`;\n      \n      setShippingResult({\n        price,\n        days,\n        address: `${addressData.logradouro}, ${addressData.bairro} - ${addressData.localidade}/${addressData.uf}`,\n        options: [\n          { name: 'Correios', price, days }\n        ]\n      });\n      \n      setShippingPrice(price);\n      \n      // Auto move to summary and scroll (only when user manually enters CEP)\n      if (shouldAdvanceStep) {\n        setCurrentStep(summaryStepNumber);\n        setTimeout(() => {\n          const summaryElement = document.getElementById('order-summary');\n          summaryElement?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n        }, 100);\n      }\n    } catch (error) {\n      console.error(\"Erro ao calcular frete:\", error);\n    } finally {\n      setIsCalculatingShipping(false);\n    }\n  };\n\n  const [selectedColor, setSelectedColor] = useState<any>(null);\n  const [selectedSize, setSelectedSize] = useState<any>(null);\n  const [selectedFabric, setSelectedFabric] = useState<any>(null);\n  const [selectedPrintPosition, setSelectedPrintPosition] = useState<\"frente\" | \"costas\" | null>(null);\n  const [currentStep, setCurrentStep] = useState(1);\n  const [sizeError, setSizeError] = useState(false);\n  \n  // Sistema din√¢mico de passos - calcula o n√∫mero do passo baseado nas op√ß√µes ativas\n  const hasColorStep = colors.length > 0;\n  const hasSizeStep = sizes.length > 0;\n  const hasFabricStep = product?.fabricsEnabled && fabrics.length > 0;\n  const hasPrintPositionStep = product?.customizableFront || product?.customizableBack;\n  \n  // Calcula o n√∫mero din√¢mico de cada passo (passos de sele√ß√£o de produto)\n  // Cada passo usa √≠ndices sequenciais inteiros\n  let stepIndex = 1;\n  const colorStepNumber = hasColorStep ? stepIndex++ : 0;\n  const sizeStepNumber = hasSizeStep ? stepIndex++ : 0;\n  const fabricStepNumber = hasFabricStep ? stepIndex++ : 0;\n  const printPositionStepNumber = hasPrintPositionStep ? stepIndex++ : 0;\n  const summaryStepNumber = stepIndex; // CEP agora √© opcional dentro do resumo\n  \n  // Primeiro passo ativo\n  const firstActiveStep = hasColorStep ? colorStepNumber : \n                          hasSizeStep ? sizeStepNumber : \n                          hasFabricStep ? fabricStepNumber : \n                          hasPrintPositionStep ? printPositionStepNumber : \n                          summaryStepNumber;\n\n  const scrollToRef = (ref: React.RefObject<HTMLDivElement | null>) => {\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        ref.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      });\n    });\n  };\n\n  const goToNextStep = (fromStep: 'color' | 'size' | 'fabric' | 'printPosition') => {\n    if (fromStep === 'color') {\n      if (hasSizeStep) {\n        setCurrentStep(sizeStepNumber);\n        scrollToRef(sizeSectionRef);\n      } else if (hasFabricStep) {\n        setCurrentStep(fabricStepNumber);\n        scrollToRef(fabricSectionRef);\n      } else if (hasPrintPositionStep) {\n        setCurrentStep(printPositionStepNumber);\n        scrollToRef(printPositionSectionRef);\n      } else {\n        setCurrentStep(summaryStepNumber);\n        scrollToRef(orderSummarySectionRef);\n      }\n    } else if (fromStep === 'size') {\n      if (hasFabricStep) {\n        setCurrentStep(fabricStepNumber);\n        scrollToRef(fabricSectionRef);\n      } else if (hasPrintPositionStep) {\n        setCurrentStep(printPositionStepNumber);\n        scrollToRef(printPositionSectionRef);\n      } else {\n        setCurrentStep(summaryStepNumber);\n        scrollToRef(orderSummarySectionRef);\n      }\n    } else if (fromStep === 'fabric') {\n      if (hasPrintPositionStep) {\n        setCurrentStep(printPositionStepNumber);\n        scrollToRef(printPositionSectionRef);\n      } else {\n        setCurrentStep(summaryStepNumber);\n        scrollToRef(orderSummarySectionRef);\n      }\n    } else if (fromStep === 'printPosition') {\n      setCurrentStep(summaryStepNumber);\n      scrollToRef(orderSummarySectionRef);\n    }\n  };\n  const colorSectionRef = useRef<HTMLDivElement>(null);\n  const sizeSectionRef = useRef<HTMLDivElement>(null);\n  const fabricSectionRef = useRef<HTMLDivElement>(null);\n  const printPositionSectionRef = useRef<HTMLDivElement>(null);\n  const orderSummarySectionRef = useRef<HTMLDivElement>(null);\n  const imageColRef = useRef<HTMLDivElement>(null);\n  const [imageColHeight, setImageColHeight] = useState<number>(0);\n\n  useEffect(() => {\n    const el = imageColRef.current;\n    if (!el) return;\n    const updateHeight = () => {\n      setImageColHeight(el.offsetHeight);\n    };\n    updateHeight();\n    const ro = new ResizeObserver(updateHeight);\n    ro.observe(el);\n    return () => ro.disconnect();\n  }, [product]);\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [carouselApi, setCarouselApi] = useState<CarouselApi>();\n  const [isAddingToMochila, setIsAddingToMochila] = useState(false);\n  const [toastItem, setToastItem] = useState<MochilaItem | null>(null);\n  const [showToast, setShowToast] = useState(false);\n  const [showInstallmentsModal, setShowInstallmentsModal] = useState(false);\n  const [installmentOptions, setInstallmentOptions] = useState<any[]>([]);\n  const [selectedSizes, setSelectedSizes] = useState<string[]>([]);\n  const [measurements, setMeasurements] = useState<any[]>([]);\n  const [fields, setFields] = useState<any[]>([]);\n\n  // Limite de tamanhos para compara√ß√£o\n  const MAX_SELECTED = 3;\n\n  // Fun√ß√£o para selecionar/desmarcar um tamanho\n  const toggleSize = (size: string) => {\n    setSelectedSizes(prev => {\n      if (prev.includes(size)) {\n        return prev.filter(s => s !== size);\n      }\n      if (prev.length >= MAX_SELECTED) {\n        // Se atingir o limite, remove o primeiro e adiciona o novo\n        return [...prev.slice(1), size];\n      }\n      return [...prev, size];\n    });\n  };\n\n  // Fun√ß√£o para buscar o valor espec√≠fico de uma medida para um tamanho\n  const getMeasurementValue = (sizeName: string, fieldId: string) => {\n    const measurement = measurements.find(m => m.sizeName === sizeName && m.fieldId === fieldId);\n    return measurement?.value || \"‚Äî\";\n  };\n\n  useEffect(() => {\n    if (product?.id) {\n      // Load installments\n      fetch(`/api/products/${product.id}/installments`)\n        .then(res => res.json())\n        .then(data => {\n          if (Array.isArray(data)) {\n            setInstallmentOptions(data);\n          }\n        })\n        .catch(err => console.error(\"Error loading installments:\", err));\n\n      // Load measurements and fields\n      Promise.all([\n        fetch(`/api/products/${product.id}/measurement-fields`).then(res => res.json()),\n        fetch(`/api/products/${product.id}/size-measurements`).then(res => res.json())\n      ]).then(([fieldsData, measurementsData]) => {\n        setFields(fieldsData.fields || []);\n        setMeasurements(measurementsData.measurements || []);\n      }).catch(err => console.error(\"Error loading measurements:\", err));\n    }\n  }, [product?.id]);\n  \n  const prevProductIdRef = useRef<string | undefined>(undefined);\n\n  useEffect(() => {\n    if (prevProductIdRef.current !== product?.id) {\n      prevProductIdRef.current = product?.id;\n      setSelectedColor(colors.length > 0 ? colors[0] : null);\n      setSelectedSize(null);\n      setSizeError(false);\n      setSelectedFabric(null);\n      setSelectedPrintPosition(null);\n      setCurrentStep(firstActiveStep);\n    }\n  }, [product?.id, colors, sizes, fabrics, firstActiveStep]);\n\n  // Dispara o evento ViewContent do Facebook Pixel quando o produto carrega\n  // Este evento rastreia a visualiza√ß√£o de produtos\n  useEffect(() => {\n    if (product?.id && product?.name && product?.price) {\n      // Rastreia a visualiza√ß√£o do produto com ID, nome e pre√ßo\n      trackViewContent(\n        String(product.id),\n        product.name,\n        Number(product.price),\n        \"BRL\",\n        product.category || \"camisetas\"\n      );\n    }\n  }, [product?.id, product?.name, product?.price, trackViewContent]);\n\n  useEffect(() => {\n    setSelectedColor((prev: any) => {\n      if (colors.length === 0) return null;\n      if (!prev) return colors[0];\n      const match = colors.find((c: any) => c.hex === prev.hex);\n      return match || colors[0];\n    });\n  }, [colors]);\n\n  useEffect(() => {\n    setSelectedSize((prev: any) => {\n      if (sizes.length === 0) return null;\n      if (!prev) return null;\n      const match = sizes.find((s: any) => s.name === prev.name && s.available !== false);\n      return match || null;\n    });\n  }, [sizes]);\n\n  const displayImages = useMemo(() => {\n    if (!product?.images || !Array.isArray(product.images) || product.images.length === 0) {\n      return [FALLBACK_IMAGE];\n    }\n    \n    const getPresentationImages = () => {\n      return product.images\n        .filter((img: any) => img.imageType === 'presentation')\n        .sort((a: any, b: any) => (a.sortOrder || 0) - (b.sortOrder || 0))\n        .map((img: any) => img.imageUrl);\n    };\n    \n    if (!selectedColor) {\n      const presentationImages = getPresentationImages();\n      return presentationImages.length > 0 ? presentationImages : [FALLBACK_IMAGE];\n    }\n    \n    const carouselImages = product.images\n      .filter((img: any) => img.imageType === 'carousel' && img.color === selectedColor.name)\n      .sort((a: any, b: any) => (a.sortOrder || 0) - (b.sortOrder || 0))\n      .map((img: any) => img.imageUrl);\n    \n    if (carouselImages.length > 0) {\n      return carouselImages;\n    }\n    \n    const presentationImages = getPresentationImages();\n    return presentationImages.length > 0 ? presentationImages : [FALLBACK_IMAGE];\n  }, [selectedColor, product]);\n\n  useEffect(() => {\n    if (carouselApi) {\n      carouselApi.scrollTo(0);\n      setCurrentImageIndex(0);\n    }\n  }, [selectedColor, carouselApi]);\n\n  useEffect(() => {\n    if (!carouselApi) return;\n    carouselApi.on(\"select\", () => {\n      setCurrentImageIndex(carouselApi.selectedScrollSnap());\n    });\n  }, [carouselApi]);\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  const totalPrice = useMemo(() => {\n    if (!product) return 0;\n    let total = Number(product.price);\n    if (selectedFabric?.price) {\n      total += Number(selectedFabric.price);\n    }\n    return total;\n  }, [product, selectedFabric]);\n\n  const addToMochila = () => {\n    const needsColor = colors.length > 0;\n    const needsSize = sizes.length > 0;\n\n    if (needsSize && !selectedSize) {\n      setSizeError(true);\n      setTimeout(() => {\n        sizeSectionRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }, 0);\n      return;\n    }\n\n    if (product.fabricsEnabled && fabrics.length > 0 && !selectedFabric) {\n      const fabricSection = document.getElementById('fabric-selection');\n      fabricSection?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      return;\n    }\n\n    if (!product || (needsColor && !selectedColor) || (needsSize && selectedSize.available === false)) return;\n    \n    setIsAddingToMochila(true);\n    \n    const item: any = {\n      productId: product.id,\n      name: product.name,\n      price: totalPrice,\n      image: displayImages[0],\n    };\n    \n    if (selectedColor) item.color = selectedColor;\n    if (selectedSize) item.size = selectedSize.name;\n    if (selectedFabric) item.fabric = { name: selectedFabric.name, price: selectedFabric.price };\n    if ((product.customizableFront || product.customizableBack) && selectedPrintPosition) {\n      item.printPosition = selectedPrintPosition;\n    }\n    \n    addItem(item);\n    \n    // Dispara o evento AddToCart do Facebook Pixel\n    // Rastreia quando o usu√°rio adiciona um produto ao carrinho\n    trackAddToCart(\n      String(product.id),\n      product.name,\n      totalPrice,\n      \"BRL\",\n      1 // Quantidade adicionada\n    );\n    \n    setToastItem({ ...item, id: Date.now().toString(), quantity: 1 });\n    setShowToast(true);\n    \n    // Garantir que o CEP e o pre√ßo do frete calculados nesta p√°gina sejam persistidos no contexto da mochila\n    if (shippingResult) {\n      setZipCode(cep);\n      setShippingPrice(shippingResult.price);\n    }\n    \n    setTimeout(() => { setShowToast(false); }, 5000);\n    setTimeout(() => { setIsAddingToMochila(false); }, 400);\n  };\n  \n  const { data: freeShippingConfig } = useQuery<{ system: string; threshold: string; shippingValue: string; shippingMinDays: string; shippingMaxDays: string }>({\n    queryKey: ['/api/settings/free_shipping'],\n  });\n\n  const { data: ctaConfig } = useQuery<{\n    shippingLabel: string;\n    buyNowText: string;\n    buyNowBg: string;\n    buyNowTextColor: string;\n    addToCartText: string;\n    addToCartBorder: string;\n    addToCartTextColor: string;\n    trustText: string;\n    trustIcon: string;\n    ctaShippingFreeText: string;\n    ctaShippingPaidText: string;\n    mochilaShippingFreeText: string;\n    mochilaShippingPaidText: string;\n  }>({\n    queryKey: ['/api/settings/cta'],\n  });\n\n  const getTrustIcon = () => {\n    const iconMap: Record<string, any> = {\n      lock: null,\n      shield: Shield,\n      \"check-circle\": CheckCircle,\n      \"credit-card\": CreditCard,\n      star: Star,\n      heart: Heart,\n      zap: Zap,\n      award: Award,\n    };\n    return iconMap[ctaConfig?.trustIcon || \"lock\"];\n  };\n  \n  // \"all\" = frete gr√°tis para todos, \"threshold\" = frete gr√°tis a partir de R$200\n  const isFreeShippingForAll = freeShippingConfig?.system === \"all\";\n  const isShippingSystemThreshold = freeShippingConfig?.system === \"threshold\" || !freeShippingConfig?.system;\n  const thresholdValue = parseFloat(freeShippingConfig?.threshold || \"200\");\n  const defaultShippingValue = parseFloat(freeShippingConfig?.shippingValue || \"19.99\");\n\n  if (isLoading) return <ProductPageSkeleton />;\n\n  if (!product || (product.status === \"draft\" && product.previewToken !== previewToken)) {\n    return (\n      <div className=\"min-h-screen bg-muted/30 dark:bg-muted/10 flex items-center justify-center px-6\">\n        <motion.div \n          initial={{ opacity: 0, y: 24 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ duration: 0.8, ease: [0.25, 0.1, 0.25, 1] }}\n          className=\"flex flex-col items-center text-center max-w-sm\"\n        >\n          <motion.div \n            initial={{ scale: 0.8, opacity: 0 }}\n            animate={{ scale: 1, opacity: 1 }}\n            transition={{ duration: 0.6, delay: 0.1, ease: [0.25, 0.1, 0.25, 1] }}\n            className=\"w-24 h-24 rounded-full bg-background dark:bg-card flex items-center justify-center mb-10 shadow-sm\"\n          >\n            <Search className=\"h-9 w-9 text-muted-foreground/40\" />\n          </motion.div>\n          <motion.h1 \n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5, delay: 0.2 }}\n            className=\"text-2xl font-semibold tracking-tight mb-2 lowercase\" \n            data-testid=\"text-product-not-found-title\"\n          >\n            produto n√£o encontrado\n          </motion.h1>\n          <motion.p \n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5, delay: 0.3 }}\n            className=\"text-sm text-muted-foreground/60 font-light leading-relaxed mb-10 lowercase\" \n            data-testid=\"text-product-not-found-description\"\n          >\n            o item que voc√™ procura n√£o est√° dispon√≠vel ou pode ter sido removido.\n          </motion.p>\n          <motion.div\n            initial={{ opacity: 0, y: 8 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5, delay: 0.4 }}\n          >\n            <Link href=\"/\">\n              <Button className=\"h-11 px-7 rounded-full text-sm font-medium lowercase gap-2\" data-testid=\"button-back-home\">\n                <ArrowLeft className=\"h-4 w-4\" />\n                voltar para p√°gina inicial\n              </Button>\n            </Link>\n          </motion.div>\n        </motion.div>\n      </div>\n    );\n  }\n\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"max-w-6xl mx-auto px-4\">\n        <div className=\"flex items-center justify-start py-2 mb-1\">\n          <Link href=\"/\">\n            <Button variant=\"ghost\" size=\"sm\" className=\"group flex items-center gap-2 px-0 hover:bg-transparent no-default-hover-elevate no-default-active-elevate text-muted-foreground hover:text-foreground transition-colors\">\n              <div className=\"h-7 w-7 rounded-full bg-muted/30 flex items-center justify-center group-hover:bg-muted transition-colors\">\n                <ChevronLeft className=\"h-3.5 w-3.5\" />\n              </div>\n              <span className=\"text-xs font-medium tracking-tight\">voltar</span>\n            </Button>\n          </Link>\n        </div>\n\n        <div className=\"flex flex-col lg:grid lg:grid-cols-2 gap-6 lg:gap-10 items-start\">\n          <div ref={imageColRef} className=\"w-full lg:sticky lg:top-[5.5rem] lg:self-start\">\n            <motion.div className=\"relative\" initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }}>\n              <div className=\"absolute top-4 right-4 z-20 flex flex-col gap-2\">\n                <Button variant=\"secondary\" size=\"icon\" onClick={(e) => { \n                    e.stopPropagation(); \n                    if (!isFavorito(product.id)) {\n                      trackAddToWishlist(String(product.id), product.name, Number(product.price));\n                      triggerFavoritoToast({\n                        id: product.id,\n                        name: product.name,\n                        price: Number(product.price),\n                        image: displayImages[0] || ''\n                      });\n                    }\n                    toggleFavorito(product.id); \n                  }} className=\"h-8 w-8 rounded-md shadow-sm\">\n                  <Heart className={`h-4 w-4 ${isFavorito(product.id) ? 'fill-current text-red-500' : ''}`} />\n                </Button>\n                <Button variant=\"secondary\" size=\"icon\" onClick={() => {\n                  if (navigator.share) {\n                    navigator.share({\n                      title: product.name,\n                      text: product.description,\n                      url: window.location.href,\n                    }).catch(console.error);\n                  } else {\n                    navigator.clipboard.writeText(window.location.href);\n                  }\n                }} className=\"h-8 w-8 rounded-md shadow-sm\">\n                  <Share2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n              <Carousel setApi={setCarouselApi} className=\"w-full\" opts={{ loop: true }}>\n                <CarouselContent>\n                  {displayImages.map((image: string, index: number) => (\n                    <CarouselItem key={index}>\n                      <div className=\"aspect-[3/4] lg:aspect-square overflow-hidden rounded-2xl relative\">\n                        <img src={image} alt={`${product.name} - ${index + 1}`} className=\"w-full h-full object-cover hover:scale-105 transition-transform duration-700\" loading=\"lazy\" decoding=\"async\" />\n                      </div>\n                    </CarouselItem>\n                  ))}\n                </CarouselContent>\n              </Carousel>\n              {displayImages.length > 1 && (\n                <div className=\"absolute bottom-6 left-1/2 -translate-x-1/2 flex gap-1.5 z-10\">\n                  {displayImages.map((_: string, idx: number) => (\n                    <div key={idx} className={`h-1 rounded-full transition-all duration-300 ${idx === currentImageIndex ? \"w-4 bg-white\" : \"w-1 bg-white/50\"}`} />\n                  ))}\n                </div>\n              )}\n            </motion.div>\n          </div>\n\n          <div className=\"w-full lg:sticky lg:top-[5.5rem] lg:self-start relative\"\n            style={imageColHeight > 0 ? { maxHeight: `${imageColHeight}px` } : {}}>\n            <div className=\"hidden lg:block pointer-events-none absolute bottom-0 left-0 right-0 h-36 z-10\" style={{ background: 'linear-gradient(to top, hsl(var(--background) / 0.9) 0%, hsl(var(--background) / 0.5) 20%, hsl(var(--background) / 0.2) 50%, transparent 100%)' }} />\n            <div className=\"space-y-6 lg:overflow-y-auto scrollbar-hide lg:pb-24\"\n              style={{ scrollbarWidth: 'none', msOverflowStyle: 'none', maxHeight: 'inherit' } as React.CSSProperties}>\n            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className=\"space-y-4\">\n              <h1 className=\"text-4xl lg:text-5xl font-light lowercase\">{product.name}</h1>\n              \n              <div className=\"py-2\">\n                <p className=\"text-sm text-muted-foreground leading-relaxed font-light whitespace-pre-line\">\n                  {product.description || \"Design minimalista e clean. Para quem aprecia a simplicidade com estilo.\"}\n                </p>\n              </div>\n\n              <div className=\"flex flex-col gap-2\">\n                <div className=\"flex items-baseline gap-3\">\n                  <span className=\"text-2xl font-medium tracking-tight text-primary\">{formatPrice(totalPrice)}</span>\n                  {product.originalPrice && Number(product.originalPrice) > totalPrice && (\n                    <span className=\"text-lg text-muted-foreground line-through font-light\">\n                      {formatPrice(Number(product.originalPrice))}\n                    </span>\n                  )}\n                </div>\n                {product.showInstallments !== false && (\n                <button \n                  onClick={() => setShowInstallmentsModal(true)}\n                  className=\"w-full group relative flex items-center justify-between p-4 rounded-2xl bg-muted/30 border border-border/50 hover:bg-muted/50 transition-all duration-300 hover:shadow-sm mt-2\"\n                >\n                  <div className=\"flex flex-col items-start gap-1\">\n                    <span className=\"text-[10px] text-muted-foreground uppercase tracking-wider font-medium\">parcelamento</span>\n                    <span className=\"text-sm font-medium\">\n                      {installmentOptions.length > 0 ? (\n                        <>\n                          {installmentOptions[0].installments}x de {formatPrice(installmentOptions[0].installmentValue)}\n                          {installmentOptions[0].isInterestFree && (\n                            <span className=\"text-muted-foreground/50 font-light ml-1\">sem juros</span>\n                          )}\n                        </>\n                      ) : (\n                        <>12x de {formatPrice(totalPrice / 12)} <span className=\"text-muted-foreground/50 font-light ml-1\">sem juros</span></>\n                      )}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2 px-3 py-1.5 rounded-full border border-muted-foreground/30 dark:border-foreground/20 bg-muted/20 dark:bg-foreground/5 hover:bg-muted/30 dark:hover:bg-foreground/10 transition-colors\">\n                    <span className=\"text-[11px] text-muted-foreground dark:text-foreground/40 uppercase tracking-tighter\">ver detalhes</span>\n                    <ChevronRight className=\"h-3 w-3 text-muted-foreground/60 dark:text-foreground/30 group-hover:text-foreground/60 transition-colors\" />\n                  </div>\n                </button>\n                )}\n              </div>\n            </motion.div>\n\n            <Dialog open={showInstallmentsModal} onOpenChange={setShowInstallmentsModal}>\n              <DialogContent className=\"max-w-md rounded-[32px] p-0 overflow-hidden border-none bg-background/95 backdrop-blur-xl shadow-2xl\">\n                <div className=\"p-8 space-y-8\">\n                  <div className=\"flex items-center justify-between\">\n                    <h2 className=\"text-2xl font-light lowercase tracking-tight\">op√ß√µes de pagamento</h2>\n                    <div className=\"flex gap-2 items-center opacity-60\">\n                      <SiVisa className=\"h-5 w-5\" />\n                      <SiMastercard className=\"h-4 w-4\" />\n                      <SiPix className=\"h-3 w-3\" />\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-3 max-h-[60vh] overflow-y-auto pr-2 custom-scrollbar\">\n                    {installmentOptions.map((opt, index) => (\n                      <div \n                        key={index}\n                        className=\"flex items-center justify-between p-4 rounded-2xl bg-muted/30 border border-border/50 hover:bg-muted/50 transition-colors\"\n                      >\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-base font-medium\">\n                            {opt.installments}x de {formatPrice(opt.installmentValue)}\n                          </span>\n                          <span className=\"text-[10px] text-muted-foreground lowercase\">\n                            {opt.isInterestFree ? \"sem juros\" : \"com acr√©scimo\"}\n                          </span>\n                        </div>\n                        <div className=\"text-right\">\n                          <span className=\"text-xs font-light text-muted-foreground lowercase\">\n                            total: <span className=\"normal-case\">{formatPrice(opt.totalPrice)}</span>\n                          </span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n\n                  <div className=\"pt-4 space-y-4\">\n                    <div className=\"flex items-center gap-4 p-4 rounded-2xl bg-primary/5 border border-primary/10\">\n                      <div className=\"h-10 w-10 rounded-xl bg-primary/10 flex items-center justify-center\">\n                        <SiPix className=\"h-5 w-5 text-primary\" />\n                      </div>\n                      <div className=\"flex flex-col\">\n                        <span className=\"text-sm font-medium\">pix</span>\n                        <span className=\"text-xs text-muted-foreground\">aprova√ß√£o imediata</span>\n                      </div>\n                    </div>\n                    \n                    <Button \n                      className=\"w-full h-14 rounded-2xl text-lg font-light shadow-lg hover:shadow-xl transition-all duration-300\"\n                      onClick={() => setShowInstallmentsModal(false)}\n                    >\n                      fechar\n                    </Button>\n                  </div>\n                </div>\n              </DialogContent>\n            </Dialog>\n\n            {(product.sectionLabel || product.sectionTitle || product.sectionSubtitle) && (\n              <motion.div \n                initial={{ opacity: 0, y: 12 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.6, ease: [0.25, 0.1, 0.25, 1] }}\n                className=\"text-center space-y-2 pt-4 pb-2\"\n              >\n                {product.sectionLabel && (\n                  <p className=\"text-[10px] font-medium tracking-[0.25em] text-muted-foreground/60 uppercase\">\n                    {product.sectionLabel}\n                  </p>\n                )}\n                {product.sectionTitle && (\n                  <h3 className=\"text-lg font-light lowercase tracking-tight text-foreground/90\">\n                    {product.sectionTitle}\n                  </h3>\n                )}\n                {product.sectionSubtitle && (\n                  <p className=\"text-xs text-muted-foreground/50 font-light\">\n                    {product.sectionSubtitle}\n                  </p>\n                )}\n              </motion.div>\n            )}\n\n            <div className=\"space-y-4\">\n              {colors.length > 0 && (\n                <motion.div \n                  ref={colorSectionRef}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  onClick={() => setCurrentStep(colorStepNumber)} \n                  className={`space-y-4 p-5 rounded-[24px] border-2 transition-all duration-500 cursor-pointer ${currentStep === colorStepNumber ? 'border-foreground shadow-sm bg-card' : 'border-transparent opacity-60 bg-muted/30'}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex flex-col gap-1\">\n                      <span className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">passo {colorStepNumber}</span>\n                      <h3 className=\"text-lg font-medium lowercase\">escolha a cor {selectedColor && <span className=\"text-muted-foreground font-light\">‚Äî {selectedColor.name}</span>}</h3>\n                    </div>\n                    {selectedColor && currentStep > colorStepNumber && (\n                      <div className=\"h-6 w-6 rounded-full bg-primary flex items-center justify-center\">\n                        <Sparkles className=\"h-3 w-3 text-primary-foreground fill-current\" />\n                      </div>\n                    )}\n                  </div>\n                  {currentStep === colorStepNumber && (\n                    <div className=\"grid grid-cols-4 gap-3\">\n                      {colors.map((color: any) => (\n                        <button \n                          key={color.hex} \n                          onClick={(e) => { \n                            e.stopPropagation(); \n                            setSelectedColor(color); \n                            setTimeout(() => goToNextStep('color'), 300); \n                          }} \n                          className={`group relative aspect-square rounded-2xl border-2 transition-all duration-300 flex items-center justify-center ${selectedColor?.hex === color.hex ? 'border-foreground ring-2 ring-foreground/10' : 'border-border/40 hover:border-border/80'}`}\n                          title={color.name}\n                        >\n                          <div className=\"w-10 h-10 rounded-xl shadow-inner\" style={{ backgroundColor: color.hex }} />\n                        </button>\n                      ))}\n                    </div>\n                  )}\n                </motion.div>\n              )}\n\n              {sizes.length > 0 && (\n                <motion.div \n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  ref={sizeSectionRef} \n                  onClick={() => { if (selectedColor || colors.length === 0) setCurrentStep(sizeStepNumber); }} \n                  className={`space-y-4 p-5 rounded-[24px] border-2 transition-all duration-500 cursor-pointer ${currentStep === sizeStepNumber ? 'border-foreground shadow-sm bg-card' : 'border-transparent opacity-60 bg-muted/30'}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex flex-col gap-1\">\n                      <span className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">passo {sizeStepNumber}</span>\n                      <h3 className=\"text-lg font-medium lowercase\">qual o tamanho? {selectedSize && <span className=\"text-muted-foreground font-light\">‚Äî {selectedSize.name}</span>}</h3>\n                    </div>\n                    {selectedSize && currentStep > sizeStepNumber && (\n                      <div className=\"h-6 w-6 rounded-full bg-primary flex items-center justify-center\">\n                        <Sparkles className=\"h-3 w-3 text-primary-foreground fill-current\" />\n                      </div>\n                    )}\n                  </div>\n                  {currentStep === sizeStepNumber && (\n                    <div className=\"space-y-4\">\n                      <div className=\"grid grid-cols-3 gap-3\">\n                        {sizes.map((size: any) => (\n                          <Button \n                            key={size.name} \n                            variant={selectedSize?.name === size.name ? \"default\" : \"outline\"} \n                            disabled={size.available === false} \n                            onClick={(e) => { \n                              e.stopPropagation(); \n                              setSelectedSize(size); \n                              setSizeError(false); \n                              setTimeout(() => goToNextStep('size'), 300);\n                            }} \n                            className={`h-14 rounded-2xl text-lg font-light transition-all duration-300 ${selectedSize?.name === size.name ? 'scale-[1.02] shadow-md' : ''}`}\n                          >\n                            {size.name}\n                          </Button>\n                        ))}\n                      </div>\n                      {product.sizeChartEnabled && (\n                        <div className=\"pt-4 border-t border-border/5\">\n                          <SizeChartModal \n                            productId={product.id} \n                            productName={product.name}\n                            sizeChartImage={product.sizeChartImage}\n                            sizeChartEnabled={product.sizeChartEnabled}\n                            activeSizes={sizes}\n                            trigger={\n                              <button \n                                className=\"w-full group flex items-center justify-between py-1 transition-colors hover:text-foreground/80\"\n                                data-testid=\"button-open-size-chart\"\n                              >\n                                <div className=\"flex items-center gap-3\">\n                                  <div className=\"h-8 w-8 rounded-full bg-muted/50 flex items-center justify-center group-hover:bg-muted transition-colors\">\n                                    <Ruler className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                                  </div>\n                                  <span className=\"text-sm font-medium lowercase tracking-tight\">guia de tamanhos</span>\n                                </div>\n                                <ChevronRight className=\"h-4 w-4 text-muted-foreground/40 group-hover:text-muted-foreground/60 transition-transform group-hover:translate-x-0.5\" />\n                              </button>\n                            }\n                          />\n                        </div>\n                      )}\n                      {sizeError && (\n                        <p className=\"text-xs text-destructive text-center font-medium\">por favor, selecione um tamanho</p>\n                      )}\n                    </div>\n                  )}\n                </motion.div>\n              )}\n\n              {/* Step 3: Fabric Selection */}\n              {product.fabricsEnabled && fabrics.length > 0 && (\n                <motion.div\n                  ref={fabricSectionRef}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  onClick={() => { if (selectedSize || !hasSizeStep) setCurrentStep(fabricStepNumber); }}\n                  className={`space-y-4 p-5 rounded-[24px] border-2 transition-all duration-500 cursor-pointer ${currentStep === fabricStepNumber ? 'border-foreground shadow-sm bg-card' : 'border-transparent opacity-60 bg-muted/30'}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex flex-col gap-1\">\n                      <span className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">passo {fabricStepNumber}</span>\n                      <h3 className=\"text-lg font-medium lowercase\">escolha o tecido {selectedFabric && <span className=\"text-muted-foreground font-light\">‚Äî {selectedFabric.name}</span>}</h3>\n                    </div>\n                    {selectedFabric && currentStep > fabricStepNumber && (\n                      <div className=\"h-6 w-6 rounded-full bg-primary flex items-center justify-center\">\n                        <Sparkles className=\"h-3 w-3 text-primary-foreground fill-current\" />\n                      </div>\n                    )}\n                  </div>\n                  {currentStep === fabricStepNumber && (\n                    <div className=\"space-y-8\" onClick={(e) => e.stopPropagation()}>\n                      <div className=\"grid grid-cols-1 gap-3\">\n                        {fabrics.map((fabric: any) => (\n                          <button\n                            key={fabric.name}\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              setSelectedFabric(fabric);\n                              setTimeout(() => goToNextStep('fabric'), 300);\n                            }}\n                            className={`flex items-center justify-between p-4 rounded-2xl border-2 transition-all duration-300 ${selectedFabric?.name === fabric.name ? 'border-foreground bg-foreground/5' : 'border-border/40 hover:border-border/80'}`}\n                          >\n                            <div className=\"text-left\">\n                              <p className=\"font-medium lowercase\">{fabric.name}</p>\n                              {fabric.description && (\n                                <p className=\"text-xs text-muted-foreground/70 font-light lowercase mt-0.5\">{fabric.description}</p>\n                              )}\n                              {fabric.price > 0 && (\n                                <p className=\"text-xs text-muted-foreground mt-1.5\"><span className=\"normal-case\">+{formatPrice(fabric.price)}</span></p>\n                              )}\n                            </div>\n                            {selectedFabric?.name === fabric.name && <Circle className=\"h-4 w-4 fill-current\" />}\n                          </button>\n                        ))}\n                      </div>\n\n                    </div>\n                  )}\n                </motion.div>\n              )}\n\n              {/* Step: Print Position Selection */}\n              {(product.customizableFront || product.customizableBack) && (\n                <motion.div\n                  ref={printPositionSectionRef}\n                  initial={{ opacity: 0, y: 20 }}\n                  animate={{ opacity: 1, y: 0 }}\n                  onClick={() => { if (selectedFabric || !product.fabricsEnabled) setCurrentStep(printPositionStepNumber); }}\n                  className={`space-y-4 p-5 rounded-[24px] border-2 transition-all duration-500 cursor-pointer ${currentStep === printPositionStepNumber ? 'border-foreground shadow-sm bg-card' : 'border-transparent opacity-60 bg-muted/30'}`}\n                >\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex flex-col gap-1\">\n                      <span className=\"text-[10px] text-muted-foreground uppercase tracking-widest font-bold\">passo {printPositionStepNumber}</span>\n                      <h3 className=\"text-lg font-medium lowercase\">posi√ß√£o da estampa {selectedPrintPosition && <span className=\"text-muted-foreground font-light\">‚Äî {selectedPrintPosition}</span>}</h3>\n                    </div>\n                    {selectedPrintPosition && currentStep > printPositionStepNumber && (\n                      <div className=\"h-6 w-6 rounded-full bg-primary flex items-center justify-center\">\n                        <Sparkles className=\"h-3 w-3 text-primary-foreground fill-current\" />\n                      </div>\n                    )}\n                  </div>\n                  {currentStep === printPositionStepNumber && (\n                    <div className=\"grid grid-cols-2 gap-3\">\n                      {product.customizableFront && (\n                        <Button\n                          variant={selectedPrintPosition === \"frente\" ? \"default\" : \"outline\"}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setSelectedPrintPosition(\"frente\");\n                            setTimeout(() => goToNextStep('printPosition'), 300);\n                          }}\n                          className=\"h-14 rounded-2xl lowercase font-light\"\n                        >\n                          frente\n                        </Button>\n                      )}\n                      {product.customizableBack && (\n                        <Button\n                          variant={selectedPrintPosition === \"costas\" ? \"default\" : \"outline\"}\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setSelectedPrintPosition(\"costas\");\n                            setTimeout(() => goToNextStep('printPosition'), 300);\n                          }}\n                          className=\"h-14 rounded-2xl lowercase font-light\"\n                        >\n                          costas\n                        </Button>\n                      )}\n                    </div>\n                  )}\n                </motion.div>\n              )}\n\n              {/* Order Summary - Apple Style */}\n              <AnimatePresence>\n                {((selectedColor || !hasColorStep) && (selectedSize || !hasSizeStep) && (!product.fabricsEnabled || selectedFabric) && (!hasPrintPositionStep || selectedPrintPosition)) && (\n                  <motion.div \n                    ref={orderSummarySectionRef}\n                    id=\"order-summary\"\n                    initial={{ opacity: 0, y: 32, scale: 0.98 }} \n                    animate={{ opacity: 1, y: 0, scale: 1 }}\n                    exit={{ opacity: 0, y: 16, scale: 0.98 }}\n                    transition={{ duration: 0.5, ease: [0.25, 0.1, 0.25, 1] }}\n                    className=\"relative overflow-hidden\"\n                  >\n                    {/* Card Principal */}\n                    <div className=\"relative bg-[#1d1d1f] text-white rounded-[24px] p-5 sm:p-6\">\n                      \n                      {/* Header minimalista */}\n                      <div className=\"text-center space-y-1 mb-8\">\n                        <motion.div\n                          initial={{ opacity: 0, y: 8 }}\n                          animate={{ opacity: 1, y: 0 }}\n                          transition={{ delay: 0.1 }}\n                        >\n                          <p className=\"text-[11px] font-medium tracking-[0.2em] text-white/40 uppercase\">pronto para enviar</p>\n                        </motion.div>\n                      </div>\n\n                      {/* Shipping Section */}\n                      <motion.div \n                        initial={{ opacity: 0, y: 12 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.15 }}\n                        className=\"space-y-4 mb-8\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"w-8 h-8 rounded-full bg-white/[0.08] flex items-center justify-center\">\n                            <Truck className=\"h-4 w-4 text-white/60\" />\n                          </div>\n                          <span className=\"text-[13px] font-medium text-white/80\">entrega</span>\n                        </div>\n                        \n                        <div className=\"relative\">\n                          <Input\n                            placeholder=\"digite seu cep\"\n                            className=\"h-[52px] rounded-2xl bg-white/[0.06] border-0 text-white placeholder:text-white/30 text-[15px] font-light pl-4 pr-12 focus:bg-white/[0.08] focus:ring-1 focus:ring-white/20 transition-all duration-300\"\n                            value={cep}\n                            onChange={handleCepChange}\n                            data-testid=\"input-cep-summary\"\n                          />\n                          {isCalculatingShipping && (\n                            <div className=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                              <div className=\"h-5 w-5 border-2 border-white/10 border-t-white/60 rounded-full animate-spin\" />\n                            </div>\n                          )}\n                        </div>\n                        \n                        {shippingError && (\n                          <motion.p \n                            initial={{ opacity: 0, y: -4 }}\n                            animate={{ opacity: 1, y: 0 }}\n                            className=\"text-[13px] text-red-400/90 font-light pl-1\"\n                          >\n                            {shippingError}\n                          </motion.p>\n                        )}\n                        \n                        <AnimatePresence>\n                          {shippingResult && (\n                            <motion.div \n                              initial={{ opacity: 0, height: 0 }}\n                              animate={{ opacity: 1, height: \"auto\" }}\n                              exit={{ opacity: 0, height: 0 }}\n                              transition={{ duration: 0.3 }}\n                              className=\"overflow-hidden\"\n                            >\n                              <div className=\"bg-white/[0.04] rounded-2xl p-4 space-y-3\">\n                                <div className=\"space-y-1\">\n                                  <p className=\"text-[10px] uppercase tracking-widest text-white/40 font-bold\">{ctaConfig?.shippingLabel || \"frete padr√£o\"}</p>\n                                  <p className=\"text-[13px] text-white/80 font-light\">\n                                    {shippingResult.price === 0\n                                      ? `${ctaConfig?.ctaShippingFreeText || \"chegar√° gr√°tis\"} ${shippingResult.days}`\n                                      : `${ctaConfig?.ctaShippingPaidText || \"chegar√° por\"} ${formatPrice(shippingResult.price)} ${shippingResult.days}`}\n                                  </p>\n                                  <p className=\"text-[11px] text-white/40 font-light truncate max-w-[200px]\">{shippingResult.address}</p>\n                                </div>\n                              </div>\n                            </motion.div>\n                          )}\n                        </AnimatePresence>\n                      </motion.div>\n\n                      {/* Action Buttons - Apple Style */}\n                      <motion.div \n                        initial={{ opacity: 0, y: 12 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        transition={{ delay: 0.2 }}\n                        className=\"space-y-3\"\n                      >\n                        <button \n                          onClick={() => {\n                            addToMochila();\n                            navigate('/checkout');\n                          }} \n                          disabled={isAddingToMochila}\n                          className=\"w-full h-[54px] rounded-[14px] text-[15px] font-semibold tracking-[-0.01em] transition-all duration-200 active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2\"\n                          style={{ backgroundColor: ctaConfig?.buyNowBg || '#ffffff', color: ctaConfig?.buyNowTextColor || '#1d1d1f' }}\n                          data-testid=\"button-buy-now\"\n                        >\n                          {isAddingToMochila ? (\n                            <div className=\"h-5 w-5 border-2 border-[#1d1d1f]/20 border-t-[#1d1d1f] rounded-full animate-spin\" />\n                          ) : (\n                            ctaConfig?.buyNowText || \"comprar agora\"\n                          )}\n                        </button>\n                        \n                        <button \n                          onClick={addToMochila} \n                          disabled={isAddingToMochila}\n                          className=\"w-full h-[50px] rounded-[14px] bg-transparent text-[15px] font-medium tracking-[-0.01em] border transition-all duration-200 hover:bg-white/[0.06] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed\"\n                          style={{ borderColor: ctaConfig?.addToCartBorder || 'rgba(255,255,255,0.12)', color: ctaConfig?.addToCartTextColor || 'rgba(255,255,255,0.9)' }}\n                          data-testid=\"button-add-to-cart\"\n                        >\n                          {ctaConfig?.addToCartText || \"adicionar √† mochila\"}\n                        </button>\n                      </motion.div>\n\n                      {/* Trust Badge */}\n                      <motion.div \n                        initial={{ opacity: 0 }}\n                        animate={{ opacity: 1 }}\n                        transition={{ delay: 0.3 }}\n                        className=\"mt-6 pt-5 border-t border-white/[0.06]\"\n                      >\n                        <div className=\"flex items-center justify-center gap-2 text-white/30\">\n                          {(() => {\n                            const TrustIcon = getTrustIcon();\n                            if (TrustIcon) {\n                              return <TrustIcon className=\"w-4 h-4\" />;\n                            }\n                            return (\n                              <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                                <path fillRule=\"evenodd\" d=\"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z\" clipRule=\"evenodd\" />\n                              </svg>\n                            );\n                          })()}\n                          <span className=\"text-[11px] font-medium tracking-wide\">{ctaConfig?.trustText || \"pagamento seguro via mercado pago\"}</span>\n                        </div>\n                      </motion.div>\n                    </div>\n                  </motion.div>\n                )}\n              </AnimatePresence>\n\n              {/* Collapsible Details Sections (Apple Style) */}\n              <div className=\"pt-6 space-y-3 pb-8\">\n                {(product.fabricDescription || (product.fabricTech && Array.isArray(product.fabricTech) && product.fabricTech.length > 0 && product.fabricTech[0] !== '') || product.careInstructions) && (\n                  <>\n                    <Separator className=\"opacity-50\" />\n                    \n                    <Collapsible className=\"w-full group\">\n                      <CollapsibleTrigger asChild>\n                        <Button variant=\"ghost\" className=\"w-full justify-between p-0 h-14 hover:bg-transparent lowercase text-foreground group\">\n                          <span className=\"flex items-center gap-3 font-medium\">\n                            <Droplet className=\"h-4 w-4 opacity-40\" />\n                            tecido e tecnologias\n                          </span>\n                          <ChevronDown className=\"h-4 w-4 opacity-40 transition-transform duration-300 group-data-[state=open]:rotate-180\" />\n                        </Button>\n                      </CollapsibleTrigger>\n                      <CollapsibleContent className=\"pb-6 pt-2 space-y-6\">\n                        {product.fabricDescription && (\n                          <div className=\"space-y-2\">\n                            <p className=\"text-[10px] uppercase tracking-widest text-muted-foreground font-bold\">composi√ß√£o</p>\n                            <p className=\"text-sm text-muted-foreground font-light whitespace-pre-line\">\n                              {product.fabricDescription}\n                            </p>\n                          </div>\n                        )}\n                        \n                        {product.fabricTech && Array.isArray(product.fabricTech) && product.fabricTech.length > 0 && product.fabricTech[0] !== '' && (\n                          <div className=\"grid grid-cols-2 gap-2\">\n                            {product.fabricTech.map((tech: string, i: number) => (\n                              <div key={i} className=\"flex items-center gap-2 text-[11px] text-muted-foreground font-light lowercase\">\n                                <Zap className=\"h-3 w-3 text-primary opacity-40\" />\n                                {tech}\n                              </div>\n                            ))}\n                          </div>\n                        )}\n\n                        {product.careInstructions && (\n                          <div className=\"pt-4 border-t border-border/5 space-y-2\">\n                            <p className=\"text-[10px] uppercase tracking-widest text-muted-foreground font-bold\">cuidados</p>\n                            <p className=\"text-sm text-muted-foreground font-light whitespace-pre-line\">\n                              {product.careInstructions}\n                            </p>\n                          </div>\n                        )}\n                      </CollapsibleContent>\n                    </Collapsible>\n                  </>\n                )}\n\n                <Separator className=\"opacity-50\" />\n\n                {/* Reviews Summary Trigger */}\n                {product.reviewsEnabled !== false && (\n                  <Button \n                    variant=\"ghost\" \n                    className=\"w-full justify-between p-0 h-14 hover:bg-transparent lowercase text-foreground group\"\n                    onClick={() => setShowReviewsModal(true)}\n                  >\n                    <span className=\"flex items-center gap-3 font-medium\">\n                      <Star className=\"h-4 w-4 opacity-40\" />\n                      avalia√ß√µes ({product.reviewsCount || 0})\n                    </span>\n                    <div className=\"flex items-center gap-3\">\n                      <ChevronRight className=\"h-4 w-4 opacity-40\" />\n                    </div>\n                  </Button>\n                )}\n                \n                {product.reviewsEnabled !== false && <Separator className=\"opacity-50\" />}\n              </div>\n            </div>\n            </div>\n          </div>\n        </div>\n\n        <RelatedProducts currentProductId={id || product.id} />\n      </div>\n\n      {product.reviewsEnabled !== false && (\n        <ReviewsModal productId={product.id} isOpen={showReviewsModal} onOpenChange={setShowReviewsModal} productName={product.name} />\n      )}\n\n      {/* Installments Modal */}\n      <Dialog open={showInstallmentsModal} onOpenChange={setShowInstallmentsModal}>\n        <DialogContent className=\"max-w-md rounded-[32px] p-8\">\n          <DialogHeader>\n            <DialogTitle className=\"text-2xl font-light lowercase tracking-tight mb-6\">op√ß√µes de parcelamento</DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <div className=\"grid grid-cols-1 gap-2\">\n              {installmentOptions.map((opt: any) => (\n                <div \n                  key={opt.installments}\n                  className=\"flex items-center justify-between p-4 rounded-xl border border-border/10 hover:bg-muted/30 transition-colors\"\n                >\n                  <div className=\"flex flex-col\">\n                    <span className=\"text-sm font-medium\">{opt.installments}x de <span className=\"normal-case\">{formatPrice(opt.installmentValue)}</span></span>\n                    <span className=\"text-[10px] text-muted-foreground\">\n                      {opt.isInterestFree ? \"sem juros\" : \"com acr√©scimo\"}\n                    </span>\n                  </div>\n                  <span className=\"text-[10px] uppercase tracking-wider opacity-40 font-bold\">total: <span className=\"normal-case\">{formatPrice(opt.totalPrice)}</span></span>\n                </div>\n              ))}\n            </div>\n            <div className=\"pt-6 border-t border-border/10 mt-6 flex items-center justify-center gap-4 opacity-60\">\n              <SiVisa className=\"h-6 w-6\" />\n              <SiMastercard className=\"h-5 w-5\" />\n              <SiAmericanexpress className=\"h-5 w-5\" />\n              <SiPix className=\"h-4 w-4\" />\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n      \n      <MochilaToast item={toastItem} isVisible={showToast} onClose={() => setShowToast(false)} onOpenDrawer={() => setIsDrawerOpen(true)} />\n    </div>\n  );\n}\n","path":null,"size_bytes":64046,"size_tokens":null},"client/src/components/SizeSelector.tsx":{"content":"import { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { cn } from \"@/lib/utils\";\n\ninterface SizeOption {\n  value: string;\n  label: string;\n  available: boolean;\n  measurements?: {\n    chest: string;\n    length: string;\n  };\n}\n\ninterface SizeSelectorProps {\n  sizes: SizeOption[];\n  selectedSize: string;\n  onSizeChange: (size: string) => void;\n  onSizeGuide?: () => void;\n  className?: string;\n}\n\nexport default function SizeSelector({ \n  sizes, \n  selectedSize, \n  onSizeChange, \n  onSizeGuide,\n  className \n}: SizeSelectorProps) {\n  return (\n    <div className={cn(\"space-y-4\", className)}>\n      <div className=\"flex items-center justify-between\">\n        <label className=\"text-sm font-medium text-foreground\">\n          tamanho: {selectedSize || 'selecione'}\n        </label>\n        {onSizeGuide && (\n          <button\n            onClick={onSizeGuide}\n            className=\"text-xs text-muted-foreground hover:text-foreground transition-colors border-b border-current\"\n            data-testid=\"button-size-guide\"\n          >\n            guia de medidas\n          </button>\n        )}\n      </div>\n      \n      <div className=\"flex gap-2 flex-wrap\">\n        {sizes.map((size) => (\n          <Button\n            key={size.value}\n            variant={selectedSize === size.value ? \"default\" : \"outline\"}\n            size=\"sm\"\n            onClick={() => size.available && onSizeChange(size.value)}\n            disabled={!size.available}\n            className={cn(\n              \"relative min-w-[3rem]\",\n              !size.available && \"opacity-50 cursor-not-allowed\"\n            )}\n            data-testid={`button-size-${size.value}`}\n          >\n            {size.label}\n            {!size.available && (\n              <div className=\"absolute inset-0 flex items-center justify-center\">\n                <div className=\"w-full h-0.5 bg-muted-foreground transform rotate-45\" />\n              </div>\n            )}\n          </Button>\n        ))}\n      </div>\n      \n      {selectedSize && (\n        <div className=\"text-xs text-muted-foreground\">\n          {sizes.find(s => s.value === selectedSize)?.measurements && (\n            <div className=\"space-y-1\">\n              <div>peito: {sizes.find(s => s.value === selectedSize)?.measurements?.chest}</div>\n              <div>comprimento: {sizes.find(s => s.value === selectedSize)?.measurements?.length}</div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}","path":null,"size_bytes":2487,"size_tokens":null},"client/src/components/examples/ProductCard.tsx":{"content":"import ProductCard from '../ProductCard';\nimport tshirtImage1 from '@assets/generated_images/camiseta_crist√£_luxuosa_modelo_jovem_b1688629.png';\nimport tshirtImage2 from '@assets/generated_images/camiseta_preta_luxo_cruz_dourada_4ac95e78.png';\n\nexport default function ProductCardExample() {\n  return (\n    <div className=\"p-8 max-w-sm\">\n      <ProductCard\n        id=\"1\"\n        name=\"camiseta essencial cruz\"\n        price={129.90}\n        originalPrice={179.90}\n        images={[tshirtImage1, tshirtImage2]}\n        colors={[\"#ffffff\", \"#000000\", \"#f5f5f5\"]}\n        sizes={[\"P\", \"M\", \"G\", \"GG\"]}\n        isNew={true}\n        isFavorite={false}\n        onFavoriteToggle={(id) => console.log('favorite toggled:', id)}\n        onQuickAdd={(id) => console.log('quick add:', id)}\n      />\n    </div>\n  );\n}","path":null,"size_bytes":806,"size_tokens":null},"client/src/components/ProductCarousel3D.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport type { Product } from \"@shared/schema\";\n\ndeclare global {\n  namespace JSX {\n    interface IntrinsicElements {\n      'model-viewer': any;\n    }\n  }\n}\n\ninterface ProductCarousel3DProps {\n  products: Product[];\n}\n\nexport default function ProductCarousel3D({ products }: ProductCarousel3DProps) {\n  const [modelViewerLoaded, setModelViewerLoaded] = useState(false);\n  const [hasWebGL, setHasWebGL] = useState(true);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [direction, setDirection] = useState(0);\n  \n  useEffect(() => {\n    const canvas = document.createElement('canvas');\n    const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');\n    if (!gl) {\n      console.warn('WebGL not supported, using fallback');\n      setHasWebGL(false);\n      setModelViewerLoaded(true);\n      return;\n    }\n\n    if (!customElements.get('model-viewer')) {\n      import(\"@google/model-viewer\")\n        .then(() => {\n          setModelViewerLoaded(true);\n        })\n        .catch((err) => {\n          console.error(\"Failed to load model-viewer:\", err);\n          setHasWebGL(false);\n          setModelViewerLoaded(true);\n        });\n    } else {\n      setModelViewerLoaded(true);\n    }\n\n    const handleError = (e: ErrorEvent) => {\n      if (e.message?.includes('xr') || e.message?.includes('XR') || e.message?.includes('WebGL')) {\n        e.preventDefault();\n        e.stopPropagation();\n        console.warn('WebXR/WebGL error suppressed:', e.message);\n        setHasWebGL(false);\n      }\n    };\n    window.addEventListener('error', handleError, true);\n    return () => window.removeEventListener('error', handleError, true);\n  }, []);\n\n  if (!products || products.length === 0) {\n    return null;\n  }\n\n  const goToPrevious = () => {\n    setDirection(-1);\n    setCurrentIndex((prev) => (prev - 1 + products.length) % products.length);\n  };\n\n  const goToNext = () => {\n    setDirection(1);\n    setCurrentIndex((prev) => (prev + 1) % products.length);\n  };\n\n  const getPrevIndex = () => (currentIndex - 1 + products.length) % products.length;\n  const getNextIndex = () => (currentIndex + 1) % products.length;\n\n  const positionConfigs = {\n    left: {\n      x: '-60%',\n      y: '15%',\n      scale: 0.65,\n      opacity: 0.4,\n      zIndex: 10,\n      cameraOrbit: '90deg 75deg 105%',\n      width: 'clamp(240px, 55vw, 380px)',\n      height: 'clamp(240px, 55vw, 380px)',\n    },\n    center: {\n      x: '0%',\n      y: '0%',\n      scale: 1,\n      opacity: 1,\n      zIndex: 30,\n      cameraOrbit: '0deg 75deg 105%',\n      width: 'clamp(320px, 85vw, 520px)',\n      height: 'clamp(320px, 85vw, 520px)',\n    },\n    right: {\n      x: '60%',\n      y: '15%',\n      scale: 0.65,\n      opacity: 0.4,\n      zIndex: 10,\n      cameraOrbit: '-90deg 75deg 105%',\n      width: 'clamp(240px, 55vw, 380px)',\n      height: 'clamp(240px, 55vw, 380px)',\n    },\n  };\n\n  const slideVariants = {\n    enter: (direction: number) => ({\n      x: direction > 0 ? '100%' : '-100%',\n      opacity: 0,\n      scale: 0.5,\n    }),\n    center: {\n      x: '0%',\n      y: '0%',\n      opacity: 1,\n      scale: 1,\n      zIndex: 30,\n    },\n    exit: (direction: number) => ({\n      x: direction < 0 ? '100%' : '-100%',\n      opacity: 0,\n      scale: 0.5,\n    }),\n  };\n\n  const renderTshirt = (position: 'left' | 'center' | 'right', index: number) => {\n    const product = products[index];\n    if (!product) return null;\n    \n    const config = positionConfigs[position];\n    const isCenter = position === 'center';\n\n    return (\n      <motion.div\n        key={`${position}-${index}`}\n        className=\"absolute\"\n        initial={false}\n        animate={{ \n          x: config.x,\n          y: config.y,\n          scale: config.scale,\n          opacity: config.opacity,\n        }}\n        transition={{\n          duration: 0.6,\n          ease: [0.32, 0.72, 0, 1],\n        }}\n        style={{\n          transformStyle: 'preserve-3d',\n          pointerEvents: isCenter ? 'auto' : 'none',\n          zIndex: config.zIndex,\n        }}\n      >\n        <div className=\"relative\">\n          {hasWebGL ? (\n            <model-viewer\n              src={product.modelUrl || \"/attached_assets/tshirt_1759213351118.glb\"}\n              alt={product.name}\n              camera-controls={isCenter ? \"true\" : undefined}\n              disable-zoom=\"true\"\n              disable-pan=\"true\"\n              camera-orbit={config.cameraOrbit}\n              min-camera-orbit={`auto 75deg 105%`}\n              max-camera-orbit={`auto 75deg 105%`}\n              bounds=\"tight\"\n              loading=\"eager\"\n              interaction-prompt=\"none\"\n              reveal=\"auto\"\n              shadow-intensity=\"0\"\n              style={{\n                width: config.width,\n                height: config.height,\n                '--progress-bar-color': 'transparent',\n              } as any}\n            />\n          ) : (\n            <div \n              className=\"flex items-center justify-center bg-muted/30 rounded-lg\"\n              style={{\n                width: config.width,\n                height: config.height,\n              }}\n            >\n              <div className=\"text-center p-4\">\n                <p className=\"text-muted-foreground text-sm\">{product.name}</p>\n              </div>\n            </div>\n          )}\n          \n          {isCenter && (\n            <motion.div\n              key={`button-${product.id}`}\n              initial={{ opacity: 0, scale: 0.8, y: 20 }}\n              animate={{ opacity: 1, scale: 1, y: 0 }}\n              transition={{ \n                delay: 0.2, \n                duration: 0.4,\n                ease: [0.22, 0.61, 0.36, 1]\n              }}\n              className=\"absolute bottom-4 sm:bottom-12 left-1/2 -translate-x-1/2\"\n            >\n              <Link href={`/product/${product.id}`}>\n                <Button\n                  variant=\"outline\"\n                  size=\"lg\"\n                  className=\"backdrop-blur-xl bg-background/30 border-border/50 hover:bg-background/50 shadow-2xl hover-elevate active-elevate-2\"\n                  data-testid=\"button-view-product\"\n                  aria-label={`Ver detalhes de ${product.name}`}\n                >\n                  Ver Produto\n                </Button>\n              </Link>\n            </motion.div>\n          )}\n        </div>\n      </motion.div>\n    );\n  };\n\n  if (!modelViewerLoaded) {\n    return (\n      <div className=\"relative w-full h-full flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-pulse text-muted-foreground\">Carregando modelos 3D...</div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"relative w-full h-full flex items-center justify-center overflow-hidden\">\n      <div \n        className=\"relative w-full max-w-7xl h-[500px] flex items-center justify-center\"\n        style={{ \n          perspective: '1800px',\n          perspectiveOrigin: 'center center'\n        }}\n      >\n        <AnimatePresence initial={false} custom={direction}>\n          {products.length > 1 && renderTshirt('left', getPrevIndex())}\n          {renderTshirt('center', currentIndex)}\n          {products.length > 1 && renderTshirt('right', getNextIndex())}\n        </AnimatePresence>\n      </div>\n\n      {products.length > 1 && (\n        <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-40 flex gap-3\">\n          <button\n            onClick={goToPrevious}\n            className=\"p-2 rounded-full bg-background/20 backdrop-blur-md border border-border/30 text-foreground hover-elevate active-elevate-2 transition-all\"\n            data-testid=\"button-carousel-previous\"\n            aria-label=\"Produto anterior\"\n          >\n            <ChevronLeft className=\"h-6 w-6\" />\n          </button>\n          \n          <button\n            onClick={goToNext}\n            className=\"p-2 rounded-full bg-background/20 backdrop-blur-md border border-border/30 text-foreground hover-elevate active-elevate-2 transition-all\"\n            data-testid=\"button-carousel-next\"\n            aria-label=\"Pr√≥ximo produto\"\n          >\n            <ChevronRight className=\"h-6 w-6\" />\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":8419,"size_tokens":null},"client/src/components/ProductCard.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Heart } from \"lucide-react\";\nimport { useState, memo, useCallback, useRef, useMemo } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { motion, useScroll, useSpring, useTransform, AnimatePresence } from \"framer-motion\";\n\nconst FALLBACK_IMAGE = \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='533' viewBox='0 0 400 533'%3E%3Crect width='400' height='533' fill='%23f3f4f6'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='system-ui, sans-serif' font-size='18' fill='%239ca3af'%3Eimagem indispon√≠vel%3C/text%3E%3C/svg%3E\";\n\ninterface ProductCardProps {\n  id: string;\n  sku?: string;\n  slug?: string;\n  name: string;\n  price: number;\n  originalPrice?: number;\n  installmentsMax?: number;\n  installmentsValue?: number;\n  installmentsInterestFree?: boolean;\n  images: string[];\n  colors?: string[] | null;\n  sizes?: string[] | null;\n  isNew?: boolean;\n  isFavorite?: boolean;\n  showInstallments?: boolean;\n  onFavoriteToggle?: (id: string, productInfo: { name: string; price: number; image: string }) => void;\n  disableLazyLoading?: boolean;\n}\n\nconst ProductCard = memo(function ProductCard({\n  id,\n  sku,\n  slug,\n  name,\n  price,\n  originalPrice,\n  installmentsMax,\n  installmentsValue,\n  installmentsInterestFree,\n  images,\n  isNew = false,\n  isFavorite = false,\n  showInstallments = true,\n  onFavoriteToggle,\n  disableLazyLoading = false\n}: ProductCardProps) {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n  const [, setLocation] = useLocation();\n  const cardRef = useRef<HTMLDivElement>(null);\n\n  const { scrollYProgress } = useScroll({\n    target: cardRef,\n    offset: [\"start end\", \"end start\"]\n  });\n\n  const rawScale = useTransform(scrollYProgress, [0, 0.3, 0.7, 1], [1.15, 1.15, 1.15, 1]);\n  const scale = useSpring(rawScale, {\n    stiffness: 50,\n    damping: 20,\n    mass: 0.5,\n    restDelta: 0.0001\n  });\n\n  const isDragging = useRef(false);\n\n  const handleDragStart = () => {\n    isDragging.current = true;\n  };\n\n  const handleDragEnd = (_: any, info: any) => {\n    setTimeout(() => {\n      isDragging.current = false;\n    }, 50);\n\n    const threshold = 50;\n    if (images.length <= 1) return;\n\n    if (info.offset.x < -threshold) {\n      setCurrentImageIndex((prev) => (prev + 1) % images.length);\n    } else if (info.offset.x > threshold) {\n      setCurrentImageIndex((prev) => (prev - 1 + images.length) % images.length);\n    }\n  };\n\n  const handleTap = () => {\n    if (!isDragging.current) {\n      setLocation(`/${slug || sku || id}`);\n    }\n  };\n\n  const formatPrice = useCallback((value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  }, []);\n\n  const handleFavoriteClick = useCallback((e: React.MouseEvent) => {\n    e.preventDefault();\n    e.stopPropagation();\n    onFavoriteToggle?.(id, { name, price, image: images[0] || '' });\n  }, [onFavoriteToggle, id, name, price, images]);\n\n  const displayImage = images.length === 0 \n    ? FALLBACK_IMAGE \n    : (images[currentImageIndex] || images[0]);\n\n  const formattedPrice = useMemo(() => formatPrice(price), [price, formatPrice]);\n  \n  const formattedOriginalPrice = useMemo(() => \n    originalPrice ? formatPrice(originalPrice) : null, \n    [originalPrice, formatPrice]\n  );\n  \n  const installmentPrice = useMemo(() => \n    installmentsValue \n      ? formatPrice(installmentsValue)\n      : formatPrice(price / (installmentsMax || 12)),\n    [installmentsValue, installmentsMax, price, formatPrice]\n  );\n  \n  const discountPercentage = useMemo(() => \n    originalPrice ? Math.round(((originalPrice - price) / originalPrice) * 100) : null,\n    [originalPrice, price]\n  );\n\n  return (\n    <Card ref={cardRef} className=\"group overflow-hidden hover-elevate border-0 shadow-sm\">\n      <div className=\"relative\">\n        {/* Product Image Carousel */}\n        <div \n          className=\"aspect-[3/4] bg-muted overflow-hidden cursor-pointer relative touch-pan-y\"\n          data-testid={`image-product-${id}`}\n        >\n          <motion.img\n            key={currentImageIndex}\n            src={displayImage}\n            alt={name}\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0 }}\n            dragElastic={0.2}\n            onDragStart={handleDragStart}\n            onDragEnd={handleDragEnd}\n            onTap={handleTap}\n            style={{ scale }}\n            className=\"w-full h-full object-cover select-none\"\n            {...(!disableLazyLoading && { loading: \"lazy\" as const, decoding: \"async\" as const })}\n          />\n\n          {/* Carousel Indicators */}\n          {images.length > 1 && (\n            <div className=\"absolute bottom-3 left-1/2 -translate-x-1/2 flex gap-1.5 z-10 pointer-events-none\">\n              {images.map((_, idx) => (\n                <div \n                  key={idx}\n                  className={`h-1 rounded-full transition-all duration-300 ${\n                    idx === currentImageIndex ? \"w-4 bg-white\" : \"w-1 bg-white/50\"\n                  }`}\n                />\n              ))}\n            </div>\n          )}\n        </div>\n        \n        {/* Badges */}\n        <div className=\"absolute top-3 left-3 flex flex-col gap-1.5 pointer-events-none z-10\">\n          {isNew && (\n            <span\n              className=\"inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-medium tracking-wide uppercase bg-white/80 dark:bg-black/60 text-foreground backdrop-blur-xl shadow-sm\"\n              data-testid={`badge-new-${id}`}\n            >\n              novo\n            </span>\n          )}\n          {discountPercentage && (\n            <span\n              className=\"inline-flex items-center px-2.5 py-1 rounded-full text-[10px] font-medium tracking-wide uppercase bg-black/70 dark:bg-white/80 text-white dark:text-black backdrop-blur-xl shadow-sm\"\n              data-testid={`badge-sale-${id}`}\n            >\n              -{discountPercentage}%\n            </span>\n          )}\n        </div>\n        \n        {/* Actions */}\n        <div className=\"absolute top-3 right-3 flex flex-col gap-2 transition-opacity z-20 opacity-0 group-hover:opacity-100\">\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            className=\"h-8 w-8\"\n            onClick={handleFavoriteClick}\n            data-testid={`button-favorite-${id}`}\n          >\n            <Heart className={`h-4 w-4 ${isFavorite ? 'fill-current text-red-500' : ''}`} />\n          </Button>\n        </div>\n      </div>\n      \n      <Link href={`/${slug || sku || id}`}>\n        <CardContent className=\"px-4 pt-3 pb-4 cursor-pointer\">\n          <p className=\"text-lg font-medium text-foreground leading-snug tracking-tight\" data-testid={`text-name-${id}`}>\n            {name}\n          </p>\n          <div className=\"mt-1.5\">\n            <div className=\"flex items-baseline gap-1.5\">\n              <span className=\"text-[15px] font-semibold tracking-tight text-foreground\" data-testid={`text-price-${id}`}>\n                {formattedPrice}\n              </span>\n              {formattedOriginalPrice && (\n                <span className=\"text-[13px] text-muted-foreground/60 line-through\" data-testid={`text-original-price-${id}`}>\n                  {formattedOriginalPrice}\n                </span>\n              )}\n            </div>\n            {showInstallments && (\n              <p className=\"text-[11px] text-muted-foreground/70 mt-0.5 tracking-tight\">\n                at√© {installmentsMax || 12}x de {installmentPrice}\n                {installmentsInterestFree !== false ? \" sem juros\" : \"\"}\n              </p>\n            )}\n          </div>\n        </CardContent>\n      </Link>\n    </Card>\n  );\n});\n\nexport default ProductCard;\n","path":null,"size_bytes":7913,"size_tokens":null},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","path":null,"size_bytes":2695,"size_tokens":null},"client/src/contexts/FavoritosContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, useCallback, useMemo, useRef, ReactNode } from \"react\";\nimport type { FavoritoToastItem } from \"@/components/FavoritoToast\";\n\ninterface FavoritoItem {\n  id: string;\n  timestamp: number;\n}\n\ninterface FavoritosContextType {\n  favoritos: string[];\n  isFavorito: (productId: string) => boolean;\n  toggleFavorito: (productId: string) => void;\n  isDrawerOpen: boolean;\n  setIsDrawerOpen: (open: boolean) => void;\n  showFavoritoToast: boolean;\n  favoritoToastItem: FavoritoToastItem | null;\n  triggerFavoritoToast: (item: FavoritoToastItem) => void;\n  closeFavoritoToast: () => void;\n}\n\nconst FavoritosContext = createContext<FavoritosContextType | undefined>(undefined);\n\nconst STORAGE_KEY = \"oudla_favoritos\";\nconst CACHE_DURATION = 60 * 24 * 60 * 60 * 1000; // 60 dias em milissegundos\n\nexport function FavoritosProvider({ children }: { children: ReactNode }) {\n  const [favoritos, setFavoritos] = useState<string[]>([]);\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\n  const [showFavoritoToast, setShowFavoritoToast] = useState(false);\n  const [favoritoToastItem, setFavoritoToastItem] = useState<FavoritoToastItem | null>(null);\n  const toastTimeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n\n  useEffect(() => {\n    const loadFavoritos = () => {\n      try {\n        if (typeof window === 'undefined' || !window.localStorage) {\n          console.warn(\"localStorage n√£o est√° dispon√≠vel\");\n          return;\n        }\n\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n          const items: FavoritoItem[] = JSON.parse(stored);\n          \n          if (!Array.isArray(items)) {\n            console.error(\"Dados de favoritos corrompidos, limpando...\");\n            localStorage.removeItem(STORAGE_KEY);\n            return;\n          }\n\n          const now = Date.now();\n          \n          const validItems = items.filter(item => \n            item && \n            typeof item.id === 'string' && \n            typeof item.timestamp === 'number' &&\n            now - item.timestamp < CACHE_DURATION\n          );\n          \n          if (validItems.length !== items.length) {\n            localStorage.setItem(STORAGE_KEY, JSON.stringify(validItems));\n          }\n          \n          setFavoritos(validItems.map(item => item.id));\n        }\n      } catch (error) {\n        if (error instanceof SyntaxError) {\n          console.error(\"Erro ao parsear favoritos, dados corrompidos:\", error);\n          try {\n            localStorage.removeItem(STORAGE_KEY);\n          } catch (e) {\n            console.error(\"N√£o foi poss√≠vel limpar dados corrompidos:\", e);\n          }\n        } else if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel salvar favoritos\");\n        } else {\n          console.error(\"Erro ao carregar favoritos:\", error);\n        }\n      }\n    };\n\n    loadFavoritos();\n  }, []);\n\n  const toggleFavorito = useCallback((productId: string) => {\n    setFavoritos(prev => {\n      const newFavoritos = prev.includes(productId)\n        ? prev.filter(id => id !== productId)\n        : [...prev, productId];\n      \n      const items: FavoritoItem[] = newFavoritos.map(id => ({\n        id,\n        timestamp: Date.now()\n      }));\n      \n      try {\n        if (typeof window !== 'undefined' && window.localStorage) {\n          localStorage.setItem(STORAGE_KEY, JSON.stringify(items));\n        }\n      } catch (error) {\n        if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel salvar favorito\");\n        } else {\n          console.error(\"Erro ao salvar favorito:\", error);\n        }\n      }\n      \n      return newFavoritos;\n    });\n  }, []);\n\n  const isFavorito = useCallback((productId: string) => {\n    return favoritos.includes(productId);\n  }, [favoritos]);\n\n  const triggerFavoritoToast = useCallback((item: FavoritoToastItem) => {\n    if (toastTimeoutRef.current) {\n      clearTimeout(toastTimeoutRef.current);\n    }\n    setFavoritoToastItem(item);\n    setShowFavoritoToast(true);\n    toastTimeoutRef.current = setTimeout(() => {\n      setShowFavoritoToast(false);\n    }, 3000);\n  }, []);\n\n  const closeFavoritoToast = useCallback(() => {\n    if (toastTimeoutRef.current) {\n      clearTimeout(toastTimeoutRef.current);\n    }\n    setShowFavoritoToast(false);\n  }, []);\n\n  const contextValue = useMemo(() => ({\n    favoritos, \n    isFavorito, \n    toggleFavorito,\n    isDrawerOpen,\n    setIsDrawerOpen,\n    showFavoritoToast,\n    favoritoToastItem,\n    triggerFavoritoToast,\n    closeFavoritoToast\n  }), [favoritos, isFavorito, toggleFavorito, isDrawerOpen, showFavoritoToast, favoritoToastItem, triggerFavoritoToast, closeFavoritoToast]);\n\n  return (\n    <FavoritosContext.Provider value={contextValue}>\n      {children}\n    </FavoritosContext.Provider>\n  );\n}\n\nexport function useFavoritos() {\n  const context = useContext(FavoritosContext);\n  if (!context) {\n    throw new Error(\"useFavoritos must be used within FavoritosProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":5161,"size_tokens":null},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","path":null,"size_bytes":1280,"size_tokens":null},"client/src/components/ThemeToggle.tsx":{"content":"import { Moon, Sun } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useEffect, useState } from \"react\";\n\nexport default function ThemeToggle() {\n  const [theme, setTheme] = useState<'light' | 'dark'>('dark');\n\n  useEffect(() => {\n    const stored = localStorage.getItem('theme') as 'light' | 'dark' | null;\n    const initialTheme = stored || 'dark';\n    \n    if (!stored) {\n      localStorage.setItem('theme', 'dark');\n    }\n    \n    setTheme(initialTheme);\n    document.documentElement.classList.toggle('dark', initialTheme === 'dark');\n    document.documentElement.style.colorScheme = initialTheme;\n    // For√ßar fundo escuro no body para evitar flash branco\n    document.body.style.backgroundColor = initialTheme === 'dark' ? '#141517' : '#fafafa';\n\n    const handleExternalToggle = () => {\n      toggleTheme();\n    };\n\n    window.addEventListener('toggle-theme', handleExternalToggle);\n    return () => window.removeEventListener('toggle-theme', handleExternalToggle);\n  }, [theme]);\n\n  const toggleTheme = () => {\n    const newTheme = theme === 'light' ? 'dark' : 'light';\n    setTheme(newTheme);\n    localStorage.setItem('theme', newTheme);\n    document.documentElement.classList.toggle('dark', newTheme === 'dark');\n    document.documentElement.style.colorScheme = newTheme;\n    document.body.style.backgroundColor = newTheme === 'dark' ? '#141517' : '#fafafa';\n  };\n\n  return (\n    <Button\n      variant=\"ghost\"\n      size=\"icon\"\n      onClick={toggleTheme}\n      data-testid=\"button-theme-toggle\"\n      className=\"h-9 w-9\"\n    >\n      {theme === 'light' ? <Moon className=\"h-4 w-4\" /> : <Sun className=\"h-4 w-4\" />}\n      <span className=\"sr-only\">alternar tema</span>\n    </Button>\n  );\n}","path":null,"size_bytes":1731,"size_tokens":null},"client/src/components/examples/Header.tsx":{"content":"import Header from '../Header';\n\nexport default function HeaderExample() {\n  return <Header />;\n}","path":null,"size_bytes":97,"size_tokens":null},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","path":null,"size_bytes":7428,"size_tokens":null},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","path":null,"size_bytes":261,"size_tokens":null},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser, \n  type Product, \n  type InsertProduct,\n  type CartItem,\n  type InsertCartItem,\n  type Favorite,\n  type InsertFavorite,\n  type Review,\n  type InsertReview,\n  type ReviewImage,\n  type InsertReviewImage,\n  type ReviewLike,\n  type InsertReviewLike,\n  type ReviewQA,\n  type InsertReviewQA,\n  type ProductImage,\n  type InsertProductImage,\n  type UpdateUserMeasurements,\n  type SiteBanner,\n  type InsertSiteBanner,\n  type SiteContent,\n  type InsertSiteContent,\n  type SiteSetting,\n  type InsertSiteSetting,\n  type SiteVerse,\n  type InsertSiteVerse,\n  type ContentCard,\n  type InsertContentCard,\n  type ContentCardImage,\n  type InsertContentCardImage,\n  type CtaBannerConfig,\n  type InsertCtaBannerConfig,\n  type Faq,\n  type InsertFaq,\n  type AdminUser,\n  type InsertAdminUser,\n  type Order,\n  type InsertOrder,\n  type OrderItem,\n  type InsertOrderItem,\n  type ProductMeasurementField,\n  type InsertProductMeasurementField,\n  type ProductSizeMeasurement,\n  type InsertProductSizeMeasurement,\n  type CompanyInfo,\n  type InsertCompanyInfo,\n  type AdminProductReview,\n  type InsertAdminProductReview,\n  type ProductCoupon,\n  type InsertProductCoupon,\n  type GlobalCoupon,\n  type InsertGlobalCoupon,\n  type NewsletterSubscriber,\n  type InsertNewsletterSubscriber,\n  type NewsletterSettings,\n  type InsertNewsletterSettings,\n  type TrackingPixels,\n  type InsertTrackingPixels,\n  type EmailTemplate,\n  type InsertEmailTemplate,\n  type CookieSettings,\n  type InsertCookieSettings,\n  users,\n  products,\n  cartItems,\n  favorites,\n  reviews,\n  reviewImages,\n  reviewLikes,\n  reviewQA,\n  productImages,\n  adminProductReviews,\n  siteBanners,\n  siteContent,\n  siteSettings,\n  siteVerses,\n  contentCards,\n  contentCardImages,\n  ctaBannerConfigs,\n  faqs,\n  adminUsers,\n  orders,\n  orderItems,\n  productMeasurementFields,\n  productSizeMeasurements,\n  companyInfo,\n  productCoupons,\n  globalCoupon,\n  newsletterSubscribers,\n  newsletterSettings,\n  productInstallmentOptions,\n  trackingPixels,\n  emailTemplates,\n  cookieSettings\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport { eq, and, or, desc, asc, sql, inArray } from \"drizzle-orm\";\nimport { db } from \"./db\";\n\nexport interface IStorage {\n  // User methods\n  getUser(id: string): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserMeasurements(userId: string, measurements: UpdateUserMeasurements): Promise<User | undefined>;\n  \n  // Product methods\n  getProducts(): Promise<Product[]>;\n  getAllProducts(): Promise<Product[]>;\n  getProductsWithPresentationImages(): Promise<(Product & { images: string[] })[]>;\n  getProduct(id: string): Promise<Product | undefined>;\n  getProductById(id: string): Promise<Product | undefined>;\n  getProductImages(productId: string): Promise<ProductImage[]>;\n  createProduct(product: InsertProduct): Promise<Product>;\n  addProductImage(image: InsertProductImage): Promise<ProductImage>;\n  \n  // Cart methods\n  getCartItems(userId: string): Promise<CartItem[]>;\n  addToCart(item: InsertCartItem): Promise<CartItem>;\n  updateCartItem(id: string, quantity: number, userId: string): Promise<CartItem | undefined>;\n  removeFromCart(id: string, userId: string): Promise<boolean>;\n  clearCart(userId: string): Promise<boolean>;\n  \n  // Favorites methods\n  getFavorites(userId: string): Promise<Favorite[]>;\n  addFavorite(favorite: InsertFavorite): Promise<Favorite>;\n  removeFavorite(userId: string, productId: string): Promise<boolean>;\n  isFavorite(userId: string, productId: string): Promise<boolean>;\n  \n  // Review methods\n  getReviews(productId: string): Promise<Review[]>;\n  getReview(id: string): Promise<Review | undefined>;\n  createReview(review: InsertReview): Promise<Review>;\n  addReviewImage(image: InsertReviewImage): Promise<ReviewImage>;\n  getReviewImages(reviewId: string): Promise<ReviewImage[]>;\n  likeReview(like: InsertReviewLike): Promise<ReviewLike>;\n  unlikeReview(userId: string, reviewId: string): Promise<boolean>;\n  getReviewLikes(reviewId: string): Promise<ReviewLike[]>;\n  addReviewQA(qa: InsertReviewQA): Promise<ReviewQA>;\n  getReviewQA(reviewId: string): Promise<ReviewQA[]>;\n\n  // Admin product review methods\n  getAdminProductReviews(productId: string): Promise<AdminProductReview[]>;\n  getAdminProductReview(id: string): Promise<AdminProductReview | undefined>;\n  createAdminProductReview(review: InsertAdminProductReview): Promise<AdminProductReview>;\n  updateAdminProductReview(id: string, review: Partial<InsertAdminProductReview>): Promise<AdminProductReview | undefined>;\n  deleteAdminProductReview(id: string): Promise<boolean>;\n\n  // Admin - Site banner methods\n  getSiteBanners(): Promise<SiteBanner[]>;\n  getSiteBanner(id: string): Promise<SiteBanner | undefined>;\n  createSiteBanner(banner: InsertSiteBanner): Promise<SiteBanner>;\n  updateSiteBanner(id: string, banner: Partial<InsertSiteBanner>): Promise<SiteBanner | undefined>;\n  deleteSiteBanner(id: string): Promise<boolean>;\n\n  // Admin - Site content methods\n  getSiteContent(): Promise<SiteContent[]>;\n  getSiteContentByKey(key: string): Promise<SiteContent | undefined>;\n  upsertSiteContent(content: InsertSiteContent): Promise<SiteContent>;\n  deleteSiteContent(key: string): Promise<boolean>;\n\n  // Admin - Site settings methods\n  getSiteSettings(): Promise<SiteSetting[]>;\n  getSiteSettingByKey(key: string): Promise<SiteSetting | undefined>;\n  upsertSiteSetting(setting: InsertSiteSetting): Promise<SiteSetting>;\n\n  // Admin - Site verses methods\n  getSiteVerses(): Promise<SiteVerse[]>;\n  getActiveSiteVerse(): Promise<SiteVerse | undefined>;\n  createSiteVerse(verse: InsertSiteVerse): Promise<SiteVerse>;\n  updateSiteVerse(id: string, verse: Partial<InsertSiteVerse>): Promise<SiteVerse | undefined>;\n  deleteSiteVerse(id: string): Promise<boolean>;\n\n  // Admin - Content cards methods\n  getContentCards(): Promise<ContentCard[]>;\n  getContentCard(id: string): Promise<ContentCard | undefined>;\n  createContentCard(card: InsertContentCard): Promise<ContentCard>;\n  updateContentCard(id: string, card: Partial<InsertContentCard>): Promise<ContentCard | undefined>;\n  deleteContentCard(id: string): Promise<boolean>;\n  \n  // Content card images\n  getContentCardImages(cardId: string): Promise<ContentCardImage[]>;\n  addContentCardImage(image: InsertContentCardImage): Promise<ContentCardImage>;\n  deleteContentCardImage(id: string): Promise<boolean>;\n\n  // Admin - CTA Banner config methods\n  getCtaBannerConfig(): Promise<CtaBannerConfig | undefined>;\n  upsertCtaBannerConfig(config: Partial<InsertCtaBannerConfig>): Promise<CtaBannerConfig>;\n\n  // Installment Options methods\n  getInstallmentOptions(productId: string): Promise<any[]>;\n  updateInstallmentOptions(productId: string, options: any[]): Promise<void>;\n\n  // Admin - FAQ methods\n  getFaqs(): Promise<Faq[]>;\n  getActiveFaqs(): Promise<Faq[]>;\n  getFaq(id: string): Promise<Faq | undefined>;\n  createFaq(faq: InsertFaq): Promise<Faq>;\n  updateFaq(id: string, faq: Partial<InsertFaq>): Promise<Faq | undefined>;\n  deleteFaq(id: string): Promise<boolean>;\n\n  // Admin - Product management\n  updateProduct(id: string, product: Partial<InsertProduct>): Promise<Product | undefined>;\n  deleteProduct(id: string): Promise<boolean>;\n  updateProductImage(id: string, image: Partial<InsertProductImage>): Promise<ProductImage | undefined>;\n  deleteProductImage(id: string): Promise<boolean>;\n\n  // Admin user authentication\n  getAdminByUsername(username: string): Promise<AdminUser | undefined>;\n  updateAdminLastLogin(username: string): Promise<void>;\n\n  // Orders methods\n  createOrder(orderData: Omit<InsertOrder, 'id' | 'createdAt' | 'updatedAt' | 'paidAt'>, items: Omit<InsertOrderItem, 'id' | 'createdAt' | 'orderId'>[]): Promise<Order & { items: OrderItem[] }>;\n  getOrders(options?: { search?: string; status?: string; filter?: 'all' | 'archived' | 'deleted'; sortField?: string; sortDirection?: 'asc' | 'desc' }): Promise<Order[]>;\n  getOrder(id: string): Promise<(Order & { items: OrderItem[] }) | undefined>;\n  getOrderByOrderNumber(orderNumber: string): Promise<Order | undefined>;\n  getOrderByNumberOrTracking(identifier: string): Promise<(Order & { items: OrderItem[] }) | undefined>;\n  getOrderByPaymentPreferenceId(preferenceId: string): Promise<Order | undefined>;\n  updateOrderPaymentStatus(id: string, paymentStatus: string, paymentId?: string, paymentMethod?: string, paymentTypeId?: string, installments?: number): Promise<Order | undefined>;\n  updateOrderPreference(id: string, preferenceId: string): Promise<Order | undefined>;\n  markOrderAsPaid(id: string): Promise<Order | undefined>;\n  updateOrder(id: string, data: Partial<Pick<Order, 'customerName' | 'customerEmail' | 'customerPhone' | 'street' | 'number' | 'complement' | 'neighborhood' | 'city' | 'state' | 'zipCode' | 'internalNotes' | 'orderStatus' | 'trackingCode' | 'shippingMethod' | 'estimatedDeliveryDate' | 'actualDeliveryDate' | 'confirmationEmailSentAt' | 'trackingEmailSentAt' | 'emailDeliveredAt' | 'emailOpenedAt' | 'emailComplainedAt' | 'emailFailedAt' | 'emailFailureReason'>>): Promise<Order | undefined>;\n  archiveOrder(id: string): Promise<Order | undefined>;\n  unarchiveOrder(id: string): Promise<Order | undefined>;\n  softDeleteOrder(id: string): Promise<Order | undefined>;\n  restoreOrder(id: string): Promise<Order | undefined>;\n  getOrderItems(orderId: string): Promise<OrderItem[]>;\n\n  // Product measurement methods\n  getProductMeasurementFields(productId: string): Promise<ProductMeasurementField[]>;\n  createProductMeasurementField(field: InsertProductMeasurementField): Promise<ProductMeasurementField>;\n  updateProductMeasurementField(id: string, data: Partial<InsertProductMeasurementField>): Promise<ProductMeasurementField | undefined>;\n  deleteProductMeasurementField(id: string): Promise<boolean>;\n  getProductSizeMeasurements(productId: string): Promise<ProductSizeMeasurement[]>;\n  upsertProductSizeMeasurement(measurement: InsertProductSizeMeasurement): Promise<ProductSizeMeasurement>;\n  deleteProductSizeMeasurement(id: string): Promise<boolean>;\n  deleteProductSizeMeasurementsByField(fieldId: string): Promise<boolean>;\n  // Newsletter methods\n  getNewsletterSubscribers(): Promise<NewsletterSubscriber[]>;\n  addNewsletterSubscriber(subscriber: InsertNewsletterSubscriber): Promise<NewsletterSubscriber>;\n  getNewsletterSettings(): Promise<NewsletterSettings | undefined>;\n  upsertNewsletterSettings(settings: Partial<InsertNewsletterSettings>): Promise<NewsletterSettings>;\n\n  // M√©todos de Tracking Pixels (pixels de rastreamento)\n  getTrackingPixels(): Promise<TrackingPixels | undefined>;\n  updateTrackingPixels(data: Partial<InsertTrackingPixels>): Promise<TrackingPixels>;\n\n  // Email template methods\n  getEmailTemplates(): Promise<EmailTemplate[]>;\n  getEmailTemplateByKey(templateKey: string): Promise<EmailTemplate | undefined>;\n  upsertEmailTemplate(templateKey: string, data: Partial<InsertEmailTemplate>): Promise<EmailTemplate>;\n\n  // Cookie settings methods\n  getCookieSettings(): Promise<CookieSettings | undefined>;\n  updateCookieSettings(data: Partial<InsertCookieSettings>): Promise<CookieSettings>;\n}\n\nexport class DbStorage implements IStorage {\n  // Newsletter methods\n  async getNewsletterSubscribers(): Promise<NewsletterSubscriber[]> {\n    try {\n      return await db.select().from(newsletterSubscribers).orderBy(desc(newsletterSubscribers.createdAt));\n    } catch (e) {\n      console.error(\"Error getting subscribers:\", e);\n      return [];\n    }\n  }\n\n  async addNewsletterSubscriber(subscriber: InsertNewsletterSubscriber): Promise<NewsletterSubscriber> {\n    const result = await db.insert(newsletterSubscribers).values(subscriber).returning();\n    return result[0];\n  }\n\n  async getNewsletterSettings(): Promise<NewsletterSettings | undefined> {\n    try {\n      const result = await db.select().from(newsletterSettings).limit(1);\n      return result[0];\n    } catch (e) {\n      console.error(\"Error getting newsletter settings:\", e);\n      return undefined;\n    }\n  }\n\n  async updateNewsletterSubscriberStatus(id: string, status: string): Promise<NewsletterSubscriber | undefined> {\n    const result = await db.update(newsletterSubscribers)\n      .set({ status })\n      .where(eq(newsletterSubscribers.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteNewsletterSubscriber(id: string): Promise<boolean> {\n    const result = await db.delete(newsletterSubscribers)\n      .where(eq(newsletterSubscribers.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  async upsertNewsletterSettings(settings: Partial<InsertNewsletterSettings>): Promise<NewsletterSettings> {\n    const existing = await this.getNewsletterSettings();\n    if (existing) {\n      const result = await db.update(newsletterSettings)\n        .set({ ...settings, updatedAt: sql`CURRENT_TIMESTAMP` })\n        .where(eq(newsletterSettings.id, existing.id))\n        .returning();\n      return result[0];\n    } else {\n      const result = await db.insert(newsletterSettings)\n        .values({\n          title: settings.title || \"fique por dentro\",\n          description: settings.description || \"inscreva-se para receber novidades, lan√ßamentos e conte√∫dos exclusivos.\",\n          buttonText: settings.buttonText || \"inscrever\",\n        } as any)\n        .returning();\n      return result[0];\n    }\n  }\n\n  // User methods\n  async getUser(id: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.id, id)).limit(1);\n    return result[0];\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.username, username)).limit(1);\n    return result[0];\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const result = await db.select().from(users).where(eq(users.email, email)).limit(1);\n    return result[0];\n  }\n\n  async createUser(user: InsertUser): Promise<User> {\n    const result = await db.insert(users).values(user).returning();\n    return result[0];\n  }\n\n  async updateUserMeasurements(userId: string, measurements: UpdateUserMeasurements): Promise<User | undefined> {\n    const result = await db.update(users)\n      .set(measurements)\n      .where(eq(users.id, userId))\n      .returning();\n    return result[0];\n  }\n\n  // Helper to parse product colors from JSON string\n  private parseProductColors(product: Product): Product {\n    if (!product.colors) {\n      return product;\n    }\n    \n    if (typeof product.colors === 'string') {\n      try {\n        const parsed = JSON.parse(product.colors);\n        return {\n          ...product,\n          colors: parsed\n        };\n      } catch (error) {\n        console.error(\"‚ùå [parseProductColors] Failed to parse colors JSON:\", (error as Error).message);\n        return product;\n      }\n    }\n    \n    // Handle legacy array format (should not happen with current schema, but kept for safety)\n    const colorsAny = product.colors as any;\n    if (Array.isArray(colorsAny)) {\n      // Check if it's legacy format (array of hex strings) and convert to new format\n      if (colorsAny.length > 0 && typeof colorsAny[0] === 'string') {\n        const convertedColors = colorsAny.map((hex: string) => ({\n          name: hex,\n          hex: hex\n        }));\n        return {\n          ...product,\n          colors: convertedColors as any\n        };\n      }\n    }\n    \n    return product;\n  }\n\n  // Product methods\n  async getProducts(): Promise<Product[]> {\n    const results = await db.select().from(products)\n      .where(eq(products.status, \"published\"))\n      .orderBy(desc(products.displayOrder));\n    return results.map(p => this.parseProductColors(p));\n  }\n\n  async getAllProducts(): Promise<Product[]> {\n    const results = await db.select().from(products)\n      .orderBy(desc(products.displayOrder));\n    return results.map(p => this.parseProductColors(p));\n  }\n\n  async getProductsWithPresentationImages(): Promise<(Product & { images: string[] })[]> {\n    const [productsList, allImages] = await Promise.all([\n      db.select().from(products)\n        .where(eq(products.status, \"published\"))\n        .orderBy(desc(products.displayOrder)),\n      db.select().from(productImages).where(eq(productImages.imageType, \"presentation\")).orderBy(productImages.sortOrder)\n    ]);\n    \n    const imagesByProductId = new Map<string, string[]>();\n    for (const img of allImages) {\n      const existing = imagesByProductId.get(img.productId) || [];\n      existing.push(img.imageUrl);\n      imagesByProductId.set(img.productId, existing);\n    }\n    \n    return productsList.map(p => ({\n      ...this.parseProductColors(p),\n      images: imagesByProductId.get(p.id) || []\n    }));\n  }\n\n  async getProduct(id: string): Promise<Product | undefined> {\n    const result = await db.select().from(products)\n      .where(and(eq(products.id, id), eq(products.status, \"published\")))\n      .limit(1);\n    return result[0] ? this.parseProductColors(result[0]) : undefined;\n  }\n\n  async getProductById(id: string): Promise<Product | undefined> {\n    const result = await db.select().from(products)\n      .where(eq(products.id, id))\n      .limit(1);\n    return result[0] ? this.parseProductColors(result[0]) : undefined;\n  }\n\n  async getProductBySlugOrSku(identifier: string): Promise<Product | undefined> {\n    const result = await db.select().from(products)\n      .where(and(\n        or(eq(products.slug, identifier), eq(products.sku, identifier)),\n        eq(products.status, \"published\")\n      ))\n      .limit(1);\n    return result[0] ? this.parseProductColors(result[0]) : undefined;\n  }\n\n  async getProductImages(productId: string): Promise<ProductImage[]> {\n    return await db.select().from(productImages)\n      .where(eq(productImages.productId, productId))\n      .orderBy(productImages.sortOrder);\n  }\n\n  async getProductPresentationImages(productId: string): Promise<ProductImage[]> {\n    return await db.select().from(productImages)\n      .where(and(\n        eq(productImages.productId, productId),\n        eq(productImages.imageType, \"presentation\")\n      ))\n      .orderBy(productImages.sortOrder);\n  }\n\n  async getProductCarouselImages(productId: string, color?: string): Promise<ProductImage[]> {\n    const conditions = [\n      eq(productImages.productId, productId),\n      eq(productImages.imageType, \"carousel\")\n    ];\n    \n    if (color) {\n      conditions.push(eq(productImages.color, color));\n    }\n    \n    return await db.select().from(productImages)\n      .where(and(...conditions))\n      .orderBy(productImages.sortOrder);\n  }\n\n  async createProduct(product: InsertProduct): Promise<Product> {\n    // Ensure colors is properly stored as text (already handled by schema transform)\n    const result = await db.insert(products).values(product as any).returning();\n    return this.parseProductColors(result[0]);\n  }\n\n  async addProductImage(image: InsertProductImage): Promise<ProductImage> {\n    const result = await db.insert(productImages).values(image).returning();\n    return result[0];\n  }\n\n  // Cart methods\n  async getCartItems(userId: string): Promise<CartItem[]> {\n    return await db.select().from(cartItems)\n      .where(eq(cartItems.userId, userId))\n      .orderBy(desc(cartItems.createdAt));\n  }\n\n  async addToCart(item: InsertCartItem): Promise<CartItem> {\n    // Try to update existing item first\n    const existing = await db.select().from(cartItems)\n      .where(and(\n        eq(cartItems.userId, item.userId),\n        eq(cartItems.productId, item.productId),\n        eq(cartItems.size, item.size),\n        eq(cartItems.color, item.color)\n      )).limit(1);\n\n    if (existing[0]) {\n      const result = await db.update(cartItems)\n        .set({ quantity: existing[0].quantity + (item.quantity || 1) })\n        .where(eq(cartItems.id, existing[0].id))\n        .returning();\n      return result[0];\n    }\n\n    const result = await db.insert(cartItems).values(item).returning();\n    return result[0];\n  }\n\n  async updateCartItem(id: string, quantity: number, userId: string): Promise<CartItem | undefined> {\n    const result = await db.update(cartItems)\n      .set({ quantity })\n      .where(and(eq(cartItems.id, id), eq(cartItems.userId, userId)))\n      .returning();\n    return result[0];\n  }\n\n  async removeFromCart(id: string, userId: string): Promise<boolean> {\n    const result = await db.delete(cartItems)\n      .where(and(eq(cartItems.id, id), eq(cartItems.userId, userId)))\n      .returning();\n    return result.length > 0;\n  }\n\n  async clearCart(userId: string): Promise<boolean> {\n    const result = await db.delete(cartItems).where(eq(cartItems.userId, userId)).returning();\n    return result.length > 0;\n  }\n\n  // Favorites methods\n  async getFavorites(userId: string): Promise<Favorite[]> {\n    return await db.select().from(favorites)\n      .where(eq(favorites.userId, userId))\n      .orderBy(desc(favorites.createdAt));\n  }\n\n  async addFavorite(favorite: InsertFavorite): Promise<Favorite> {\n    const result = await db.insert(favorites).values(favorite).returning();\n    return result[0];\n  }\n\n  async removeFavorite(userId: string, productId: string): Promise<boolean> {\n    const result = await db.delete(favorites)\n      .where(and(eq(favorites.userId, userId), eq(favorites.productId, productId)))\n      .returning();\n    return result.length > 0;\n  }\n\n  async isFavorite(userId: string, productId: string): Promise<boolean> {\n    const result = await db.select().from(favorites)\n      .where(and(eq(favorites.userId, userId), eq(favorites.productId, productId)))\n      .limit(1);\n    return result.length > 0;\n  }\n\n  // Review methods\n  async getReviews(productId: string): Promise<Review[]> {\n    return await db.select().from(reviews)\n      .where(eq(reviews.productId, productId))\n      .orderBy(desc(reviews.createdAt));\n  }\n\n  async getReview(id: string): Promise<Review | undefined> {\n    const result = await db.select().from(reviews).where(eq(reviews.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createReview(review: InsertReview): Promise<Review> {\n    const result = await db.insert(reviews).values(review).returning();\n    return result[0];\n  }\n\n  async addReviewImage(image: InsertReviewImage): Promise<ReviewImage> {\n    const result = await db.insert(reviewImages).values(image).returning();\n    return result[0];\n  }\n\n  async getReviewImages(reviewId: string): Promise<ReviewImage[]> {\n    return await db.select().from(reviewImages)\n      .where(eq(reviewImages.reviewId, reviewId))\n      .orderBy(reviewImages.createdAt);\n  }\n\n  async likeReview(like: InsertReviewLike): Promise<ReviewLike> {\n    const result = await db.insert(reviewLikes).values(like).returning();\n    return result[0];\n  }\n\n  async unlikeReview(userId: string, reviewId: string): Promise<boolean> {\n    const result = await db.delete(reviewLikes)\n      .where(and(eq(reviewLikes.userId, userId), eq(reviewLikes.reviewId, reviewId)))\n      .returning();\n    return result.length > 0;\n  }\n\n  async getReviewLikes(reviewId: string): Promise<ReviewLike[]> {\n    return await db.select().from(reviewLikes)\n      .where(eq(reviewLikes.reviewId, reviewId))\n      .orderBy(reviewLikes.createdAt);\n  }\n\n  async addReviewQA(qa: InsertReviewQA): Promise<ReviewQA> {\n    const result = await db.insert(reviewQA).values(qa).returning();\n    return result[0];\n  }\n\n  async getReviewQA(reviewId: string): Promise<ReviewQA[]> {\n    return await db.select().from(reviewQA)\n      .where(eq(reviewQA.reviewId, reviewId))\n      .orderBy(reviewQA.createdAt);\n  }\n\n  // Admin product review methods\n  async getAdminProductReviews(productId: string): Promise<AdminProductReview[]> {\n    return await db.select().from(adminProductReviews)\n      .where(eq(adminProductReviews.productId, productId))\n      .orderBy(adminProductReviews.sortOrder, adminProductReviews.createdAt);\n  }\n\n  async getAdminProductReview(id: string): Promise<AdminProductReview | undefined> {\n    const result = await db.select().from(adminProductReviews)\n      .where(eq(adminProductReviews.id, id))\n      .limit(1);\n    return result[0];\n  }\n\n  async createAdminProductReview(review: InsertAdminProductReview): Promise<AdminProductReview> {\n    const result = await db.insert(adminProductReviews).values(review).returning();\n    return result[0];\n  }\n\n  async updateAdminProductReview(id: string, review: Partial<InsertAdminProductReview>): Promise<AdminProductReview | undefined> {\n    const result = await db.update(adminProductReviews)\n      .set({ ...review, updatedAt: sql`CURRENT_TIMESTAMP` })\n      .where(eq(adminProductReviews.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteAdminProductReview(id: string): Promise<boolean> {\n    const result = await db.delete(adminProductReviews)\n      .where(eq(adminProductReviews.id, id))\n      .returning();\n    return result.length > 0;\n  }\n\n  // Admin - Site banner methods\n  async getSiteBanners(): Promise<SiteBanner[]> {\n    return await db.select().from(siteBanners).orderBy(desc(siteBanners.sortOrder));\n  }\n\n  async getSiteBanner(id: string): Promise<SiteBanner | undefined> {\n    const result = await db.select().from(siteBanners).where(eq(siteBanners.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createSiteBanner(banner: InsertSiteBanner): Promise<SiteBanner> {\n    const result = await db.insert(siteBanners).values(banner).returning();\n    return result[0];\n  }\n\n  async updateSiteBanner(id: string, banner: Partial<InsertSiteBanner>): Promise<SiteBanner | undefined> {\n    const result = await db.update(siteBanners)\n      .set({ ...banner, updatedAt: sql`CURRENT_TIMESTAMP` })\n      .where(eq(siteBanners.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteSiteBanner(id: string): Promise<boolean> {\n    const result = await db.delete(siteBanners).where(eq(siteBanners.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Admin - Site content methods\n  async getSiteContent(): Promise<SiteContent[]> {\n    return await db.select().from(siteContent);\n  }\n\n  async getSiteContentByKey(key: string): Promise<SiteContent | undefined> {\n    const result = await db.select().from(siteContent).where(eq(siteContent.key, key)).limit(1);\n    return result[0];\n  }\n\n  async upsertSiteContent(content: InsertSiteContent): Promise<SiteContent> {\n    const result = await db.insert(siteContent)\n      .values(content)\n      .onConflictDoUpdate({\n        target: siteContent.key,\n        set: { value: content.value, updatedAt: sql`CURRENT_TIMESTAMP` }\n      })\n      .returning();\n    return result[0];\n  }\n\n  async deleteSiteContent(key: string): Promise<boolean> {\n    const result = await db.delete(siteContent).where(eq(siteContent.key, key)).returning();\n    return result.length > 0;\n  }\n\n  // Admin - Site settings methods\n  async getSiteSettings(): Promise<SiteSetting[]> {\n    return await db.select().from(siteSettings);\n  }\n\n  async getSiteSettingByKey(key: string): Promise<SiteSetting | undefined> {\n    const result = await db.select().from(siteSettings).where(eq(siteSettings.key, key)).limit(1);\n    return result[0];\n  }\n\n  async upsertSiteSetting(setting: InsertSiteSetting): Promise<SiteSetting> {\n    const result = await db.insert(siteSettings)\n      .values(setting)\n      .onConflictDoUpdate({\n        target: siteSettings.key,\n        set: { value: setting.value, type: setting.type, updatedAt: sql`CURRENT_TIMESTAMP` }\n      })\n      .returning();\n    return result[0];\n  }\n\n  // Admin - Site verses methods\n  async getSiteVerses(): Promise<SiteVerse[]> {\n    return await db.select().from(siteVerses).orderBy(desc(siteVerses.createdAt));\n  }\n\n  async getActiveSiteVerse(): Promise<SiteVerse | undefined> {\n    const result = await db.select().from(siteVerses)\n      .where(eq(siteVerses.isActive, true))\n      .orderBy(desc(siteVerses.createdAt))\n      .limit(1);\n    return result[0];\n  }\n\n  async createSiteVerse(verse: InsertSiteVerse): Promise<SiteVerse> {\n    const result = await db.insert(siteVerses).values(verse).returning();\n    return result[0];\n  }\n\n  async updateSiteVerse(id: string, verse: Partial<InsertSiteVerse>): Promise<SiteVerse | undefined> {\n    const result = await db.update(siteVerses)\n      .set({ ...verse, updatedAt: sql`CURRENT_TIMESTAMP` })\n      .where(eq(siteVerses.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteSiteVerse(id: string): Promise<boolean> {\n    const result = await db.delete(siteVerses).where(eq(siteVerses.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Admin - Content cards methods\n  async getContentCards(): Promise<ContentCard[]> {\n    return await db.select().from(contentCards).orderBy(contentCards.sortOrder);\n  }\n\n  async getContentCard(id: string): Promise<ContentCard | undefined> {\n    const result = await db.select().from(contentCards).where(eq(contentCards.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createContentCard(card: InsertContentCard): Promise<ContentCard> {\n    const result = await db.insert(contentCards).values(card).returning();\n    return result[0];\n  }\n\n  async updateContentCard(id: string, card: Partial<InsertContentCard>): Promise<ContentCard | undefined> {\n    const result = await db.update(contentCards)\n      .set({ ...card, updatedAt: sql`CURRENT_TIMESTAMP` })\n      .where(eq(contentCards.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteContentCard(id: string): Promise<boolean> {\n    const result = await db.delete(contentCards).where(eq(contentCards.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getContentCardImages(cardId: string): Promise<ContentCardImage[]> {\n    return await db.select().from(contentCardImages)\n      .where(eq(contentCardImages.cardId, cardId))\n      .orderBy(contentCardImages.sortOrder);\n  }\n\n  async addContentCardImage(image: InsertContentCardImage): Promise<ContentCardImage> {\n    const result = await db.insert(contentCardImages).values(image).returning();\n    return result[0];\n  }\n\n  async deleteContentCardImage(id: string): Promise<boolean> {\n    const result = await db.delete(contentCardImages).where(eq(contentCardImages.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Admin - CTA Banner config methods\n  async getCtaBannerConfig(): Promise<CtaBannerConfig | undefined> {\n    try {\n      const result = await db.select().from(ctaBannerConfigs)\n        .where(eq(ctaBannerConfigs.isActive, true))\n        .orderBy(desc(ctaBannerConfigs.updatedAt))\n        .limit(1);\n      return result[0];\n    } catch (e) {\n      console.error(\"Error getting CTA banner config:\", e);\n      return undefined;\n    }\n  }\n\n  async upsertCtaBannerConfig(config: Partial<InsertCtaBannerConfig>): Promise<CtaBannerConfig> {\n    const existing = await this.getCtaBannerConfig();\n    if (existing) {\n      const result = await db.update(ctaBannerConfigs)\n        .set({ ...config, updatedAt: sql`CURRENT_TIMESTAMP` })\n        .where(eq(ctaBannerConfigs.id, existing.id))\n        .returning();\n      return result[0];\n    } else {\n      const result = await db.insert(ctaBannerConfigs)\n        .values({ ...config, isActive: true })\n        .returning();\n      return result[0];\n    }\n  }\n\n  // Installment Options methods\n  async getInstallmentOptions(productId: string): Promise<any[]> {\n    return await db.select().from(productInstallmentOptions)\n      .where(eq(productInstallmentOptions.productId, productId))\n      .orderBy(asc(productInstallmentOptions.installments));\n  }\n\n  async updateInstallmentOptions(productId: string, options: any[]): Promise<void> {\n    await db.delete(productInstallmentOptions).where(eq(productInstallmentOptions.productId, productId));\n    if (options && options.length > 0) {\n      await db.insert(productInstallmentOptions).values(\n        options.map(opt => ({\n          productId,\n          installments: opt.installments,\n          isInterestFree: opt.isInterestFree,\n          customValue: opt.customValue?.toString() || null,\n        }))\n      );\n    }\n  }\n\n  // Admin - FAQ methods\n  async getFaqs(): Promise<Faq[]> {\n    return await db.select().from(faqs).orderBy(faqs.category, faqs.sortOrder);\n  }\n\n  async getActiveFaqs(): Promise<Faq[]> {\n    return await db.select().from(faqs)\n      .where(eq(faqs.isActive, true))\n      .orderBy(faqs.category, faqs.sortOrder);\n  }\n\n  async getFaq(id: string): Promise<Faq | undefined> {\n    const result = await db.select().from(faqs).where(eq(faqs.id, id)).limit(1);\n    return result[0];\n  }\n\n  async createFaq(faq: InsertFaq): Promise<Faq> {\n    const result = await db.insert(faqs).values(faq).returning();\n    return result[0];\n  }\n\n  async updateFaq(id: string, faq: Partial<InsertFaq>): Promise<Faq | undefined> {\n    const result = await db.update(faqs)\n      .set({ ...faq, updatedAt: sql`CURRENT_TIMESTAMP` })\n      .where(eq(faqs.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteFaq(id: string): Promise<boolean> {\n    const result = await db.delete(faqs).where(eq(faqs.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Admin - Product management\n  async updateProduct(id: string, product: Partial<InsertProduct>): Promise<Product | undefined> {\n    const updateData = { ...product, updatedAt: sql`CURRENT_TIMESTAMP` };\n    // Convert rating to string if it's a number to satisfy PG decimal type\n    if (typeof updateData.rating === 'number') {\n      (updateData as any).rating = updateData.rating.toString();\n    }\n    const result = await db.update(products)\n      .set(updateData as any)\n      .where(eq(products.id, id))\n      .returning();\n    \n    return result[0] ? this.parseProductColors(result[0]) : undefined;\n  }\n\n  async deleteProduct(id: string): Promise<boolean> {\n    const result = await db.delete(products).where(eq(products.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async updateProductImage(id: string, image: Partial<InsertProductImage>): Promise<ProductImage | undefined> {\n    const result = await db.update(productImages)\n      .set(image)\n      .where(eq(productImages.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteProductImage(id: string): Promise<boolean> {\n    const result = await db.delete(productImages).where(eq(productImages.id, id)).returning();\n    return result.length > 0;\n  }\n\n  // Admin user authentication\n  async getAdminByUsername(username: string): Promise<AdminUser | undefined> {\n    const result = await db.select().from(adminUsers).where(eq(adminUsers.username, username)).limit(1);\n    return result[0];\n  }\n\n  async updateAdminLastLogin(username: string): Promise<void> {\n    await db.update(adminUsers)\n      .set({ lastLogin: sql`CURRENT_TIMESTAMP` })\n      .where(eq(adminUsers.username, username));\n  }\n\n  // Orders methods\n  async createOrder(orderData: Omit<InsertOrder, 'id' | 'createdAt' | 'updatedAt' | 'paidAt'>, items: Omit<InsertOrderItem, 'id' | 'createdAt' | 'orderId'>[]): Promise<Order & { items: OrderItem[] }> {\n    const [order] = await db.insert(orders).values(orderData as any).returning();\n    \n    const orderItemsData = items.map(item => ({\n      ...item,\n      orderId: order.id\n    }));\n    \n    const createdItems = await db.insert(orderItems).values(orderItemsData as any).returning();\n    \n    return {\n      ...order,\n      items: createdItems\n    };\n  }\n\n  async getOrders(options?: { \n    search?: string; \n    status?: string; \n    filter?: 'all' | 'archived' | 'deleted' | 'shipped' | 'delivered' | 'refunded'; \n    sortField?: string; \n    sortDirection?: 'asc' | 'desc' \n  }): Promise<Order[]> {\n    const conditions: any[] = [];\n    \n    // Aplicar filtros baseados no tipo\n    if (options?.filter === 'archived') {\n      conditions.push(sql`${orders.archivedAt} IS NOT NULL AND ${orders.deletedAt} IS NULL`);\n    } else if (options?.filter === 'deleted') {\n      conditions.push(sql`${orders.deletedAt} IS NOT NULL`);\n    } else if (options?.filter === 'shipped') {\n      conditions.push(eq(orders.orderStatus, 'shipped'), sql`${orders.archivedAt} IS NULL AND ${orders.deletedAt} IS NULL`);\n    } else if (options?.filter === 'delivered') {\n      conditions.push(eq(orders.orderStatus, 'delivered'), sql`${orders.archivedAt} IS NULL AND ${orders.deletedAt} IS NULL`);\n    } else if (options?.filter === 'refunded') {\n      conditions.push(eq(orders.orderStatus, 'refunded'), sql`${orders.archivedAt} IS NULL AND ${orders.deletedAt} IS NULL`);\n    } else {\n      // 'all' - mostrar apenas n√£o arquivados e n√£o deletados\n      conditions.push(sql`${orders.archivedAt} IS NULL AND ${orders.deletedAt} IS NULL`);\n    }\n    \n    // Aplicar busca se fornecida\n    if (options?.search && options.search.trim()) {\n      const searchTerm = `%${options.search.toLowerCase()}%`;\n      \n      // Buscar em itens por SKU\n      const itemsWithSkuMatch = await db.select({ orderId: orderItems.orderId })\n        .from(orderItems)\n        .innerJoin(products, eq(orderItems.productId, products.id))\n        .where(sql`LOWER(${products.sku}) LIKE ${searchTerm}`);\n      \n      const orderIdsFromSku = itemsWithSkuMatch.map(i => i.orderId);\n\n      const searchConditions = [\n        sql`LOWER(${orders.orderNumber}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.customerName}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.customerEmail}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.customerCpf}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.customerPhone}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.city}) LIKE ${searchTerm}`,\n        sql`LOWER(${orders.state}) LIKE ${searchTerm}`\n      ];\n\n      if (orderIdsFromSku.length > 0) {\n        searchConditions.push(inArray(orders.id, orderIdsFromSku));\n      }\n\n      conditions.push(sql`(${sql.join(searchConditions, sql` OR `)})`);\n    }\n    \n    // Aplicar filtro de status se fornecido\n    if (options?.status && options.status !== 'all') {\n      if (options.status === 'paid') {\n        // Pedidos pagos devem ter o status de pagamento aprovado no Mercado Pago\n        // Independentemente do status do pedido (paid, shipped, delivered)\n        conditions.push(eq(orders.paymentStatus, 'approved'));\n      } else {\n        // Se o status for diferente de 'paid', filtramos estritamente pelo status do pedido\n        conditions.push(eq(orders.orderStatus, options.status));\n      }\n    }\n    \n    // Aplicar ordena√ß√£o\n    const sortFieldMap: Record<string, any> = {\n      orderNumber: orders.orderNumber,\n      customerName: orders.customerName,\n      createdAt: orders.createdAt,\n      totalAmount: orders.totalAmount,\n      orderStatus: orders.orderStatus,\n      paymentStatus: orders.paymentStatus,\n    };\n    \n    const sortField = options?.sortField && sortFieldMap[options.sortField] ? options.sortField : 'createdAt';\n    const sortDirection = options?.sortDirection === 'asc' ? asc : desc;\n    \n    const whereClause = conditions.length > 0 ? and(...conditions) : undefined;\n    \n    const result = await db.select()\n      .from(orders)\n      .where(whereClause)\n      .orderBy(sortDirection(sortFieldMap[sortField]));\n    \n    return result;\n  }\n\n  async getOrder(id: string): Promise<(Order & { items: OrderItem[] }) | undefined> {\n    const [order] = await db.select().from(orders).where(eq(orders.id, id)).limit(1);\n    if (!order) return undefined;\n    \n    const items = await db.select().from(orderItems).where(eq(orderItems.orderId, id));\n    \n    return {\n      ...order,\n      items\n    };\n  }\n\n  async getOrderByOrderNumber(orderNumber: string): Promise<Order | undefined> {\n    const [order] = await db.select().from(orders).where(eq(orders.orderNumber, orderNumber)).limit(1);\n    return order;\n  }\n\n  async getOrderByNumberOrTracking(identifier: string): Promise<(Order & { items: OrderItem[] }) | undefined> {\n    const [order] = await db.select()\n      .from(orders)\n      .where(\n        sql`${orders.orderNumber} = ${identifier} OR ${orders.trackingCode} = ${identifier}`\n      )\n      .limit(1);\n    \n    if (!order) return undefined;\n    \n    const items = await db.select().from(orderItems).where(eq(orderItems.orderId, order.id));\n    \n    return {\n      ...order,\n      items\n    };\n  }\n\n  async getOrderByPaymentPreferenceId(preferenceId: string): Promise<Order | undefined> {\n    const [order] = await db.select().from(orders).where(eq(orders.paymentPreferenceId, preferenceId)).limit(1);\n    return order;\n  }\n\n  async updateOrderPaymentStatus(id: string, paymentStatus: string, paymentId?: string, paymentMethod?: string, paymentTypeId?: string, installments?: number): Promise<Order | undefined> {\n    const updateData: any = {\n      paymentStatus: paymentStatus,\n      updatedAt: sql`CURRENT_TIMESTAMP`\n    };\n\n    if (paymentId) {\n      updateData.paymentId = paymentId;\n    }\n\n    if (paymentMethod) {\n      updateData.paymentMethod = paymentMethod;\n    }\n\n    if (paymentTypeId) {\n      updateData.paymentTypeId = paymentTypeId;\n    }\n\n    if (installments !== undefined) {\n      updateData.paymentInstallments = installments;\n    }\n\n    if (paymentStatus === 'approved') {\n      updateData.orderStatus = 'paid';\n      updateData.paidAt = sql`CURRENT_TIMESTAMP`;\n      const existingOrder = await this.getOrder(id);\n      if (!existingOrder?.verificationCode) {\n        updateData.verificationCode = this.generateVerificationCode();\n      }\n    } else if (paymentStatus === 'rejected' || paymentStatus === 'cancelled') {\n      updateData.orderStatus = 'failed';\n    }\n\n    const [updated] = await db.update(orders)\n      .set(updateData)\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  /**\n   * Atualiza o ID da prefer√™ncia do Mercado Pago no pedido.\n   * Chamado ap√≥s criar a prefer√™ncia de pagamento no MP.\n   */\n  async updateOrderPreference(id: string, preferenceId: string): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        paymentPreferenceId: preferenceId,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  /**\n   * Marca um pedido como pago, atualizando o status e a data de pagamento.\n   * Chamado quando o webhook confirma que o pagamento foi aprovado.\n   */\n  private generateVerificationCode(): string {\n    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';\n    let code = '';\n    for (let i = 0; i < 8; i++) {\n      code += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return code;\n  }\n\n  async markOrderAsPaid(id: string): Promise<Order | undefined> {\n    const existingOrder = await this.getOrder(id);\n    const updateData: any = {\n      orderStatus: 'paid',\n      paidAt: sql`CURRENT_TIMESTAMP`,\n      updatedAt: sql`CURRENT_TIMESTAMP`\n    };\n    if (!existingOrder?.verificationCode) {\n      updateData.verificationCode = this.generateVerificationCode();\n    }\n    const [updated] = await db.update(orders)\n      .set(updateData)\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async getOrderItems(orderId: string): Promise<OrderItem[]> {\n    const items = await db.select().from(orderItems).where(eq(orderItems.orderId, orderId));\n    return items;\n  }\n\n  async updateOrder(id: string, data: Partial<Pick<Order, 'customerName' | 'customerEmail' | 'customerPhone' | 'street' | 'number' | 'complement' | 'neighborhood' | 'city' | 'state' | 'zipCode' | 'internalNotes' | 'orderStatus' | 'trackingCode' | 'refundReason' | 'actualDeliveryDate' | 'confirmationEmailSentAt' | 'trackingEmailSentAt' | 'emailDeliveredAt' | 'emailOpenedAt' | 'emailComplainedAt' | 'emailFailedAt' | 'emailFailureReason'>>): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        ...data,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async archiveOrder(id: string): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        archivedAt: sql`CURRENT_TIMESTAMP`,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async unarchiveOrder(id: string): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        archivedAt: null,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async softDeleteOrder(id: string): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        deletedAt: sql`CURRENT_TIMESTAMP`,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async restoreOrder(id: string): Promise<Order | undefined> {\n    const [updated] = await db.update(orders)\n      .set({\n        deletedAt: null,\n        updatedAt: sql`CURRENT_TIMESTAMP`\n      })\n      .where(eq(orders.id, id))\n      .returning();\n    \n    return updated;\n  }\n\n  async hardDeleteOrder(id: string): Promise<boolean> {\n    await db.delete(orderItems).where(eq(orderItems.orderId, id));\n    const result = await db.delete(orders).where(eq(orders.id, id));\n    return true;\n  }\n\n  // Product measurement methods\n  async getProductMeasurementFields(productId: string): Promise<ProductMeasurementField[]> {\n    return await db.select().from(productMeasurementFields)\n      .where(eq(productMeasurementFields.productId, productId))\n      .orderBy(productMeasurementFields.sortOrder);\n  }\n\n  async createProductMeasurementField(field: InsertProductMeasurementField): Promise<ProductMeasurementField> {\n    const result = await db.insert(productMeasurementFields).values(field).returning();\n    return result[0];\n  }\n\n  async updateProductMeasurementField(id: string, data: Partial<InsertProductMeasurementField>): Promise<ProductMeasurementField | undefined> {\n    const result = await db.update(productMeasurementFields)\n      .set(data)\n      .where(eq(productMeasurementFields.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteProductMeasurementField(id: string): Promise<boolean> {\n    // First delete all measurements for this field\n    await db.delete(productSizeMeasurements).where(eq(productSizeMeasurements.fieldId, id));\n    // Then delete the field itself\n    const result = await db.delete(productMeasurementFields).where(eq(productMeasurementFields.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getProductSizeMeasurements(productId: string): Promise<ProductSizeMeasurement[]> {\n    return await db.select().from(productSizeMeasurements)\n      .where(eq(productSizeMeasurements.productId, productId));\n  }\n\n  async upsertProductSizeMeasurement(measurement: InsertProductSizeMeasurement): Promise<ProductSizeMeasurement> {\n    // Check if measurement already exists for this product/size/field combination\n    const existing = await db.select().from(productSizeMeasurements)\n      .where(and(\n        eq(productSizeMeasurements.productId, measurement.productId),\n        eq(productSizeMeasurements.sizeName, measurement.sizeName),\n        eq(productSizeMeasurements.fieldId, measurement.fieldId)\n      ))\n      .limit(1);\n\n    if (existing[0]) {\n      // Update existing\n      const result = await db.update(productSizeMeasurements)\n        .set({ value: measurement.value, updatedAt: sql`CURRENT_TIMESTAMP` })\n        .where(eq(productSizeMeasurements.id, existing[0].id))\n        .returning();\n      return result[0];\n    } else {\n      // Create new\n      const result = await db.insert(productSizeMeasurements).values(measurement).returning();\n      return result[0];\n    }\n  }\n\n  async deleteProductSizeMeasurement(id: string): Promise<boolean> {\n    const result = await db.delete(productSizeMeasurements).where(eq(productSizeMeasurements.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async deleteProductSizeMeasurementsByField(fieldId: string): Promise<boolean> {\n    const result = await db.delete(productSizeMeasurements).where(eq(productSizeMeasurements.fieldId, fieldId)).returning();\n    return result.length > 0;\n  }\n\n  async getCompanyInfo(): Promise<CompanyInfo | undefined> {\n    const result = await db.select().from(companyInfo).limit(1);\n    return result[0];\n  }\n\n  async updateCompanyInfo(data: Partial<InsertCompanyInfo>): Promise<CompanyInfo> {\n    const existing = await this.getCompanyInfo();\n    if (existing) {\n      const result = await db.update(companyInfo).set({ ...data, updatedAt: sql`CURRENT_TIMESTAMP` }).where(eq(companyInfo.id, existing.id)).returning();\n      return result[0];\n    } else {\n      const result = await db.insert(companyInfo).values(data as InsertCompanyInfo).returning();\n      return result[0];\n    }\n  }\n\n  // Coupon methods\n  async getProductCoupon(productId: string): Promise<ProductCoupon | undefined> {\n    const coupons = await db.select().from(productCoupons)\n      .where(and(\n        eq(productCoupons.productId, productId),\n        eq(productCoupons.isActive, true)\n      ))\n      .limit(1);\n    return coupons[0];\n  }\n\n  async createProductCoupon(coupon: InsertProductCoupon): Promise<ProductCoupon> {\n    const result = await db.insert(productCoupons).values({\n      ...coupon,\n      discountValue: String(coupon.discountValue)\n    } as any).returning();\n    return result[0];\n  }\n\n  async updateProductCoupon(id: string, data: Partial<InsertProductCoupon>): Promise<ProductCoupon | undefined> {\n    const result = await db.update(productCoupons)\n      .set({ \n        ...data,\n        ...(data.discountValue && { discountValue: String(data.discountValue) }),\n        updatedAt: sql`CURRENT_TIMESTAMP` \n      } as any)\n      .where(eq(productCoupons.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteProductCoupon(id: string): Promise<boolean> {\n    const result = await db.delete(productCoupons).where(eq(productCoupons.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getProductCoupons(productId: string): Promise<ProductCoupon[]> {\n    return await db.select().from(productCoupons)\n      .where(eq(productCoupons.productId, productId))\n      .orderBy(desc(productCoupons.createdAt));\n  }\n\n  // Global coupon methods\n  async getGlobalCoupon(): Promise<GlobalCoupon | undefined> {\n    const coupons = await db.select().from(globalCoupon)\n      .where(eq(globalCoupon.isActive, true))\n      .limit(1);\n    return coupons[0];\n  }\n\n  async getAllGlobalCoupons(): Promise<GlobalCoupon[]> {\n    return await db.select().from(globalCoupon)\n      .orderBy(desc(globalCoupon.createdAt));\n  }\n\n  async createGlobalCoupon(coupon: InsertGlobalCoupon): Promise<GlobalCoupon> {\n    const result = await db.insert(globalCoupon).values({\n      ...coupon,\n      discountValue: String(coupon.discountValue)\n    } as any).returning();\n    return result[0];\n  }\n\n  async updateGlobalCoupon(id: string, data: Partial<InsertGlobalCoupon>): Promise<GlobalCoupon | undefined> {\n    const result = await db.update(globalCoupon)\n      .set({ \n        ...data,\n        ...(data.discountValue && { discountValue: String(data.discountValue) }),\n        updatedAt: sql`CURRENT_TIMESTAMP` \n      } as any)\n      .where(eq(globalCoupon.id, id))\n      .returning();\n    return result[0];\n  }\n\n  async deleteGlobalCoupon(id: string): Promise<boolean> {\n    const result = await db.delete(globalCoupon).where(eq(globalCoupon.id, id)).returning();\n    return result.length > 0;\n  }\n\n  async getCouponByCode(code: string): Promise<GlobalCoupon | undefined> {\n    const results = await db.select().from(globalCoupon)\n      .where(and(\n        eq(globalCoupon.code, code.toUpperCase()),\n        eq(globalCoupon.isActive, true)\n      ))\n      .limit(1);\n    return results[0];\n  }\n\n  // ===== M√âTODOS DE TRACKING PIXELS =====\n  \n  // Busca a configura√ß√£o de tracking pixels (retorna o primeiro registro ou undefined)\n  async getTrackingPixels(): Promise<TrackingPixels | undefined> {\n    try {\n      const results = await db.select().from(trackingPixels).limit(1);\n      return results[0];\n    } catch (e) {\n      console.error(\"‚ùå [TRACKING_PIXELS] Erro ao buscar configura√ß√£o:\", e);\n      return undefined;\n    }\n  }\n\n  // Atualiza ou cria a configura√ß√£o de tracking pixels (upsert)\n  async updateTrackingPixels(data: Partial<InsertTrackingPixels>): Promise<TrackingPixels> {\n    try {\n      // Verifica se j√° existe uma configura√ß√£o\n      const existing = await this.getTrackingPixels();\n      \n      if (existing) {\n        // Atualiza o registro existente\n        const result = await db.update(trackingPixels)\n          .set({\n            ...data,\n            updatedAt: sql`CURRENT_TIMESTAMP`\n          })\n          .where(eq(trackingPixels.id, existing.id))\n          .returning();\n        console.log(\"‚úÖ [TRACKING_PIXELS] Configura√ß√£o atualizada\");\n        return result[0];\n      } else {\n        // Cria um novo registro\n        const result = await db.insert(trackingPixels)\n          .values(data as InsertTrackingPixels)\n          .returning();\n        console.log(\"‚úÖ [TRACKING_PIXELS] Nova configura√ß√£o criada\");\n        return result[0];\n      }\n    } catch (e) {\n      console.error(\"‚ùå [TRACKING_PIXELS] Erro ao atualizar configura√ß√£o:\", e);\n      throw e;\n    }\n  }\n\n  // ===== EMAIL TEMPLATE METHODS =====\n\n  async getEmailTemplates(): Promise<EmailTemplate[]> {\n    try {\n      return await db.select().from(emailTemplates).orderBy(emailTemplates.templateKey);\n    } catch (e) {\n      console.error(\"‚ùå [EMAIL_TEMPLATES] Erro ao buscar templates:\", e);\n      return [];\n    }\n  }\n\n  async getEmailTemplateByKey(templateKey: string): Promise<EmailTemplate | undefined> {\n    try {\n      const results = await db.select().from(emailTemplates).where(eq(emailTemplates.templateKey, templateKey)).limit(1);\n      return results[0];\n    } catch (e) {\n      console.error(\"‚ùå [EMAIL_TEMPLATES] Erro ao buscar template:\", e);\n      return undefined;\n    }\n  }\n\n  async upsertEmailTemplate(templateKey: string, data: Partial<InsertEmailTemplate>): Promise<EmailTemplate> {\n    const existing = await this.getEmailTemplateByKey(templateKey);\n    if (existing) {\n      const result = await db.update(emailTemplates)\n        .set({ ...data, updatedAt: sql`CURRENT_TIMESTAMP` })\n        .where(eq(emailTemplates.templateKey, templateKey))\n        .returning();\n      return result[0];\n    } else {\n      const result = await db.insert(emailTemplates)\n        .values({\n          templateKey,\n          name: data.name || templateKey,\n          subject: data.subject || \"\",\n          htmlContent: data.htmlContent || \"\",\n          enabled: data.enabled ?? true,\n        })\n        .returning();\n      return result[0];\n    }\n  }\n  async getCookieSettings(): Promise<CookieSettings | undefined> {\n    try {\n      const results = await db.select().from(cookieSettings).limit(1);\n      return results[0];\n    } catch (e) {\n      console.error(\"‚ùå [COOKIE_SETTINGS] Erro ao buscar configura√ß√£o:\", e);\n      return undefined;\n    }\n  }\n\n  async updateCookieSettings(data: Partial<InsertCookieSettings>): Promise<CookieSettings> {\n    try {\n      const existing = await this.getCookieSettings();\n      \n      if (existing) {\n        const result = await db.update(cookieSettings)\n          .set({\n            ...data,\n            updatedAt: sql`CURRENT_TIMESTAMP`\n          })\n          .where(eq(cookieSettings.id, existing.id))\n          .returning();\n        return result[0];\n      } else {\n        const result = await db.insert(cookieSettings)\n          .values(data as any)\n          .returning();\n        return result[0];\n      }\n    } catch (e) {\n      console.error(\"‚ùå [COOKIE_SETTINGS] Erro ao atualizar configura√ß√£o:\", e);\n      throw e;\n    }\n  }\n}\n\nexport const storage = new DbStorage();\n","path":null,"size_bytes":55901,"size_tokens":null},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":711,"size_tokens":null},"client/src/components/Header.tsx":{"content":"import { Backpack } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport { Link, useLocation } from \"wouter\";\nimport { useEffect, useState } from \"react\";\nimport logoSvg from \"@/assets/logo.svg\";\nimport AppleMenu from \"./AppleMenu\";\nimport FavoritoToast from \"./FavoritoToast\";\n\nconst InvertedStairsIcon = ({ className }: { className?: string }) => (\n  <svg \n    viewBox=\"0 0 24 24\" \n    fill=\"none\" \n    stroke=\"currentColor\" \n    strokeWidth=\"2.5\" \n    strokeLinecap=\"round\" \n    strokeLinejoin=\"round\" \n    className={className}\n  >\n    <line x1=\"3\" y1=\"6\" x2=\"21\" y2=\"6\" />\n    <line x1=\"9\" y1=\"12\" x2=\"21\" y2=\"12\" />\n    <line x1=\"15\" y1=\"18\" x2=\"21\" y2=\"18\" />\n  </svg>\n);\n\nexport default function Header() {\n  const { totalItems, setIsDrawerOpen } = useMochila();\n  const { favoritos, showFavoritoToast, favoritoToastItem, closeFavoritoToast } = useFavoritos();\n  const [location] = useLocation();\n  const [isVisible, setIsVisible] = useState(false);\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\n  \n  const isHomePage = location === \"/\";\n\n  useEffect(() => {\n    if (!isHomePage) {\n      setIsVisible(true);\n      return;\n    }\n\n    const handleScroll = () => {\n      const scrollPosition = window.scrollY;\n      setIsVisible(scrollPosition > 100);\n    };\n\n    window.addEventListener(\"scroll\", handleScroll);\n    return () => window.removeEventListener(\"scroll\", handleScroll);\n  }, [isHomePage]);\n\n  return (\n    <>\n      <header className={`${isHomePage ? 'fixed' : 'sticky'} top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60 transition-transform duration-300 ${\n        isVisible ? \"translate-y-0\" : \"-translate-y-full\"\n      }`}>\n        <div className=\"flex h-16 items-center justify-between px-4 md:px-8 relative\">\n          <div className=\"flex items-center gap-1.5 mr-auto\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setIsMenuOpen(true)}\n              data-testid=\"button-menu\"\n              className=\"h-14 w-14 flex items-center justify-center\"\n            >\n              <InvertedStairsIcon className=\"h-[54px] w-[54px] scale-x-[-1]\" />\n              <span className=\"sr-only\">menu</span>\n            </Button>\n          </div>\n\n          <div className=\"flex items-center\">\n            <Link href=\"/\" className=\"flex items-center gap-2 md:relative absolute left-1/2 -translate-x-1/2 md:left-0 md:translate-x-0\">\n              <img src={logoSvg} alt=\"Oudla Logo\" className=\"h-[28.8px] w-[28.8px] object-contain dark:invert shrink-0\" loading=\"lazy\" decoding=\"async\" />\n            </Link>\n          </div>\n\n          <div className=\"flex items-center gap-1.5 ml-auto\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={() => setIsDrawerOpen(true)}\n              data-testid=\"button-mochila\"\n              className=\"h-14 w-14 relative flex items-center justify-center\"\n            >\n              <Backpack className=\"h-8 w-8\" />\n              {totalItems > 0 && (\n                <span className=\"absolute top-2 right-2 h-4 w-4 bg-primary text-[10px] text-primary-foreground rounded-full flex items-center justify-center font-bold\">\n                  {totalItems}\n                </span>\n              )}\n              <span className=\"sr-only\">mochila</span>\n            </Button>\n          </div>\n        </div>\n      </header>\n\n      <AppleMenu isOpen={isMenuOpen} onClose={() => setIsMenuOpen(false)} />\n      <FavoritoToast\n        item={favoritoToastItem}\n        isVisible={showFavoritoToast}\n        onClose={closeFavoritoToast}\n        onOpenMenu={() => setIsMenuOpen(true)}\n      />\n    </>\n  );\n}","path":null,"size_bytes":3882,"size_tokens":null},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","path":null,"size_bytes":1753,"size_tokens":null},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, decimal, boolean, timestamp, index, unique, check, foreignKey } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  email: text(\"email\").notNull().unique(),\n  passwordHash: text(\"password_hash\").notNull(),\n  name: text(\"name\").notNull(),\n  height: integer(\"height\"), // cm\n  weight: integer(\"weight\"), // kg\n  preferredSize: varchar(\"preferred_size\", { length: 10 }),\n  isAdmin: boolean(\"is_admin\").default(false),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Products table\nexport const products = pgTable(\"products\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sku: text(\"sku\").unique(), // Stock Keeping Unit\n  slug: text(\"slug\").unique(), // Personalized URL slug\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  price: decimal(\"price\", { precision: 10, scale: 2 }).notNull(),\n  originalPrice: decimal(\"original_price\", { precision: 10, scale: 2 }),\n  productType: varchar(\"product_type\", { length: 50 }).default(\"tshirt\"), // \"tshirt\" or \"accessory\"\n  category: text(\"category\"), // category for accessories\n  colors: text(\"colors\"), // IMPORTANT: Stored as JSON string. Format: '[{\"name\":\"Preto\",\"hex\":\"#000000\"}]' (optional for accessories)\n  sizes: text(\"sizes\").array(), // [\"P\", \"M\", \"G\", \"GG\"] (optional for accessories)\n  modelUrl: text(\"model_url\"), // Path to 3D model (.glb file)\n  isNew: boolean(\"is_new\").default(false),\n  displayOrder: integer(\"display_order\").default(0), // Order priority on homepage\n  customizable: boolean(\"customizable\").default(false), // Toggle customizable options\n  customizableFront: boolean(\"customizable_front\").default(false), // Allow front customization\n  customizableBack: boolean(\"customizable_back\").default(false), // Allow back customization\n  sizesEnabled: boolean(\"sizes_enabled\").default(true), // Enable/disable sizes\n  showInstallments: boolean(\"show_installments\").default(true), // Toggle installments visibility\n  fabricTech: text(\"fabric_tech\").array(), // [\"n√£o encolhe\", \"seca r√°pido\"]\n  fabricDescription: text(\"fabric_description\"),\n  careInstructions: text(\"care_instructions\"),\n  sizeGuide: text(\"size_guide\"), // JSON string with size measurements\n  sizeChartImage: text(\"size_chart_image\"), // URL to uploaded size chart image\n  sizeChartEnabled: boolean(\"size_chart_enabled\").default(false), // Enable/disable size chart display\n  fabricsEnabled: boolean(\"fabrics_enabled\").default(false), // Enable/disable fabric selection\n  rating: decimal(\"rating\", { precision: 2, scale: 1 }).default(\"4.5\"), // Average rating (1.0 - 5.0)\n  reviewsCount: integer(\"reviews_count\").default(0), // Number of reviews\n  reviewsEnabled: boolean(\"reviews_enabled\").default(false), // Enable/disable reviews for this product\n  installmentsMax: integer(\"installments_max\").default(12), // Max installments number\n  installmentsValue: decimal(\"installments_value\", { precision: 10, scale: 2 }), // Custom installment value\n  installmentsInterestFree: boolean(\"installments_interest_free\").default(true), // Whether installments are interest-free\n  fabrics: text(\"fabrics\"), // IMPORTANT: Stored as JSON string. Format: '[{\"name\":\"Algod√£o\",\"price\":0}, {\"name\":\"Seda\",\"price\":40}]'\n  sectionLabel: text(\"section_label\"), // Small label above title (e.g. \"personalize\")\n  sectionTitle: text(\"section_title\"), // Main heading (e.g. \"escolha os detalhes da sua pe√ßa\")\n  sectionSubtitle: text(\"section_subtitle\"), // Description below title\n  status: text(\"status\").default(\"draft\"), // \"draft\" or \"published\"\n  previewToken: text(\"preview_token\"), // Secret token for private viewing\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  priceCheck: check(\"products_price_check\", sql`${table.price} >= 0`),\n  originalPriceCheck: check(\"products_original_price_check\", sql`${table.originalPrice} >= 0 OR ${table.originalPrice} IS NULL`),\n  installmentsValueCheck: check(\"products_installments_value_check\", sql`${table.installmentsValue} >= 0 OR ${table.installmentsValue} IS NULL`),\n  ratingCheck: check(\"products_rating_check\", sql`${table.rating} >= 1.0 AND ${table.rating} <= 5.0`),\n  reviewsCountCheck: check(\"products_reviews_count_check\", sql`${table.reviewsCount} >= 0`),\n}));\n\n// Product images table\nexport const productImages = pgTable(\"product_images\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  imageUrl: text(\"image_url\").notNull(),\n  altText: text(\"alt_text\"),\n  imageType: varchar(\"image_type\", { length: 20 }).default(\"carousel\"), // \"presentation\" or \"carousel\"\n  color: text(\"color\"), // color name for carousel images, null for presentation\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"product_images_product_id_idx\").on(table.productId),\n}));\n\n// Reviews table\nexport const reviews = pgTable(\"reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  title: text(\"title\"),\n  content: text(\"content\").notNull(),\n  verified: boolean(\"verified\").default(false),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"reviews_product_id_idx\").on(table.productId),\n  userIdIdx: index(\"reviews_user_id_idx\").on(table.userId),\n  ratingCheck: check(\"reviews_rating_check\", sql`${table.rating} >= 1 AND ${table.rating} <= 5`),\n}));\n\n// Admin product reviews table - Reviews created by admin for products\nexport const adminProductReviews = pgTable(\"admin_product_reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  userName: text(\"user_name\").notNull(),\n  userImage: text(\"user_image\"), // URL to user profile image\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  comment: text(\"comment\").notNull(),\n  userCity: text(\"user_city\"), // City/State e.g., \"Maring√°/PR\"\n  reviewImage: text(\"review_image\"),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"admin_product_reviews_product_id_idx\").on(table.productId),\n  ratingCheck: check(\"admin_product_reviews_rating_check\", sql`${table.rating} >= 1 AND ${table.rating} <= 5`),\n}));\n\n// Review images table\nexport const reviewImages = pgTable(\"review_images\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reviewId: varchar(\"review_id\").notNull().references(() => reviews.id, { onDelete: \"cascade\" }),\n  imageUrl: text(\"image_url\").notNull(),\n  altText: text(\"alt_text\"),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  reviewIdIdx: index(\"review_images_review_id_idx\").on(table.reviewId),\n}));\n\n// Review likes table\nexport const reviewLikes = pgTable(\"review_likes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reviewId: varchar(\"review_id\").notNull().references(() => reviews.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  reviewUserIdx: index(\"review_likes_review_user_idx\").on(table.reviewId, table.userId),\n  uniqueReviewUser: unique(\"review_likes_unique\").on(table.reviewId, table.userId),\n}));\n\n// Review Q&A table\nexport const reviewQA = pgTable(\"review_qa\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  reviewId: varchar(\"review_id\").notNull().references(() => reviews.id, { onDelete: \"cascade\" }),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  question: text(\"question\"),\n  answer: text(\"answer\"),\n  isQuestion: boolean(\"is_question\").default(true),\n  parentId: varchar(\"parent_id\"),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  reviewIdIdx: index(\"review_qa_review_id_idx\").on(table.reviewId),\n  parentFk: foreignKey({\n    columns: [table.parentId],\n    foreignColumns: [table.id],\n    name: \"review_qa_parent_fk\"\n  }),\n}));\n\n// Favorites table\nexport const favorites = pgTable(\"favorites\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  userProductIdx: index(\"favorites_user_product_idx\").on(table.userId, table.productId),\n  uniqueUserProduct: unique(\"favorites_unique\").on(table.userId, table.productId),\n}));\n\n// Cart items table\nexport const cartItems = pgTable(\"cart_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull().references(() => users.id, { onDelete: \"cascade\" }),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  size: varchar(\"size\", { length: 10 }).notNull(),\n  color: varchar(\"color\", { length: 7 }).notNull(), // hex color\n  quantity: integer(\"quantity\").notNull().default(1),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  userIdIdx: index(\"cart_items_user_id_idx\").on(table.userId),\n  uniqueUserProductSizeColor: unique(\"cart_items_unique\").on(table.userId, table.productId, table.size, table.color),\n  quantityCheck: check(\"cart_items_quantity_check\", sql`${table.quantity} >= 1`),\n}));\n\n// User schemas\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  email: true,\n  passwordHash: true,\n  name: true,\n  height: true,\n  weight: true,\n});\n\nexport const updateUserMeasurementsSchema = createInsertSchema(users).pick({\n  height: true,\n  weight: true,\n  preferredSize: true,\n});\n\n// Color schema for validation\nexport const colorSchema = z.object({\n  name: z.string().min(1, \"Nome da cor √© obrigat√≥rio\"),\n  hex: z.string().regex(/^#[0-9A-Fa-f]{6}$/, \"Hexadecimal inv√°lido (use #RRGGBB)\"),\n});\n\n// Fabric schema for validation\nexport const fabricSchema = z.object({\n  name: z.string().min(1, \"Nome do tecido √© obrigat√≥rio\"),\n  price: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]).default(0),\n});\n\n// Product schemas\nexport const insertProductSchema = createInsertSchema(products).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  sku: z.string().optional().nullable(),\n  colors: z.union([\n    z.string(),  // Accept already stringified JSON\n    z.array(colorSchema)  // Accept array and transform\n  ]).optional().transform((val) => {\n    console.log(\"üîÑ [SCHEMA TRANSFORM] Transformando colors\");\n    console.log(\"üîÑ [SCHEMA TRANSFORM] Valor recebido:\", val);\n    console.log(\"üîÑ [SCHEMA TRANSFORM] Tipo:\", typeof val);\n    \n    if (!val) {\n      console.log(\"üîÑ [SCHEMA TRANSFORM] Valor vazio/null, retornando null\");\n      return null;\n    }\n    \n    if (typeof val === 'string') {\n      console.log(\"üîÑ [SCHEMA TRANSFORM] J√° √© string, retornando como est√°:\", val);\n      return val;\n    }\n    \n    if (Array.isArray(val)) {\n      const stringified = JSON.stringify(val);\n      console.log(\"üîÑ [SCHEMA TRANSFORM] √â array, convertendo para JSON:\", stringified);\n      return stringified;\n    }\n    \n    console.log(\"üîÑ [SCHEMA TRANSFORM] Tipo desconhecido, retornando null\");\n    return null;\n  }),\n  fabrics: z.union([\n    z.string(),\n    z.array(fabricSchema)\n  ]).optional().nullable().transform((val) => {\n    if (!val) return null;\n    if (typeof val === 'string') return val;\n    if (Array.isArray(val)) return JSON.stringify(val);\n    return null;\n  }),\n  sizeChartImage: z.string().optional().nullable(),\n  sizeChartEnabled: z.boolean().optional(),\n  fabricsEnabled: z.boolean().optional(),\n  reviewsCount: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]).optional(),\n  rating: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]).optional(),\n  installmentsMax: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]).optional(),\n  installmentsValue: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]).optional().nullable(),\n  installmentsInterestFree: z.boolean().optional(),\n});\n\n// Review schemas\nexport const insertReviewSchema = createInsertSchema(reviews).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  verified: true,\n});\n\n// Cart schemas\nexport const insertCartItemSchema = createInsertSchema(cartItems).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Product image schemas\nexport const insertProductImageSchema = createInsertSchema(productImages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Admin product review schemas\nexport const insertAdminProductReviewSchema = createInsertSchema(adminProductReviews).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  rating: z.union([\n    z.number(),\n    z.string().transform(val => Number(val))\n  ]),\n});\n\n// Review image schemas\nexport const insertReviewImageSchema = createInsertSchema(reviewImages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Review like schemas\nexport const insertReviewLikeSchema = createInsertSchema(reviewLikes).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Review Q&A schemas\nexport const insertReviewQASchema = createInsertSchema(reviewQA).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Favorite schemas\nexport const insertFavoriteSchema = createInsertSchema(favorites).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Site banners table - for homepage carousel\nexport const siteBanners = pgTable(\"site_banners\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  subtitle: text(\"subtitle\").notNull(),\n  ctaText: text(\"cta_text\"), // Optional\n  ctaLink: text(\"cta_link\"), // Optional - used when productId is null\n  productId: varchar(\"product_id\").references(() => products.id, { onDelete: \"set null\" }), // Optional - link to specific product\n  imageUrl: text(\"image_url\").notNull(),\n  position: varchar(\"position\", { length: 10 }).default(\"left\"), // left or right\n  showText: boolean(\"show_text\").default(true), // Show or hide text overlay\n  sortOrder: integer(\"sort_order\").default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Site content table - for editable texts throughout the site\nexport const siteContent = pgTable(\"site_content\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(), // e.g., \"newsletter_title\", \"footer_description\"\n  value: text(\"value\").notNull(),\n  section: text(\"section\"), // e.g., \"newsletter\", \"footer\", \"feature_banner\"\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Site settings table - for theme and general settings\nexport const siteSettings = pgTable(\"site_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  key: text(\"key\").notNull().unique(), // e.g., \"primary_color\", \"theme_mode\", \"free_shipping_enabled\"\n  value: text(\"value\").notNull(),\n  type: varchar(\"type\", { length: 20 }).default(\"text\"), // text, color, boolean, number\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Daily verses table\nexport const siteVerses = pgTable(\"site_verses\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  text: text(\"text\").notNull(),\n  reference: text(\"reference\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Admin users table - separate from regular users for security\nexport const adminUsers = pgTable(\"admin_users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  username: text(\"username\").notNull().unique(),\n  passwordHash: text(\"password_hash\").notNull(),\n  isActive: boolean(\"is_active\").default(true),\n  lastLogin: timestamp(\"last_login\"),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Site banners schemas\nexport const insertSiteBannerSchema = createInsertSchema(siteBanners).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Site content schemas\nexport const insertSiteContentSchema = createInsertSchema(siteContent).omit({\n  id: true,\n  updatedAt: true,\n});\n\n// Site settings schemas\nexport const insertSiteSettingSchema = createInsertSchema(siteSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\n// Site verses schemas\nexport const insertSiteVerseSchema = createInsertSchema(siteVerses).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Content cards table - for homepage feature sections\nexport const contentCards = pgTable(\"content_cards\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  cardType: varchar(\"card_type\", { length: 50 }).notNull(), // \"feature\" or \"lifestyle\"\n  title: text(\"title\"),\n  subtitle: text(\"subtitle\"),\n  ctaText: text(\"cta_text\"),\n  ctaLink: text(\"cta_link\"),\n  productId: varchar(\"product_id\").references(() => products.id, { onDelete: \"set null\" }),\n  imageUrl: text(\"image_url\").notNull(),\n  position: varchar(\"position\", { length: 20 }).default(\"center\"), // text position: left, right, center\n  height: varchar(\"height\", { length: 20 }).default(\"medium\"), // small, medium, large for different card sizes\n  isActive: boolean(\"is_active\").default(true),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Content card images table - for multiple images per card\nexport const contentCardImages = pgTable(\"content_card_images\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  cardId: varchar(\"card_id\").notNull().references(() => contentCards.id, { onDelete: \"cascade\" }),\n  imageUrl: text(\"image_url\").notNull(),\n  sortOrder: integer(\"sort_order\").default(0),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Content cards schemas\nexport const insertContentCardSchema = createInsertSchema(contentCards).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertContentCardImageSchema = createInsertSchema(contentCardImages).omit({\n  id: true,\n  createdAt: true,\n});\n\n// CTA Banner Config table - for the \"view all products\" banner configuration\nexport const ctaBannerConfigs = pgTable(\"cta_banner_configs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  tagLabel: text(\"tag_label\").default(\"cole√ß√£o completa\"), // Top label like \"cole√ß√£o completa\"\n  title: text(\"title\").notNull().default(\"explore toda a cole√ß√£o\"),\n  description: text(\"description\").default(\"descubra pe√ßas √∫nicas que combinam f√©, estilo e qualidade premium\"),\n  buttonText: text(\"button_text\").notNull().default(\"ver todos os produtos\"),\n  buttonBgColor: text(\"button_bg_color\").default(\"#ffffff\"), // Hex color for button background\n  backgroundImageUrl: text(\"background_image_url\"), // URL to uploaded background image\n  backgroundImageAlt: text(\"background_image_alt\").default(\"banner background\"),\n  isActive: boolean(\"is_active\").default(true), // Only one can be active at a time\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// CTA Banner schemas\nexport const insertCtaBannerConfigSchema = createInsertSchema(ctaBannerConfigs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// FAQ table - for frequently asked questions\nexport const faqs = pgTable(\"faqs\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  question: text(\"question\").notNull(),\n  answer: text(\"answer\").notNull(),\n  category: varchar(\"category\", { length: 50 }).default(\"geral\"), // \"geral\", \"envio\", \"produto\", \"pagamento\", \"devolucao\"\n  sortOrder: integer(\"sort_order\").default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// FAQ schemas\nexport const insertFaqSchema = createInsertSchema(faqs).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Product installments configuration\nexport const productInstallmentOptions = pgTable(\"product_installment_options\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  installments: integer(\"installments\").notNull(),\n  isInterestFree: boolean(\"is_interest_free\").default(true),\n  customValue: decimal(\"custom_value\", { precision: 10, scale: 2 }), // Optional custom value per installment\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"product_installment_options_product_idx\").on(table.productId),\n}));\n\n// Product measurement fields table - defines which measurement fields a product uses\nexport const productMeasurementFields = pgTable(\"product_measurement_fields\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  fieldName: text(\"field_name\").notNull(),\n  sortOrder: integer(\"sort_order\").default(0),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"product_measurement_fields_product_idx\").on(table.productId),\n}));\n\n// Product size measurements table - actual measurement values per size\nexport const productSizeMeasurements = pgTable(\"product_size_measurements\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  sizeName: varchar(\"size_name\", { length: 10 }).notNull(),\n  fieldId: varchar(\"field_id\").notNull().references(() => productMeasurementFields.id, { onDelete: \"cascade\" }),\n  value: text(\"value\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"product_size_measurements_product_idx\").on(table.productId),\n  fieldIdIdx: index(\"product_size_measurements_field_idx\").on(table.fieldId),\n}));\n\n// Product measurement field schemas\nexport const insertProductMeasurementFieldSchema = createInsertSchema(productMeasurementFields).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Product size measurement schemas\nexport const insertProductSizeMeasurementSchema = createInsertSchema(productSizeMeasurements).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Footer pages table - for managing footer content (about, policies, returns, etc)\nexport const footerPages = pgTable(\"footer_pages\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  slug: text(\"slug\").notNull().unique(), // \"about\", \"policies\", \"returns\", \"shipping\", \"privacy\"\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(), // HTML allowed\n  description: text(\"description\"), // Short description for meta tags\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Newsletter subscribers table\nexport const newsletterSubscribers = pgTable(\"newsletter_subscribers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: text(\"email\").notNull().unique(),\n  status: text(\"status\").default('active'),\n  ipAddress: text(\"ip_address\"),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Newsletter settings table\nexport const newsletterSettings = pgTable(\"newsletter_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull().default(\"fique por dentro\"),\n  description: text(\"description\").notNull().default(\"inscreva-se para receber novidades, lan√ßamentos e conte√∫dos exclusivos.\"),\n  buttonText: text(\"button_text\").notNull().default(\"inscrever\"),\n  disclaimerText: text(\"disclaimer_text\").notNull().default(\"sem spam. cancele quando quiser.\"),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Company info table - for managing footer company information (CNPJ, address, copyright)\nexport const companyInfo = pgTable(\"company_info\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  companyName: text(\"company_name\").notNull(),\n  cnpj: text(\"cnpj\").notNull(),\n  street: text(\"street\").notNull(),\n  number: text(\"number\").notNull(),\n  complement: text(\"complement\"),\n  neighborhood: text(\"neighborhood\").notNull(),\n  city: text(\"city\").notNull(),\n  state: varchar(\"state\", { length: 2 }).notNull(),\n  zipCode: varchar(\"zip_code\", { length: 9 }).notNull(),\n  phone: varchar(\"phone\", { length: 20 }),\n  email: text(\"email\"),\n  copyrightYear: integer(\"copyright_year\").notNull(),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Newsletter schemas\nexport const insertNewsletterSubscriberSchema = createInsertSchema(newsletterSubscribers).omit({\n  id: true,\n  createdAt: true,\n}).extend({\n  email: z.string().email(\"E-mail inv√°lido\"),\n});\n\nexport const insertNewsletterSettingsSchema = createInsertSchema(newsletterSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type NewsletterSubscriber = typeof newsletterSubscribers.$inferSelect;\nexport type InsertNewsletterSubscriber = z.infer<typeof insertNewsletterSubscriberSchema>;\nexport type NewsletterSettings = typeof newsletterSettings.$inferSelect;\nexport type InsertNewsletterSettings = z.infer<typeof insertNewsletterSettingsSchema>;\n\n// Admin user schemas\nexport const insertAdminUserSchema = createInsertSchema(adminUsers).omit({\n  id: true,\n  createdAt: true,\n  lastLogin: true,\n});\n\n// Footer pages schemas\nexport const insertFooterPageSchema = createInsertSchema(footerPages).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Company info schemas\nexport const insertCompanyInfoSchema = createInsertSchema(companyInfo).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  companyName: z.string().optional().default(\"\"),\n  cnpj: z.string().optional().default(\"\"),\n  street: z.string().optional().default(\"\"),\n  number: z.string().optional().default(\"\"),\n  complement: z.string().optional().nullable(),\n  neighborhood: z.string().optional().default(\"\"),\n  city: z.string().optional().default(\"\"),\n  state: z.string().optional().default(\"\"),\n  zipCode: z.string().optional().default(\"\"),\n  phone: z.string().optional().nullable(),\n  email: z.string().optional().nullable(),\n});\n\n// Orders table - for customer orders\nexport const orders = pgTable(\"orders\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderNumber: varchar(\"order_number\", { length: 50 }).notNull().unique(), // Human-readable order number\n  \n  // Customer information\n  customerName: text(\"customer_name\").notNull(),\n  customerEmail: text(\"customer_email\").notNull(),\n  customerPhone: varchar(\"customer_phone\", { length: 20 }),\n  customerCpf: varchar(\"customer_cpf\", { length: 14 }).notNull(), // Format: 000.000.000-00\n  \n  // Delivery address\n  zipCode: varchar(\"zip_code\", { length: 9 }).notNull(), // Format: 00000-000\n  street: text(\"street\").notNull(),\n  number: varchar(\"number\", { length: 20 }).notNull(),\n  complement: text(\"complement\"),\n  neighborhood: text(\"neighborhood\").notNull(),\n  city: text(\"city\").notNull(),\n  state: varchar(\"state\", { length: 2 }).notNull(), // Format: SP, RJ, etc.\n  \n  // Order totals\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(),\n  discountAmount: decimal(\"discount_amount\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  shippingCost: decimal(\"shipping_cost\", { precision: 10, scale: 2 }).default(\"0.00\"),\n  totalAmount: decimal(\"total_amount\", { precision: 10, scale: 2 }).notNull(),\n  \n  // Payment information - Generic (prepared for any payment gateway)\n  // Note: Column names are legacy from previous integration, kept for backward compatibility\n  paymentPreferenceId: text(\"mercado_pago_preference_id\"), // Payment session/preference ID\n  paymentId: text(\"mercado_pago_payment_id\"), // Payment transaction ID\n  paymentStatus: varchar(\"mercado_pago_payment_status\", { length: 50 }), // approved, pending, rejected, etc.\n  paymentMethod: text(\"mercado_pago_payment_method\"), // credit_card, pix, boleto, etc.\n  paymentTypeId: varchar(\"mercado_pago_payment_type_id\", { length: 50 }), // credit_card, debit_card, ticket, etc.\n  paymentInstallments: integer(\"mercado_pago_installments\"), // Number of installments\n  \n  // Order status\n  orderStatus: varchar(\"order_status\", { length: 50 }).default(\"pending\"), // pending, paid, processing, shipped, delivered, cancelled, failed\n  \n  // Shipping tracking\n  trackingCode: varchar(\"tracking_code\", { length: 50 }), // Correios tracking code\n  refundReason: text(\"refund_reason\"), // Reason for refund\n  shippingMethod: varchar(\"shipping_method\", { length: 100 }), // PAC, SEDEX, etc.\n  estimatedDeliveryDate: timestamp(\"estimated_delivery_date\"),\n  actualDeliveryDate: timestamp(\"actual_delivery_date\"),\n  \n  // Admin management\n  internalNotes: text(\"internal_notes\"), // Admin-only notes about the order\n  archivedAt: timestamp(\"archived_at\"), // When the order was archived\n  deletedAt: timestamp(\"deleted_at\"), // Soft delete timestamp\n  \n  // Customer tracking information\n  customerIp: text(\"customer_ip\"),\n  userAgent: text(\"user_agent\"),\n  deviceType: varchar(\"device_type\", { length: 50 }), // mobile, tablet, desktop\n  browserName: varchar(\"browser_name\", { length: 100 }),\n  browserVersion: varchar(\"browser_version\", { length: 50 }),\n  osName: varchar(\"os_name\", { length: 100 }),\n  osVersion: varchar(\"os_version\", { length: 50 }),\n  screenResolution: varchar(\"screen_resolution\", { length: 50 }), // e.g., \"1920x1080\"\n  \n  // Verification code - random unique code generated on payment approval for anti-fraud\n  verificationCode: varchar(\"verification_code\", { length: 20 }),\n  \n  // Email timestamps\n  confirmationEmailSentAt: timestamp(\"confirmation_email_sent_at\"),\n  trackingEmailSentAt: timestamp(\"tracking_email_sent_at\"),\n  emailDeliveredAt: timestamp(\"email_delivered_at\"),\n  emailOpenedAt: timestamp(\"email_opened_at\"),\n  emailComplainedAt: timestamp(\"email_complained_at\"),\n  emailFailedAt: timestamp(\"email_failed_at\"),\n  emailFailureReason: text(\"email_failure_reason\"),\n  \n  // Timestamps\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n  paidAt: timestamp(\"paid_at\"),\n}, (table) => ({\n  orderNumberIdx: index(\"orders_order_number_idx\").on(table.orderNumber),\n  customerEmailIdx: index(\"orders_customer_email_idx\").on(table.customerEmail),\n  orderStatusIdx: index(\"orders_order_status_idx\").on(table.orderStatus),\n  paymentPreferenceIdx: index(\"orders_mp_preference_idx\").on(table.paymentPreferenceId),\n  subtotalCheck: check(\"orders_subtotal_check\", sql`${table.subtotal} >= 0`),\n  shippingCostCheck: check(\"orders_shipping_cost_check\", sql`${table.shippingCost} >= 0`),\n  totalAmountCheck: check(\"orders_total_amount_check\", sql`${table.totalAmount} >= 0`),\n}));\n\n// Product coupons table - individual coupons per product\nexport const productCoupons = pgTable(\"product_coupons\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"cascade\" }),\n  code: text(\"code\").notNull(),\n  discountType: varchar(\"discount_type\", { length: 20 }).default(\"percentage\"), // \"percentage\" or \"fixed\"\n  discountValue: decimal(\"discount_value\", { precision: 10, scale: 2 }).notNull(),\n  validFrom: timestamp(\"valid_from\"),\n  validUntil: timestamp(\"valid_until\"),\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  productIdIdx: index(\"product_coupons_product_id_idx\").on(table.productId),\n  codeIdx: index(\"product_coupons_code_idx\").on(table.code),\n  discountValueCheck: check(\"product_coupons_discount_value_check\", sql`${table.discountValue} > 0`),\n}));\n\n// Global coupon table - single coupon for free shipping or discounts\nexport const globalCoupon = pgTable(\"global_coupon\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  code: text(\"code\").notNull().unique(),\n  discountType: varchar(\"discount_type\", { length: 20 }).default(\"percentage\"), // \"percentage\" or \"fixed\"\n  discountValue: decimal(\"discount_value\", { precision: 10, scale: 2 }).notNull(),\n  description: text(\"description\"), // e.g., \"frete gr√°tis\"\n  isActive: boolean(\"is_active\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  codeIdx: index(\"global_coupon_code_idx\").on(table.code),\n  discountValueCheck: check(\"global_coupon_discount_value_check\", sql`${table.discountValue} > 0`),\n}));\n\n// Order items table - items in each order\nexport const orderItems = pgTable(\"order_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  orderId: varchar(\"order_id\").notNull().references(() => orders.id, { onDelete: \"cascade\" }),\n  productId: varchar(\"product_id\").notNull().references(() => products.id, { onDelete: \"restrict\" }),\n  \n  // Product details at time of purchase (snapshot)\n  productName: text(\"product_name\").notNull(),\n  productImage: text(\"product_image\").notNull(),\n  \n  // Variant details\n  size: varchar(\"size\", { length: 10 }).notNull(),\n  color: text(\"color\").notNull(), // JSON string: {\"name\":\"Preto\",\"hex\":\"#000000\"}\n  fabric: text(\"fabric\"), // JSON string: {\"name\":\"Algod√£o\",\"price\":0}\n  printPosition: varchar(\"print_position\", { length: 20 }), // \"frente\" or \"costas\"\n  \n  // Pricing\n  unitPrice: decimal(\"unit_price\", { precision: 10, scale: 2 }).notNull(),\n  quantity: integer(\"quantity\").notNull(),\n  subtotal: decimal(\"subtotal\", { precision: 10, scale: 2 }).notNull(), // unitPrice * quantity\n  \n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n}, (table) => ({\n  orderIdIdx: index(\"order_items_order_id_idx\").on(table.orderId),\n  productIdIdx: index(\"order_items_product_id_idx\").on(table.productId),\n  unitPriceCheck: check(\"order_items_unit_price_check\", sql`${table.unitPrice} >= 0`),\n  quantityCheck: check(\"order_items_quantity_check\", sql`${table.quantity} >= 1`),\n  subtotalCheck: check(\"order_items_subtotal_check\", sql`${table.subtotal} >= 0`),\n}));\n\n// Order schemas\nexport const insertOrderSchema = createInsertSchema(orders).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n  paidAt: true,\n}).extend({\n  customerCpf: z.string().regex(/^\\d{3}\\.\\d{3}\\.\\d{3}-\\d{2}$/, \"CPF inv√°lido (use 000.000.000-00)\"),\n  zipCode: z.string().regex(/^\\d{5}-\\d{3}$/, \"CEP inv√°lido (use 00000-000)\"),\n  state: z.string().length(2, \"Estado deve ter 2 caracteres\"),\n  customerEmail: z.string().email(\"Email inv√°lido\"),\n});\n\nexport const insertOrderItemSchema = createInsertSchema(orderItems).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Coupon schemas\nexport const insertProductCouponSchema = createInsertSchema(productCoupons).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  code: z.string().min(2).max(50),\n  discountValue: z.string().transform(v => parseFloat(v)),\n});\n\nexport const insertGlobalCouponSchema = createInsertSchema(globalCoupon).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n}).extend({\n  code: z.string().min(2).max(50),\n  discountValue: z.string().transform(v => parseFloat(v)),\n});\n\n// Types\nexport type Color = z.infer<typeof colorSchema>;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Product = typeof products.$inferSelect;\nexport type InsertProduct = z.infer<typeof insertProductSchema>;\nexport type ProductImage = typeof productImages.$inferSelect;\nexport type InsertProductImage = z.infer<typeof insertProductImageSchema>;\nexport type Review = typeof reviews.$inferSelect;\nexport type InsertReview = z.infer<typeof insertReviewSchema>;\nexport type ReviewImage = typeof reviewImages.$inferSelect;\nexport type InsertReviewImage = z.infer<typeof insertReviewImageSchema>;\nexport type ReviewLike = typeof reviewLikes.$inferSelect;\nexport type InsertReviewLike = z.infer<typeof insertReviewLikeSchema>;\nexport type ReviewQA = typeof reviewQA.$inferSelect;\nexport type InsertReviewQA = z.infer<typeof insertReviewQASchema>;\nexport type Favorite = typeof favorites.$inferSelect;\nexport type InsertFavorite = z.infer<typeof insertFavoriteSchema>;\nexport type CartItem = typeof cartItems.$inferSelect;\nexport type InsertCartItem = z.infer<typeof insertCartItemSchema>;\nexport type UpdateUserMeasurements = z.infer<typeof updateUserMeasurementsSchema>;\nexport type SiteBanner = typeof siteBanners.$inferSelect;\nexport type InsertSiteBanner = z.infer<typeof insertSiteBannerSchema>;\nexport type SiteContent = typeof siteContent.$inferSelect;\nexport type InsertSiteContent = z.infer<typeof insertSiteContentSchema>;\nexport type SiteSetting = typeof siteSettings.$inferSelect;\nexport type InsertSiteSetting = z.infer<typeof insertSiteSettingSchema>;\nexport type SiteVerse = typeof siteVerses.$inferSelect;\nexport type InsertSiteVerse = z.infer<typeof insertSiteVerseSchema>;\nexport type ContentCard = typeof contentCards.$inferSelect;\nexport type InsertContentCard = z.infer<typeof insertContentCardSchema>;\nexport type ContentCardImage = typeof contentCardImages.$inferSelect;\nexport type InsertContentCardImage = z.infer<typeof insertContentCardImageSchema>;\nexport type CtaBannerConfig = typeof ctaBannerConfigs.$inferSelect;\nexport type InsertCtaBannerConfig = z.infer<typeof insertCtaBannerConfigSchema>;\nexport type Faq = typeof faqs.$inferSelect;\nexport type InsertFaq = z.infer<typeof insertFaqSchema>;\nexport type AdminUser = typeof adminUsers.$inferSelect;\nexport type InsertAdminUser = z.infer<typeof insertAdminUserSchema>;\nexport type Order = typeof orders.$inferSelect;\nexport type InsertOrder = z.infer<typeof insertOrderSchema>;\nexport type OrderItem = typeof orderItems.$inferSelect;\nexport type InsertOrderItem = z.infer<typeof insertOrderItemSchema>;\nexport type ProductMeasurementField = typeof productMeasurementFields.$inferSelect;\nexport type InsertProductMeasurementField = z.infer<typeof insertProductMeasurementFieldSchema>;\nexport type ProductSizeMeasurement = typeof productSizeMeasurements.$inferSelect;\nexport type InsertProductSizeMeasurement = z.infer<typeof insertProductSizeMeasurementSchema>;\nexport type CompanyInfo = typeof companyInfo.$inferSelect;\nexport type InsertCompanyInfo = z.infer<typeof insertCompanyInfoSchema>;\nexport type AdminProductReview = typeof adminProductReviews.$inferSelect;\nexport type InsertAdminProductReview = z.infer<typeof insertAdminProductReviewSchema>;\nexport type ProductCoupon = typeof productCoupons.$inferSelect;\nexport type InsertProductCoupon = z.infer<typeof insertProductCouponSchema>;\nexport type GlobalCoupon = typeof globalCoupon.$inferSelect;\nexport type InsertGlobalCoupon = z.infer<typeof insertGlobalCouponSchema>;\n\n/**\n * Tabela de Pixels de Rastreamento e Scripts\n * \n * Armazena configura√ß√µes de pixels de rastreamento (Facebook, Google, TikTok)\n * e scripts customizados para header/body do site.\n * \n * Facebook Pixel Events rastreados automaticamente:\n * - PageView: Visualiza√ß√£o de p√°gina\n * - ViewContent: Visualiza√ß√£o de produto\n * - AddToCart: Adicionar ao carrinho\n * - RemoveFromCart: Remover do carrinho\n * - InitiateCheckout: Iniciar checkout\n * - AddPaymentInfo: Adicionar info de pagamento\n * - Purchase: Compra conclu√≠da\n * - Lead: Cadastro newsletter\n * - Search: Busca de produtos\n * - AddToWishlist: Adicionar aos favoritos\n * - CompleteRegistration: Registro completo\n * \n * Exemplo de uso:\n * - Facebook Pixel ID: 123456789012345\n * - Google Ads Conversion ID: AW-123456789\n * - TikTok Pixel ID: CXXXXXXXXXXXXXXXXXX\n */\nexport const trackingPixels = pgTable(\"tracking_pixels\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  \n  // ===== FACEBOOK PIXEL =====\n  facebookPixelId: text(\"facebook_pixel_id\"), // ID do pixel (ex: 123456789012345)\n  facebookPixelEnabled: boolean(\"facebook_pixel_enabled\").default(false),\n  facebookTestEventCode: text(\"facebook_test_event_code\"), // C√≥digo de teste para debug (ex: TEST12345)\n  \n  // ===== GOOGLE ADS =====\n  googleAdsConversionId: text(\"google_ads_conversion_id\"), // ID de convers√£o (ex: AW-123456789)\n  googleAdsConversionLabel: text(\"google_ads_conversion_label\"), // Label de convers√£o\n  googleAdsEnabled: boolean(\"google_ads_enabled\").default(false),\n  \n  // ===== GOOGLE ANALYTICS 4 =====\n  googleAnalyticsId: text(\"google_analytics_id\"), // ID do GA4 (ex: G-XXXXXXXXXX)\n  googleAnalyticsEnabled: boolean(\"google_analytics_enabled\").default(false),\n  \n  // ===== TIKTOK PIXEL =====\n  tiktokPixelId: text(\"tiktok_pixel_id\"), // ID do pixel TikTok\n  tiktokPixelEnabled: boolean(\"tiktok_pixel_enabled\").default(false),\n  \n  // ===== SCRIPTS CUSTOMIZADOS =====\n  // Scripts injetados no <head> do site (ex: Hotjar, Clarity, etc)\n  headerScripts: text(\"header_scripts\"),\n  // Scripts injetados no final do <body> do site\n  bodyScripts: text(\"body_scripts\"),\n  \n  // ===== MERCADO PAGO TRACKING =====\n  mercadoPagoTrackingEnabled: boolean(\"mercado_pago_tracking_enabled\").default(true),\n  \n  // Timestamps\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const insertTrackingPixelsSchema = createInsertSchema(trackingPixels).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type TrackingPixels = typeof trackingPixels.$inferSelect;\nexport type InsertTrackingPixels = z.infer<typeof insertTrackingPixelsSchema>;\n\n// Email templates table - for customizable transactional emails\nexport const emailTemplates = pgTable(\"email_templates\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  templateKey: varchar(\"template_key\", { length: 50 }).notNull().unique(),\n  name: text(\"name\").notNull(),\n  subject: text(\"subject\").notNull(),\n  htmlContent: text(\"html_content\").notNull(),\n  enabled: boolean(\"enabled\").default(true),\n  createdAt: timestamp(\"created_at\").default(sql`CURRENT_TIMESTAMP`),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\n// Email templates schemas\nexport const insertEmailTemplateSchema = createInsertSchema(emailTemplates).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport type EmailTemplate = typeof emailTemplates.$inferSelect;\nexport type InsertEmailTemplate = z.infer<typeof insertEmailTemplateSchema>;\n\n// Cookie consent settings\nexport const cookieSettings = pgTable(\"cookie_settings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  enabled: boolean(\"enabled\").default(true),\n  title: text(\"title\").default(\"usamos cookies\").notNull(),\n  description: text(\"description\").default(\"utilizamos cookies para melhorar sua experi√™ncia de navega√ß√£o, personalizar conte√∫do e analisar nosso tr√°fego.\").notNull(),\n  buttonAcceptText: text(\"button_accept_text\").default(\"aceitar todos\").notNull(),\n  buttonRejectText: text(\"button_reject_text\").default(\"recusar\").notNull(),\n  buttonCustomizeText: text(\"button_customize_text\").default(\"personalizar\").notNull(),\n  showCustomizeButton: boolean(\"show_customize_button\").default(false),\n  privacyPolicyUrl: text(\"privacy_policy_url\").default(\"/privacidade\"),\n  updatedAt: timestamp(\"updated_at\").default(sql`CURRENT_TIMESTAMP`),\n});\n\nexport const insertCookieSettingsSchema = createInsertSchema(cookieSettings).omit({\n  id: true,\n  updatedAt: true,\n});\n\nexport type CookieSettings = typeof cookieSettings.$inferSelect;\nexport type InsertCookieSettings = z.infer<typeof insertCookieSettingsSchema>;\n","path":null,"size_bytes":45764,"size_tokens":null},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","path":null,"size_bytes":3021,"size_tokens":null},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","path":null,"size_bytes":772,"size_tokens":null},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\n// Import Cinzel font for the OUDLA logo\nconst link = document.createElement('link');\nlink.href = 'https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap';\nlink.rel = 'stylesheet';\ndocument.head.appendChild(link);\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","path":null,"size_bytes":391,"size_tokens":null},"client/src/components/examples/ColorSelector.tsx":{"content":"import ColorSelector from '../ColorSelector';\nimport { useState } from 'react';\n\nconst mockColors = [\n  { name: 'branco', value: 'white', hex: '#ffffff' },\n  { name: 'preto', value: 'black', hex: '#000000' },\n  { name: 'cinza claro', value: 'light-gray', hex: '#f5f5f5' },\n  { name: 'bege', value: 'beige', hex: '#f5f5dc' }\n];\n\nexport default function ColorSelectorExample() {\n  const [selectedColor, setSelectedColor] = useState('white');\n  \n  return (\n    <div className=\"p-8 max-w-md\">\n      <ColorSelector\n        colors={mockColors}\n        selectedColor={selectedColor}\n        onColorChange={setSelectedColor}\n      />\n    </div>\n  );\n}","path":null,"size_bytes":643,"size_tokens":null},"client/src/components/examples/Hero.tsx":{"content":"import Hero from '../Hero';\n\nexport default function HeroExample() {\n  return <Hero />;\n}","path":null,"size_bytes":89,"size_tokens":null},"client/src/components/ui/sidebar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, VariantProps } from \"class-variance-authority\"\nimport { PanelLeftIcon } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nfunction SidebarProvider({\n  defaultOpen = true,\n  open: openProp,\n  onOpenChange: setOpenProp,\n  className,\n  style,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  defaultOpen?: boolean\n  open?: boolean\n  onOpenChange?: (open: boolean) => void\n}) {\n  const isMobile = useIsMobile()\n  const [openMobile, setOpenMobile] = React.useState(false)\n\n  // This is the internal state of the sidebar.\n  // We use openProp and setOpenProp for control from outside the component.\n  const [_open, _setOpen] = React.useState(defaultOpen)\n  const open = openProp ?? _open\n  const setOpen = React.useCallback(\n    (value: boolean | ((value: boolean) => boolean)) => {\n      const openState = typeof value === \"function\" ? value(open) : value\n      if (setOpenProp) {\n        setOpenProp(openState)\n      } else {\n        _setOpen(openState)\n      }\n\n      // This sets the cookie to keep the sidebar state.\n      document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n    },\n    [setOpenProp, open]\n  )\n\n  // Helper to toggle the sidebar.\n  const toggleSidebar = React.useCallback(() => {\n    return isMobile ? setOpenMobile((open) => !open) : setOpen((open) => !open)\n  }, [isMobile, setOpen, setOpenMobile])\n\n  // Adds a keyboard shortcut to toggle the sidebar.\n  React.useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      if (\n        event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n        (event.metaKey || event.ctrlKey)\n      ) {\n        event.preventDefault()\n        toggleSidebar()\n      }\n    }\n\n    window.addEventListener(\"keydown\", handleKeyDown)\n    return () => window.removeEventListener(\"keydown\", handleKeyDown)\n  }, [toggleSidebar])\n\n  // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n  // This makes it easier to style the sidebar with Tailwind classes.\n  const state = open ? \"expanded\" : \"collapsed\"\n\n  const contextValue = React.useMemo<SidebarContextProps>(\n    () => ({\n      state,\n      open,\n      setOpen,\n      isMobile,\n      openMobile,\n      setOpenMobile,\n      toggleSidebar,\n    }),\n    [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n  )\n\n  return (\n    <SidebarContext.Provider value={contextValue}>\n      <TooltipProvider delayDuration={0}>\n        <div\n          data-slot=\"sidebar-wrapper\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH,\n              \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n              ...style,\n            } as React.CSSProperties\n          }\n          className={cn(\n            \"group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full\",\n            className\n          )}\n          {...props}\n        >\n          {children}\n        </div>\n      </TooltipProvider>\n    </SidebarContext.Provider>\n  )\n}\n\nfunction Sidebar({\n  side = \"left\",\n  variant = \"sidebar\",\n  collapsible = \"offcanvas\",\n  className,\n  children,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  side?: \"left\" | \"right\"\n  variant?: \"sidebar\" | \"floating\" | \"inset\"\n  collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n}) {\n  const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n  if (collapsible === \"none\") {\n    return (\n      <div\n        data-slot=\"sidebar\"\n        className={cn(\n          \"bg-sidebar text-sidebar-foreground flex h-full w-[var(--sidebar-width)] flex-col\",\n          className\n        )}\n        {...props}\n      >\n        {children}\n      </div>\n    )\n  }\n\n  if (isMobile) {\n    return (\n      <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n        <SheetContent\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar\"\n          data-mobile=\"true\"\n          className=\"bg-sidebar text-sidebar-foreground w-[var(--sidebar-width)] p-0 [&>button]:hidden\"\n          style={\n            {\n              \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n            } as React.CSSProperties\n          }\n          side={side}\n        >\n          <SheetHeader className=\"sr-only\">\n            <SheetTitle>Sidebar</SheetTitle>\n            <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n          </SheetHeader>\n          <div className=\"flex h-full w-full flex-col\">{children}</div>\n        </SheetContent>\n      </Sheet>\n    )\n  }\n\n  return (\n    <div\n      className=\"group peer text-sidebar-foreground hidden md:block\"\n      data-state={state}\n      data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n      data-variant={variant}\n      data-side={side}\n      data-slot=\"sidebar\"\n    >\n      {/* This is what handles the sidebar gap on desktop */}\n      <div\n        data-slot=\"sidebar-gap\"\n        className={cn(\n          \"relative w-[var(--sidebar-width)] bg-transparent transition-[width] duration-200 ease-linear\",\n          \"group-data-[collapsible=offcanvas]:w-0\",\n          \"group-data-[side=right]:rotate-180\",\n          variant === \"floating\" || variant === \"inset\"\n            ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4))]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)]\"\n        )}\n      />\n      <div\n        data-slot=\"sidebar-container\"\n        className={cn(\n          \"fixed inset-y-0 z-10 hidden h-svh w-[var(--sidebar-width)] transition-[left,right,width] duration-200 ease-linear md:flex\",\n          side === \"left\"\n            ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n            : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n          // Adjust the padding for floating and inset variants.\n          variant === \"floating\" || variant === \"inset\"\n            ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)+var(--spacing-4)+2px)]\"\n            : \"group-data-[collapsible=icon]:w-[var(--sidebar-width-icon)] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n          className\n        )}\n        {...props}\n      >\n        <div\n          data-sidebar=\"sidebar\"\n          data-slot=\"sidebar-inner\"\n          className=\"bg-sidebar group-data-[variant=floating]:border-sidebar-border flex h-full w-full flex-col group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:shadow-sm\"\n        >\n          {children}\n        </div>\n      </div>\n    </div>\n  )\n}\n\nfunction SidebarTrigger({\n  className,\n  onClick,\n  ...props\n}: React.ComponentProps<typeof Button>) {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      data-sidebar=\"trigger\"\n      data-slot=\"sidebar-trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeftIcon />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n}\n\nfunction SidebarRail({ className, ...props }: React.ComponentProps<\"button\">) {\n  const { toggleSidebar } = useSidebar()\n\n  // Note: Tailwind v3.4 doesn't support \"in-\" selectors. So the rail won't work perfectly.\n  return (\n    <button\n      data-sidebar=\"rail\"\n      data-slot=\"sidebar-rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"hover:after:bg-sidebar-border absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear group-data-[side=left]:-right-4 group-data-[side=right]:left-0 after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] sm:flex\",\n        \"in-data-[side=left]:cursor-w-resize in-data-[side=right]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"hover:group-data-[collapsible=offcanvas]:bg-sidebar group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInset({ className, ...props }: React.ComponentProps<\"main\">) {\n  return (\n    <main\n      data-slot=\"sidebar-inset\"\n      className={cn(\n        \"bg-background relative flex w-full flex-1 flex-col\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow-sm md:peer-data-[variant=inset]:peer-data-[state=collapsed]:ml-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarInput({\n  className,\n  ...props\n}: React.ComponentProps<typeof Input>) {\n  return (\n    <Input\n      data-slot=\"sidebar-input\"\n      data-sidebar=\"input\"\n      className={cn(\"bg-background h-8 w-full shadow-none\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-header\"\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-footer\"\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarSeparator({\n  className,\n  ...props\n}: React.ComponentProps<typeof Separator>) {\n  return (\n    <Separator\n      data-slot=\"sidebar-separator\"\n      data-sidebar=\"separator\"\n      className={cn(\"bg-sidebar-border mx-2 w-auto\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarContent({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-content\"\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroup({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group\"\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupLabel({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"div\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-label\"\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"text-sidebar-foreground/70 ring-sidebar-ring flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium outline-hidden transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:h-4 [&>svg]:w-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupAction({\n  className,\n  asChild = false,\n  ...props\n}: React.ComponentProps<\"button\"> & { asChild?: boolean }) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-group-action\"\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground absolute top-3.5 right-3 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarGroupContent({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-group-content\"\n      data-sidebar=\"group-content\"\n      className={cn(\"w-full text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenu({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu\"\n      data-sidebar=\"menu\"\n      className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuItem({ className, ...props }: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-item\"\n      data-sidebar=\"menu-item\"\n      className={cn(\"group/menu-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-hidden ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-data-[sidebar=menu-action]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:w-8! group-data-[collapsible=icon]:h-8! group-data-[collapsible=icon]:p-2! [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:p-0!\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nfunction SidebarMenuButton({\n  asChild = false,\n  isActive = false,\n  variant = \"default\",\n  size = \"default\",\n  tooltip,\n  className,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  isActive?: boolean\n  tooltip?: string | React.ComponentProps<typeof TooltipContent>\n} & VariantProps<typeof sidebarMenuButtonVariants>) {\n  const Comp = asChild ? Slot : \"button\"\n  const { isMobile, state } = useSidebar()\n\n  const button = (\n    <Comp\n      data-slot=\"sidebar-menu-button\"\n      data-sidebar=\"menu-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n      {...props}\n    />\n  )\n\n  if (!tooltip) {\n    return button\n  }\n\n  if (typeof tooltip === \"string\") {\n    tooltip = {\n      children: tooltip,\n    }\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>{button}</TooltipTrigger>\n      <TooltipContent\n        side=\"right\"\n        align=\"center\"\n        hidden={state !== \"collapsed\" || isMobile}\n        {...tooltip}\n      />\n    </Tooltip>\n  )\n}\n\nfunction SidebarMenuAction({\n  className,\n  asChild = false,\n  showOnHover = false,\n  ...props\n}: React.ComponentProps<\"button\"> & {\n  asChild?: boolean\n  showOnHover?: boolean\n}) {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-action\"\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground peer-hover/menu-button:text-sidebar-accent-foreground absolute top-1.5 right-1 flex aspect-square w-5 items-center justify-center rounded-md p-0 outline-hidden transition-transform focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 md:after:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"peer-data-[active=true]/menu-button:text-sidebar-accent-foreground group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuBadge({\n  className,\n  ...props\n}: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"sidebar-menu-badge\"\n      data-sidebar=\"menu-badge\"\n      className={cn(\n        \"text-sidebar-foreground pointer-events-none absolute right-1 flex h-5 min-w-5 items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums select-none\",\n        \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSkeleton({\n  className,\n  showIcon = false,\n  ...props\n}: React.ComponentProps<\"div\"> & {\n  showIcon?: boolean\n}) {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      data-slot=\"sidebar-menu-skeleton\"\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[var(--skeleton-width)] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n}\n\nfunction SidebarMenuSub({ className, ...props }: React.ComponentProps<\"ul\">) {\n  return (\n    <ul\n      data-slot=\"sidebar-menu-sub\"\n      data-sidebar=\"menu-sub\"\n      className={cn(\n        \"border-sidebar-border mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l px-2.5 py-0.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubItem({\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) {\n  return (\n    <li\n      data-slot=\"sidebar-menu-sub-item\"\n      data-sidebar=\"menu-sub-item\"\n      className={cn(\"group/menu-sub-item relative\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction SidebarMenuSubButton({\n  asChild = false,\n  size = \"md\",\n  isActive = false,\n  className,\n  ...props\n}: React.ComponentProps<\"a\"> & {\n  asChild?: boolean\n  size?: \"sm\" | \"md\"\n  isActive?: boolean\n}) {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      data-slot=\"sidebar-menu-sub-button\"\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"text-sidebar-foreground ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground active:bg-sidebar-accent active:text-sidebar-accent-foreground [&>svg]:text-sidebar-accent-foreground flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 outline outline-2 outline-transparent outline-offset-2 focus-visible:ring-2 disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","path":null,"size_bytes":21846,"size_tokens":null},"client/src/components/FavoritosDrawer.tsx":{"content":"import { X, Heart, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Product } from \"@shared/schema\";\n\ninterface ProductWithImages extends Product {\n  images?: string[];\n}\n\nexport default function FavoritosDrawer() {\n  const { favoritos, isDrawerOpen, setIsDrawerOpen, toggleFavorito } = useFavoritos();\n  const [, setLocation] = useLocation();\n\n  const { data: productsData } = useQuery<{ products: ProductWithImages[] }>({\n    queryKey: ['/api/products'],\n    enabled: isDrawerOpen && favoritos.length > 0,\n  });\n\n  const favoritoProducts = productsData?.products?.filter((p) => favoritos.includes(p.id)) || [];\n\n  const formatPrice = (value: string | number) => {\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(numValue);\n  };\n\n  return (\n    <AnimatePresence>\n      {isDrawerOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={() => setIsDrawerOpen(false)}\n            className=\"fixed inset-0 bg-black/50 z-50\"\n            data-testid=\"backdrop-favoritos\"\n          />\n\n          {/* Drawer */}\n          <motion.div\n            initial={{ x: \"100%\" }}\n            animate={{ x: 0 }}\n            exit={{ x: \"100%\" }}\n            transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n            className=\"fixed right-0 top-0 h-full w-full max-w-md bg-background shadow-2xl z-50 flex flex-col\"\n            data-testid=\"drawer-favoritos\"\n          >\n            {/* Header */}\n            <div className=\"flex items-center justify-between p-6 border-b\">\n              <h2 className=\"text-xl font-medium lowercase\">lista de desejos</h2>\n              <Button\n                variant=\"ghost\"\n                size=\"icon\"\n                onClick={() => setIsDrawerOpen(false)}\n                data-testid=\"button-close-drawer\"\n              >\n                <X className=\"h-5 w-5\" />\n              </Button>\n            </div>\n\n            {/* Items */}\n            <div className=\"flex-1 overflow-y-auto p-6\">\n              {favoritoProducts.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center\">\n                  <Heart className=\"h-12 w-12 text-muted-foreground mb-4\" />\n                  <p className=\"text-muted-foreground mb-4\">lista de desejos vazia</p>\n                  <p className=\"text-sm text-muted-foreground\">adicione produtos √† lista de desejos para v√™-los aqui</p>\n                </div>\n              ) : (\n                <div className=\"space-y-4\">\n                  {favoritoProducts.map((product) => {\n                    const firstImage = product.images?.[0] || '/placeholder.jpg';\n                    \n                    return (\n                      <motion.div\n                        key={product.id}\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, x: -100 }}\n                        className=\"relative flex gap-4 p-4 rounded-lg border hover-elevate cursor-pointer\"\n                        data-testid={`favorito-item-${product.id}`}\n                        onClick={() => {\n                          setIsDrawerOpen(false);\n                          setLocation(`/produto/${product.id}`);\n                        }}\n                      >\n                        <img\n                          src={firstImage}\n                          alt={product.name}\n                          className=\"w-20 h-20 object-cover rounded-md\"\n                          data-testid={`image-${product.id}`}\n                          loading=\"lazy\"\n                          decoding=\"async\"\n                        />\n\n                        <div className=\"flex-1 min-w-0\">\n                          <h3 className=\"font-medium lowercase truncate mb-1\" data-testid={`name-${product.id}`}>\n                            {product.name}\n                          </h3>\n                          <p className=\"text-sm text-muted-foreground mb-2\" data-testid={`price-${product.id}`}>\n                            {formatPrice(product.price)}\n                          </p>\n                        </div>\n                        \n                        <div className=\"flex items-end\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={(e) => {\n                              e.preventDefault();\n                              e.stopPropagation();\n                              toggleFavorito(product.id);\n                            }}\n                            className=\"h-7 w-7\"\n                            data-testid={`button-remove-${product.id}`}\n                          >\n                            <Trash2 className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </motion.div>\n                    );\n                  })}\n                </div>\n              )}\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":5542,"size_tokens":null},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","path":null,"size_bytes":1584,"size_tokens":null},"client/src/components/examples/SizeSelector.tsx":{"content":"import SizeSelector from '../SizeSelector';\nimport { useState } from 'react';\n\nconst mockSizes = [\n  { value: 'P', label: 'P', available: true, measurements: { chest: '92cm', length: '66cm' } },\n  { value: 'M', label: 'M', available: true, measurements: { chest: '98cm', length: '68cm' } },\n  { value: 'G', label: 'G', available: true, measurements: { chest: '104cm', length: '70cm' } },\n  { value: 'GG', label: 'GG', available: false, measurements: { chest: '110cm', length: '72cm' } },\n  { value: 'XG', label: 'XG', available: true, measurements: { chest: '116cm', length: '74cm' } }\n];\n\nexport default function SizeSelectorExample() {\n  const [selectedSize, setSelectedSize] = useState('M');\n  \n  return (\n    <div className=\"p-8 max-w-md\">\n      <SizeSelector\n        sizes={mockSizes}\n        selectedSize={selectedSize}\n        onSizeChange={setSelectedSize}\n        onSizeGuide={() => console.log('guia de medidas clicado')}\n      />\n    </div>\n  );\n}","path":null,"size_bytes":958,"size_tokens":null},"client/src/components/MochilaDrawer.tsx":{"content":"import { X, Plus, Minus, ChevronRight, Truck, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { useState, useEffect } from \"react\";\n// Importa o hook do Facebook Pixel para rastreamento de eventos\nimport { usePixel } from \"@/hooks/usePixel\";\n\ninterface ShippingResult {\n  price: number;\n  days: string;\n}\n\nexport default function MochilaDrawer() {\n  const { \n    items, \n    isDrawerOpen, \n    setIsDrawerOpen, \n    updateQuantity, \n    clearAll,\n    appliedCoupon,\n    setAppliedCoupon,\n    appliedDiscount,\n    zipCode,\n    setZipCode,\n    setShippingPrice\n  } = useMochila();\n  \n  // Inicializa o hook do Facebook Pixel para rastreamento de eventos\n  const { trackRemoveFromCart } = usePixel();\n  const [couponCode, setCouponCode] = useState(\"\");\n  const [isApplying, setIsApplying] = useState(false);\n  const [couponError, setCouponError] = useState<string | null>(null);\n  const [localCep, setLocalCep] = useState(zipCode || \"\");\n  const [isCalculating, setIsCalculating] = useState(false);\n  const [shippingResult, setShippingResult] = useState<ShippingResult | null>(null);\n  const [shippingError, setShippingError] = useState<string | null>(null);\n\n  const { data: freeShippingConfig } = useQuery<{ system: string; threshold: string; shippingValue: string; shippingMinDays: string; shippingMaxDays: string }>({\n    queryKey: ['/api/settings/free_shipping'],\n  });\n\n  const { data: ctaConfig } = useQuery<{ mochilaShippingFreeText: string; mochilaShippingPaidText: string }>({\n    queryKey: ['/api/settings/cta'],\n  });\n\n  const calculateShipping = async (val: string) => {\n    const cleanCep = val.replace(/\\D/g, \"\");\n    if (cleanCep.length !== 8) return;\n\n    setIsCalculating(true);\n    setShippingError(null);\n    setShippingResult(null);\n    \n    try {\n      const response = await fetch(`https://viacep.com.br/ws/${cleanCep}/json/`);\n      const data = await response.json();\n      \n      if (data.erro) {\n        setShippingError(\"cep n√£o encontrado\");\n        setIsCalculating(false);\n        return;\n      }\n      \n      await new Promise(resolve => setTimeout(resolve, 500));\n      \n      const isFreeForAll = freeShippingConfig?.system === \"all\";\n      const isThresholdSystem = freeShippingConfig?.system === \"threshold\" || !freeShippingConfig?.system;\n      const threshold = parseFloat(freeShippingConfig?.threshold || \"200\");\n      const defaultPrice = parseFloat(freeShippingConfig?.shippingValue || \"19.99\");\n      const currentSubtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n      const isFreeByThreshold = isThresholdSystem && currentSubtotal >= threshold;\n      const price = (isFreeForAll || isFreeByThreshold) ? 0 : defaultPrice;\n      \n      const minDays = parseInt(freeShippingConfig?.shippingMinDays || \"9\");\n      const maxDays = parseInt(freeShippingConfig?.shippingMaxDays || \"15\");\n\n      const addBusinessDays = (startDate: Date, numDays: number) => {\n        const result = new Date(startDate);\n        let added = 0;\n        while (added < numDays) {\n          result.setDate(result.getDate() + 1);\n          if (result.getDay() !== 0 && result.getDay() !== 6) added++;\n        }\n        return result;\n      };\n\n      const today = new Date();\n      const dateMin = addBusinessDays(today, minDays);\n      const dateMax = addBusinessDays(today, maxDays);\n\n      const diasSemana = [\"domingo\", \"segunda\", \"ter√ßa\", \"quarta\", \"quinta\", \"sexta\", \"s√°bado\"];\n      const formatDate = (date: Date) => {\n        const dia = diasSemana[date.getDay()];\n        const d = date.getDate().toString().padStart(2, '0');\n        const m = (date.getMonth() + 1).toString().padStart(2, '0');\n        return `${dia}, ${d}/${m}`;\n      };\n\n      const days = `entre ${formatDate(dateMin)} a ${formatDate(dateMax)}`;\n      \n      setZipCode(val);\n      setShippingPrice(price);\n      setShippingResult({ price, days });\n    } catch (e) {\n      console.error(e);\n      setShippingError(\"erro ao calcular frete\");\n    } finally {\n      setIsCalculating(false);\n    }\n  };\n\n  const handleCepChange = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const val = e.target.value.replace(/\\D/g, \"\").slice(0, 8);\n    let formatted = val;\n    if (val.length > 5) formatted = `${val.slice(0, 5)}-${val.slice(5)}`;\n    setLocalCep(formatted);\n    if (val.length === 8) calculateShipping(formatted);\n  };\n\n  const { data: couponResponse } = useQuery<{ coupon?: any }>({\n    queryKey: ['/api/global-coupon'],\n  });\n\n  const globalCoupon = couponResponse?.coupon;\n\n  // \"all\" = frete gr√°tis para todos, \"threshold\" = frete gr√°tis a partir de R$200\n  const isFreeShippingForAll = freeShippingConfig?.system === \"all\";\n  const isShippingSystemThreshold = freeShippingConfig?.system === \"threshold\" || !freeShippingConfig?.system;\n  const thresholdValue = parseFloat(freeShippingConfig?.threshold || \"200\");\n  const defaultShippingValue = parseFloat(freeShippingConfig?.shippingValue || \"19.99\");\n  const subtotal = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n  const isFreeShippingByValue = isShippingSystemThreshold && subtotal >= thresholdValue;\n  const shipping = isFreeShippingForAll || isFreeShippingByValue ? 0 : (zipCode ? defaultShippingValue : 0);\n  const discountAmount = appliedDiscount ? (subtotal * (Number(appliedDiscount) / 100)) : 0;\n  const subtotalAfterDiscount = subtotal - discountAmount;\n  const total = subtotalAfterDiscount + shipping;\n  \n  const applyCoupon = async () => {\n    if (!couponCode) return;\n    \n    setIsApplying(true);\n    setCouponError(null);\n    try {\n      const response = await fetch(\"/api/coupons/validate\", {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ code: couponCode })\n      });\n      \n      const data = await response.json();\n      \n      if (response.ok && data.valid) {\n        setAppliedCoupon(data.coupon.code, Number(data.coupon.discountValue));\n        setCouponCode(\"\");\n      } else {\n        if (globalCoupon && couponCode.toLowerCase() === globalCoupon.code.toLowerCase()) {\n          setAppliedCoupon(globalCoupon.code, Number(globalCoupon.discountValue));\n          setCouponCode(\"\");\n        } else {\n          setCouponError(data.error || \"cupom inv√°lido\");\n        }\n      }\n    } catch (error) {\n      if (globalCoupon && couponCode.toLowerCase() === globalCoupon.code.toLowerCase()) {\n        setAppliedCoupon(globalCoupon.code, Number(globalCoupon.discountValue));\n        setCouponCode(\"\");\n      } else {\n        setCouponError(\"erro ao validar cupom\");\n      }\n    } finally {\n      setIsApplying(false);\n    }\n  };\n\n  const removeCoupon = () => {\n    setAppliedCoupon(null);\n  };\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  useEffect(() => {\n    if (zipCode) {\n      setLocalCep(zipCode);\n      // Calculate shipping when drawer opens with saved CEP\n      if (isDrawerOpen && !shippingResult && !isCalculating) {\n        calculateShipping(zipCode);\n      }\n    }\n  }, [zipCode, isDrawerOpen]);\n\n  return (\n    <AnimatePresence>\n      {isDrawerOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={() => setIsDrawerOpen(false)}\n            className=\"fixed inset-0 bg-black/20 backdrop-blur-sm z-[60]\"\n            data-testid=\"backdrop-mochila\"\n          />\n\n          {/* Menu Panel - Popup Style */}\n          <motion.div\n            initial={{ x: \"100%\", opacity: 0 }}\n            animate={{ x: 0, opacity: 1 }}\n            exit={{ x: \"100%\", opacity: 0 }}\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0 }}\n            dragElastic={{ left: 0.1, right: 0.8 }}\n            onDragEnd={(_, info) => {\n              if (info.offset.x > 100) {\n                setIsDrawerOpen(false);\n              }\n            }}\n            transition={{ type: \"spring\", damping: 30, stiffness: 300 }}\n            className=\"fixed right-4 top-4 bottom-4 w-[calc(100%-2rem)] max-w-md bg-background/95 backdrop-blur-xl z-[61] shadow-2xl rounded-[2.5rem] overflow-hidden flex flex-col border border-white/10 touch-none\"\n            data-testid=\"drawer-mochila\"\n          >\n            {/* Header / Close handle */}\n            <div className=\"flex items-center justify-center pt-4 pb-2 shrink-0\">\n              <div className=\"w-12 h-1.5 bg-muted rounded-full\" />\n            </div>\n\n            {/* Content */}\n            <div className=\"flex-1 overflow-y-auto px-6 py-4 custom-scrollbar\">\n              <div className=\"space-y-6\">\n                <div className=\"flex items-center justify-between px-2\">\n                  <div className=\"flex items-center gap-3\">\n                    <h2 className=\"text-2xl font-semibold tracking-tight lowercase\">minha mochila</h2>\n                    {items.length > 0 && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"icon\"\n                        className=\"h-8 w-8 rounded-full opacity-30 hover:opacity-100 transition-opacity\"\n                        onClick={clearAll}\n                        data-testid=\"button-clear-mochila\"\n                      >\n                        <Trash2 className=\"h-3.5 w-3.5\" />\n                      </Button>\n                    )}\n                  </div>\n                  <Button \n                    variant=\"ghost\" \n                    size=\"icon\" \n                    className=\"h-10 w-10 rounded-full bg-muted/20 hover:bg-muted/40 transition-colors\"\n                    onClick={() => setIsDrawerOpen(false)}\n                  >\n                    <X className=\"h-5 w-5\" />\n                  </Button>\n                </div>\n\n                {items.length === 0 ? (\n                  <div className=\"py-20 flex flex-col items-center justify-center rounded-[2rem] bg-muted/20 border border-dashed border-muted\">\n                    <p className=\"text-sm text-muted-foreground lowercase\">sua mochila est√° vazia</p>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {items.map((item) => (\n                      <motion.div\n                        key={item.id}\n                        initial={{ opacity: 0, y: 20 }}\n                        animate={{ opacity: 1, y: 0 }}\n                        exit={{ opacity: 0, x: -100 }}\n                        className=\"flex gap-3 md:gap-4 p-2.5 md:p-3 rounded-2xl md:rounded-3xl bg-muted/10 border border-transparent hover:border-white/5 transition-all\"\n                        data-testid={`mochila-item-${item.id}`}\n                      >\n                        <Link \n                          href={`/produto/${item.productId}`}\n                          onClick={() => setIsDrawerOpen(false)}\n                          className=\"flex gap-4 flex-1 min-w-0 cursor-pointer\"\n                        >\n                          <img\n                            src={item.image}\n                            alt={item.name}\n                            className=\"w-16 h-16 object-cover rounded-2xl shadow-sm\"\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                          />\n                          <div className=\"flex-1 min-w-0 py-1 flex flex-col justify-center\">\n                            <h3 className=\"font-medium text-sm lowercase truncate\">{item.name}</h3>\n                            <p className=\"text-xs text-muted-foreground font-medium\">{formatPrice(item.price)}</p>\n                            \n                            {(item.color || item.size) && (\n                              <div className=\"flex items-center gap-2 mt-1\">\n                                {item.color && (\n                                  <div\n                                    className=\"w-3 h-3 rounded-full border border-white/10\"\n                                    style={{ backgroundColor: item.color.hex }}\n                                  />\n                                )}\n                                {item.size && (\n                                  <span className=\"text-[10px] uppercase font-bold text-muted-foreground\">\n                                    {item.size}\n                                  </span>\n                                )}\n                                {item.fabric && (\n                                  <>\n                                    <span className=\"text-[10px] text-muted-foreground/40\">‚Ä¢</span>\n                                    <span className=\"text-[10px] uppercase font-bold text-muted-foreground\">\n                                      {item.fabric.name}\n                                    </span>\n                                  </>\n                                )}\n                              </div>\n                            )}\n                          </div>\n                        </Link>\n\n                        <div className=\"flex flex-col items-center justify-between py-1\">\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-6 w-6 rounded-full bg-background/50 hover:bg-background shadow-sm\"\n                            onClick={() => updateQuantity(item.id, item.quantity + 1)}\n                          >\n                            <Plus className=\"h-3 w-3\" />\n                          </Button>\n                          <span className=\"text-xs font-bold\">{item.quantity}</span>\n                          <Button\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            className=\"h-6 w-6 rounded-full bg-background/50 hover:bg-background shadow-sm\"\n                            onClick={() => {\n                              // Quando a quantidade chegar a 0, o item ser√° removido - dispara evento RemoveFromCart\n                              if (item.quantity === 1) {\n                                trackRemoveFromCart(String(item.productId), item.name, item.price);\n                              }\n                              updateQuantity(item.id, item.quantity - 1);\n                            }}\n                          >\n                            <Minus className=\"h-3 w-3\" />\n                          </Button>\n                        </div>\n                      </motion.div>\n                    ))}\n                  </div>\n                )}\n              </div>\n\n              {/* Summary & Coupon */}\n              {items.length > 0 && (\n                <div className=\"mt-8 space-y-6 pb-20\">\n                  <div className=\"space-y-4\">\n                    <h3 className=\"text-lg font-semibold lowercase px-2\">cupom e frete</h3>\n                    \n                    <div className=\"px-2 space-y-3\">\n                      <div className=\"flex items-center gap-2 text-muted-foreground\">\n                        <Truck className=\"h-4 w-4\" />\n                        <span className=\"text-[10px] uppercase tracking-widest font-bold\">calcular frete e prazo</span>\n                      </div>\n                      <div className=\"relative\">\n                        <Input\n                          placeholder=\"00000-000\"\n                          value={localCep}\n                          onChange={handleCepChange}\n                          className=\"h-12 rounded-2xl bg-muted/10 border-transparent lowercase text-sm\"\n                          maxLength={9}\n                          data-testid=\"input-cep-drawer\"\n                        />\n                        {isCalculating && (\n                          <div className=\"absolute right-4 top-1/2 -translate-y-1/2\">\n                            <div className=\"h-4 w-4 border-2 border-primary border-t-transparent rounded-full animate-spin\" />\n                          </div>\n                        )}\n                      </div>\n                      {shippingError && (\n                        <p className=\"text-xs text-destructive lowercase ml-1\">{shippingError}</p>\n                      )}\n                      {shippingResult && (\n                        <div className=\"p-3 rounded-xl bg-muted/20 space-y-1\">\n                          <p className=\"text-sm lowercase\">\n                            {isFreeShippingForAll || isFreeShippingByValue\n                              ? `${ctaConfig?.mochilaShippingFreeText || \"entrega gr√°tis\"} ${shippingResult.days}`\n                              : <>{ctaConfig?.mochilaShippingPaidText || \"entrega por\"} <span className=\"normal-case\">{formatPrice(defaultShippingValue)}</span> {shippingResult.days}</>}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n\n                    {!appliedCoupon && (\n                      <div className=\"flex gap-2 px-2\">\n                        <Input\n                          placeholder=\"digite o cupom\"\n                          value={couponCode}\n                          onChange={(e) => {\n                            setCouponCode(e.target.value);\n                            if (couponError) setCouponError(null);\n                          }}\n                          className=\"h-12 rounded-2xl bg-muted/10 border-transparent lowercase text-sm\"\n                        />\n                        <Button\n                          onClick={applyCoupon}\n                          disabled={!couponCode || isApplying}\n                          className=\"h-12 rounded-2xl px-6 lowercase\"\n                        >\n                          {isApplying ? \"...\" : \"aplicar\"}\n                        </Button>\n                      </div>\n                    )}\n\n                    {appliedCoupon && (\n                      <div className=\"mx-2 p-4 rounded-[1.5rem] bg-primary/10 border border-primary/20 flex items-center justify-between\">\n                        <div className=\"flex flex-col\">\n                          <span className=\"text-[10px] text-muted-foreground lowercase\">cupom ativo</span>\n                          <span className=\"text-sm font-bold uppercase\">{appliedCoupon} (-{appliedDiscount}%)</span>\n                        </div>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-8 w-8 rounded-full\" onClick={removeCoupon}>\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"bg-muted/10 rounded-[2rem] md:rounded-[2.5rem] p-4 md:p-6 space-y-3\">\n                    <div className=\"flex justify-between text-sm text-muted-foreground lowercase\">\n                      <span>subtotal</span>\n                      <span className=\"font-medium normal-case\">{formatPrice(subtotal)}</span>\n                    </div>\n                    {discountAmount > 0 && (\n                      <div className=\"flex justify-between text-sm text-green-500 lowercase\">\n                        <span>desconto</span>\n                        <span className=\"font-medium normal-case\">-{formatPrice(discountAmount)}</span>\n                      </div>\n                    )}\n                    <div className=\"flex justify-between text-sm text-muted-foreground lowercase\">\n                      <span>frete</span>\n                      <span className=\"font-medium\">{isFreeShippingForAll || isFreeShippingByValue ? \"gr√°tis\" : <span className=\"normal-case\">{formatPrice(shipping)}</span>}</span>\n                    </div>\n                    \n                    {isFreeShippingByValue && !isFreeShippingForAll && (\n                      <div className=\"flex items-center gap-2 px-1 pt-1\">\n                        <div className=\"h-px flex-1 bg-foreground/5\" />\n                        <span className=\"text-[10px] text-muted-foreground/50 font-medium lowercase tracking-wide\">frete gr√°tis acima de <span className=\"normal-case\">{formatPrice(thresholdValue)}</span></span>\n                        <div className=\"h-px flex-1 bg-foreground/5\" />\n                      </div>\n                    )}\n                    \n                    {!isFreeShippingForAll && !isFreeShippingByValue && isShippingSystemThreshold && subtotal < thresholdValue && (\n                      <div className=\"pt-1\">\n                        <div className=\"w-full h-1 rounded-full bg-foreground/5 overflow-hidden\">\n                          <div \n                            className=\"h-full rounded-full bg-foreground/20 transition-all duration-500 ease-out\"\n                            style={{ width: `${Math.min((subtotal / thresholdValue) * 100, 100)}%` }}\n                          />\n                        </div>\n                        <p className=\"text-[10px] text-muted-foreground/40 font-medium lowercase text-center mt-1.5\">\n                          falta <span className=\"text-foreground/50 normal-case\">{formatPrice(thresholdValue - subtotal)}</span> para frete gr√°tis\n                        </p>\n                      </div>\n                    )}\n                    \n                    <div className=\"flex justify-between items-center pt-3 border-t border-white/5 mt-2\">\n                      <span className=\"text-lg md:text-xl font-bold lowercase\">total</span>\n                      <span className=\"text-xl md:text-2xl font-bold\">{formatPrice(total)}</span>\n                    </div>\n                  </div>\n                </div>\n              )}\n            </div>\n\n            {/* Action Bar */}\n            <div className=\"p-6 pb-8 shrink-0 bg-gradient-to-t from-background to-transparent border-t border-white/5\">\n              {items.length === 0 ? (\n                <Link href=\"/\" className=\"block w-full\">\n                  <Button \n                    className=\"w-full h-14 rounded-full text-lg font-bold lowercase transition-all active:scale-[0.95]\"\n                    onClick={() => setIsDrawerOpen(false)}\n                  >\n                    ver produtos\n                  </Button>\n                </Link>\n              ) : (\n                <Link href=\"/checkout\" className=\"block w-full\">\n                  <Button \n                    className=\"w-full h-14 rounded-full text-lg font-bold lowercase transition-all active:scale-[0.95]\"\n                    onClick={() => setIsDrawerOpen(false)}\n                  >\n                    concluir pedido\n                  </Button>\n                </Link>\n              )}\n            </div>\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":22956,"size_tokens":null},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","path":null,"size_bytes":2154,"size_tokens":null},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","path":null,"size_bytes":4420,"size_tokens":null},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","path":null,"size_bytes":1467,"size_tokens":null},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","path":null,"size_bytes":6210,"size_tokens":null},"replit.md":{"content":"# oudla - Luxury Christian Fashion Brand\n\n## Overview\n\noudla is a luxury Christian fashion e-commerce platform targeting young, modern audiences. The brand focuses on creating a community-driven shopping experience that combines faith, style, and premium quality. Built as a full-stack web application, it features a sophisticated product catalog, shopping cart (\"mochila\"), and modern UI/UX with mobile-first design principles.\n\nThe platform emphasizes:\n- Premium, minimalist aesthetic inspired by luxury brands (Ralph Lauren, Zara)\n- Christian identity subtly integrated throughout the experience\n- Community and belonging over pure commerce\n- Innovative product presentation and user interaction patterns\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework & Build System:**\n- React with TypeScript for type-safe component development\n- Vite as the build tool and development server\n- Wouter for lightweight client-side routing\n- Mobile-first responsive design approach\n\n**State Management:**\n- React Context API for global state (shopping cart/mochila)\n- TanStack Query (React Query) for server state management and data fetching\n- Local state with React hooks for component-level state\n\n**UI Component System:**\n- Shadcn/ui component library with Radix UI primitives\n- Tailwind CSS for utility-first styling with custom design tokens\n- Custom design system following luxury brand aesthetics\n- All text intentionally lowercase per brand guidelines\n- Motion animations via Framer Motion for enhanced UX\n\n**Design Tokens:**\n- Deep Charcoal (#1a1a1a) for primary text\n- Pure White/Warm Cream for backgrounds\n- Subtle Gold accents for premium touches\n- Custom spacing scale using Tailwind units\n- Typography: Inter (primary) and Playfair Display (accent/serif)\n\n### Backend Architecture\n\n**Server Framework:**\n- Express.js for HTTP server and API routing\n- TypeScript for type safety across the stack\n- RESTful API design pattern\n\n**Session Management:**\n- Express sessions with secure cookie configuration\n- Session regeneration on authentication to prevent fixation attacks\n- HTTP-only cookies in production with HTTPS requirement\n- SameSite cookie protection against CSRF\n\n**Authentication & Authorization:**\n- Bcrypt for password hashing\n- Role-based access control (isAdmin flag)\n- Session-based authentication (no JWT)\n- User ownership validation for cart and favorite operations\n\n**API Structure:**\n- `/api/products` - Product catalog endpoints\n- `/api/products/:id` - Individual product details with images\n- Protected admin routes for product management\n- User-scoped endpoints for cart and favorites\n\n### Data Storage\n\n**Database:**\n- PostgreSQL via Neon serverless\n- Drizzle ORM for type-safe database queries\n- Schema-first design with TypeScript types generated from schema\n\n**Database Schema:**\n- `users` - User accounts with measurements (height, weight) for size recommendations\n- `products` - Product catalog with color arrays, sizes, fabric tech info\n- `product_images` - Multiple images per product with sort order\n- `cart_items` - Shopping cart with user association\n- `favorites` - User wishlists\n- `reviews` - Product reviews with star ratings\n- `review_images` - User-uploaded review photos\n- `review_likes` - Social engagement on reviews\n- `review_qa` - Q&A system on product pages\n\n**Key Design Patterns:**\n- UUID primary keys for all entities\n- Soft deletes via isActive flags\n- Timestamps (createdAt, updatedAt) on all tables\n- Foreign key constraints with cascade deletes\n- Check constraints for data validation (prices >= 0)\n\n### External Dependencies\n\n**Image Assets:**\n- Static images stored in `/attached_assets/generated_images/`\n- Product images via URLs in database\n- Support for multiple images per product with carousel display\n\n**Development Tools:**\n- Replit-specific plugins for development environment\n- ESBuild for production server bundling\n- Drizzle Kit for database migrations\n\n**Security:**\n- Environment variables for sensitive configuration (SUPABASE_DATABASE_URL, SESSION_SECRET)\n- CORS and origin validation for admin operations\n- Production security checklist includes HTTPS, secure cookies, rate limiting\n\n**Payment Gateway:**\n- Sistema preparado para integra√ß√£o com gateway de pagamento\n- Estrutura de orders e order_items no banco de dados\n- Rotas de checkout gen√©ricas prontas para conex√£o\n- Rate limiting para prote√ß√£o contra abuse\n\n**Design & UI Libraries:**\n- Google Fonts (Inter, Playfair Display)\n- Lucide React for icons\n- Embla Carousel for product image galleries\n- React Hook Form with Zod validation for forms\n\n### Application Flow\n\n**Shopping Experience:**\n1. Users browse products on homepage with hero section and daily Bible verse\n2. Product cards show hover states, quick color selection, and favorite toggles\n3. Product detail pages feature image carousels, size/color selectors, shipping calculator\n4. Items added to \"mochila\" (backpack) with toast notifications\n5. Shopping cart drawer shows items, quantities, and total\n\n**Daily Verse System:**\n- Single verse of the day displayed on homepage from database\n- Admin panel allows manual editing of the current verse\n- No automatic rotation - admin has full control over verse content\n- Loading skeleton shown while verse data is being fetched from database\n- No hardcoded fallback - shows loading state until data is available\n\n**Homepage Loading:**\n- Full-page skeleton loading while main content fetches from database\n- Prevents display of cached or hardcoded data\n- Shows animated placeholders for banners, products, and feature sections\n\n**Deployment:**\n- App supports dual deployment: Replit and Oracle Free Tier (Ubuntu ARM)\n- Database driver auto-detects: Neon serverless on Replit, standard pg elsewhere\n- DATABASE_URL or SUPABASE_DATABASE_URL accepted (external Supabase PostgreSQL)\n- Deploy artifacts in /deploy folder: nginx.conf, oudla.service, setup-oracle.sh\n- PM2 config: ecosystem.config.cjs\n- Environment template: .env.example\n- Trust proxy configurable via TRUST_PROXY env var\n- Mercado Pago production detection: APP_ENV or NODE_ENV (no Replit vars needed)\n\n**Order Tracking System:**\n- Page at `/rastreio` - accessible from header hamburger menu and footer\n- Supports all major Brazilian carriers with automatic detection by tracking code format:\n  - Prefix-based: Correios, UPS, LATAM Cargo, Melhor Envio, Manda√™, J&T Express, Kangu, Azul Cargo, DHL (JD prefix), Loggi, FedEx (DT prefix), Sequoia, Buslog\n  - Numeric patterns: J&T (82xxx), FedEx (6xxx), Aramex (15+ digits), Jadlog (10-14 digits), TNT (8-9 digits), Total Express (5-7 digits)\n- Email template variable `{{link_rastreio}}` generates link to site's own tracking page\n- Email template variable `{{codigo_rastreio}}` contains the raw tracking code\n- Tracking code email template key: `tracking_code`\n\n**Planned Features:**\n- 3D interactive size calculator based on height/weight\n- Review system with photos and Q&A\n- Swipe gestures throughout mobile experience\n- Policy pages (returns, shipping, etc.)\n- Community features to foster connection","path":null,"size_bytes":7149,"size_tokens":null},"client/src/components/examples/ThemeToggle.tsx":{"content":"import ThemeToggle from '../ThemeToggle';\n\nexport default function ThemeToggleExample() {\n  return <ThemeToggle />;\n}","path":null,"size_bytes":117,"size_tokens":null},"client/src/components/Footer.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Instagram, MessageCircle } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport logoSvg from \"@/assets/logo.svg\";\n\ninterface CompanyInfo {\n  id: string;\n  companyName: string;\n  cnpj: string;\n  street: string;\n  number: string;\n  complement?: string;\n  neighborhood: string;\n  city: string;\n  state: string;\n  zipCode: string;\n  phone?: string;\n  email?: string;\n  copyrightYear: number;\n}\n\nexport default function Footer() {\n  const { data: companyData, isLoading } = useQuery<{ company: CompanyInfo | null }>({\n    queryKey: ['/api/company-info'],\n  });\n\n  const company = companyData?.company;\n  const currentYear = company?.copyrightYear || new Date().getFullYear();\n\n  return (\n    <footer className=\"border-t\">\n      <div className=\"container mx-auto px-4 py-16\">\n        {/* Main Footer Content */}\n        <div className=\"grid grid-cols-1 md:grid-cols-12 gap-12 mb-12\">\n          {/* Brand - Larger space */}\n          <div className=\"md:col-span-5 space-y-6\">\n            <div className=\"flex items-center gap-3 mb-4\">\n              <img src={logoSvg} alt=\"Oudla Logo\" className=\"h-8 w-8 object-contain dark:invert shrink-0\" loading=\"lazy\" decoding=\"async\" />\n              <h3 className=\"font-serif text-3xl text-foreground lowercase\">oudla</h3>\n            </div>\n            <div>\n              <p className=\"text-sm text-muted-foreground lowercase max-w-sm\">\n                uma marca crist√£ que conecta pessoas atrav√©s da f√© e do estilo.\n              </p>\n              {company && !isLoading && (company.street || company.neighborhood || company.city || company.email) && (\n                <div className=\"text-xs text-muted-foreground lowercase mt-4 space-y-1\">\n                  {(company.street || company.number) && (\n                    <p>{company.street}{company.street && company.number ? `, ${company.number}` : company.number ? company.number : ''}{company.complement ? `, ${company.complement}` : ''}</p>\n                  )}\n                  {(company.neighborhood || company.city || company.state) && (\n                    <p>{company.neighborhood}{company.neighborhood && company.city ? ', ' : ''}{company.city}{company.city && company.state ? ' - ' : ''}{company.state}{company.state && company.zipCode ? ' ' : ''}{company.zipCode}</p>\n                  )}\n                  {company.email && (\n                    <p className=\"mt-2\">\n                      <a href={`mailto:${company.email}`} className=\"hover:text-foreground transition-colors\" data-testid=\"link-footer-email\">\n                        {company.email}\n                      </a>\n                    </p>\n                  )}\n                </div>\n              )}\n            </div>\n            <div className=\"flex gap-3\">\n              <Button \n                variant=\"outline\" \n                size=\"icon\" \n                data-testid=\"link-instagram\"\n                onClick={() => window.open('https://instagram.com/oudl.a', '_blank')}\n              >\n                <Instagram className=\"h-4 w-4\" />\n              </Button>\n              <Button \n                variant=\"outline\" \n                size=\"icon\" \n                data-testid=\"link-whatsapp\"\n                onClick={() => window.open('https://wa.me/5544998362704', '_blank')}\n              >\n                <MessageCircle className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n          \n          {/* Links - Organized in columns */}\n          <div className=\"md:col-span-7\">\n            <div className=\"grid grid-cols-2 gap-8\">\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-foreground lowercase text-sm\">atendimento</h4>\n                <ul className=\"space-y-3 text-sm text-muted-foreground lowercase\">\n                  <li>\n                    <Link href=\"/rastreio\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-rastreio\">\n                      rastreamento de pedido\n                    </Link>\n                  </li>\n                  <li>\n                    <Link href=\"/trocas-devolucoes\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-trocas-devolucoes\">\n                      trocas e devolu√ß√µes\n                    </Link>\n                  </li>\n                  <li>\n                    <Link href=\"/faq\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-faq\">\n                      d√∫vidas frequentes\n                    </Link>\n                  </li>\n                </ul>\n              </div>\n              \n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-foreground lowercase text-sm\">institucional</h4>\n                <ul className=\"space-y-3 text-sm text-muted-foreground lowercase\">\n                  <li>\n                    <Link href=\"/sobre\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-sobre\">\n                      sobre n√≥s\n                    </Link>\n                  </li>\n                  <li>\n                    <Link href=\"/privacidade\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-privacidade\">\n                      pol√≠tica de privacidade\n                    </Link>\n                  </li>\n                  <li>\n                    <Link href=\"/termos\" className=\"hover:text-foreground transition-colors inline-block\" data-testid=\"link-termos\">\n                      termos de uso\n                    </Link>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Bottom Bar */}\n        <div className=\"border-t pt-8\">\n          <div className=\"flex flex-col md:flex-row items-center justify-between gap-4 text-xs text-muted-foreground lowercase\">\n            <p>¬© {currentYear} oudla. todos os direitos reservados.</p>\n            {company && <p>cnpj: {company.cnpj}</p>}\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}","path":null,"size_bytes":6161,"size_tokens":null},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","path":null,"size_bytes":4885,"size_tokens":null},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* LIGHT MODE */\n:root {\n  --button-outline: rgba(0,0,0, .10);\n  --badge-outline: rgba(0,0,0, .05);\n\n  /* Automatic computation of border around primary / danger buttons */\n  --opaque-button-border-intensity: -8; /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(0,0,0, .03);\n  --elevate-2: rgba(0,0,0, .08);\n\n  --background: 0 0% 98%;\n\n  --foreground: 0 0% 15%;\n\n  --border: 0 0% 90%;\n\n  --card: 0 0% 96%;\n\n  --card-foreground: 0 0% 15%;\n\n  --card-border: 0 0% 93%;\n\n  --sidebar: 0 0% 94%;\n\n  --sidebar-foreground: 0 0% 15%;\n\n  --sidebar-border: 0 0% 91%;\n\n  --sidebar-primary: 45 35% 32%;\n\n  --sidebar-primary-foreground: 45 20% 95%;\n\n  --sidebar-accent: 0 0% 90%;\n\n  --sidebar-accent-foreground: 0 0% 20%;\n\n  --sidebar-ring: 45 35% 75%;\n\n  --popover: 0 0% 92%;\n\n  --popover-foreground: 0 0% 15%;\n\n  --popover-border: 0 0% 89%;\n\n  --primary: 45 35% 32%;\n\n  --primary-foreground: 45 20% 95%;\n\n  --secondary: 0 0% 88%;\n\n  --secondary-foreground: 0 0% 20%;\n\n  --muted: 0 0% 89%;\n\n  --muted-foreground: 0 0% 45%;\n\n  --accent: 45 15% 85%;\n\n  --accent-foreground: 0 0% 25%;\n\n  --destructive: 0 65% 35%;\n\n  --destructive-foreground: 0 20% 95%;\n\n  --input: 0 0% 75%;\n  --ring: 45 35% 75%;\n  --chart-1: 220 25% 25%;\n  --chart-2: 45 35% 32%;\n  --chart-3: 35 20% 55%;\n  --chart-4: 0 0% 35%;\n  --chart-5: 190 15% 35%;\n\n  --font-sans: Open Sans, sans-serif;\n  --font-serif: Georgia, serif;\n  --font-luxury: 'Cinzel', serif;\n  --font-mono: Menlo, monospace;\n  --radius: .5rem; /* 8px */\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 0% 85% / 0.15);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 0% 85% / 0.15);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 0% 85% / 0.15), 0px 1px 2px -1px hsl(0 0% 85% / 0.15);\n  --shadow: 0px 2px 0px 0px hsl(0 0% 85% / 0.15), 0px 1px 2px -1px hsl(0 0% 85% / 0.15);\n  --shadow-md: 0px 2px 0px 0px hsl(0 0% 85% / 0.15), 0px 2px 4px -1px hsl(0 0% 85% / 0.15);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 0% 85% / 0.15), 0px 4px 6px -1px hsl(0 0% 85% / 0.15);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 0% 85% / 0.15), 0px 8px 10px -1px hsl(0 0% 85% / 0.15);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 0% 85% / 0.15);\n  --tracking-normal: 0.025em;\n  --spacing: 0.25rem;\n\n  /* Automatically computed borders - intensity can be controlled by the user by the --opaque-button-border-intensity setting */\n\n  /* Fallback for older browsers */\n  --sidebar-primary-border: hsl(var(--sidebar-primary));\n  --sidebar-primary-border: hsl(from hsl(var(--sidebar-primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --sidebar-accent-border: hsl(var(--sidebar-accent));\n  --sidebar-accent-border: hsl(from hsl(var(--sidebar-accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --primary-border: hsl(var(--primary));\n  --primary-border: hsl(from hsl(var(--primary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --secondary-border: hsl(var(--secondary));\n  --secondary-border: hsl(from hsl(var(--secondary)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --muted-border: hsl(var(--muted));\n  --muted-border: hsl(from hsl(var(--muted)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --accent-border: hsl(var(--accent));\n  --accent-border: hsl(from hsl(var(--accent)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n\n  /* Fallback for older browsers */\n  --destructive-border: hsl(var(--destructive));\n  --destructive-border: hsl(from hsl(var(--destructive)) h s calc(l + var(--opaque-button-border-intensity)) / alpha);\n}\n\n.dark {\n  --button-outline: rgba(255,255,255, .10);\n  --badge-outline: rgba(255,255,255, .05);\n\n  --opaque-button-border-intensity: 9;  /* In terms of percentages */\n\n  /* Backgrounds applied on top of other backgrounds when hovered/active */\n  --elevate-1: rgba(255,255,255, .04);\n  --elevate-2: rgba(255,255,255, .09);\n\n  --background: 220 8% 8%;\n\n  --foreground: 0 0% 90%;\n\n  --border: 220 6% 15%;\n\n  --card: 220 7% 11%;\n\n  --card-foreground: 0 0% 90%;\n\n  --card-border: 220 6% 16%;\n\n  --sidebar: 220 8% 13%;\n\n  --sidebar-foreground: 0 0% 90%;\n\n  --sidebar-border: 220 6% 18%;\n\n  --sidebar-primary: 45 35% 28%;\n\n  --sidebar-primary-foreground: 45 20% 95%;\n\n  --sidebar-accent: 220 8% 20%;\n\n  --sidebar-accent-foreground: 0 0% 85%;\n\n  --sidebar-ring: 45 35% 75%;\n\n  --popover: 220 8% 18%;\n\n  --popover-foreground: 0 0% 90%;\n\n  --popover-border: 220 6% 23%;\n\n  --primary: 45 35% 28%;\n\n  --primary-foreground: 45 20% 95%;\n\n  --secondary: 220 8% 25%;\n\n  --secondary-foreground: 0 0% 85%;\n\n  --muted: 220 8% 22%;\n\n  --muted-foreground: 0 0% 65%;\n\n  --accent: 220 12% 30%;\n\n  --accent-foreground: 0 0% 85%;\n\n  --destructive: 0 65% 35%;\n\n  --destructive-foreground: 0 20% 95%;\n\n  /* Used as the border around inputs. Dark mode: Should be a border that is light enough to have high contrast when rendered on a --card background. More contrast than standard --border */\n  --input: 220 6% 35%;\n  --ring: 45 35% 75%;\n  --chart-1: 220 25% 75%;\n  --chart-2: 45 35% 72%;\n  --chart-3: 35 20% 75%;\n  --chart-4: 0 0% 75%;\n  --chart-5: 190 15% 75%;\n\n  --shadow-2xs: 0px 2px 0px 0px hsl(220 25% 5% / 0.40);\n  --shadow-xs: 0px 2px 0px 0px hsl(220 25% 5% / 0.40);\n  --shadow-sm: 0px 2px 0px 0px hsl(220 25% 5% / 0.40), 0px 1px 2px -1px hsl(220 25% 5% / 0.40);\n  --shadow: 0px 2px 0px 0px hsl(220 25% 5% / 0.40), 0px 1px 2px -1px hsl(220 25% 5% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(220 25% 5% / 0.40), 0px 2px 4px -1px hsl(220 25% 5% / 0.40);\n  --shadow-lg: 0px 2px 0px 0px hsl(220 25% 5% / 0.40), 0px 4px 6px -1px hsl(220 25% 5% / 0.40);\n  --shadow-xl: 0px 2px 0px 0px hsl(220 25% 5% / 0.40), 0px 8px 10px -1px hsl(220 25% 5% / 0.40);\n  --shadow-2xl: 0px 2px 0px 0px hsl(220 25% 5% / 0.40);\n\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground overflow-x-hidden;\n  }\n}\n\n/**\n * Using the elevate system.\n * Automatic contrast adjustment.\n *\n * <element className=\"hover-elevate\" />\n * <element className=\"active-elevate-2\" />\n *\n * // Using the tailwind utility when a data attribute is \"on\"\n * <element className=\"toggle-elevate data-[state=on]:toggle-elevated\" />\n * // Or manually controlling the toggle state\n * <element className=\"toggle-elevate toggle-elevated\" />\n *\n * Elevation systems have to handle many states.\n * - not-hovered, vs. hovered vs. active  (three mutually exclusive states)\n * - toggled or not\n * - focused or not (this is not handled with these utilities)\n *\n * Even without handling focused or not, this is six possible combinations that\n * need to be distinguished from eachother visually.\n */\n@layer utilities {\n\n  /* Hide ugly search cancel button in Chrome until we can style it properly */\n  input[type=\"search\"]::-webkit-search-cancel-button {\n    @apply hidden;\n  }\n\n  /* Placeholder styling for contentEditable div */\n  [contenteditable][data-placeholder]:empty::before {\n    content: attr(data-placeholder);\n    color: hsl(var(--muted-foreground));\n    pointer-events: none;\n  }\n\n  /* .no-default-hover-elevate/no-default-active-elevate is an escape hatch so consumers of\n   * buttons/badges can remove the automatic brightness adjustment on interactions\n   * and program their own. */\n  .no-default-hover-elevate {}\n\n  .no-default-active-elevate {}\n\n\n  /**\n   * Toggleable backgrounds go behind the content. Hoverable/active goes on top.\n   * This way they can stack/compound. Both will overlap the parent's borders!\n   * So borders will be automatically adjusted both on toggle, and hover/active,\n   * and they will be compounded.\n   */\n  .toggle-elevate::before,\n  .toggle-elevate-2::before {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: -1;\n    /* sits behind content but above backdrop */\n  }\n\n  .toggle-elevate.toggle-elevated::before {\n    background-color: var(--elevate-2);\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.toggle-elevate::before {\n    inset: -1px;\n  }\n\n  /* Does not work on elements with overflow:hidden! */\n  .hover-elevate:not(.no-default-hover-elevate),\n  .active-elevate:not(.no-default-active-elevate),\n  .hover-elevate-2:not(.no-default-hover-elevate),\n  .active-elevate-2:not(.no-default-active-elevate) {\n    position: relative;\n    z-index: 0;\n  }\n\n  .hover-elevate:not(.no-default-hover-elevate)::after,\n  .active-elevate:not(.no-default-active-elevate)::after,\n  .hover-elevate-2:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:not(.no-default-active-elevate)::after {\n    content: \"\";\n    pointer-events: none;\n    position: absolute;\n    inset: 0px;\n    /*border-radius: inherit;   match rounded corners */\n    border-radius: inherit;\n    z-index: 999;\n    /* sits in front of content */\n  }\n\n  .hover-elevate:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-1);\n  }\n\n  .hover-elevate-2:hover:not(.no-default-hover-elevate)::after,\n  .active-elevate-2:active:not(.no-default-active-elevate)::after {\n    background-color: var(--elevate-2);\n  }\n\n  /* Custom scrollbar */\n  .custom-scrollbar::-webkit-scrollbar {\n    width: 4px;\n  }\n  .custom-scrollbar::-webkit-scrollbar-track {\n    background: transparent;\n  }\n  .custom-scrollbar::-webkit-scrollbar-thumb {\n    background: hsl(var(--muted-foreground) / 0.2);\n    border-radius: 10px;\n  }\n  .custom-scrollbar::-webkit-scrollbar-thumb:hover {\n    background: hsl(var(--muted-foreground) / 0.4);\n  }\n  .custom-scrollbar {\n    scrollbar-width: thin;\n    scrollbar-color: hsl(var(--muted-foreground) / 0.2) transparent;\n  }\n\n  /* If there's a 1px border, adjust the inset so that it covers that parent's border */\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate-2:not(.no-hover-interaction-elevate)::after,\n  .border.active-elevate-2:not(.no-active-interaction-elevate)::after,\n  .border.hover-elevate:not(.no-hover-interaction-elevate)::after {\n    inset: -1px;\n  }\n\n  /* 3D Perspective for carousel */\n  .perspective-1000 {\n    perspective: 1000px;\n  }\n\n  /* Performance optimizations - GPU acceleration */\n  .gpu-accelerate {\n    transform: translateZ(0);\n    backface-visibility: hidden;\n    perspective: 1000px;\n  }\n\n  /* Smooth scrolling */\n  html {\n    scroll-behavior: smooth;\n  }\n\n  /* Optimize animations - will-change properties */\n  @media (prefers-reduced-motion: no-preference) {\n    .animate-smooth {\n      will-change: transform, opacity;\n    }\n  }\n\n  .no-scrollbar {\n    -ms-overflow-style: none;\n    scrollbar-width: none;\n  }\n  .no-scrollbar::-webkit-scrollbar {\n    display: none;\n  }\n\n  /* Reduce repaints on hover - will-change for transform optimization */\n  .hover-optimize {\n    will-change: transform;\n  }\n\n  /* GPU acceleration for animated elements */\n  .gpu-animate {\n    transform: translateZ(0);\n    backface-visibility: hidden;\n    -webkit-font-smoothing: antialiased;\n    -moz-osx-font-smoothing: grayscale;\n  }\n\n  /* Optimize transform-based animations */\n  .animate-gpu {\n    will-change: transform;\n    backface-visibility: hidden;\n  }\n\n  .scrollbar-hide::-webkit-scrollbar {\n    display: none;\n  }\n}","path":null,"size_bytes":11643,"size_tokens":null},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","path":null,"size_bytes":2765,"size_tokens":null},"client/src/components/examples/BannerCarousel.tsx":{"content":"import BannerCarousel from '../BannerCarousel';\n\nexport default function BannerCarouselExample() {\n  return <BannerCarousel />;\n}","path":null,"size_bytes":129,"size_tokens":null},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","path":null,"size_bytes":4281,"size_tokens":null},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","path":null,"size_bytes":689,"size_tokens":null},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","path":null,"size_bytes":1642,"size_tokens":null},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","path":null,"size_bytes":1723,"size_tokens":null},"design_guidelines.md":{"content":"# Design Guidelines - oudla: Luxury Christian Fashion Brand\n\n## Design Approach\n**Reference-Based Approach**: Drawing inspiration from luxury fashion brands (Ralph Lauren, Zara) combined with modern minimalist Christian aesthetics, tailored for a young, cool audience. Creating a community-focused brand identity that transcends traditional e-commerce.\n\n## Core Design Principles\n- **Minimalist Luxury**: Clean, sophisticated layouts with premium materials and subtle elegance\n- **Young & Cool**: Modern, fresh aesthetic that appeals to a younger demographic without losing sophistication  \n- **Christian Identity**: Subtle spiritual elements integrated naturally into the design\n- **Community Focus**: Design emphasizes connection, belonging, and shared values over pure commerce\n- **Technological Excellence**: Cutting-edge UX/UI that showcases innovation\n\n## Color Palette\n\n**Primary Colors:**\n- Deep Charcoal: 0 0% 15% (primary text, sophisticated base)\n- Pure White: 0 0% 98% (backgrounds, clean contrast)\n- Warm Cream: 35 20% 95% (subtle background alternative)\n\n**Brand Accent:**\n- Subtle Gold: 45 35% 75% (premium touches, call-to-actions - used very sparingly)\n\n**Supporting Colors:**\n- Soft Gray: 0 0% 85% (borders, secondary elements)\n- Deep Navy: 220 25% 25% (dark mode, premium feel)\n\n**Gradients:**\n- Hero sections: Subtle cream to white vertical gradients\n- Premium product cards: Charcoal to deep navy for luxury depth\n- Banner overlays: Semi-transparent charcoal gradients for text readability\n\n## Typography\n**Primary Font**: Inter (Google Fonts) - modern, clean, highly legible\n**Accent Font**: Playfair Display (Google Fonts) - elegant serif for brand moments\n**All text in lowercase** as specified by brand guidelines\n**Font Scale**: 12px, 14px, 16px, 20px, 24px, 32px, 48px for hierarchy\n\n## Layout System\n**Tailwind Spacing Units**: Consistent use of 2, 4, 6, 8, 12, 16 units\n- Micro spacing: p-2, m-2 (8px)\n- Standard spacing: p-4, m-4 (16px) \n- Section spacing: p-8, m-8 (32px)\n- Large spacing: p-16, m-16 (64px)\n\n## Component Library\n\n### Navigation\n- Minimal header with centered \"oudla\" wordmark\n- Floating navigation with login, favorites (heart icon), shopping bag\n- Sticky scroll behavior with subtle shadow\n\n### Hero Section  \n- Full viewport height with centered \"oudla\" logo\n- Daily verse integration below logo with elegant typography\n- Subtle parallax background with spiritual/nature imagery\n\n### Banner Carousel\n- Full-width swipeable banners with navigation arrows\n- Overlay text with blurred backgrounds for readability\n- Smooth transitions and touch-friendly interactions\n\n### Product Components\n- Premium product cards with multiple image hover states\n- 3D interactive sizing visualizations\n- Real-time freight calculation displays\n- Color/size selectors with luxury aesthetic\n- Free exchange policy prominently featured\n\n### Interactive Elements\n- Sophisticated hover effects and micro-animations\n- Smooth page transitions and lazy loading\n- Premium loading states and empty states\n- Elegant form styling with validation\n\n### Call-to-Action Elements\n- Outline buttons with blurred backgrounds when over images\n- Consistent hover states handled by component defaults\n- Strategic use of gold accent for primary actions\n\n## Images\n**Hero Background**: Subtle, inspirational imagery (sunrise, nature, community) with soft overlays\n**Product Photography**: Multiple high-resolution lifestyle and detail shots per t-shirt\n**Banner Images**: Lifestyle photography featuring young, diverse Christians in elegant settings\n**Brand Imagery**: Minimalist, artistic photography that conveys luxury and spirituality\n\n## Accessibility & Experience\n- Dark mode support across all components\n- Portuguese Brazilian language throughout\n- Brazilian Real (R$) currency formatting\n- Mobile-first responsive design\n- High contrast ratios maintaining luxury aesthetic\n- Smooth animations that enhance rather than distract\n\nThis design creates an elevated, technological experience that positions \"oudla\" as a premium Christian lifestyle brand for young, sophisticated consumers who value both faith and fashion.","path":null,"size_bytes":4131,"size_tokens":null},"client/src/data/mockProducts.ts":{"content":"// Produto 1: Camiseta Cruz - 4 cores\nimport product1White from '@assets/generated_images/white_cross_tshirt_product_20abe436.png';\nimport product1WhiteAlt from '@assets/generated_images/white_cross_tshirt_lifestyle_0bd10795.png';\nimport product1Black from '@assets/generated_images/black_cross_tshirt_product_45f7b071.png';\nimport product1BlackAlt from '@assets/generated_images/black_cross_tshirt_lifestyle_45cae89e.png';\nimport product1Navy from '@assets/generated_images/navy_cross_tshirt_product_8013ae3c.png';\nimport product1NavyAlt from '@assets/generated_images/navy_cross_tshirt_lifestyle_f13bd58d.png';\nimport product1Gray from '@assets/generated_images/gray_cross_tshirt_product_08896eb3.png';\nimport product1GrayAlt from '@assets/generated_images/gray_cross_tshirt_lifestyle_78bee5b5.png';\n\n// Produto 2: Camiseta F√© - 4 cores\nimport product2White from '@assets/generated_images/white_faith_tshirt_product_f2f1c616.png';\nimport product2WhiteAlt from '@assets/generated_images/white_faith_tshirt_lifestyle_f729b011.png';\nimport product2Black from '@assets/generated_images/black_faith_tshirt_product_8decd0c5.png';\nimport product2BlackAlt from '@assets/generated_images/black_faith_tshirt_lifestyle_81a679e9.png';\nimport product2Navy from '@assets/generated_images/navy_faith_tshirt_product_e808e3d2.png';\nimport product2NavyAlt from '@assets/generated_images/navy_faith_tshirt_lifestyle_5dad04e7.png';\nimport product2Gray from '@assets/generated_images/gray_faith_tshirt_product_98c9212a.png';\nimport product2GrayAlt from '@assets/generated_images/gray_faith_tshirt_lifestyle_db820185.png';\n\n// Produto 3: Camiseta Minimalista - 4 cores\nimport product3White from '@assets/generated_images/white_minimalist_tshirt_product_a5698a09.png';\nimport product3WhiteAlt from '@assets/generated_images/white_minimalist_tshirt_lifestyle_5314c2ad.png';\nimport product3Black from '@assets/generated_images/black_minimalist_tshirt_product_df23d670.png';\nimport product3BlackAlt from '@assets/generated_images/black_minimalist_tshirt_lifestyle_d4d7dd73.png';\nimport product3Navy from '@assets/generated_images/navy_minimalist_tshirt_product_9d8c701c.png';\nimport product3NavyAlt from '@assets/generated_images/navy_minimalist_tshirt_lifestyle_8a1fe5f1.png';\nimport product3Gray from '@assets/generated_images/gray_minimalist_tshirt_product_66f381b9.png';\nimport product3GrayAlt from '@assets/generated_images/gray_minimalist_tshirt_lifestyle_6d4865bd.png';\n\n// Produto 4: Camiseta Comunidade - 4 cores\nimport product4White from '@assets/generated_images/white_community_tshirt_product_fd392c04.png';\nimport product4WhiteAlt from '@assets/generated_images/white_community_tshirt_lifestyle_314d92d4.png';\nimport product4Black from '@assets/generated_images/black_community_tshirt_product_6a7884e8.png';\nimport product4BlackAlt from '@assets/generated_images/black_community_tshirt_lifestyle_ced62a8a.png';\nimport product4Navy from '@assets/generated_images/navy_community_tshirt_product_dd993a4d.png';\nimport product4NavyAlt from '@assets/generated_images/navy_community_tshirt_lifestyle_fda02c64.png';\nimport product4Gray from '@assets/generated_images/gray_community_tshirt_product_caed87b4.png';\nimport product4GrayAlt from '@assets/generated_images/gray_community_tshirt_lifestyle_0c2a7140.png';\n\n// Produto 5: Camiseta Esperan√ßa - 4 cores\nimport product5White from '@assets/generated_images/white_hope_tshirt_product_43244f93.png';\nimport product5WhiteAlt from '@assets/generated_images/white_hope_tshirt_lifestyle_42d85f64.png';\nimport product5Black from '@assets/generated_images/black_hope_tshirt_product_00747f94.png';\nimport product5BlackAlt from '@assets/generated_images/black_hope_tshirt_lifestyle_3a5bf592.png';\nimport product5Navy from '@assets/generated_images/navy_hope_tshirt_product_e891d352.png';\nimport product5NavyAlt from '@assets/generated_images/navy_hope_tshirt_lifestyle_a026bed0.png';\nimport product5Gray from '@assets/generated_images/gray_hope_tshirt_product_c13ed3f2.png';\nimport product5GrayAlt from '@assets/generated_images/gray_hope_tshirt_lifestyle_3c4ed1a4.png';\n\n// Produto 6: Camiseta Amor - 4 cores\nimport product6White from '@assets/generated_images/white_love_tshirt_product_1a2d5fe8.png';\nimport product6WhiteAlt from '@assets/generated_images/white_love_tshirt_lifestyle_56364376.png';\nimport product6Black from '@assets/generated_images/black_love_tshirt_product_95693831.png';\nimport product6BlackAlt from '@assets/generated_images/black_love_tshirt_lifestyle_ce5e8f37.png';\nimport product6Navy from '@assets/generated_images/navy_love_tshirt_product_a753b9dd.png';\nimport product6NavyAlt from '@assets/generated_images/navy_love_tshirt_lifestyle_06576cb5.png';\nimport product6Gray from '@assets/generated_images/gray_love_tshirt_product_8eb3f1b8.png';\nimport product6GrayAlt from '@assets/generated_images/gray_love_tshirt_lifestyle_57fbdeb0.png';\n\nexport interface Product {\n  id: string;\n  name: string;\n  price: number;\n  originalPrice?: number;\n  images: string[];\n  colors: string[];\n  sizes: string[];\n  isNew: boolean;\n  category?: string;\n  colorImages?: {\n    [colorHex: string]: string[];\n  };\n}\n\nexport const mockProducts: Product[] = [\n  {\n    id: \"1\",\n    name: \"camiseta essencial cruz\",\n    price: 129.90,\n    originalPrice: 179.90,\n    images: [product1White, product1WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"P\", \"M\", \"G\", \"GG\"],\n    isNew: true,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product1White, product1WhiteAlt],\n      \"#000000\": [product1Black, product1BlackAlt],\n      \"#1a2742\": [product1Navy, product1NavyAlt],\n      \"#9ca3af\": [product1Gray, product1GrayAlt]\n    }\n  },\n  {\n    id: \"2\", \n    name: \"camiseta premium f√©\",\n    price: 149.90,\n    images: [product2White, product2WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"P\", \"M\", \"G\", \"GG\", \"XG\"],\n    isNew: false,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product2White, product2WhiteAlt],\n      \"#000000\": [product2Black, product2BlackAlt],\n      \"#1a2742\": [product2Navy, product2NavyAlt],\n      \"#9ca3af\": [product2Gray, product2GrayAlt]\n    }\n  },\n  {\n    id: \"3\",\n    name: \"camiseta minimalista\",\n    price: 119.90,\n    originalPrice: 159.90,\n    images: [product3White, product3WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"P\", \"M\", \"G\"],\n    isNew: true,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product3White, product3WhiteAlt],\n      \"#000000\": [product3Black, product3BlackAlt],\n      \"#1a2742\": [product3Navy, product3NavyAlt],\n      \"#9ca3af\": [product3Gray, product3GrayAlt]\n    }\n  },\n  {\n    id: \"4\",\n    name: \"camiseta comunidade\",\n    price: 139.90,\n    images: [product4White, product4WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"M\", \"G\", \"GG\", \"XG\"],\n    isNew: false,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product4White, product4WhiteAlt],\n      \"#000000\": [product4Black, product4BlackAlt],\n      \"#1a2742\": [product4Navy, product4NavyAlt],\n      \"#9ca3af\": [product4Gray, product4GrayAlt]\n    }\n  },\n  {\n    id: \"5\",\n    name: \"camiseta esperan√ßa\",\n    price: 134.90,\n    originalPrice: 169.90,\n    images: [product5White, product5WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"P\", \"M\", \"G\", \"GG\"],\n    isNew: true,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product5White, product5WhiteAlt],\n      \"#000000\": [product5Black, product5BlackAlt],\n      \"#1a2742\": [product5Navy, product5NavyAlt],\n      \"#9ca3af\": [product5Gray, product5GrayAlt]\n    }\n  },\n  {\n    id: \"6\",\n    name: \"camiseta amor\",\n    price: 144.90,\n    images: [product6White, product6WhiteAlt],\n    colors: [\"#ffffff\", \"#000000\", \"#1a2742\", \"#9ca3af\"],\n    sizes: [\"P\", \"M\", \"G\", \"GG\", \"XG\"],\n    isNew: false,\n    category: \"camisetas\",\n    colorImages: {\n      \"#ffffff\": [product6White, product6WhiteAlt],\n      \"#000000\": [product6Black, product6BlackAlt],\n      \"#1a2742\": [product6Navy, product6NavyAlt],\n      \"#9ca3af\": [product6Gray, product6GrayAlt]\n    }\n  }\n];\n","path":null,"size_bytes":8195,"size_tokens":null},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","path":null,"size_bytes":1977,"size_tokens":null},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n          await import(\"@replit/vite-plugin-dev-banner\").then((m) =>\n            m.devBanner(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","path":null,"size_bytes":1080,"size_tokens":null},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","path":null,"size_bytes":1209,"size_tokens":null},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","path":null,"size_bytes":1056,"size_tokens":null},"client/src/components/ProductGrid.tsx":{"content":"import ProductCard from \"./ProductCard\";\nimport { Link } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport { ArrowRight } from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport ctaBackgroundImage from \"@assets/generated_images/luxury_fabric_texture_background_e669b3a7.png\";\n\nfunction ProductSkeleton() {\n  return (\n    <Card className=\"overflow-hidden\">\n      <div className=\"aspect-square bg-muted animate-pulse\" />\n      <CardContent className=\"p-4 space-y-2\">\n        <div className=\"h-4 bg-muted animate-pulse rounded\" />\n        <div className=\"h-6 bg-muted animate-pulse rounded w-24\" />\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function ProductGrid() {\n  const { isFavorito, toggleFavorito, triggerFavoritoToast } = useFavoritos();\n  \n  const { data: apiData, isLoading } = useQuery<{products: any[]}>({\n    queryKey: ['/api/products'],\n  });\n\n  const { data: ctaBannerData } = useQuery<{config: any}>({\n    queryKey: ['/api/cta-banner'],\n  });\n  \n  const products = (apiData?.products?.filter((product: any) => \n    (!product.productType || product.productType === 'tshirt') && \n    product.status === 'published'\n  ) || []).slice(0, 6);\n\n  // Get CTA banner config or null\n  const ctaConfig = ctaBannerData?.config;\n\n  return (\n    <section className=\"py-16 px-4\">\n      <div className=\"container mx-auto\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {isLoading ? (\n            <>\n              {[...Array(4)].map((_, i) => (\n                <ProductSkeleton key={i} />\n              ))}\n            </>\n          ) : (\n            products.map((product: any) => (\n              <ProductCard\n                key={product.id}\n                {...product}\n                isFavorite={isFavorito(product.id)}\n                showInstallments={false}\n                onFavoriteToggle={(id, productInfo) => {\n                  if (!isFavorito(id)) {\n                    triggerFavoritoToast({ id, ...productInfo });\n                  }\n                  toggleFavorito(id);\n                }}\n                disableLazyLoading={true}\n              />\n            ))\n          )}\n        </div>\n        \n        {!isLoading && ctaConfig && (\n          <div className=\"mt-20\">\n            <Link href=\"/produtos\">\n              <div \n                className=\"relative overflow-hidden rounded-md group cursor-pointer transition-transform hover:scale-[1.02] active:scale-[0.99]\"\n                data-testid=\"button-view-all\"\n              >\n                <div \n                  className=\"absolute inset-0 bg-cover bg-center\"\n                  style={{ backgroundImage: `url(${ctaConfig.backgroundImageUrl})` }}\n                />\n                <div className=\"absolute inset-0 bg-gradient-to-r from-black/70 via-black/60 to-black/70\" />\n                \n                <div className=\"relative py-24 px-8 md:py-32 md:px-16 text-center space-y-6\">\n                  {ctaConfig.tagLabel && (\n                    <div className=\"text-xs uppercase tracking-widest text-white/80 mb-4\">\n                      <span>{ctaConfig.tagLabel}</span>\n                    </div>\n                  )}\n                  \n                  <h2 className=\"text-3xl md:text-5xl lg:text-6xl font-light text-white lowercase tracking-tight\">\n                    {ctaConfig.title}\n                  </h2>\n                  \n                  {ctaConfig.description && (\n                    <p className=\"text-white/70 lowercase text-sm md:text-base max-w-2xl mx-auto\">\n                      {ctaConfig.description}\n                    </p>\n                  )}\n                  \n                  <div className=\"pt-4\">\n                    <Button \n                      size=\"lg\"\n                      style={{ \n                        backgroundColor: ctaConfig.buttonBgColor,\n                        borderColor: ctaConfig.buttonBgColor,\n                        color: ctaConfig.buttonBgColor === '#ffffff' || ctaConfig.buttonBgColor === '#fff' ? '#000000' : '#ffffff'\n                      }}\n                      className=\"hover:opacity-90 lowercase font-medium px-8 border-2 group-hover:bg-transparent group-hover:text-white transition-all\"\n                      asChild\n                    >\n                      <span className=\"inline-flex items-center\">\n                        {ctaConfig.buttonText}\n                        <ArrowRight className=\"ml-2 h-4 w-4 transition-transform group-hover:translate-x-2\" />\n                      </span>\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </Link>\n          </div>\n        )}\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":4846,"size_tokens":null},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":2263,"size_tokens":null},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","path":null,"size_bytes":7609,"size_tokens":null},"client/src/components/examples/ShippingCalculator.tsx":{"content":"import ShippingCalculator from '../ShippingCalculator';\n\nexport default function ShippingCalculatorExample() {\n  return (\n    <div className=\"p-8 max-w-md\">\n      <ShippingCalculator\n        onShippingSelect={(option) => console.log('op√ß√£o selecionada:', option)}\n      />\n    </div>\n  );\n}","path":null,"size_bytes":292,"size_tokens":null},"server/db.ts":{"content":"import * as schema from \"@shared/schema\";\n\nconst databaseUrl = process.env.SUPABASE_DATABASE_URL;\n\nif (!databaseUrl) {\n  throw new Error(\n    \"SUPABASE_DATABASE_URL must be set.\",\n  );\n}\n\nlet db: any;\nlet pool: any;\n\nconst pgModule = await import('pg');\nconst { drizzle } = await import('drizzle-orm/node-postgres');\nconst Pool = pgModule.default?.Pool || pgModule.Pool;\n\npool = new Pool({\n  connectionString: databaseUrl,\n  max: 10,\n  idleTimeoutMillis: 30000,\n  connectionTimeoutMillis: 10000,\n  ssl: process.env.DB_SSL === 'false' ? false : { rejectUnauthorized: false },\n});\n\ndb = drizzle(pool, { schema });\n\npool.on('error', (err: Error) => {\n  console.error('‚ùå Unexpected pool error:', err);\n});\n\npool.query('SELECT 1')\n  .then(() => console.log('‚úÖ Database connection successful (supabase)'))\n  .catch((error: Error) => {\n    console.error('‚ùå Database connection failed:', error.message);\n    console.error('Please check your SUPABASE_DATABASE_URL configuration');\n  });\n\nexport { db, pool };\n","path":null,"size_bytes":1006,"size_tokens":null},"client/src/pages/Home.tsx":{"content":"import BannerCarousel from \"@/components/BannerCarousel\";\nimport ProductGrid from \"@/components/ProductGrid\";\nimport FeatureBanner from \"@/components/FeatureBanner\";\nimport AccessoriesCarousel from \"@/components/AccessoriesCarousel\";\nimport LifestyleBanner from \"@/components/LifestyleBanner\";\nimport DailyVerse from \"@/components/DailyVerse\";\nimport NewsletterSection from \"@/components/NewsletterSection\";\nimport Footer from \"@/components/Footer\";\nimport { useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Card, CardContent } from \"@/components/ui/card\";\n\nfunction HomeSkeleton() {\n  return (\n    <div className=\"min-h-screen bg-background space-y-8\">\n      <div className=\"h-96 bg-muted animate-pulse\" />\n      <div className=\"px-4 container mx-auto\">\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <Card key={i}>\n              <div className=\"aspect-square bg-muted animate-pulse\" />\n              <CardContent className=\"p-4 space-y-2\">\n                <div className=\"h-4 bg-muted animate-pulse rounded\" />\n                <div className=\"h-6 bg-muted animate-pulse rounded w-24\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default function Home() {\n  useEffect(() => {\n    queryClient.prefetchQuery({ queryKey: ['/api/products'] });\n    queryClient.prefetchQuery({ queryKey: ['/api/banners'] });\n    queryClient.prefetchQuery({ queryKey: ['/api/cta-banner'] });\n    queryClient.prefetchQuery({ queryKey: ['/api/content-cards'] });\n  }, []);\n\n  const { isLoading: productsLoading } = useQuery({\n    queryKey: ['/api/products'],\n  });\n\n  const { isLoading: bannersLoading } = useQuery({\n    queryKey: ['/api/banners'],\n  });\n\n  const isLoadingContent = productsLoading || bannersLoading;\n\n  if (isLoadingContent) {\n    return <HomeSkeleton />;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <main>\n        <BannerCarousel />\n        <ProductGrid />\n        <FeatureBanner />\n        <AccessoriesCarousel />\n        <LifestyleBanner />\n      </main>\n      <section className=\"py-20 md:py-32 px-4 bg-card/30\">\n        <DailyVerse />\n      </section>\n      <NewsletterSection />\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":2386,"size_tokens":null},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 5000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","path":null,"size_bytes":3892,"size_tokens":null},"client/src/components/examples/Footer.tsx":{"content":"import Footer from '../Footer';\n\nexport default function FooterExample() {\n  return <Footer />;\n}","path":null,"size_bytes":97,"size_tokens":null},"client/src/pages/TrocasDevolucoes.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport Footer from \"@/components/Footer\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function TrocasDevolucoes() {\n  const { data: pageData, isLoading } = useQuery<{\n    id: string;\n    slug: string;\n    title: string;\n    content: string;\n  }>({\n    queryKey: ['/api/footer-page', 'returns'],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-16\">\n        <div className=\"max-w-4xl mx-auto space-y-12\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-20\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : pageData ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <h1 className=\"text-4xl md:text-5xl font-light lowercase text-foreground tracking-tight\" data-testid=\"text-page-title\">\n                  {pageData.title}\n                </h1>\n              </div>\n              <Card className=\"p-6 sm:p-8\">\n                <div\n                  className=\"prose dark:prose-invert max-w-none lowercase [&_h2]:text-2xl [&_h2]:font-light [&_h2]:mt-8 [&_h2]:mb-4 [&_h3]:font-medium [&_h3]:mt-6 [&_h3]:mb-2 [&_p]:text-muted-foreground [&_li]:text-muted-foreground [&_ul]:space-y-1\"\n                  dangerouslySetInnerHTML={{ __html: pageData.content }}\n                  data-testid=\"content-page\"\n                />\n              </Card>\n            </>\n          ) : (\n            <div className=\"text-center py-16\">\n              <p className=\"text-muted-foreground lowercase\">p√°gina n√£o encontrada</p>\n            </div>\n          )}\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":1819,"size_tokens":null},"client/src/components/Hero.tsx":{"content":"export default function Hero() {\n  return (\n    <section className=\"relative min-h-screen flex flex-col items-center justify-center\">\n      <div className=\"absolute top-4 left-1/2 -translate-x-1/2 z-10\">\n        <h1 \n          className=\"font-luxury text-5xl md:text-6xl font-light text-foreground tracking-wide uppercase\"\n          data-testid=\"text-logo-hero\"\n        >\n          oudla\n        </h1>\n      </div>\n      \n      <div className=\"flex-1 flex items-center justify-center w-full px-4\">\n        {/* Espa√ßo vazio */}\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":563,"size_tokens":null},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const sessionId = localStorage.getItem('admin_session');\n  const headers: Record<string, string> = data ? { \"Content-Type\": \"application/json\" } : {};\n  \n  if (sessionId) {\n    headers['x-session-id'] = sessionId;\n  }\n  \n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\n\nfunction buildUrl(queryKey: readonly unknown[]): string {\n  const [baseUrl, ...rest] = queryKey;\n  let url = String(baseUrl);\n  \n  // Se houver par√¢metros adicionais\n  if (rest.length > 0) {\n    const lastParam = rest[rest.length - 1];\n    \n    // Se o √∫ltimo par√¢metro √© um objeto, converter para query string\n    if (lastParam && typeof lastParam === 'object' && !Array.isArray(lastParam)) {\n      const params = new URLSearchParams();\n      Object.entries(lastParam as Record<string, string>).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== '') {\n          params.append(key, String(value));\n        }\n      });\n      \n      const queryString = params.toString();\n      if (queryString) {\n        url += `?${queryString}`;\n      }\n    } else {\n      // Se n√£o for objeto, juntar com / (para IDs, etc)\n      url = queryKey.filter(k => k !== null && k !== undefined).join(\"/\") as string;\n    }\n  }\n  \n  return url;\n}\n\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const sessionId = localStorage.getItem('admin_session');\n    const headers: Record<string, string> = {};\n    \n    if (sessionId) {\n      headers['x-session-id'] = sessionId;\n    }\n    \n    const url = buildUrl(queryKey);\n    \n    const res = await fetch(url, {\n      credentials: \"include\",\n      headers,\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: true,\n      staleTime: 5 * 60 * 1000, // 5 minutos - dados ficam \"fresh\" por 5min\n      gcTime: 10 * 60 * 1000, // 10 minutos - cache dura 10min\n      retry: 1,\n      retryDelay: attemptIndex => Math.min(1000 * 2 ** attemptIndex, 30000),\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","path":null,"size_bytes":2926,"size_tokens":null},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","path":null,"size_bytes":10481,"size_tokens":null},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","path":null,"size_bytes":4120,"size_tokens":null},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","path":null,"size_bytes":565,"size_tokens":null},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(`\n      after:content-[''] after:block after:absolute after:inset-0 after:rounded-full after:pointer-events-none after:border after:border-black/10 dark:after:border-white/10\n      relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","path":null,"size_bytes":1592,"size_tokens":null},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\nimport tailwindcssAnimate from \"tailwindcss-animate\";\nimport tailwindcssTypography from \"@tailwindcss/typography\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \".5625rem\", /* 9px */\n        md: \".375rem\", /* 6px */\n        sm: \".1875rem\", /* 3px */\n      },\n      colors: {\n        // Flat / base colors (regular buttons)\n        background: \"hsl(var(--background) / <alpha-value>)\",\n        foreground: \"hsl(var(--foreground) / <alpha-value>)\",\n        border: \"hsl(var(--border) / <alpha-value>)\",\n        input: \"hsl(var(--input) / <alpha-value>)\",\n        card: {\n          DEFAULT: \"hsl(var(--card) / <alpha-value>)\",\n          foreground: \"hsl(var(--card-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--card-border) / <alpha-value>)\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover) / <alpha-value>)\",\n          foreground: \"hsl(var(--popover-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--popover-border) / <alpha-value>)\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--primary-foreground) / <alpha-value>)\",\n          border: \"var(--primary-border)\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary) / <alpha-value>)\",\n          foreground: \"hsl(var(--secondary-foreground) / <alpha-value>)\",\n          border: \"var(--secondary-border)\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted) / <alpha-value>)\",\n          foreground: \"hsl(var(--muted-foreground) / <alpha-value>)\",\n          border: \"var(--muted-border)\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--accent-foreground) / <alpha-value>)\",\n          border: \"var(--accent-border)\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive) / <alpha-value>)\",\n          foreground: \"hsl(var(--destructive-foreground) / <alpha-value>)\",\n          border: \"var(--destructive-border)\",\n        },\n        ring: \"hsl(var(--ring) / <alpha-value>)\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1) / <alpha-value>)\",\n          \"2\": \"hsl(var(--chart-2) / <alpha-value>)\",\n          \"3\": \"hsl(var(--chart-3) / <alpha-value>)\",\n          \"4\": \"hsl(var(--chart-4) / <alpha-value>)\",\n          \"5\": \"hsl(var(--chart-5) / <alpha-value>)\",\n        },\n        sidebar: {\n          ring: \"hsl(var(--sidebar-ring) / <alpha-value>)\",\n          DEFAULT: \"hsl(var(--sidebar) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-foreground) / <alpha-value>)\",\n          border: \"hsl(var(--sidebar-border) / <alpha-value>)\",\n        },\n        \"sidebar-primary\": {\n          DEFAULT: \"hsl(var(--sidebar-primary) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-primary-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-primary-border)\",\n        },\n        \"sidebar-accent\": {\n          DEFAULT: \"hsl(var(--sidebar-accent) / <alpha-value>)\",\n          foreground: \"hsl(var(--sidebar-accent-foreground) / <alpha-value>)\",\n          border: \"var(--sidebar-accent-border)\"\n        },\n        status: {\n          online: \"rgb(34 197 94)\",\n          away: \"rgb(245 158 11)\",\n          busy: \"rgb(239 68 68)\",\n          offline: \"rgb(156 163 175)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"Inter\", \"system-ui\", \"sans-serif\"],\n        serif: [\"Playfair Display\", \"Georgia\", \"serif\"],\n        luxury: [\"Cinzel\", \"serif\"],\n        mono: [\"var(--font-mono)\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: { height: \"0\" },\n          to: { height: \"var(--radix-accordion-content-height)\" },\n        },\n        \"accordion-up\": {\n          from: { height: \"var(--radix-accordion-content-height)\" },\n          to: { height: \"0\" },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [tailwindcssAnimate, tailwindcssTypography],\n} satisfies Config;\n","path":null,"size_bytes":4212,"size_tokens":null},"client/src/contexts/MochilaContext.tsx":{"content":"import { createContext, useContext, useState, useEffect, useCallback, useMemo, ReactNode } from \"react\";\nimport Cookies from \"js-cookie\";\n\nexport interface MochilaItem {\n  id: string;\n  productId: string;\n  name: string;\n  price: number;\n  color?: {\n    name: string;\n    hex: string;\n  };\n  size?: string;\n  fabric?: {\n    name: string;\n    price: number;\n  };\n  image: string;\n  quantity: number;\n  printPosition?: \"frente\" | \"costas\";\n}\n\ninterface MochilaContextType {\n  items: MochilaItem[];\n  addItem: (item: Omit<MochilaItem, \"id\" | \"quantity\">) => void;\n  removeItem: (id: string) => void;\n  updateQuantity: (id: string, quantity: number) => void;\n  clearAll: () => void;\n  getTotalPrice: () => number;\n  totalItems: number;\n  isDrawerOpen: boolean;\n  setIsDrawerOpen: (open: boolean) => void;\n  appliedCoupon: string | null;\n  setAppliedCoupon: (coupon: string | null, discount?: number) => void;\n  appliedDiscount: number | null;\n  isFreeShippingActive: boolean;\n  setIsFreeShippingActive: (active: boolean) => void;\n  shippingPrice: number;\n  setShippingPrice: (price: number) => void;\n  zipCode: string | null;\n  setZipCode: (zip: string | null) => void;\n}\n\nconst MochilaContext = createContext<MochilaContextType | undefined>(undefined);\n\nconst STORAGE_KEY = \"oudla_mochila\";\nconst COUPON_KEY = \"oudla_coupon\";\nconst DISCOUNT_KEY = \"oudla_discount\";\nconst FREE_SHIPPING_KEY = \"oudla_free_shipping\";\nconst ZIP_CODE_COOKIE_KEY = \"oudla_zip_code\";\nconst ZIP_CODE_KEY = \"oudla_zip_code\";\nconst SHIPPING_PRICE_KEY = \"oudla_shipping_price\";\n\nexport function MochilaProvider({ children }: { children: ReactNode }) {\n  const [items, setItems] = useState<MochilaItem[]>([]);\n  const [isDrawerOpen, setIsDrawerOpen] = useState(false);\n  const [appliedCoupon, setAppliedCouponState] = useState<string | null>(null);\n  const [appliedDiscount, setAppliedDiscount] = useState<number | null>(null);\n  const [isFreeShippingActive, setIsFreeShippingActiveState] = useState(false);\n  const [shippingPrice, setShippingPriceState] = useState(0);\n  const [zipCode, setZipCodeState] = useState<string | null>(Cookies.get(ZIP_CODE_COOKIE_KEY) || null);\n\n  useEffect(() => {\n    const loadMochila = () => {\n      try {\n        const stored = localStorage.getItem(STORAGE_KEY);\n        if (stored) {\n          const parsedItems: MochilaItem[] = JSON.parse(stored);\n          setItems(parsedItems);\n        }\n\n        const storedCoupon = localStorage.getItem(COUPON_KEY);\n        if (storedCoupon) setAppliedCouponState(storedCoupon);\n\n        const storedDiscount = localStorage.getItem(DISCOUNT_KEY);\n        if (storedDiscount) setAppliedDiscount(Number(storedDiscount));\n\n        const storedFreeShipping = localStorage.getItem(FREE_SHIPPING_KEY);\n        if (storedFreeShipping) setIsFreeShippingActiveState(storedFreeShipping === \"true\");\n\n        // Prefer cookie for zipCode, fallback to localStorage if needed\n        const cookieZip = Cookies.get(ZIP_CODE_COOKIE_KEY);\n        const storedZip = localStorage.getItem(ZIP_CODE_KEY);\n        const finalZip = cookieZip || storedZip;\n        if (finalZip) setZipCodeState(finalZip);\n\n        const storedPrice = localStorage.getItem(SHIPPING_PRICE_KEY);\n        if (storedPrice) setShippingPriceState(Number(storedPrice));\n      } catch (error) {\n        if (error instanceof SyntaxError) {\n          console.error(\"Erro ao parsear mochila, dados corrompidos:\", error);\n          try {\n            localStorage.removeItem(STORAGE_KEY);\n          } catch (e) {\n            console.error(\"N√£o foi poss√≠vel limpar dados corrompidos:\", e);\n          }\n        } else if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel carregar mochila\");\n        } else {\n          console.error(\"Erro ao carregar mochila:\", error);\n        }\n      }\n    };\n\n    loadMochila();\n  }, []);\n\n  const setZipCode = useCallback((zip: string | null) => {\n    setZipCodeState(zip);\n    if (zip) {\n      localStorage.setItem(ZIP_CODE_KEY, zip);\n      Cookies.set(ZIP_CODE_COOKIE_KEY, zip, { expires: 365 }); // Store for 1 year\n    } else {\n      localStorage.removeItem(ZIP_CODE_KEY);\n      Cookies.remove(ZIP_CODE_COOKIE_KEY);\n    }\n  }, []);\n\n  const setShippingPrice = useCallback((price: number) => {\n    setShippingPriceState(price);\n    localStorage.setItem(SHIPPING_PRICE_KEY, String(price));\n  }, []);\n\n  const setAppliedCoupon = useCallback((coupon: string | null, discount?: number) => {\n    setAppliedCouponState(coupon);\n    if (coupon) {\n      localStorage.setItem(COUPON_KEY, coupon);\n      if (discount !== undefined) {\n        const discountValue = Number(discount);\n        setAppliedDiscount(discountValue);\n        localStorage.setItem(DISCOUNT_KEY, String(discountValue));\n      } else {\n        setAppliedDiscount(null);\n        localStorage.removeItem(DISCOUNT_KEY);\n      }\n      setIsFreeShippingActiveState(false);\n      localStorage.removeItem(FREE_SHIPPING_KEY);\n    } else {\n      localStorage.removeItem(COUPON_KEY);\n      setAppliedDiscount(null);\n      localStorage.removeItem(DISCOUNT_KEY);\n    }\n  }, []);\n\n  const setIsFreeShippingActive = useCallback((active: boolean) => {\n    setIsFreeShippingActiveState(active);\n    if (active) {\n      localStorage.setItem(FREE_SHIPPING_KEY, \"true\");\n      setAppliedCouponState(null);\n      localStorage.removeItem(COUPON_KEY);\n    } else {\n      localStorage.removeItem(FREE_SHIPPING_KEY);\n    }\n  }, []);\n\n  const addItem = useCallback((newItem: Omit<MochilaItem, \"id\" | \"quantity\">) => {\n    setItems(prev => {\n      const existingItemIndex = prev.findIndex(\n        (item) =>\n          item.productId === newItem.productId &&\n          item.color?.hex === newItem.color?.hex &&\n          item.size === newItem.size &&\n          item.printPosition === newItem.printPosition\n      );\n\n      let updatedItems: MochilaItem[];\n      if (existingItemIndex >= 0) {\n        updatedItems = [...prev];\n        updatedItems[existingItemIndex].quantity += 1;\n      } else {\n        const id = `${newItem.productId}-${newItem.color?.hex || 'no-color'}-${newItem.size || 'no-size'}-${newItem.printPosition || 'default'}-${Date.now()}`;\n        updatedItems = [...prev, { ...newItem, id, quantity: 1 }];\n      }\n      \n      try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedItems));\n      } catch (error) {\n        if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel salvar item na mochila\");\n        } else {\n          console.error(\"Erro ao salvar item na mochila:\", error);\n        }\n      }\n\n      return updatedItems;\n    });\n  }, []);\n\n  const removeItem = useCallback((id: string) => {\n    setItems(prev => {\n      const updatedItems = prev.filter((item) => item.id !== id);\n      \n      try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedItems));\n      } catch (error) {\n        if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel atualizar mochila\");\n        } else {\n          console.error(\"Erro ao atualizar mochila:\", error);\n        }\n      }\n\n      return updatedItems;\n    });\n  }, []);\n\n  const updateQuantity = useCallback((id: string, quantity: number) => {\n    if (quantity <= 0) {\n      setItems(prev => {\n        const updatedItems = prev.filter((item) => item.id !== id);\n        try {\n          localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedItems));\n        } catch (error) {\n          console.error(\"Erro ao atualizar mochila:\", error);\n        }\n        return updatedItems;\n      });\n      return;\n    }\n    \n    setItems(prev => {\n      const updatedItems = prev.map((item) => (item.id === id ? { ...item, quantity } : item));\n      \n      try {\n        localStorage.setItem(STORAGE_KEY, JSON.stringify(updatedItems));\n      } catch (error) {\n        if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          console.error(\"localStorage cheio, n√£o foi poss√≠vel atualizar quantidade\");\n        } else {\n          console.error(\"Erro ao atualizar quantidade:\", error);\n        }\n      }\n\n      return updatedItems;\n    });\n  }, []);\n\n  const clearAll = useCallback(() => {\n    setItems([]);\n    setAppliedCouponState(null);\n    setAppliedDiscount(null);\n    setIsFreeShippingActiveState(false);\n    setShippingPriceState(0);\n    try {\n      localStorage.removeItem(STORAGE_KEY);\n      localStorage.removeItem(COUPON_KEY);\n      localStorage.removeItem(DISCOUNT_KEY);\n      localStorage.removeItem(FREE_SHIPPING_KEY);\n      localStorage.removeItem(SHIPPING_PRICE_KEY);\n    } catch (e) {\n      console.error(\"Erro ao limpar mochila:\", e);\n    }\n  }, []);\n\n  const totalItems = useMemo(() => items.reduce((sum, item) => sum + item.quantity, 0), [items]);\n\n  const getTotalPrice = useCallback(() => {\n    return items.reduce((sum, item) => sum + (item.price * item.quantity), 0);\n  }, [items]);\n\n  const contextValue = useMemo(() => ({\n    items,\n    addItem,\n    removeItem,\n    updateQuantity,\n    clearAll,\n    getTotalPrice,\n    totalItems,\n    isDrawerOpen,\n    setIsDrawerOpen,\n    appliedCoupon,\n    setAppliedCoupon,\n    appliedDiscount,\n    isFreeShippingActive,\n    setIsFreeShippingActive,\n    shippingPrice,\n    setShippingPrice,\n    zipCode,\n    setZipCode,\n  }), [items, addItem, removeItem, updateQuantity, clearAll, getTotalPrice, totalItems, isDrawerOpen, appliedCoupon, setAppliedCoupon, appliedDiscount, isFreeShippingActive, setIsFreeShippingActive, shippingPrice, setShippingPrice, zipCode, setZipCode]);\n\n  return (\n    <MochilaContext.Provider value={contextValue}>\n      {children}\n    </MochilaContext.Provider>\n  );\n}\n\nexport function useMochila() {\n  const context = useContext(MochilaContext);\n  if (context === undefined) {\n    throw new Error(\"useMochila must be used within a MochilaProvider\");\n  }\n  return context;\n}\n","path":null,"size_bytes":9996,"size_tokens":null},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"shadcn-card rounded-xl border bg-card border-card-border text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n));\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n));\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n));\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\nexport {\n  Card,\n  CardHeader,\n  CardFooter,\n  CardTitle,\n  CardDescription,\n  CardContent,\n}\n","path":null,"size_bytes":1904,"size_tokens":null},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","path":null,"size_bytes":5128,"size_tokens":null},"client/src/components/Newsletter.tsx":{"content":"import { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Loader2 } from \"lucide-react\";\nimport type { NewsletterSettings } from \"@shared/schema\";\n// Importa o hook do Facebook Pixel para rastreamento de eventos\nimport { usePixel } from \"@/hooks/usePixel\";\n\nexport default function Newsletter() {\n  const [email, setEmail] = useState(\"\");\n  const { toast } = useToast();\n  \n  // Inicializa o hook do Facebook Pixel para rastreamento de eventos\n  const { trackLead } = usePixel();\n\n  const { data: settings } = useQuery<NewsletterSettings>({\n    queryKey: [\"/api/newsletter/settings\"],\n  });\n\n  const subscribeMutation = useMutation({\n    mutationFn: async (email: string) => {\n      const res = await apiRequest(\"POST\", \"/api/newsletter/subscribe\", { email });\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || \"erro ao se inscrever\");\n      }\n      return res.json();\n    },\n    onSuccess: () => {\n      // Dispara o evento Lead do Facebook Pixel quando inscri√ß√£o √© bem-sucedida\n      // Este evento rastreia cadastros na newsletter (gera√ß√£o de leads)\n      trackLead(email);\n      \n      toast({\n        title: \"sucesso!\",\n        description: \"voc√™ foi cadastrado na nossa newsletter.\",\n      });\n      setEmail(\"\");\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"erro no cadastro\",\n        description: error.message,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!email) {\n      toast({\n        title: \"email necess√°rio\",\n        description: \"por favor, insira seu email\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    subscribeMutation.mutate(email);\n  };\n\n  return (\n    <section className=\"py-32 px-4\">\n      <div className=\"max-w-xl mx-auto text-center space-y-8\">\n        <div className=\"space-y-3\">\n          <h2 className=\"text-4xl md:text-5xl font-light lowercase text-foreground tracking-tight\">\n            {settings?.title || \"fique por dentro\"}\n          </h2>\n          <p className=\"text-muted-foreground lowercase\">\n            {settings?.description || \"novidades e lan√ßamentos no seu email\"}\n          </p>\n        </div>\n        \n        <form onSubmit={handleSubmit} className=\"space-y-3\">\n          <div className=\"flex gap-2\">\n            <Input\n              type=\"email\"\n              placeholder=\"seu email\"\n              value={email}\n              onChange={(e) => setEmail(e.target.value)}\n              className=\"flex-1 lowercase\"\n              data-testid=\"input-newsletter-email\"\n              disabled={subscribeMutation.isPending}\n            />\n            <Button \n              type=\"submit\"\n              data-testid=\"button-newsletter-submit\"\n              disabled={subscribeMutation.isPending}\n            >\n              {subscribeMutation.isPending ? (\n                <Loader2 className=\"h-4 w-4 animate-spin\" />\n              ) : (\n                settings?.buttonText || \"enviar\"\n              )}\n            </Button>\n          </div>\n        </form>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":3382,"size_tokens":null},"client/src/pages/examples/Home.tsx":{"content":"import Home from '../Home';\n\nexport default function HomeExample() {\n  return <Home />;\n}","path":null,"size_bytes":89,"size_tokens":null},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\" +\n  \" hover-elevate active-elevate-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground border border-primary-border\",\n        destructive:\n          \"bg-destructive text-destructive-foreground border border-destructive-border\",\n        outline:\n          // Shows the background color of whatever card / sidebar / accent background it is inside of.\n          // Inherits the current text color.\n          \" border [border-color:var(--button-outline)]  shadow-xs active:shadow-none \",\n        secondary: \"border bg-secondary text-secondary-foreground border border-secondary-border \",\n        // Add a transparent border so that when someone toggles a border on later, it doesn't shift layout/size.\n        ghost: \"border border-transparent\",\n      },\n      // Heights are set as \"min\" heights, because sometimes Ai will place large amount of content\n      // inside buttons. With a min-height they will look appropriate with small amounts of content,\n      // but will expand to fit large amounts of content.\n      size: {\n        default: \"min-h-9 px-4 py-2\",\n        sm: \"min-h-8 rounded-md px-3 text-xs\",\n        lg: \"min-h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  },\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","path":null,"size_bytes":2359,"size_tokens":null},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","path":null,"size_bytes":5741,"size_tokens":null},"client/src/pages/Privacidade.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport Footer from \"@/components/Footer\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function Privacidade() {\n  const { data: pageData, isLoading } = useQuery<{\n    id: string;\n    slug: string;\n    title: string;\n    content: string;\n  }>({\n    queryKey: ['/api/footer-page', 'privacy'],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-16\">\n        <div className=\"max-w-4xl mx-auto space-y-12\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-20\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : pageData ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <h1 className=\"text-4xl md:text-5xl font-light lowercase text-foreground tracking-tight\" data-testid=\"text-page-title\">\n                  {pageData.title}\n                </h1>\n              </div>\n              <Card className=\"p-6 sm:p-8\">\n                <div\n                  className=\"prose dark:prose-invert max-w-none lowercase [&_h2]:text-2xl [&_h2]:font-light [&_h2]:mt-8 [&_h2]:mb-4 [&_h3]:font-medium [&_h3]:mt-6 [&_h3]:mb-2 [&_p]:text-muted-foreground [&_li]:text-muted-foreground [&_ul]:space-y-1\"\n                  dangerouslySetInnerHTML={{ __html: pageData.content }}\n                  data-testid=\"content-page\"\n                />\n              </Card>\n            </>\n          ) : (\n            <div className=\"text-center py-16\">\n              <p className=\"text-muted-foreground lowercase\">p√°gina n√£o encontrada</p>\n            </div>\n          )}\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":1814,"size_tokens":null},"client/src/pages/Termos.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport Footer from \"@/components/Footer\";\nimport { Loader2 } from \"lucide-react\";\n\nexport default function Termos() {\n  const { data: pageData, isLoading } = useQuery<{\n    id: string;\n    slug: string;\n    title: string;\n    content: string;\n  }>({\n    queryKey: ['/api/footer-page', 'policies'],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-16\">\n        <div className=\"max-w-4xl mx-auto space-y-12\">\n          {isLoading ? (\n            <div className=\"flex items-center justify-center py-20\">\n              <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n            </div>\n          ) : pageData ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <h1 className=\"text-4xl md:text-5xl font-light lowercase text-foreground tracking-tight\" data-testid=\"text-page-title\">\n                  {pageData.title}\n                </h1>\n              </div>\n              <Card className=\"p-6 sm:p-8\">\n                <div\n                  className=\"prose dark:prose-invert max-w-none lowercase [&_h2]:text-2xl [&_h2]:font-light [&_h2]:mt-8 [&_h2]:mb-4 [&_h3]:font-medium [&_h3]:mt-6 [&_h3]:mb-2 [&_p]:text-muted-foreground [&_li]:text-muted-foreground [&_ul]:space-y-1\"\n                  dangerouslySetInnerHTML={{ __html: pageData.content }}\n                  data-testid=\"content-page\"\n                />\n              </Card>\n            </>\n          ) : (\n            <div className=\"text-center py-16\">\n              <p className=\"text-muted-foreground lowercase\">p√°gina n√£o encontrada</p>\n            </div>\n          )}\n        </div>\n      </div>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":1810,"size_tokens":null},"PRODUCTION_SECURITY.md":{"content":"# Configura√ß√µes de Seguran√ßa para Produ√ß√£o\n\n## Vari√°veis de Ambiente Obrigat√≥rias\n\n```bash\n# Sess√£o\nSESSION_SECRET=your-strong-random-secret-key-here-minimum-32-chars\n\n# Banco de dados\nSUPABASE_DATABASE_URL=your-production-supabase-database-url\n\n# Ambiente\nNODE_ENV=production\n```\n\n## Configura√ß√µes de Seguran√ßa Implementadas\n\n### 1. Session Security\n- **httpOnly**: true (previne acesso via JavaScript)\n- **secure**: true em produ√ß√£o (HTTPS obrigat√≥rio)\n- **sameSite**: 'lax' (prote√ß√£o CSRF)\n- **maxAge**: 24 horas\n\n### 2. CSRF Protection\n- **sameSite cookies**: Prote√ß√£o prim√°ria contra CSRF\n- **Origin validation**: Verifica√ß√£o de origem para opera√ß√µes admin\n- **Development bypass**: Permitido apenas em desenvolvimento\n\n### 3. Authorization\n- **Role-based access**: Campo isAdmin no banco\n- **Session regeneration**: Previne session fixation\n- **Cookie clearing**: Logout completo\n\n### 4. Endpoints Protegidos\n- **Admin only**: POST /api/products, POST /api/products/:id/images\n- **User ownership**: Cart operations, review images\n- **Authentication required**: Todas as opera√ß√µes de estado\n\n## Checklist de Deploy\n\n- [ ] SESSION_SECRET configurado (m√≠nimo 32 caracteres)\n- [ ] NODE_ENV=production\n- [ ] HTTPS configurado (obrigat√≥rio para cookies secure)\n- [ ] Database URL de produ√ß√£o configurada\n- [ ] Origin validation configurada para dom√≠nio de produ√ß√£o\n- [ ] Rate limiting implementado (recomendado)\n- [ ] Logs de seguran√ßa configurados","path":null,"size_bytes":1481,"size_tokens":null},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","path":null,"size_bytes":2751,"size_tokens":null},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","path":null,"size_bytes":710,"size_tokens":null},"client/src/components/ColorSelector.tsx":{"content":"import { cn } from \"@/lib/utils\";\n\ninterface ColorOption {\n  name: string;\n  value: string;\n  hex: string;\n}\n\ninterface ColorSelectorProps {\n  colors: ColorOption[];\n  selectedColor: string;\n  onColorChange: (color: string) => void;\n  className?: string;\n}\n\nexport default function ColorSelector({ \n  colors, \n  selectedColor, \n  onColorChange,\n  className \n}: ColorSelectorProps) {\n  return (\n    <div className={cn(\"space-y-3\", className)}>\n      <label className=\"text-sm font-medium text-foreground\">\n        cor: {colors.find(c => c.value === selectedColor)?.name || selectedColor}\n      </label>\n      \n      <div className=\"flex gap-3\">\n        {colors.map((color) => (\n          <button\n            key={color.value}\n            onClick={() => onColorChange(color.value)}\n            className={cn(\n              \"w-10 h-10 rounded-full border-2 transition-all hover:scale-110\",\n              selectedColor === color.value \n                ? \"border-foreground shadow-lg\" \n                : \"border-border hover:border-muted-foreground\"\n            )}\n            style={{ backgroundColor: color.hex }}\n            data-testid={`button-color-${color.value}`}\n            title={color.name}\n          >\n            <span className=\"sr-only\">{color.name}</span>\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":1330,"size_tokens":null},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","path":null,"size_bytes":1077,"size_tokens":null},"client/src/components/AccessoriesCarousel.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { useRef, useState } from \"react\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface AccessoryCardProps {\n  item: {\n    id: string;\n    name: string;\n    price: number;\n    images: string[];\n  };\n  formatPrice: (value: number) => string;\n}\n\nfunction AccessoryCard({ item, formatPrice }: AccessoryCardProps) {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  return (\n    <Link href={`/produto/${item.id}`}>\n      <Card\n        className=\"flex-shrink-0 w-[280px] snap-start hover-elevate overflow-visible cursor-pointer group\"\n        data-testid={`card-accessory-${item.id}`}\n      >\n        <div \n          className=\"aspect-square bg-background overflow-hidden\"\n          onMouseEnter={() => {\n            if (item.images.length > 1) {\n              setCurrentImageIndex(1);\n            }\n          }}\n          onMouseLeave={() => setCurrentImageIndex(0)}\n        >\n          <img\n            src={item.images[currentImageIndex] || item.images[0]}\n            alt={item.name}\n            className=\"w-full h-full object-cover transition-transform duration-300 group-hover:scale-105\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </div>\n        <CardContent className=\"p-4\">\n          <h3 className=\"font-medium text-foreground mb-2 lowercase\">\n            {item.name}\n          </h3>\n          <p className=\"text-lg font-semibold text-foreground\">\n            {formatPrice(item.price)}\n          </p>\n        </CardContent>\n      </Card>\n    </Link>\n  );\n}\n\nfunction AccessorySkeleton() {\n  return (\n    <Card className=\"flex-shrink-0 w-[280px] snap-start\">\n      <div className=\"aspect-square bg-muted animate-pulse\" />\n      <CardContent className=\"p-4 space-y-2\">\n        <div className=\"h-4 bg-muted animate-pulse rounded\" />\n        <div className=\"h-6 bg-muted animate-pulse rounded w-24\" />\n      </CardContent>\n    </Card>\n  );\n}\n\nexport default function AccessoriesCarousel() {\n  const scrollRef = useRef<HTMLDivElement>(null);\n\n  const { data: apiData, isLoading } = useQuery<{products: any[]}>({\n    queryKey: ['/api/products'],\n    select: (data) => ({\n      products: data.products?.filter((p: any) => p.productType === 'accessory' && p.status === 'published') || []\n    }),\n  });\n\n  const accessories = apiData?.products || [];\n\n  const scroll = (direction: \"left\" | \"right\") => {\n    if (scrollRef.current) {\n      const scrollAmount = 300;\n      scrollRef.current.scrollBy({\n        left: direction === \"left\" ? -scrollAmount : scrollAmount,\n        behavior: \"smooth\",\n      });\n    }\n  };\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  if (!isLoading && accessories.length === 0) {\n    return null;\n  }\n\n  return (\n    <section className=\"py-16 px-4 bg-muted/30\">\n      <div className=\"container mx-auto\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <h2 className=\"text-2xl md:text-3xl font-light lowercase text-foreground\">\n            acess√≥rios\n          </h2>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => scroll(\"left\")}\n              data-testid=\"button-scroll-left\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => scroll(\"right\")}\n              data-testid=\"button-scroll-right\"\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div\n          ref={scrollRef}\n          className=\"flex gap-6 overflow-x-auto scrollbar-hide snap-x snap-mandatory pb-4\"\n          style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\n        >\n          {isLoading ? (\n            <>\n              {[...Array(4)].map((_, i) => (\n                <AccessorySkeleton key={i} />\n              ))}\n            </>\n          ) : (\n            accessories.map((item: any) => (\n              <AccessoryCard key={item.id} item={item} formatPrice={formatPrice} />\n            ))\n          )}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":4484,"size_tokens":null},"client/src/components/FeatureBanner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport type { ContentCard } from \"@shared/schema\";\n\ninterface ContentCardWithImages extends ContentCard {\n  images?: string[];\n}\n\nexport default function FeatureBanner() {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  const { data: cardsData } = useQuery<{ cards: ContentCardWithImages[] }>({\n    queryKey: ['/api/content-cards'],\n  });\n\n  const featureCard = cardsData?.cards?.find(c => c.cardType === 'feature' && c.isActive);\n\n  const images = featureCard?.images && featureCard.images.length > 0 \n    ? featureCard.images \n    : [];\n\n  useEffect(() => {\n    if (!images || images.length <= 1) return;\n    \n    const timer = setInterval(() => {\n      setCurrentImageIndex((prev) => (prev + 1) % images.length);\n    }, 5000);\n    \n    return () => clearInterval(timer);\n  }, [images?.length]);\n\n  if (!featureCard || images.length === 0) {\n    return null;\n  }\n\n  const heightClass = {\n    small: 'h-[40vh]',\n    medium: 'h-[50vh]',\n    large: 'h-[80vh]',\n  }[featureCard.height || 'large'];\n\n  const positionClass = {\n    left: 'items-end justify-start pl-8',\n    right: 'items-end justify-end pr-8',\n    center: 'items-end justify-center',\n    bottom: 'items-end justify-center',\n  }[featureCard.position || 'bottom'];\n\n  const cardLink = featureCard.productId \n    ? `/produto/${featureCard.productId}` \n    : featureCard.ctaLink || \"#\";\n\n  return (\n    <section className={`relative ${heightClass} overflow-hidden`}>\n      <div className=\"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent z-10\"></div>\n      \n      {images && images.map((imageUrl, index) => (\n        <div\n          key={index}\n          className=\"absolute inset-0 transition-opacity duration-1000\"\n          style={{\n            opacity: index === currentImageIndex ? 1 : 0,\n            pointerEvents: index === currentImageIndex ? 'auto' : 'none'\n          }}\n        >\n          <img\n            src={imageUrl}\n            alt={featureCard.title || \"produtos especiais\"}\n            className=\"w-full h-full object-cover\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </div>\n      ))}\n      \n      <div className={`absolute inset-0 z-20 flex ${positionClass} pb-12`}>\n        <div className=\"text-center max-w-lg\">\n          {featureCard.title && (\n            <h2 className=\"text-3xl md:text-4xl font-light text-white mb-4 lowercase\">\n              {featureCard.title}\n            </h2>\n          )}\n          {featureCard.subtitle && (\n            <p className=\"text-lg md:text-xl text-white/90 font-light lowercase mb-6\">\n              {featureCard.subtitle}\n            </p>\n          )}\n          {featureCard.ctaText && (\n            <Button \n              asChild\n              size=\"lg\"\n              variant=\"outline\"\n              className=\"bg-background/10 backdrop-blur-md border-white/20 text-white hover:bg-background/20 lowercase\"\n              data-testid=\"button-feature-banner\"\n            >\n              <Link href={cardLink}>\n                {featureCard.ctaText}\n              </Link>\n            </Button>\n          )}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":3324,"size_tokens":null},"client/src/data/mockAccessories.ts":{"content":"import canecaImg from \"@assets/generated_images/luxury_faith_mug_product_bb4e381c.png\";\nimport canecaImgAlt from \"@assets/generated_images/luxury_faith_mug_lifestyle_ea3a4712.png\";\nimport ecobagImg from \"@assets/generated_images/luxury_ecobag_product_1bcc5814.png\";\nimport ecobagImgAlt from \"@assets/generated_images/luxury_ecobag_lifestyle_46b98401.png\";\nimport gorroImg from \"@assets/generated_images/luxury_beanie_product_69838035.png\";\nimport gorroImgAlt from \"@assets/generated_images/luxury_beanie_lifestyle_31d6ed5f.png\";\nimport boneImg from \"@assets/generated_images/luxury_cap_product_5af45e6d.png\";\nimport boneImgAlt from \"@assets/generated_images/luxury_cap_lifestyle_a93afc16.png\";\n\nexport interface Accessory {\n  id: string;\n  name: string;\n  price: number;\n  images: string[];\n  description: string;\n  category: string;\n}\n\nexport const mockAccessories: Accessory[] = [\n  {\n    id: \"mug\",\n    name: \"caneca faith\",\n    price: 45.00,\n    images: [canecaImg, canecaImgAlt],\n    description: \"caneca de cer√¢mica com design minimalista crist√£o. perfeita para o seu caf√© da manh√£ ou momento de reflex√£o.\",\n    category: \"acess√≥rios\"\n  },\n  {\n    id: \"ecobag\",\n    name: \"ecobag essentials\",\n    price: 35.00,\n    images: [ecobagImg, ecobagImgAlt],\n    description: \"ecobag sustent√°vel com estampa sutil de f√©. ideal para carregar seus pertences com estilo e prop√≥sito.\",\n    category: \"acess√≥rios\"\n  },\n  {\n    id: \"beanie\",\n    name: \"gorro comfort\",\n    price: 55.00,\n    images: [gorroImg, gorroImgAlt],\n    description: \"gorro de tric√¥ com bordado discreto. mant√©m voc√™ aquecido enquanto expressa sua f√© com eleg√¢ncia.\",\n    category: \"acess√≥rios\"\n  },\n  {\n    id: \"cap\",\n    name: \"bon√© classic\",\n    price: 65.00,\n    images: [boneImg, boneImgAlt],\n    description: \"bon√© com bordado minimalista crist√£o. prote√ß√£o e estilo para o dia a dia urbano.\",\n    category: \"acess√≥rios\"\n  },\n];\n","path":null,"size_bytes":1921,"size_tokens":null},"client/src/components/LifestyleBanner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Link } from \"wouter\";\nimport type { ContentCard } from \"@shared/schema\";\n\ninterface ContentCardWithImages extends ContentCard {\n  images?: string[];\n}\n\nexport default function LifestyleBanner() {\n  const [currentImageIndex, setCurrentImageIndex] = useState(0);\n\n  const { data: cardsData } = useQuery<{ cards: ContentCardWithImages[] }>({\n    queryKey: ['/api/content-cards'],\n  });\n\n  const lifestyleCard = cardsData?.cards?.find(c => c.cardType === 'lifestyle' && c.isActive);\n\n  const images = lifestyleCard?.images && lifestyleCard.images.length > 0 \n    ? lifestyleCard.images \n    : [lifestyleCard?.imageUrl].filter(Boolean);\n\n  useEffect(() => {\n    if (!images || images.length <= 1) return;\n    \n    const timer = setInterval(() => {\n      setCurrentImageIndex((prev) => (prev + 1) % images.length);\n    }, 5000);\n    \n    return () => clearInterval(timer);\n  }, [images?.length]);\n\n  if (!lifestyleCard) {\n    return null;\n  }\n\n  const heightClass = {\n    small: 'h-[40vh]',\n    medium: 'h-[50vh]',\n    large: 'h-[80vh]',\n  }[lifestyleCard.height || 'medium'];\n\n  const gradientClass = {\n    left: 'bg-gradient-to-r from-black/70 via-black/30 to-transparent',\n    right: 'bg-gradient-to-l from-black/70 via-black/30 to-transparent',\n    center: 'bg-gradient-to-r from-transparent via-black/50 to-transparent',\n    bottom: 'bg-gradient-to-t from-black/70 via-black/30 to-transparent',\n  }[lifestyleCard.position || 'left'];\n\n  const positionClass = {\n    left: 'items-center justify-start px-8 md:px-16',\n    right: 'items-center justify-end px-8 md:px-16',\n    center: 'items-center justify-center text-center',\n    bottom: 'items-end justify-center pb-12 text-center',\n  }[lifestyleCard.position || 'left'];\n\n  const cardLink = lifestyleCard.productId \n    ? `/produto/${lifestyleCard.productId}` \n    : lifestyleCard.ctaLink || \"#\";\n\n  return (\n    <section className={`relative ${heightClass} overflow-hidden`}>\n      <div className={`absolute inset-0 ${gradientClass} z-10`}></div>\n      \n      {images && images.map((imageUrl, index) => (\n        <div\n          key={index}\n          className=\"absolute inset-0 transition-opacity duration-1000\"\n          style={{\n            opacity: index === currentImageIndex ? 1 : 0,\n            pointerEvents: index === currentImageIndex ? 'auto' : 'none'\n          }}\n        >\n          <img\n            src={imageUrl}\n            alt={lifestyleCard.title || \"comunidade de f√©\"}\n            className=\"w-full h-full object-cover\"\n            loading=\"lazy\"\n            decoding=\"async\"\n          />\n        </div>\n      ))}\n      \n      <div className={`absolute inset-0 z-20 flex ${positionClass}`}>\n        <div className=\"max-w-lg\">\n          {lifestyleCard.title && (\n            <h2 className=\"text-3xl md:text-4xl font-light text-white mb-4 lowercase\">\n              {lifestyleCard.title}\n            </h2>\n          )}\n          {lifestyleCard.subtitle && (\n            <p className=\"text-lg md:text-xl text-white/90 font-light lowercase mb-6\">\n              {lifestyleCard.subtitle}\n            </p>\n          )}\n          {lifestyleCard.ctaText && (\n            <Button \n              asChild\n              size=\"lg\"\n              variant=\"outline\"\n              className=\"bg-background/10 backdrop-blur-md border-white/20 text-white hover:bg-background/20 lowercase\"\n              data-testid=\"button-lifestyle-banner\"\n            >\n              <Link href={cardLink}>\n                {lifestyleCard.ctaText}\n              </Link>\n            </Button>\n          )}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":3739,"size_tokens":null},"client/src/components/RelatedProducts.tsx":{"content":"import { useRef, useEffect, useState } from \"react\";\nimport { ChevronLeft, ChevronRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\n\ninterface RelatedProductsProps {\n  currentProductId: string;\n}\n\nexport default function RelatedProducts({ currentProductId }: RelatedProductsProps) {\n  const scrollRef = useRef<HTMLDivElement>(null);\n  const sectionRef = useRef<HTMLElement>(null);\n  const [isVisible, setIsVisible] = useState(false);\n\n  const { data: apiData, isLoading } = useQuery<{products: any[]}>({\n    queryKey: ['/api/products'],\n    select: (data) => {\n      const allItems = data.products || [];\n      const currentItem = allItems.find(item => item.id === currentProductId);\n      \n      const scoredItems = allItems\n        .filter(item => item.id !== currentProductId)\n        .map(item => {\n          let score = 0;\n          \n          if (currentItem && item.productType === currentItem.productType) {\n            score += 10;\n          }\n          \n          if (currentItem) {\n            const priceDiff = Math.abs(item.price - currentItem.price);\n            if (priceDiff < 20) score += 5;\n            else if (priceDiff < 50) score += 3;\n            else if (priceDiff < 100) score += 1;\n          }\n          \n          if (currentItem && currentItem.colors && item.colors) {\n            const currentColors = Array.isArray(currentItem.colors) ? currentItem.colors.map((c: any) => typeof c === 'string' ? c : c.hex) : [];\n            const itemColors = Array.isArray(item.colors) ? item.colors.map((c: any) => typeof c === 'string' ? c : c.hex) : [];\n            const sharedColors = currentColors.filter((c: string) => itemColors.includes(c));\n            score += sharedColors.length * 2;\n          }\n          \n          return { item, score };\n        })\n        .sort((a, b) => b.score - a.score)\n        .slice(0, 6)\n        .map(({ item }) => item);\n      \n      return { products: scoredItems };\n    },\n  });\n\n  const scoredItems = apiData?.products || [];\n\n  useEffect(() => {\n    const observer = new IntersectionObserver(\n      ([entry]) => {\n        if (entry.isIntersecting) {\n          setIsVisible(true);\n          observer.disconnect();\n        }\n      },\n      { threshold: 0.1 }\n    );\n\n    if (sectionRef.current) {\n      observer.observe(sectionRef.current);\n    }\n\n    return () => observer.disconnect();\n  }, []);\n\n  const scroll = (direction: \"left\" | \"right\") => {\n    if (!scrollRef.current) return;\n    const container = scrollRef.current;\n    const scrollAmount = 300;\n\n    if (direction === \"right\") {\n      const maxScroll = container.scrollWidth - container.clientWidth;\n      if (container.scrollLeft >= maxScroll - 10) {\n        container.scrollTo({ left: 0, behavior: \"smooth\" });\n      } else {\n        container.scrollBy({ left: scrollAmount, behavior: \"smooth\" });\n      }\n    } else {\n      if (container.scrollLeft <= 10) {\n        container.scrollTo({ left: container.scrollWidth - container.clientWidth, behavior: \"smooth\" });\n      } else {\n        container.scrollBy({ left: -scrollAmount, behavior: \"smooth\" });\n      }\n    }\n  };\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  if (!isLoading && scoredItems.length === 0) return null;\n\n  return (\n    <section\n      ref={sectionRef}\n      className=\"mt-12 mb-8\"\n      style={{\n        opacity: isVisible ? 1 : 0,\n        transform: isVisible ? 'translateY(0)' : 'translateY(40px)',\n        transition: 'opacity 0.7s cubic-bezier(0.25, 0.1, 0.25, 1), transform 0.7s cubic-bezier(0.25, 0.1, 0.25, 1)',\n      }}\n    >\n      <div className=\"rounded-[24px] bg-muted/40 border border-border/30 p-6 sm:p-8 lg:p-10\">\n        <div className=\"flex items-center justify-between gap-4 mb-6\">\n          <div className=\"space-y-1\">\n            <p className=\"text-[10px] font-medium tracking-[0.2em] text-muted-foreground/50 uppercase\">\n              recomendados\n            </p>\n            <h2 className=\"text-xl sm:text-2xl font-light lowercase text-foreground tracking-tight\">\n              voc√™ tamb√©m pode gostar\n            </h2>\n          </div>\n          <div className=\"flex gap-2\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => scroll(\"left\")}\n              className=\"rounded-full h-9 w-9 border-border/40\"\n              data-testid=\"button-scroll-left\"\n            >\n              <ChevronLeft className=\"h-4 w-4\" />\n            </Button>\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={() => scroll(\"right\")}\n              className=\"rounded-full h-9 w-9 border-border/40\"\n              data-testid=\"button-scroll-right\"\n            >\n              <ChevronRight className=\"h-4 w-4\" />\n            </Button>\n          </div>\n        </div>\n\n        <div\n          ref={scrollRef}\n          className=\"flex gap-4 overflow-x-auto snap-x snap-mandatory pb-2 -mx-1 px-1\"\n          style={{ scrollbarWidth: 'none', msOverflowStyle: 'none' }}\n        >\n          {isLoading ? (\n            <>\n              {[...Array(4)].map((_, i) => (\n                <div key={i} className=\"flex-shrink-0 w-[220px] sm:w-[240px] snap-start\">\n                  <div className=\"aspect-[3/4] bg-muted animate-pulse rounded-2xl\" />\n                  <div className=\"pt-3 space-y-2\">\n                    <div className=\"h-4 bg-muted animate-pulse rounded w-3/4\" />\n                    <div className=\"h-5 bg-muted animate-pulse rounded w-1/2\" />\n                  </div>\n                </div>\n              ))}\n            </>\n          ) : (\n            scoredItems.map((item: any) => (\n              <Link key={item.id} href={`/produto/${item.id}`}>\n                <div\n                  className=\"flex-shrink-0 w-[220px] sm:w-[240px] snap-start cursor-pointer group\"\n                  data-testid={`card-related-${item.id}`}\n                >\n                  <div className=\"aspect-[3/4] bg-muted/30 overflow-hidden rounded-2xl\">\n                    <img\n                      src={item.images?.[0]}\n                      alt={item.name}\n                      className=\"w-full h-full object-cover group-hover:scale-105 transition-transform duration-500\"\n                      loading=\"lazy\"\n                      decoding=\"async\"\n                    />\n                  </div>\n                  <div className=\"pt-3 px-1\">\n                    <h3 className=\"text-sm font-medium text-foreground lowercase truncate\">\n                      {item.name}\n                    </h3>\n                    <p className=\"text-base font-semibold text-foreground mt-1\">\n                      {formatPrice(item.price)}\n                    </p>\n                  </div>\n                </div>\n              </Link>\n            ))\n          )}\n        </div>\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":7019,"size_tokens":null},"scripts/migrate-to-supabase.ts":{"content":"import { Client } from 'pg';\n\nconst mockAccessories = [\n  {\n    id: \"mug\",\n    name: \"caneca faith\",\n    price: \"45.00\",\n    description: \"caneca de cer√¢mica com design minimalista crist√£o. perfeita para o seu caf√© da manh√£ ou momento de reflex√£o.\",\n    category: \"acess√≥rios\",\n    productType: \"accessory\" as const,\n    images: [\"/attached_assets/generated_images/caneca_crist√£_minimalista_bbd4711f.png\"]\n  },\n  {\n    id: \"ecobag\",\n    name: \"ecobag essentials\",\n    price: \"35.00\",\n    description: \"ecobag sustent√°vel com estampa sutil de f√©. ideal para carregar seus pertences com estilo e prop√≥sito.\",\n    category: \"acess√≥rios\",\n    productType: \"accessory\" as const,\n    images: [\"/attached_assets/generated_images/ecobag_crist√£_minimalista_2ca64292.png\"]\n  },\n  {\n    id: \"beanie\",\n    name: \"gorro comfort\",\n    price: \"55.00\",\n    description: \"gorro de tric√¥ com bordado discreto. mant√©m voc√™ aquecido enquanto expressa sua f√© com eleg√¢ncia.\",\n    category: \"acess√≥rios\",\n    productType: \"accessory\" as const,\n    images: [\"/attached_assets/generated_images/gorro_crist√£o_minimalista_1a92040e.png\"]\n  },\n  {\n    id: \"cap\",\n    name: \"bon√© classic\",\n    price: \"65.00\",\n    description: \"bon√© com bordado minimalista crist√£o. prote√ß√£o e estilo para o dia a dia urbano.\",\n    category: \"acess√≥rios\",\n    productType: \"accessory\" as const,\n    images: [\"/attached_assets/generated_images/bon√©_crist√£o_minimalista_b531c21a.png\"]\n  },\n];\n\nasync function migrateData() {\n  if (!process.env.DATABASE_URL) {\n    throw new Error('DATABASE_URL not set');\n  }\n  if (!process.env.SUPABASE_DATABASE_URL) {\n    throw new Error('SUPABASE_DATABASE_URL not set');\n  }\n\n  const sourceClient = new Client({ connectionString: process.env.DATABASE_URL });\n  const targetClient = new Client({ connectionString: process.env.SUPABASE_DATABASE_URL });\n\n  try {\n    console.log('üîÑ Connecting to source database (Replit)...');\n    await sourceClient.connect();\n\n    console.log('üîÑ Connecting to target database (Supabase)...');\n    await targetClient.connect();\n\n    // Migrate products\n    console.log('üì¶ Migrating products...');\n    const productsResult = await sourceClient.query('SELECT * FROM products');\n    const products = productsResult.rows;\n    console.log(`Found ${products.length} products to migrate`);\n    \n    if (products.length > 0) {\n      for (const product of products) {\n        await targetClient.query(`\n          INSERT INTO products (\n            id, name, description, price, original_price, product_type, category,\n            colors, sizes, model_url, is_new, is_active, fabric_tech, \n            fabric_description, care_instructions, size_guide, created_at, updated_at\n          ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11, $12, $13, $14, $15, $16, $17, $18)\n          ON CONFLICT (id) DO NOTHING\n        `, [\n          product.id, product.name, product.description, product.price, product.original_price,\n          'tshirt', null, product.colors, product.sizes, product.model_url, product.is_new,\n          product.is_active, product.fabric_tech, product.fabric_description,\n          product.care_instructions, product.size_guide, product.created_at, product.updated_at\n        ]);\n        console.log(`‚úÖ Migrated product: ${product.name}`);\n      }\n    }\n\n    // Migrate product images\n    console.log('üñºÔ∏è  Migrating product images...');\n    const imagesResult = await sourceClient.query('SELECT * FROM product_images');\n    const productImages = imagesResult.rows;\n    console.log(`Found ${productImages.length} product images to migrate`);\n    \n    if (productImages.length > 0) {\n      for (const image of productImages) {\n        await targetClient.query(`\n          INSERT INTO product_images (id, product_id, image_url, alt_text, color, sort_order, created_at)\n          VALUES ($1, $2, $3, $4, $5, $6, $7)\n          ON CONFLICT (id) DO NOTHING\n        `, [\n          image.id, image.product_id, image.image_url, image.alt_text,\n          image.color, image.sort_order, image.created_at\n        ]);\n        console.log(`‚úÖ Migrated image for product: ${image.product_id}`);\n      }\n    }\n\n    // Add accessories\n    console.log('üéí Adding accessories...');\n    for (const accessory of mockAccessories) {\n      await targetClient.query(`\n        INSERT INTO products (\n          id, name, description, price, product_type, category, is_active, is_new\n        ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8)\n        ON CONFLICT (id) DO NOTHING\n        RETURNING id\n      `, [\n        accessory.id, accessory.name, accessory.description, accessory.price,\n        accessory.productType, accessory.category, true, false\n      ]);\n      console.log(`‚úÖ Added accessory: ${accessory.name}`);\n\n      // Add accessory images\n      for (const [index, imageUrl] of accessory.images.entries()) {\n        await targetClient.query(`\n          INSERT INTO product_images (product_id, image_url, alt_text, sort_order)\n          VALUES ($1, $2, $3, $4)\n        `, [accessory.id, imageUrl, accessory.name, index]);\n      }\n    }\n\n    console.log('‚úÖ Migration completed successfully!');\n    console.log(`\nüìä Migration Summary:\n   - Products: ${products.length}\n   - Product Images: ${productImages.length}\n   - Accessories: ${mockAccessories.length}\n   - Total Items: ${products.length + mockAccessories.length}\n    `);\n\n  } catch (error) {\n    console.error('‚ùå Migration failed:', error);\n    throw error;\n  } finally {\n    await sourceClient.end();\n    await targetClient.end();\n  }\n}\n\nmigrateData();\n","path":null,"size_bytes":5567,"size_tokens":null},"server/admin-middleware.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport bcrypt from \"bcrypt\";\nimport { storage } from \"./storage\";\n\n// Track failed login attempts for brute force protection\nconst loginAttempts = new Map<string, { count: number; timestamp: number }>();\n\nconst MAX_ATTEMPTS = 5;\nconst ATTEMPT_WINDOW = 15 * 60 * 1000; // 15 minutos\n\nexport function requireAdmin(req: Request, res: Response, next: NextFunction) {\n  if (process.env.NODE_ENV === 'development') {\n    console.log(\"üîí Admin check:\", {\n      hasSession: !!req.session,\n      isAdmin: req.session?.isAdmin\n    });\n  }\n  \n  if (!req.session?.isAdmin) {\n    return res.status(401).json({ error: \"N√£o autorizado. Admin apenas.\" });\n  }\n  \n  next();\n}\n\nexport async function loginAdmin(username: string, password: string): Promise<boolean> {\n  try {\n    // Sanitizar entrada\n    const cleanUsername = username.trim().toLowerCase();\n    if (!cleanUsername || cleanUsername.length < 3 || cleanUsername.length > 50) {\n      return false;\n    }\n    \n    // Verificar rate limiting por IP/username\n    const attemptKey = cleanUsername;\n    const now = Date.now();\n    const attempt = loginAttempts.get(attemptKey);\n    \n    if (attempt && now - attempt.timestamp < ATTEMPT_WINDOW) {\n      if (attempt.count >= MAX_ATTEMPTS) {\n        console.warn(`‚ö†Ô∏è Muitas tentativas de login para: ${cleanUsername}`);\n        return false;\n      }\n    } else {\n      loginAttempts.set(attemptKey, { count: 0, timestamp: now });\n    }\n    \n    // Buscar admin no banco de dados\n    const admin = await storage.getAdminByUsername(cleanUsername);\n    \n    if (!admin) {\n      // Incrementar tentativas mesmo que usu√°rio n√£o exista (timing attack prevention)\n      const current = loginAttempts.get(attemptKey) || { count: 0, timestamp: now };\n      current.count++;\n      loginAttempts.set(attemptKey, current);\n      return false;\n    }\n    \n    if (!admin.isActive) {\n      return false;\n    }\n    \n    // Verificar senha com bcrypt (timing-safe comparison)\n    const isValid = await bcrypt.compare(password, admin.passwordHash);\n    \n    if (isValid) {\n      // Limpar tentativas de login bem-sucedidas\n      loginAttempts.delete(attemptKey);\n      // Atualizar √∫ltimo login\n      await storage.updateAdminLastLogin(cleanUsername);\n      return true;\n    } else {\n      // Incrementar tentativas falhadas\n      const current = loginAttempts.get(attemptKey) || { count: 0, timestamp: now };\n      current.count++;\n      loginAttempts.set(attemptKey, current);\n    }\n    \n    return false;\n  } catch (error) {\n    console.error(\"‚ùå Login admin error:\", error);\n    return false;\n  }\n}\n\nexport function setAdminSession(req: Request, username: string) {\n  if (req.session) {\n    req.session.isAdmin = true;\n    req.session.userId = 'admin';\n    req.session.adminUsername = username;\n    \n    // Ensure session is saved and cookie is sent correctly\n    req.session.save();\n    \n    console.log(\"üìù Sess√£o definida:\", { \n      isAdmin: req.session.isAdmin, \n      userId: req.session.userId, \n      adminUsername: req.session.adminUsername,\n      sessionID: req.sessionID\n    });\n  }\n}\n\nexport function clearAdminSession(req: Request) {\n  if (req.session) {\n    req.session.isAdmin = false;\n    delete req.session.userId;\n    delete req.session.adminUsername;\n  }\n}\n","path":null,"size_bytes":3321,"size_tokens":null},"client/src/components/admin/AdminContent.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { SiteContent } from \"@shared/schema\";\n\nexport default function AdminContent() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    key: \"\",\n    value: \"\",\n    section: \"\",\n  });\n\n  const { data: contentData } = useQuery<{ content: SiteContent[] }>({\n    queryKey: ['/api/admin/content'],\n  });\n\n  const upsertMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/content\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/content'] });\n      setFormData({ key: \"\", value: \"\", section: \"\" });\n      toast({ title: \"Conte√∫do atualizado com sucesso!\" });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    upsertMutation.mutate(formData);\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"lowercase\">atualizar conte√∫do</CardTitle>\n          <CardDescription className=\"lowercase\">adicionar ou editar textos do site</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"key\" className=\"lowercase\">chave</Label>\n              <Input\n                id=\"key\"\n                value={formData.key}\n                onChange={(e) => setFormData({ ...formData, key: e.target.value })}\n                placeholder=\"ex: newsletter_title\"\n                required\n                data-testid=\"input-content-key\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"value\" className=\"lowercase\">valor</Label>\n              <Textarea\n                id=\"value\"\n                value={formData.value}\n                onChange={(e) => setFormData({ ...formData, value: e.target.value })}\n                placeholder=\"Digite o texto...\"\n                required\n                rows={4}\n                data-testid=\"input-content-value\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"section\" className=\"lowercase\">se√ß√£o (opcional)</Label>\n              <Input\n                id=\"section\"\n                value={formData.section}\n                onChange={(e) => setFormData({ ...formData, section: e.target.value })}\n                placeholder=\"ex: newsletter, footer\"\n                data-testid=\"input-content-section\"\n              />\n            </div>\n\n            <Button type=\"submit\" className=\"lowercase w-full sm:w-auto\" disabled={upsertMutation.isPending} data-testid=\"button-save-content\">\n              salvar conte√∫do\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-3\">\n        <h3 className=\"text-base font-medium lowercase px-1\">conte√∫dos cadastrados</h3>\n        {contentData?.content && contentData.content.length > 0 ? (\n          <div className=\"space-y-3\">\n            {contentData.content.map((item) => (\n              <Card key={item.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"space-y-2\">\n                    <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1\">\n                      <h4 className=\"font-medium lowercase truncate\">{item.key}</h4>\n                      {item.section && (\n                        <span className=\"text-xs text-muted-foreground lowercase\">{item.section}</span>\n                      )}\n                    </div>\n                    <p className=\"text-sm text-muted-foreground line-clamp-2\">{item.value}</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card>\n            <CardContent className=\"p-6 text-center\">\n              <p className=\"text-sm text-muted-foreground lowercase\">nenhum conte√∫do cadastrado</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4644,"size_tokens":null},"client/src/pages/Admin.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { \n  ImageIcon, \n  ShoppingBag,\n  LogOut,\n  BookOpen,\n  Package,\n  Gift,\n  Mail,\n  MailCheck,\n  Truck,\n  BarChart3,\n  Cookie,\n  MousePointer,\n  Globe,\n  CreditCard\n} from \"lucide-react\";\nimport { SidebarProvider, Sidebar, SidebarContent, SidebarGroup, SidebarGroupContent, SidebarGroupLabel, SidebarMenu, SidebarMenuButton, SidebarMenuItem, SidebarHeader, SidebarFooter, SidebarTrigger } from \"@/components/ui/sidebar\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport ThemeToggle from \"@/components/ThemeToggle\";\nimport AdminBanners from \"@/components/admin/AdminBanners\";\nimport AdminProducts from \"@/components/admin/AdminProducts\";\nimport AdminVerses from \"@/components/admin/AdminVerses\";\nimport AdminFooter from \"@/components/admin/AdminFooter\";\nimport AdminOrders from \"@/components/admin/AdminOrders\";\nimport AdminGlobalCoupon from \"@/components/admin/AdminGlobalCoupon\";\nimport AdminNewsletter from \"@/components/admin/AdminNewsletter\";\nimport AdminShipping from \"@/components/admin/AdminShipping\";\nimport AdminPixels from \"@/components/admin/AdminPixels\";\nimport AdminEmails from \"@/components/admin/AdminEmails\";\nimport AdminCookies from \"@/components/admin/AdminCookies\";\nimport AdminCTA from \"@/components/admin/AdminCTA\";\nimport AdminSEO from \"@/components/admin/AdminSEO\";\nimport AdminGateway from \"@/components/admin/AdminGateway\";\n\nconst menuItems = [\n  { id: \"orders\", title: \"Pedidos\", icon: Package, description: \"Gerenciar pedidos\" },\n  { id: \"products\", title: \"Produtos\", icon: ShoppingBag, description: \"Criar e editar produtos\" },\n  { id: \"shipping\", title: \"Frete\", icon: Truck, description: \"Configurar frete\" },\n  { id: \"gateway\", title: \"Gateway\", icon: CreditCard, description: \"Mercado Pago e pagamentos\" },\n  { id: \"cta\", title: \"CTA\", icon: MousePointer, description: \"Bot√µes e textos de a√ß√£o\" },\n  { id: \"coupon\", title: \"Cupom\", icon: Gift, description: \"Cupons de desconto\" },\n  { id: \"banners\", title: \"Banners\", icon: ImageIcon, description: \"Carrossel, cards e CTA\" },\n  { id: \"verses\", title: \"Vers√≠culos\", icon: BookOpen, description: \"Vers√≠culo do dia\" },\n  { id: \"emails\", title: \"Emails\", icon: MailCheck, description: \"Templates de emails transacionais\" },\n  { id: \"newsletter\", title: \"Newsletter\", icon: Mail, description: \"Gerenciar inscritos e configura√ß√µes\" },\n  { id: \"pixels\", title: \"Pixels\", icon: BarChart3, description: \"Rastreamento e analytics\" },\n  { id: \"cookies\", title: \"Cookies\", icon: Cookie, description: \"Aviso de cookies e consentimento\" },\n  { id: \"seo\", title: \"SEO\", icon: Globe, description: \"Open Graph e meta tags\" },\n  { id: \"footer\", title: \"Footer\", icon: BookOpen, description: \"Sobre, Pol√≠ticas, Devolu√ß√µes\" },\n];\n\nexport default function Admin() {\n  const [activeSection, setActiveSection] = useState(\"orders\");\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const { data: authCheck, isLoading: isCheckingAuth, isError } = useQuery<{ isAdmin: boolean }>({\n    queryKey: ['/api/admin/check'],\n    retry: 1,\n  });\n\n  useEffect(() => {\n    if (authCheck && !authCheck.isAdmin) {\n      setLocation(\"/admin/login\");\n    }\n    if (isError) {\n      setLocation(\"/admin/login\");\n    }\n  }, [authCheck, isError, setLocation]);\n\n  if (isCheckingAuth || isError) {\n    return (\n      <div className=\"flex h-screen w-full items-center justify-center bg-background\">\n        <div className=\"text-center space-y-4\">\n          <div className=\"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-r-transparent align-[-0.125em] motion-reduce:animate-[spin_1.5s_linear_infinite]\" />\n          <p className=\"text-sm text-muted-foreground lowercase\">\n            {isError ? 'redirecionando...' : 'verificando acesso...'}\n          </p>\n        </div>\n      </div>\n    );\n  }\n\n  if (authCheck && !authCheck.isAdmin) {\n    return null;\n  }\n\n  const handleLogout = async () => {\n    try {\n      await apiRequest(\"POST\", \"/api/admin/logout\");\n      toast({\n        title: \"Logout realizado\",\n        description: \"At√© breve!\",\n      });\n      setLocation(\"/\");\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    }\n  };\n\n  const renderContent = () => {\n    switch (activeSection) {\n      case \"orders\":\n        return <AdminOrders />;\n      case \"banners\":\n        return <AdminBanners />;\n      case \"products\":\n        return <AdminProducts />;\n      case \"shipping\":\n        return <AdminShipping />;\n      case \"gateway\":\n        return <AdminGateway />;\n      case \"cta\":\n        return <AdminCTA />;\n      case \"coupon\":\n        return <AdminGlobalCoupon />;\n      case \"emails\":\n        return <AdminEmails />;\n      case \"newsletter\":\n        return <AdminNewsletter />;\n      case \"pixels\":\n        return <AdminPixels />;\n      case \"cookies\":\n        return <AdminCookies />;\n      case \"seo\":\n        return <AdminSEO />;\n      case \"verses\":\n        return <AdminVerses />;\n      case \"footer\":\n        return <AdminFooter />;\n      default:\n        return <AdminOrders />;\n    }\n  };\n\n  const style = {\n    \"--sidebar-width\": \"18rem\",\n    \"--sidebar-width-icon\": \"4rem\",\n  };\n\n  const activeMenuItem = menuItems.find(item => item.id === activeSection);\n\n  return (\n    <SidebarProvider style={style as React.CSSProperties} defaultOpen={true}>\n      <div className=\"flex h-screen w-full bg-background\">\n        <Sidebar className=\"hidden md:flex\" collapsible=\"icon\">\n          <SidebarHeader className=\"border-b group-data-[collapsible=icon]:p-2 p-6\">\n            <div className=\"flex items-center justify-between group-data-[collapsible=icon]:justify-center\">\n              <div className=\"flex-1 min-w-0 group-data-[collapsible=icon]:hidden\">\n                <h2 className=\"text-2xl font-light lowercase tracking-tight truncate\">oudla admin</h2>\n                <p className=\"text-xs text-muted-foreground lowercase mt-1 truncate\">painel de controle</p>\n              </div>\n              <div className=\"flex items-center gap-2 group-data-[collapsible=icon]:flex-col\">\n                <ThemeToggle />\n                <SidebarTrigger data-testid=\"button-sidebar-toggle\" />\n              </div>\n            </div>\n          </SidebarHeader>\n          <SidebarContent>\n            <SidebarGroup>\n              <SidebarGroupLabel className=\"lowercase\">navega√ß√£o</SidebarGroupLabel>\n              <SidebarGroupContent>\n                <SidebarMenu>\n                  {menuItems.map((item) => (\n                    <SidebarMenuItem key={item.id}>\n                      <SidebarMenuButton\n                        onClick={() => setActiveSection(item.id)}\n                        isActive={activeSection === item.id}\n                        data-testid={`button-admin-nav-${item.id}`}\n                        tooltip={item.title}\n                        className=\"group-data-[collapsible=icon]:justify-center py-5\"\n                      >\n                        <item.icon className=\"h-4 w-4 flex-shrink-0\" />\n                        <span className=\"lowercase font-medium group-data-[collapsible=icon]:hidden\">{item.title}</span>\n                      </SidebarMenuButton>\n                    </SidebarMenuItem>\n                  ))}\n                </SidebarMenu>\n              </SidebarGroupContent>\n            </SidebarGroup>\n          </SidebarContent>\n          <SidebarFooter className=\"border-t group-data-[collapsible=icon]:p-2 p-4\">\n            <SidebarMenu>\n              <SidebarMenuItem>\n                <SidebarMenuButton\n                  onClick={handleLogout}\n                  data-testid=\"button-admin-logout\"\n                  tooltip=\"sair do painel\"\n                  className=\"group-data-[collapsible=icon]:justify-center\"\n                >\n                  <LogOut className=\"h-4 w-4 flex-shrink-0\" />\n                  <span className=\"lowercase group-data-[collapsible=icon]:hidden\">sair do painel</span>\n                </SidebarMenuButton>\n              </SidebarMenuItem>\n            </SidebarMenu>\n          </SidebarFooter>\n        </Sidebar>\n\n        <main className=\"flex-1 min-h-0 flex flex-col relative overflow-hidden\">\n          <div className=\"hidden md:flex items-center border-b bg-background sticky top-0 z-10 px-6 py-3\">\n            {activeMenuItem && (\n              <div>\n                <h3 className=\"text-sm font-medium lowercase\">{activeMenuItem.title}</h3>\n                <p className=\"text-xs text-muted-foreground lowercase\">{activeMenuItem.description}</p>\n              </div>\n            )}\n          </div>\n\n          <div className=\"md:hidden bg-background sticky top-0 z-20\">\n            <div className=\"px-5 pt-6 pb-5 space-y-5\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <h2 className=\"text-2xl font-semibold lowercase tracking-tight\">oudla admin</h2>\n                  <p className=\"text-[13px] text-muted-foreground/60 lowercase\">painel de controle</p>\n                </div>\n                <div className=\"flex items-center gap-1\">\n                  <ThemeToggle />\n                  <Button\n                    variant=\"ghost\"\n                    size=\"icon\"\n                    onClick={handleLogout}\n                    className=\"rounded-full\"\n                    data-testid=\"button-admin-logout-mobile\"\n                  >\n                    <LogOut className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n\n              <Select value={activeSection} onValueChange={setActiveSection}>\n                <SelectTrigger className=\"w-full h-12 rounded-2xl border-0 bg-muted/40 px-4 text-[15px] lowercase font-medium shadow-none focus:ring-0\" data-testid=\"select-mobile-section\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent className=\"z-50 rounded-xl border-0 shadow-lg p-1.5\">\n                  {menuItems.map((item) => (\n                    <SelectItem key={item.id} value={item.id} className=\"lowercase rounded-lg h-11 text-[14px] px-3 cursor-pointer\">\n                      <div className=\"flex items-center gap-3\">\n                        <item.icon className=\"h-4 w-4 text-muted-foreground/50 shrink-0\" />\n                        <div className=\"flex flex-col items-start\">\n                          <span className=\"font-medium\">{item.title}</span>\n                          <span className=\"text-[11px] text-muted-foreground/40 leading-none\">{item.description}</span>\n                        </div>\n                      </div>\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n            </div>\n            <div className=\"h-px bg-border/40\" />\n          </div>\n\n          <div className=\"flex-1 overflow-y-auto overflow-x-hidden p-4 md:p-6\">\n            <div className=\"max-w-7xl mx-auto\">\n              {renderContent()}\n            </div>\n          </div>\n        </main>\n      </div>\n    </SidebarProvider>\n  );\n}\n","path":null,"size_bytes":11350,"size_tokens":null},"client/src/components/admin/AdminVerses.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminVerses() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    text: \"\",\n    reference: \"\",\n  });\n\n  const { data: verseData, isLoading } = useQuery<{ verse: { id: string, text: string, reference: string } | null }>({\n    queryKey: ['/api/verse'],\n  });\n\n  useEffect(() => {\n    if (verseData?.verse) {\n      setFormData({\n        text: verseData.verse.text,\n        reference: verseData.verse.reference,\n      });\n    }\n  }, [verseData]);\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/verse\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/verse'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/verses'] });\n      toast({ \n        title: \"Vers√≠culo atualizado\",\n        description: \"O vers√≠culo do dia foi atualizado com sucesso!\" \n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar o vers√≠culo.\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    saveMutation.mutate(formData);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-light lowercase mb-2\">vers√≠culo do dia</h1>\n          <p className=\"text-muted-foreground lowercase\">carregando...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-light lowercase mb-2\">vers√≠culo do dia</h1>\n        <p className=\"text-muted-foreground lowercase\">edite o vers√≠culo que aparece na p√°gina inicial</p>\n      </div>\n\n      <Card className=\"max-w-2xl\">\n        <CardHeader>\n          <CardTitle className=\"lowercase\">editar vers√≠culo</CardTitle>\n          <CardDescription className=\"lowercase\">este vers√≠culo ser√° exibido na p√°gina inicial do site</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"text\" className=\"lowercase\">texto do vers√≠culo</Label>\n              <Textarea\n                id=\"text\"\n                value={formData.text}\n                onChange={(e) => setFormData({ ...formData, text: e.target.value })}\n                placeholder=\"Digite o texto do vers√≠culo...\"\n                required\n                rows={5}\n                data-testid=\"input-verse-text\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"reference\" className=\"lowercase\">refer√™ncia</Label>\n              <Input\n                id=\"reference\"\n                value={formData.reference}\n                onChange={(e) => setFormData({ ...formData, reference: e.target.value })}\n                placeholder=\"ex: jo√£o 3:16\"\n                required\n                data-testid=\"input-verse-reference\"\n              />\n            </div>\n\n            <Button \n              type=\"submit\" \n              className=\"lowercase\" \n              disabled={saveMutation.isPending} \n              data-testid=\"button-save-verse\"\n            >\n              {saveMutation.isPending ? \"salvando...\" : \"salvar vers√≠culo\"}\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":4034,"size_tokens":null},"client/src/components/admin/AdminSettings.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { SiteSetting } from \"@shared/schema\";\n\nexport default function AdminSettings() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    key: \"\",\n    value: \"\",\n    type: \"text\",\n  });\n\n  const { data: settingsData } = useQuery<{ settings: SiteSetting[] }>({\n    queryKey: ['/api/admin/settings'],\n  });\n\n  const upsertMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/settings\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/settings'] });\n      setFormData({ key: \"\", value: \"\", type: \"text\" });\n      toast({ title: \"Configura√ß√£o atualizada com sucesso!\" });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    upsertMutation.mutate(formData);\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"lowercase\">nova configura√ß√£o</CardTitle>\n          <CardDescription className=\"lowercase\">adicionar ou editar configura√ß√£o do site</CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"key\" className=\"lowercase\">chave</Label>\n              <Input\n                id=\"key\"\n                value={formData.key}\n                onChange={(e) => setFormData({ ...formData, key: e.target.value })}\n                placeholder=\"ex: primary_color\"\n                required\n                data-testid=\"input-setting-key\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"value\" className=\"lowercase\">valor</Label>\n              <Input\n                id=\"value\"\n                value={formData.value}\n                onChange={(e) => setFormData({ ...formData, value: e.target.value })}\n                placeholder=\"Digite o valor...\"\n                required\n                data-testid=\"input-setting-value\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"type\" className=\"lowercase\">tipo</Label>\n              <Select\n                value={formData.type}\n                onValueChange={(value) => setFormData({ ...formData, type: value })}\n              >\n                <SelectTrigger data-testid=\"select-setting-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"text\">Texto</SelectItem>\n                  <SelectItem value=\"color\">Cor</SelectItem>\n                  <SelectItem value=\"boolean\">Boolean</SelectItem>\n                  <SelectItem value=\"number\">N√∫mero</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <Button type=\"submit\" className=\"lowercase w-full sm:w-auto\" disabled={upsertMutation.isPending} data-testid=\"button-save-setting\">\n              salvar configura√ß√£o\n            </Button>\n          </form>\n        </CardContent>\n      </Card>\n\n      <div className=\"space-y-3\">\n        <h3 className=\"text-base font-medium lowercase px-1\">configura√ß√µes atuais</h3>\n        {settingsData?.settings && settingsData.settings.length > 0 ? (\n          <div className=\"space-y-3\">\n            {settingsData.settings.map((setting) => (\n              <Card key={setting.id}>\n                <CardContent className=\"p-4\">\n                  <div className=\"space-y-1\">\n                    <div className=\"flex items-center justify-between gap-2\">\n                      <h4 className=\"font-medium lowercase truncate\">{setting.key}</h4>\n                      <span className=\"text-xs text-muted-foreground lowercase flex-shrink-0\">{setting.type}</span>\n                    </div>\n                    <p className=\"text-sm text-muted-foreground truncate\">{setting.value}</p>\n                  </div>\n                </CardContent>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card>\n            <CardContent className=\"p-6 text-center\">\n              <p className=\"text-sm text-muted-foreground lowercase\">nenhuma configura√ß√£o cadastrada</p>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":4950,"size_tokens":null},"client/src/components/admin/AdminBanners.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Plus, \n  Edit, \n  Trash2, \n  Image as ImageIcon,\n  MoveUp,\n  MoveDown,\n  Eye,\n  EyeOff,\n  Palette,\n  Megaphone,\n  Upload,\n  X,\n  Loader2,\n  Layout,\n  Type,\n  ChevronDown\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport BannerForm from \"./BannerForm\";\nimport ContentCardForm from \"./ContentCardForm\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport type { ContentCard } from \"@shared/schema\";\nimport { useRef } from \"react\";\n\ninterface Banner {\n  id: string;\n  title: string;\n  subtitle: string;\n  ctaText: string | null;\n  ctaLink: string | null;\n  productId: string | null;\n  imageUrl: string;\n  position: string;\n  showText: boolean;\n  sortOrder: number;\n  isActive: boolean;\n}\n\ntype BannerSection = \"carousel\" | \"cards\" | \"cta\";\n\nexport default function AdminBanners() {\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [activeSection, setActiveSection] = useState<BannerSection>(\"carousel\");\n  const [showForm, setShowForm] = useState(false);\n  const [editingBanner, setEditingBanner] = useState<Banner | null>(null);\n  const [deletingBanner, setDeletingBanner] = useState<Banner | null>(null);\n  const [editingCard, setEditingCard] = useState<ContentCard | null>(null);\n  const [isUploadingCta, setIsUploadingCta] = useState(false);\n  const [ctaFormInitialized, setCtaFormInitialized] = useState(false);\n  const [ctaFormData, setCtaFormData] = useState({\n    tagLabel: \"\",\n    title: \"\",\n    description: \"\",\n    buttonText: \"\",\n    buttonBgColor: \"#ffffff\",\n  });\n\n  // Queries\n  const { data: bannersData, isLoading: isLoadingBanners } = useQuery<{ banners: Banner[] }>({\n    queryKey: ['/api/admin/banners'],\n  });\n\n  const { data: cardsData, isLoading: isLoadingCards } = useQuery<{ cards: ContentCard[] }>({\n    queryKey: ['/api/admin/content-cards'],\n  });\n\n  const { data: ctaData, isLoading: isLoadingCta } = useQuery<{ config: any }>({\n    queryKey: ['/api/admin/cta-banner'],\n  });\n\n  if (ctaData?.config && !ctaFormInitialized) {\n    setCtaFormInitialized(true);\n    setCtaFormData({\n      tagLabel: ctaData.config.tagLabel || \"\",\n      title: ctaData.config.title || \"\",\n      description: ctaData.config.description || \"\",\n      buttonText: ctaData.config.buttonText || \"\",\n      buttonBgColor: ctaData.config.buttonBgColor || \"#ffffff\",\n    });\n  }\n\n  // Mutations for Carousel\n  const deleteBannerMutation = useMutation({\n    mutationFn: async (bannerId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/banners/${bannerId}`);\n      if (!response.ok) throw new Error(\"Erro ao deletar banner\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/banners'] });\n      toast({\n        title: \"Banner deletado\",\n        description: \"O banner foi removido com sucesso.\",\n      });\n      setDeletingBanner(null);\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel deletar o banner.\",\n      });\n    },\n  });\n\n  const updateBannerOrderMutation = useMutation({\n    mutationFn: async ({ bannerId, newOrder }: { bannerId: string; newOrder: number }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/banners/${bannerId}`, {\n        sortOrder: newOrder,\n      });\n      if (!response.ok) throw new Error(\"Erro ao atualizar ordem\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.refetchQueries({ queryKey: ['/api/admin/banners'] });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar a ordem do banner.\",\n      });\n    },\n  });\n\n  const toggleActiveMutation = useMutation({\n    mutationFn: async ({ bannerId, isActive }: { bannerId: string; isActive: boolean }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/banners/${bannerId}`, {\n        isActive,\n      });\n      if (!response.ok) throw new Error(\"Erro ao atualizar status\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.refetchQueries({ queryKey: ['/api/admin/banners'] });\n      toast({\n        title: \"Status atualizado\",\n        description: \"O banner foi atualizado com sucesso.\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar o status do banner.\",\n      });\n    },\n  });\n\n  // Mutations for CTA\n  const updateCtaMutation = useMutation({\n    mutationFn: async (data: typeof ctaFormData) => {\n      const response = await apiRequest(\"PUT\", \"/api/admin/cta-banner\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n      toast({\n        title: \"Banner atualizado\",\n        description: \"As configura√ß√µes foram salvas com sucesso!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar o banner.\",\n      });\n    }\n  });\n\n  // CTA handlers\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setIsUploadingCta(true);\n    try {\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n\n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      if (sessionId) {\n        headers['x-session-id'] = sessionId;\n      }\n\n      const response = await fetch(\"/api/admin/cta-banner/image\", {\n        method: \"POST\",\n        headers,\n        body: uploadFormData,\n      });\n\n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n        toast({\n          title: \"Imagem atualizada\",\n          description: \"A imagem de fundo foi atualizada com sucesso!\",\n        });\n      } else {\n        throw new Error('Upload failed');\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    } finally {\n      setIsUploadingCta(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleRemoveCtaImage = async () => {\n    try {\n      const response = await apiRequest(\"PUT\", \"/api/admin/cta-banner\", {\n        backgroundImageUrl: null\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n        toast({\n          title: \"Imagem removida\",\n          description: \"A imagem de fundo foi removida.\",\n        });\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel remover a imagem.\",\n      });\n    }\n  };\n\n  const handleCtaSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateCtaMutation.mutate(ctaFormData);\n  };\n\n  // Carousel data\n  const banners = bannersData?.banners || [];\n  const sortedBanners = [...banners].sort((a, b) => (b.sortOrder || 0) - (a.sortOrder || 0));\n\n  // Cards data\n  const cards = cardsData?.cards || [];\n  const featureCard = cards.find(c => c.cardType === 'feature');\n  const lifestyleCard = cards.find(c => c.cardType === 'lifestyle');\n\n  // Carousel handlers\n  const handleEdit = (banner: Banner) => {\n    setEditingBanner(banner);\n    setShowForm(true);\n  };\n\n  const handleMoveUp = async (index: number) => {\n    if (index === 0) return;\n    \n    const current = sortedBanners[index];\n    const previous = sortedBanners[index - 1];\n    \n    // Simplificando a troca de ordens\n    const currentOrder = current.sortOrder ?? 0;\n    const previousOrder = previous.sortOrder ?? 0;\n\n    // Se as ordens forem iguais, for√ßamos uma diferen√ßa\n    const newCurrentOrder = currentOrder === previousOrder ? currentOrder + 1 : previousOrder;\n    const newPreviousOrder = currentOrder === previousOrder ? currentOrder : currentOrder;\n\n    try {\n      await apiRequest(\"PATCH\", `/api/admin/banners/${current.id}`, { sortOrder: newCurrentOrder });\n      await apiRequest(\"PATCH\", `/api/admin/banners/${previous.id}`, { sortOrder: newPreviousOrder });\n      \n      queryClient.invalidateQueries({ queryKey: ['/api/admin/banners'] });\n      toast({\n        title: \"Ordem atualizada\",\n        description: \"A posi√ß√£o do banner foi alterada.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar a ordem.\",\n      });\n    }\n  };\n\n  const handleMoveDown = async (index: number) => {\n    if (index === sortedBanners.length - 1) return;\n    \n    const current = sortedBanners[index];\n    const next = sortedBanners[index + 1];\n    \n    const currentOrder = current.sortOrder ?? 0;\n    const nextOrder = next.sortOrder ?? 0;\n\n    const newCurrentOrder = currentOrder === nextOrder ? currentOrder - 1 : nextOrder;\n    const newNextOrder = currentOrder === nextOrder ? currentOrder : currentOrder;\n\n    try {\n      await apiRequest(\"PATCH\", `/api/admin/banners/${current.id}`, { sortOrder: newCurrentOrder });\n      await apiRequest(\"PATCH\", `/api/admin/banners/${next.id}`, { sortOrder: newNextOrder });\n      \n      queryClient.invalidateQueries({ queryKey: ['/api/admin/banners'] });\n      toast({\n        title: \"Ordem atualizada\",\n        description: \"A posi√ß√£o do banner foi alterada.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar a ordem.\",\n      });\n    }\n  };\n\n  // Check if showing form\n  if (showForm && activeSection === \"carousel\") {\n    return (\n      <BannerForm\n        banner={editingBanner}\n        onClose={() => {\n          setShowForm(false);\n          setEditingBanner(null);\n        }}\n        onSuccess={() => {\n          setShowForm(false);\n          setEditingBanner(null);\n        }}\n      />\n    );\n  }\n\n  if (editingCard) {\n    return (\n      <ContentCardForm\n        card={editingCard}\n        onClose={() => setEditingCard(null)}\n        onSuccess={() => setEditingCard(null)}\n      />\n    );\n  }\n\n  // Main render\n  const isLoading = isLoadingBanners || isLoadingCards || isLoadingCta;\n  const currentCtaImage = ctaData?.config?.backgroundImageUrl;\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"space-y-4\">\n        <div className=\"min-w-0\">\n          <h1 className=\"text-2xl md:text-3xl font-light lowercase truncate\">gerenciar banners</h1>\n          <p className=\"text-sm text-muted-foreground lowercase\">configure todos os tipos de banners do site</p>\n        </div>\n\n        {/* Mobile Dropdown */}\n        <div className=\"block sm:hidden\">\n          <div className=\"relative\">\n            <select\n              value={activeSection}\n              onChange={(e) => setActiveSection(e.target.value as \"carousel\" | \"cards\" | \"cta\")}\n              className=\"w-full appearance-none bg-background border border-border rounded-md px-4 py-2.5 pr-10 text-sm lowercase focus:outline-none focus:ring-2 focus:ring-ring\"\n              data-testid=\"select-banner-section\"\n            >\n              <option value=\"carousel\">carrossel</option>\n              <option value=\"cards\">feature & lifestyle</option>\n              <option value=\"cta\">cta banner</option>\n            </select>\n            <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none\" />\n          </div>\n        </div>\n\n        {/* Desktop Tabs */}\n        <div className=\"hidden sm:flex gap-2 flex-wrap\">\n          <Button\n            variant={activeSection === \"carousel\" ? \"default\" : \"outline\"}\n            onClick={() => setActiveSection(\"carousel\")}\n            className=\"lowercase gap-2\"\n            data-testid=\"button-tab-carousel\"\n          >\n            <ImageIcon className=\"h-4 w-4\" />\n            carrossel\n          </Button>\n          <Button\n            variant={activeSection === \"cards\" ? \"default\" : \"outline\"}\n            onClick={() => setActiveSection(\"cards\")}\n            className=\"lowercase gap-2\"\n            data-testid=\"button-tab-cards\"\n          >\n            <Palette className=\"h-4 w-4\" />\n            feature & lifestyle\n          </Button>\n          <Button\n            variant={activeSection === \"cta\" ? \"default\" : \"outline\"}\n            onClick={() => setActiveSection(\"cta\")}\n            className=\"lowercase gap-2\"\n            data-testid=\"button-tab-cta\"\n          >\n            <Megaphone className=\"h-4 w-4\" />\n            cta banner\n          </Button>\n        </div>\n      </div>\n\n      {/* Carousel Section */}\n      {activeSection === \"carousel\" && (\n        <div className=\"space-y-4\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n            <div className=\"min-w-0\">\n              <h2 className=\"text-lg md:text-xl font-medium lowercase\">carrossel da home</h2>\n              <p className=\"text-sm text-muted-foreground lowercase\">criar, editar e organizar banners do carrossel</p>\n            </div>\n            <Button \n              onClick={() => setShowForm(true)}\n              className=\"gap-2 w-full sm:w-auto\"\n              data-testid=\"button-add-banner\"\n            >\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"lowercase\">adicionar</span>\n            </Button>\n          </div>\n\n          {isLoadingBanners ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-sm text-muted-foreground lowercase\">carregando banners...</p>\n            </div>\n          ) : sortedBanners.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <ImageIcon className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                <h3 className=\"text-base font-medium lowercase mb-2\">nenhum banner cadastrado</h3>\n                <p className=\"text-sm text-muted-foreground lowercase mb-4\">\n                  comece adicionando seu primeiro banner\n                </p>\n                <Button onClick={() => setShowForm(true)} className=\"gap-2\">\n                  <Plus className=\"h-4 w-4\" />\n                  <span className=\"lowercase\">adicionar banner</span>\n                </Button>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"grid gap-4\">\n              {sortedBanners.map((banner, index) => (\n                <Card key={banner.id} className=\"overflow-hidden hover-elevate transition-all cursor-pointer group\" onClick={() => handleEdit(banner)}>\n                  <CardContent className=\"p-0\">\n                    <div className=\"flex flex-col md:flex-row gap-4 p-4\">\n                      {/* Preview */}\n                      <div className=\"relative w-full md:w-48 h-32 bg-muted rounded overflow-hidden flex-shrink-0\">\n                        {banner.imageUrl ? (\n                          <img\n                            src={banner.imageUrl}\n                            alt={banner.title}\n                            className=\"w-full h-full object-cover\"\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                          />\n                        ) : (\n                          <div className=\"w-full h-full flex items-center justify-center\">\n                            <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Info */}\n                      <div className=\"flex-1 min-w-0\">\n                        <div className=\"flex items-start justify-between gap-2 mb-2\">\n                          <h3 className=\"font-medium text-lg lowercase truncate\">{banner.title}</h3>\n                          <div className=\"flex gap-1.5 flex-shrink-0 flex-wrap\">\n                            <Badge variant={banner.isActive ? \"default\" : \"secondary\"} className=\"lowercase rounded-full px-3 h-6 flex items-center\">\n                              {banner.isActive ? \"ativo\" : \"inativo\"}\n                            </Badge>\n                            <Badge variant=\"outline\" className=\"lowercase rounded-full px-3 h-6 flex items-center border-white/10\">\n                              texto: {banner.position}\n                            </Badge>\n                          </div>\n                        </div>\n                        <p className=\"text-sm text-muted-foreground lowercase line-clamp-2 mb-3 opacity-70\">\n                          {banner.subtitle}\n                        </p>\n                        {banner.ctaText && (\n                          <div className=\"inline-flex items-center gap-2 px-2.5 py-1 rounded-full bg-muted/30 border border-white/5\">\n                            <span className=\"text-[10px] font-bold text-primary lowercase tracking-wider\">{banner.ctaText}</span>\n                            <div className=\"w-1 h-1 rounded-full bg-muted-foreground/30\" />\n                            <span className=\"text-[10px] text-muted-foreground truncate max-w-[150px]\">\n                              {banner.productId ? `produto #${banner.productId.slice(0, 8)}...` : banner.ctaLink}\n                            </span>\n                          </div>\n                        )}\n                      </div>\n\n                      {/* Actions - Apple Style Floating Menu */}\n                      <div className=\"flex md:flex-row items-center gap-1 bg-muted/20 p-1 rounded-2xl border border-white/5 h-fit self-center\">\n                        <div className=\"flex items-center border-r border-white/10 pr-1 mr-1\">\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleMoveUp(index);\n                            }}\n                            disabled={index === 0}\n                            data-testid={`button-move-up-${banner.id}`}\n                            className=\"h-8 w-8 rounded-xl hover:bg-white/10\"\n                          >\n                            <MoveUp className=\"h-3.5 w-3.5\" />\n                          </Button>\n                          <Button\n                            size=\"icon\"\n                            variant=\"ghost\"\n                            onClick={(e) => {\n                              e.stopPropagation();\n                              handleMoveDown(index);\n                            }}\n                            disabled={index === sortedBanners.length - 1}\n                            data-testid={`button-move-down-${banner.id}`}\n                            className=\"h-8 w-8 rounded-xl hover:bg-white/10\"\n                          >\n                            <MoveDown className=\"h-3.5 w-3.5\" />\n                          </Button>\n                        </div>\n                        \n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            toggleActiveMutation.mutate({ \n                              bannerId: banner.id, \n                              isActive: !banner.isActive \n                            });\n                          }}\n                          data-testid={`button-toggle-${banner.id}`}\n                          className={`h-9 w-9 rounded-xl transition-all ${banner.isActive ? 'text-primary' : 'text-muted-foreground'}`}\n                        >\n                          {banner.isActive ? (\n                            <Eye className=\"h-4 w-4\" />\n                          ) : (\n                            <EyeOff className=\"h-4 w-4\" />\n                          )}\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            handleEdit(banner);\n                          }}\n                          data-testid={`button-edit-${banner.id}`}\n                          className=\"h-9 w-9 rounded-xl hover:bg-white/10\"\n                        >\n                          <Edit className=\"h-4 w-4\" />\n                        </Button>\n                        <Button\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={(e) => {\n                            e.stopPropagation();\n                            setDeletingBanner(banner);\n                          }}\n                          data-testid={`button-delete-${banner.id}`}\n                          className=\"h-9 w-9 rounded-xl hover:bg-destructive/10 hover:text-destructive\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Cards Section */}\n      {activeSection === \"cards\" && (\n        <div className=\"space-y-4\">\n          <div>\n            <h2 className=\"text-lg md:text-xl font-medium lowercase\">cards de conte√∫do</h2>\n            <p className=\"text-sm text-muted-foreground lowercase\">\n              edite os 2 banners fixos da home (feature e lifestyle)\n            </p>\n          </div>\n\n          {isLoadingCards ? (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {[1, 2].map((i) => (\n                <Card key={i} className=\"overflow-hidden\">\n                  <CardHeader className=\"border-b bg-muted/30\">\n                    <div className=\"h-6 w-32 bg-muted animate-pulse rounded\" />\n                  </CardHeader>\n                  <div className=\"aspect-video bg-muted animate-pulse\" />\n                  <CardContent className=\"p-4 space-y-3\">\n                    <div className=\"h-4 w-3/4 bg-muted animate-pulse rounded\" />\n                    <div className=\"h-3 w-1/2 bg-muted animate-pulse rounded\" />\n                    <div className=\"h-10 w-full bg-muted animate-pulse rounded\" />\n                  </CardContent>\n                </Card>\n              ))}\n            </div>\n          ) : (\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n              {/* Feature Card */}\n              <Card className=\"overflow-hidden\">\n                <CardHeader className=\"border-b bg-muted/30\">\n                  <div className=\"flex items-center gap-2\">\n                    <Palette className=\"h-5 w-5\" />\n                    <CardTitle className=\"text-lg lowercase\">feature banner</CardTitle>\n                  </div>\n                </CardHeader>\n                {featureCard ? (\n                  <>\n                    <div className=\"aspect-video bg-muted overflow-hidden\">\n                      <img\n                        src={featureCard.imageUrl}\n                        alt={featureCard.title || 'Feature Banner'}\n                        className=\"w-full h-full object-cover\"\n                        loading=\"lazy\"\n                        decoding=\"async\"\n                      />\n                    </div>\n                    <CardContent className=\"p-4 space-y-3\">\n                      <div className=\"space-y-1\">\n                        <h3 className=\"font-medium lowercase\">\n                          {featureCard.title || 'sem t√≠tulo'}\n                        </h3>\n                        {featureCard.subtitle && (\n                          <p className=\"text-sm text-muted-foreground lowercase\">\n                            {featureCard.subtitle}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div className={`h-2 w-2 rounded-full ${featureCard.isActive ? 'bg-green-500' : 'bg-muted-foreground'}`} />\n                        <span className=\"text-xs text-muted-foreground lowercase\">\n                          {featureCard.isActive ? 'ativo' : 'inativo'}\n                        </span>\n                      </div>\n                      <Button \n                        onClick={() => setEditingCard(featureCard)}\n                        className=\"w-full lowercase\"\n                        data-testid=\"button-edit-feature\"\n                      >\n                        <Edit className=\"h-4 w-4 mr-2\" />\n                        editar\n                      </Button>\n                    </CardContent>\n                  </>\n                ) : (\n                  <CardContent className=\"p-12 text-center\">\n                    <ImageIcon className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                    <p className=\"text-muted-foreground lowercase mb-4\">\n                      feature banner n√£o configurado\n                    </p>\n                    <p className=\"text-xs text-muted-foreground lowercase mb-4\">\n                      este banner precisa ser criado no banco de dados\n                    </p>\n                  </CardContent>\n                )}\n              </Card>\n\n              {/* Lifestyle Card */}\n              <Card className=\"overflow-hidden\">\n                <CardHeader className=\"border-b bg-muted/30\">\n                  <div className=\"flex items-center gap-2\">\n                    <ImageIcon className=\"h-5 w-5\" />\n                    <CardTitle className=\"text-lg lowercase\">lifestyle banner</CardTitle>\n                  </div>\n                </CardHeader>\n                {lifestyleCard ? (\n                  <>\n                    <div className=\"aspect-video bg-muted overflow-hidden\">\n                      <img\n                        src={lifestyleCard.imageUrl}\n                        alt={lifestyleCard.title || 'Lifestyle Banner'}\n                        className=\"w-full h-full object-cover\"\n                        loading=\"lazy\"\n                        decoding=\"async\"\n                      />\n                    </div>\n                    <CardContent className=\"p-4 space-y-3\">\n                      <div className=\"space-y-1\">\n                        <h3 className=\"font-medium lowercase\">\n                          {lifestyleCard.title || 'sem t√≠tulo'}\n                        </h3>\n                        {lifestyleCard.subtitle && (\n                          <p className=\"text-sm text-muted-foreground lowercase\">\n                            {lifestyleCard.subtitle}\n                          </p>\n                        )}\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <div className={`h-2 w-2 rounded-full ${lifestyleCard.isActive ? 'bg-green-500' : 'bg-muted-foreground'}`} />\n                        <span className=\"text-xs text-muted-foreground lowercase\">\n                          {lifestyleCard.isActive ? 'ativo' : 'inativo'}\n                        </span>\n                      </div>\n                      <Button \n                        onClick={() => setEditingCard(lifestyleCard)}\n                        className=\"w-full lowercase\"\n                        data-testid=\"button-edit-lifestyle\"\n                      >\n                        <Edit className=\"h-4 w-4 mr-2\" />\n                        editar\n                      </Button>\n                    </CardContent>\n                  </>\n                ) : (\n                  <CardContent className=\"p-12 text-center\">\n                    <ImageIcon className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n                    <p className=\"text-muted-foreground lowercase mb-4\">\n                      lifestyle banner n√£o configurado\n                    </p>\n                    <p className=\"text-xs text-muted-foreground lowercase mb-4\">\n                      este banner precisa ser criado no banco de dados\n                    </p>\n                  </CardContent>\n                )}\n              </Card>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* CTA Section */}\n      {activeSection === \"cta\" && (\n        <div className=\"space-y-10 animate-in fade-in slide-in-from-bottom-4 duration-700 pb-20\">\n          <div>\n            <h2 className=\"text-3xl font-light lowercase tracking-tight\">banner cta</h2>\n            <p className=\"text-sm text-muted-foreground lowercase opacity-70\">configurar o banner \"ver todos os produtos\"</p>\n          </div>\n\n          {isLoadingCta ? (\n            <div className=\"flex flex-col items-center justify-center py-20 gap-4\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground lowercase\">carregando configura√ß√µes...</p>\n            </div>\n          ) : (\n            <div className=\"space-y-8\">\n              {/* Preview & Image Upload - Full Width */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 px-1\">\n                  <Layout className=\"h-4 w-4 text-muted-foreground\" />\n                  <h3 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">visualiza√ß√£o e imagem</h3>\n                </div>\n\n                <Card className=\"overflow-hidden border-white/5 bg-muted/20 backdrop-blur-sm transition-all hover:bg-muted/30 rounded-[2rem]\">\n                  <CardContent className=\"p-0\">\n                    {currentCtaImage ? (\n                      <div className=\"relative group aspect-[21/9]\">\n                        <img\n                          src={currentCtaImage}\n                          alt=\"Banner background\"\n                          className=\"w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105\"\n                          loading=\"lazy\"\n                          decoding=\"async\"\n                        />\n                        <div className=\"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center gap-3\">\n                          <Button\n                            variant=\"secondary\"\n                            size=\"sm\"\n                            className=\"rounded-full bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/20 lowercase\"\n                            onClick={() => fileInputRef.current?.click()}\n                            disabled={isUploadingCta}\n                          >\n                            <Upload className=\"h-4 w-4 mr-2\" />\n                            {isUploadingCta ? \"enviando...\" : \"trocar imagem\"}\n                          </Button>\n                          <Button\n                            variant=\"destructive\"\n                            size=\"sm\"\n                            className=\"rounded-full backdrop-blur-md border-white/10 hover:bg-destructive/80 lowercase\"\n                            onClick={handleRemoveCtaImage}\n                          >\n                            <X className=\"h-4 w-4 mr-2\" />\n                            remover\n                          </Button>\n                        </div>\n                        \n                        <div className=\"absolute inset-0 flex flex-col items-center justify-center p-8 text-center pointer-events-none\">\n                          {ctaFormData.tagLabel && (\n                            <span className=\"text-[10px] uppercase tracking-[0.2em] text-white/70 mb-2 drop-shadow-md\">{ctaFormData.tagLabel}</span>\n                          )}\n                          <h3 className=\"text-2xl md:text-3xl font-light text-white mb-2 drop-shadow-lg lowercase\">{ctaFormData.title}</h3>\n                          <p className=\"text-xs text-white/80 max-w-md line-clamp-2 drop-shadow-md lowercase\">{ctaFormData.description}</p>\n                        </div>\n                      </div>\n                    ) : (\n                      <div\n                        className=\"aspect-[21/9] flex flex-col items-center justify-center cursor-pointer group\"\n                        onClick={() => fileInputRef.current?.click()}\n                      >\n                        <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-500\">\n                          <Upload className=\"h-6 w-6 text-muted-foreground group-hover:text-primary transition-colors\" />\n                        </div>\n                        <p className=\"text-sm font-medium lowercase mb-1\">clique para upload</p>\n                        <p className=\"text-xs text-muted-foreground lowercase text-center px-4\">recomendado: 1920x800px para tela cheia</p>\n                      </div>\n                    )}\n                  </CardContent>\n                </Card>\n                \n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleImageUpload}\n                  className=\"hidden\"\n                />\n              </div>\n\n              {/* Configuration Form - Full Width */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 px-1\">\n                  <Type className=\"h-4 w-4 text-muted-foreground\" />\n                  <h3 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">textos e estilos</h3>\n                </div>\n\n                <form onSubmit={handleCtaSubmit} className=\"rounded-[2rem] bg-muted/10 border border-white/5 backdrop-blur-sm p-6 sm:p-8 space-y-0\">\n                  <div className=\"grid gap-5 sm:grid-cols-2\">\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"tagLabel\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">label superior</Label>\n                      <Input\n                        id=\"tagLabel\"\n                        value={ctaFormData.tagLabel}\n                        onChange={(e) => setCtaFormData({ ...ctaFormData, tagLabel: e.target.value })}\n                        placeholder=\"ex: cole√ß√£o completa\"\n                        className=\"bg-muted/20 border-white/5 rounded-2xl h-12 px-5 lowercase focus:bg-muted/30 transition-all\"\n                        data-testid=\"input-cta-tag-label\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"title\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1 text-primary/70\">t√≠tulo *</Label>\n                      <Input\n                        id=\"title\"\n                        value={ctaFormData.title}\n                        onChange={(e) => setCtaFormData({ ...ctaFormData, title: e.target.value })}\n                        placeholder=\"ex: explore toda a cole√ß√£o\"\n                        required\n                        className=\"bg-muted/20 border-white/5 rounded-2xl h-12 px-5 lowercase focus:bg-muted/30 transition-all\"\n                        data-testid=\"input-cta-title\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2 sm:col-span-2\">\n                      <Label htmlFor=\"description\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">descri√ß√£o</Label>\n                      <Textarea\n                        id=\"description\"\n                        value={ctaFormData.description}\n                        onChange={(e) => setCtaFormData({ ...ctaFormData, description: e.target.value })}\n                        placeholder=\"ex: descubra pe√ßas √∫nicas...\"\n                        rows={2}\n                        className=\"bg-muted/20 border-white/5 rounded-2xl px-5 py-3 lowercase focus:bg-muted/30 transition-all resize-none leading-relaxed\"\n                        data-testid=\"input-cta-description\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"buttonText\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1 text-primary/70\">texto do bot√£o *</Label>\n                      <Input\n                        id=\"buttonText\"\n                        value={ctaFormData.buttonText}\n                        onChange={(e) => setCtaFormData({ ...ctaFormData, buttonText: e.target.value })}\n                        placeholder=\"ex: ver todos os produtos\"\n                        required\n                        className=\"bg-muted/20 border-white/5 rounded-2xl h-12 px-5 lowercase focus:bg-muted/30 transition-all\"\n                        data-testid=\"input-cta-button-text\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-2\">\n                      <Label htmlFor=\"buttonBgColor\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">cor do bot√£o</Label>\n                      <div className=\"flex gap-3 items-center\">\n                        <Input\n                          id=\"buttonBgColor\"\n                          type=\"color\"\n                          value={ctaFormData.buttonBgColor}\n                          onChange={(e) => setCtaFormData({ ...ctaFormData, buttonBgColor: e.target.value })}\n                          className=\"w-12 h-12 p-1 bg-muted/20 border-white/5 rounded-2xl cursor-pointer shrink-0\"\n                          data-testid=\"input-cta-button-color\"\n                        />\n                        <div className=\"flex-1 space-y-1\">\n                          <Input\n                            value={ctaFormData.buttonBgColor}\n                            onChange={(e) => setCtaFormData({ ...ctaFormData, buttonBgColor: e.target.value })}\n                            placeholder=\"#ffffff\"\n                            className=\"bg-muted/20 border-white/5 rounded-2xl h-12 px-4 lowercase text-xs tracking-widest\"\n                          />\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  <div className=\"pt-6 mt-6 border-t border-white/5 flex items-center justify-end gap-3\">\n                    <Button\n                      type=\"button\"\n                      variant=\"ghost\"\n                      onClick={() => setCtaFormData({\n                        tagLabel: ctaData?.config?.tagLabel || \"\",\n                        title: ctaData?.config?.title || \"\",\n                        description: ctaData?.config?.description || \"\",\n                        buttonText: ctaData?.config?.buttonText || \"\",\n                        buttonBgColor: ctaData?.config?.buttonBgColor || \"#ffffff\",\n                      })}\n                      className=\"rounded-2xl lowercase\"\n                    >\n                      cancelar\n                    </Button>\n                    <Button\n                      type=\"submit\"\n                      disabled={updateCtaMutation.isPending}\n                      className=\"rounded-2xl lowercase\"\n                      data-testid=\"button-save-cta-config\"\n                    >\n                      {updateCtaMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : null}\n                      salvar configura√ß√µes\n                    </Button>\n                  </div>\n                </form>\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Delete Dialog */}\n      <AlertDialog open={!!deletingBanner} onOpenChange={() => setDeletingBanner(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"lowercase\">deletar banner?</AlertDialogTitle>\n            <AlertDialogDescription className=\"lowercase\">\n              tem certeza que deseja deletar \"{deletingBanner?.title}\"? esta a√ß√£o n√£o pode ser desfeita.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"lowercase\" data-testid=\"button-cancel-delete\">cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingBanner && deleteBannerMutation.mutate(deletingBanner.id)}\n              className=\"lowercase\"\n              data-testid=\"button-confirm-delete\"\n            >\n              deletar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":41793,"size_tokens":null},"client/src/pages/AdminLogin.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ArrowRight } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport logoSvg from \"@/assets/logo.svg\";\n\nexport default function AdminLogin() {\n  const [username, setUsername] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [isLoading, setIsLoading] = useState(false);\n  const [, setLocation] = useLocation();\n  const { toast } = useToast();\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setIsLoading(true);\n\n    try {\n      const response = await apiRequest(\"POST\", \"/api/admin/login\", { username, password });\n\n      if (response.ok) {\n        const data = await response.json();\n        \n        // Store session token in localStorage\n        if (data.sessionId) {\n          localStorage.setItem('admin_session', data.sessionId);\n        }\n        \n        // Set query data immediately to avoid race condition\n        queryClient.setQueryData(['/api/admin/check'], { isAdmin: true });\n        \n        // Silent login success\n        \n        // Redirect after a small delay to ensure state is updated\n        setTimeout(() => {\n          setLocation(\"/admin\");\n        }, 100);\n      } else {\n        const data = await response.json();\n        toast({\n          variant: \"destructive\",\n          title: \"Erro no login\",\n          description: data.error || \"Credenciais inv√°lidas\",\n        });\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"Erro ao fazer login. Tente novamente.\",\n      });\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-6\">\n      <div className=\"w-full max-w-sm\">\n        <div className=\"flex justify-center mb-10\">\n          <img src={logoSvg} alt=\"oudla\" className=\"h-16 w-16 object-contain dark:invert\" />\n        </div>\n        <form onSubmit={handleSubmit} className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Input\n              id=\"username\"\n              type=\"password\"\n              value={username}\n              onChange={(e) => setUsername(e.target.value)}\n              className=\"h-12 bg-muted/50 border-0 focus-visible:ring-1\"\n              required\n              data-testid=\"input-admin-username\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Input\n              id=\"password\"\n              type=\"password\"\n              value={password}\n              onChange={(e) => setPassword(e.target.value)}\n              className=\"h-12 bg-muted/50 border-0 focus-visible:ring-1\"\n              required\n              data-testid=\"input-admin-password\"\n            />\n          </div>\n\n          <Button\n            type=\"submit\"\n            className=\"w-full h-12 group\"\n            disabled={isLoading}\n            data-testid=\"button-admin-login\"\n          >\n            {isLoading ? (\n              \"entrando...\"\n            ) : (\n              <span className=\"flex items-center justify-center gap-2\">\n                entrar\n                <ArrowRight className=\"h-4 w-4 transition-transform group-hover:translate-x-1\" />\n              </span>\n            )}\n          </Button>\n        </form>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":3516,"size_tokens":null},"client/src/components/admin/AdminProducts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Plus, \n  Edit, \n  Trash2, \n  Image as ImageIcon,\n  MoveUp,\n  MoveDown,\n  ChevronDown,\n  ChevronRight,\n  Shirt,\n  Package\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport ProductForm from \"./ProductForm\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\n\ninterface Product {\n  id: string;\n  sku?: string;\n  name: string;\n  description: string;\n  price: string;\n  originalPrice?: string;\n  productType: string;\n  category?: string;\n  colors?: string[];\n  sizes?: string[];\n  isNew: boolean;\n  isActive: boolean;\n  status?: string;\n  displayOrder: number;\n  customizableFront: boolean;\n  customizableBack: boolean;\n}\n\ninterface ProductImage {\n  id: string;\n  productId: string;\n  imageUrl: string;\n  altText?: string;\n  color?: string;\n  sortOrder: number;\n}\n\nexport default function AdminProducts() {\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editingProduct, setEditingProduct] = useState<Product | null>(null);\n  const [deletingProduct, setDeletingProduct] = useState<Product | null>(null);\n  const [productsOpen, setProductsOpen] = useState(false);\n  const [accessoriesOpen, setAccessoriesOpen] = useState(false);\n\n  const { data: productsData, isLoading } = useQuery<{ products: Product[] }>({\n    queryKey: ['/api/admin/products'],\n  });\n\n  const { data: imagesData } = useQuery<{ [productId: string]: ProductImage[] }>({\n    queryKey: ['/api/admin/products', 'images-all'],\n    queryFn: async () => {\n      if (!productsData?.products) return {};\n      \n      const imagesMap: { [productId: string]: ProductImage[] } = {};\n      \n      for (const product of productsData.products) {\n        const response = await fetch(`/api/admin/products/${product.id}`, {\n          credentials: 'include'\n        });\n        if (response.ok) {\n          const data = await response.json();\n          imagesMap[product.id] = data.product.images || [];\n        }\n      }\n      \n      return imagesMap;\n    },\n    enabled: !!productsData?.products,\n  });\n\n  const deleteProductMutation = useMutation({\n    mutationFn: async (productId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/products/${productId}`);\n      if (!response.ok) throw new Error(\"Erro ao deletar produto\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products'] });\n      toast({\n        title: \"Produto deletado\",\n        description: \"O produto foi removido com sucesso.\",\n      });\n      setDeletingProduct(null);\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel deletar o produto.\",\n      });\n    },\n  });\n\n  const updateDisplayOrderMutation = useMutation({\n    mutationFn: async ({ productId, newOrder }: { productId: string; newOrder: number }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/products/${productId}`, {\n        displayOrder: newOrder,\n      });\n      if (!response.ok) throw new Error(\"Erro ao atualizar ordem\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.refetchQueries({ queryKey: ['/api/admin/products'] });\n    },\n    onError: (error) => {\n      console.error(\"Erro ao atualizar ordem:\", error);\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar a ordem do produto.\",\n      });\n    },\n  });\n\n  const products = productsData?.products || [];\n  \n  // Separate products by type\n  const tshirts = products.filter(p => p.productType === 'tshirt');\n  const accessories = products.filter(p => p.productType === 'accessory');\n  \n  // Sort each category separately by displayOrder\n  const sortedTshirts = [...tshirts].sort((a, b) => (b.displayOrder || 0) - (a.displayOrder || 0));\n  const sortedAccessories = [...accessories].sort((a, b) => (b.displayOrder || 0) - (a.displayOrder || 0));\n\n  const handleEdit = async (product: Product) => {\n    try {\n      const response = await fetch(`/api/admin/products/${product.id}`, {\n        cache: 'no-store',\n        credentials: 'include'\n      });\n      if (response.ok) {\n        const data = await response.json();\n        setEditingProduct(data.product);\n        setShowForm(true);\n      } else {\n        toast({\n          variant: \"destructive\",\n          title: \"Erro\",\n          description: \"N√£o foi poss√≠vel carregar os detalhes do produto.\",\n        });\n      }\n    } catch (error) {\n      console.error(\"Error loading product:\", error);\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel carregar os detalhes do produto.\",\n        });\n    }\n  };\n\n  const handleDelete = (product: Product) => {\n    setDeletingProduct(product);\n  };\n\n  // New swap-based ordering that guarantees one-by-one movement\n  const handleMoveUp = async (productList: Product[], index: number) => {\n    console.log(\"üîº handleMoveUp chamado\", { index, totalItems: productList.length });\n    \n    if (index === 0) {\n      console.log(\"‚ö†Ô∏è J√° est√° no topo, nada a fazer\");\n      return;\n    }\n    \n    const currentProduct = productList[index];\n    const previousProduct = productList[index - 1];\n    \n    console.log(\"üîº Produtos:\", {\n      current: { id: currentProduct.id, name: currentProduct.name, order: currentProduct.displayOrder },\n      previous: { id: previousProduct.id, name: previousProduct.name, order: previousProduct.displayOrder }\n    });\n    \n    // Swap the displayOrder values\n    const currentOrder = currentProduct.displayOrder || 0;\n    const previousOrder = previousProduct.displayOrder || 0;\n    \n    try {\n      console.log(\"üîº Atualizando ordens...\");\n      // Update both products\n      await updateDisplayOrderMutation.mutateAsync({ \n        productId: currentProduct.id, \n        newOrder: previousOrder \n      });\n      \n      await updateDisplayOrderMutation.mutateAsync({ \n        productId: previousProduct.id, \n        newOrder: currentOrder \n      });\n      \n      console.log(\"‚úÖ Ordens atualizadas com sucesso\");\n      toast({\n        title: \"Ordem atualizada\",\n        description: \"O produto foi movido para cima.\",\n      });\n    } catch (error) {\n      console.error(\"‚ùå Erro ao mover produto:\", error);\n    }\n  };\n\n  const handleMoveDown = async (productList: Product[], index: number) => {\n    console.log(\"üîΩ handleMoveDown chamado\", { index, totalItems: productList.length });\n    \n    if (index === productList.length - 1) {\n      console.log(\"‚ö†Ô∏è J√° est√° no final, nada a fazer\");\n      return;\n    }\n    \n    const currentProduct = productList[index];\n    const nextProduct = productList[index + 1];\n    \n    console.log(\"üîΩ Produtos:\", {\n      current: { id: currentProduct.id, name: currentProduct.name, order: currentProduct.displayOrder },\n      next: { id: nextProduct.id, name: nextProduct.name, order: nextProduct.displayOrder }\n    });\n    \n    // Swap the displayOrder values\n    const currentOrder = currentProduct.displayOrder || 0;\n    const nextOrder = nextProduct.displayOrder || 0;\n    \n    try {\n      console.log(\"üîΩ Atualizando ordens...\");\n      // Update both products\n      await updateDisplayOrderMutation.mutateAsync({ \n        productId: currentProduct.id, \n        newOrder: nextOrder \n      });\n      \n      await updateDisplayOrderMutation.mutateAsync({ \n        productId: nextProduct.id, \n        newOrder: currentOrder \n      });\n      \n      console.log(\"‚úÖ Ordens atualizadas com sucesso\");\n      toast({\n        title: \"Ordem atualizada\",\n        description: \"O produto foi movido para baixo.\",\n      });\n    } catch (error) {\n      console.error(\"‚ùå Erro ao mover produto:\", error);\n    }\n  };\n\n  const renderProductCard = (product: Product, index: number, productList: Product[]) => {\n    const productImages = imagesData?.[product.id] || [];\n    const mainImage = productImages.find(img => img.sortOrder === 0) || productImages[0];\n\n    return (\n      <Card key={product.id} className=\"overflow-hidden hover-elevate transition-all cursor-pointer group\" data-testid={`card-product-${product.id}`} onClick={() => handleEdit(product)}>\n        <CardContent className=\"p-0 sm:p-4\">\n          {/* Mobile Layout - Vertical */}\n          <div className=\"sm:hidden\">\n            <div className=\"w-full h-48 bg-muted overflow-hidden\">\n              {mainImage ? (\n                <img\n                  src={mainImage.imageUrl}\n                  alt={product.name}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                />\n              ) : (\n                <div className=\"w-full h-full flex items-center justify-center\">\n                  <ImageIcon className=\"h-12 w-12 text-muted-foreground\" />\n                </div>\n              )}\n            </div>\n            \n            <div className=\"p-3 space-y-3\">\n              <div>\n                <div className=\"flex items-start justify-between gap-2 mb-1\">\n                  <div className=\"flex-1 min-w-0\">\n                    <h3 className=\"text-base font-medium lowercase truncate\" data-testid={`text-product-name-${product.id}`}>\n                      {product.name}\n                    </h3>\n                    {product.sku && (\n                      <p className=\"text-[10px] text-muted-foreground uppercase font-mono\">\n                        SKU: {product.sku}\n                      </p>\n                    )}\n                  </div>\n                  <div className=\"flex gap-1 flex-shrink-0\">\n                    {product.isNew && (\n                      <Badge variant=\"default\" className=\"lowercase text-xs\">novo</Badge>\n                    )}\n                    {product.status === \"draft\" && (\n                      <Badge variant=\"secondary\" className=\"lowercase text-xs\">rascunho</Badge>\n                    )}\n                    {product.status === \"published\" && (\n                      <Badge variant=\"outline\" className=\"lowercase text-xs text-green-600 border-green-600\">publicado</Badge>\n                    )}\n                  </div>\n                </div>\n                \n                <p className=\"text-sm text-muted-foreground lowercase line-clamp-2 mb-2\">\n                  {product.description}\n                </p>\n\n                <div className=\"flex flex-wrap items-center gap-x-3 gap-y-1 text-sm\">\n                  <div>\n                    <span className=\"font-medium\">R$ {product.price}</span>\n                    {product.originalPrice && (\n                      <span className=\"text-muted-foreground line-through ml-1 text-xs\">\n                        R$ {product.originalPrice}\n                      </span>\n                    )}\n                  </div>\n                  \n                  {productImages.length > 0 && (\n                    <div className=\"text-muted-foreground text-xs\">\n                      {productImages.length} {productImages.length === 1 ? 'imagem' : 'imagens'}\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleMoveUp(productList, index)}\n                  disabled={index === 0}\n                  className=\"flex-1 gap-1\"\n                  data-testid={`button-move-up-${product.id}`}\n                >\n                  <MoveUp className=\"h-4 w-4\" />\n                  <span className=\"lowercase\">subir</span>\n                </Button>\n                <Button\n                  size=\"sm\"\n                  variant=\"outline\"\n                  onClick={() => handleMoveDown(productList, index)}\n                  disabled={index === productList.length - 1}\n                  className=\"flex-1 gap-1\"\n                  data-testid={`button-move-down-${product.id}`}\n                >\n                  <MoveDown className=\"h-4 w-4\" />\n                  <span className=\"lowercase\">descer</span>\n                </Button>\n              </div>\n\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  onClick={() => handleEdit(product)}\n                  className=\"flex-1 gap-2\"\n                  data-testid={`button-edit-${product.id}`}\n                >\n                  <Edit className=\"h-4 w-4\" />\n                  <span className=\"lowercase\">editar</span>\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    handleDelete(product);\n                  }}\n                  className=\"flex-1 gap-2\"\n                  data-testid={`button-delete-${product.id}`}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                  <span className=\"lowercase\">deletar</span>\n                </Button>\n              </div>\n            </div>\n          </div>\n\n          {/* Desktop Layout - Horizontal */}\n          <div className=\"hidden sm:flex gap-4\">\n            <div className=\"w-24 h-24 bg-muted rounded-md flex-shrink-0 overflow-hidden\">\n              {mainImage ? (\n                <img\n                  src={mainImage.imageUrl}\n                  alt={product.name}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                />\n              ) : (\n                <div className=\"w-full h-full flex items-center justify-center\">\n                  <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n                </div>\n              )}\n            </div>\n\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex items-start gap-2 mb-1\">\n                <div className=\"flex-1 min-w-0\">\n                  <h3 className=\"text-base font-medium lowercase truncate\" data-testid={`text-product-name-${product.id}`}>\n                    {product.name}\n                  </h3>\n                  {product.sku && (\n                    <p className=\"text-[10px] text-muted-foreground uppercase font-mono\">\n                      SKU: {product.sku}\n                    </p>\n                  )}\n                </div>\n                <div className=\"flex gap-1 flex-shrink-0\">\n                  {product.isNew && (\n                    <Badge variant=\"default\" className=\"lowercase text-xs\">novo</Badge>\n                  )}\n                  {product.status === \"draft\" && (\n                    <Badge variant=\"secondary\" className=\"lowercase text-xs\">rascunho</Badge>\n                  )}\n                  {product.status === \"published\" && (\n                    <Badge variant=\"outline\" className=\"lowercase text-xs text-green-600 border-green-600\">publicado</Badge>\n                  )}\n                </div>\n              </div>\n              \n              <p className=\"text-sm text-muted-foreground lowercase line-clamp-2 mb-2\">\n                {product.description}\n              </p>\n\n              <div className=\"flex flex-wrap items-center gap-x-3 gap-y-1 text-sm\">\n                <div>\n                  <span className=\"font-medium\">R$ {product.price}</span>\n                  {product.originalPrice && (\n                    <span className=\"text-muted-foreground line-through ml-1 text-xs\">\n                      R$ {product.originalPrice}\n                    </span>\n                  )}\n                </div>\n                \n                {productImages.length > 0 && (\n                  <div className=\"text-muted-foreground\">\n                    {productImages.length} {productImages.length === 1 ? 'imagem' : 'imagens'}\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"grid grid-cols-2 gap-1 flex-shrink-0\">\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleMoveUp(productList, index);\n                }}\n                disabled={index === 0}\n                className=\"h-8 w-8\"\n                data-testid={`button-move-up-${product.id}`}\n              >\n                <MoveUp className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleMoveDown(productList, index);\n                }}\n                disabled={index === productList.length - 1}\n                className=\"h-8 w-8\"\n                data-testid={`button-move-down-${product.id}`}\n              >\n                <MoveDown className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleEdit(product);\n                }}\n                className=\"h-8 w-8\"\n                data-testid={`button-edit-${product.id}`}\n              >\n                <Edit className=\"h-4 w-4\" />\n              </Button>\n              <Button\n                size=\"icon\"\n                variant=\"ghost\"\n                onClick={(e) => {\n                  e.stopPropagation();\n                  handleDelete(product);\n                }}\n                className=\"h-8 w-8\"\n                data-testid={`button-delete-${product.id}`}\n              >\n                <Trash2 className=\"h-4 w-4\" />\n              </Button>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  };\n\n  if (showForm) {\n    return (\n      <div className=\"fixed inset-0 z-50 bg-background overflow-y-auto\">\n        <div className=\"min-h-full\">\n          <ProductForm\n            key={editingProduct?.id || 'new'}\n            product={editingProduct}\n            onClose={() => {\n              setShowForm(false);\n              setEditingProduct(null);\n            }}\n            onSuccess={() => {\n              setShowForm(false);\n              setEditingProduct(null);\n            }}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3\">\n        <div className=\"min-w-0\">\n          <h1 className=\"text-2xl md:text-3xl font-light lowercase truncate\">gerenciar produtos</h1>\n          <p className=\"text-sm text-muted-foreground lowercase\">criar, editar e organizar produtos</p>\n        </div>\n        <Button \n          onClick={() => setShowForm(true)}\n          className=\"gap-2 w-full sm:w-auto\"\n          data-testid=\"button-add-product\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          <span className=\"lowercase\">adicionar</span>\n        </Button>\n      </div>\n\n      {isLoading ? (\n        <div className=\"text-center py-12\">\n          <p className=\"text-sm text-muted-foreground lowercase\">carregando produtos...</p>\n        </div>\n      ) : products.length === 0 ? (\n        <Card>\n          <CardContent className=\"py-12 text-center\">\n            <Package className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n            <h3 className=\"text-base font-medium lowercase mb-2\">nenhum produto cadastrado</h3>\n            <p className=\"text-sm text-muted-foreground lowercase mb-4\">\n              comece adicionando seu primeiro produto\n            </p>\n            <Button onClick={() => setShowForm(true)} className=\"gap-2\">\n              <Plus className=\"h-4 w-4\" />\n              <span className=\"lowercase\">adicionar produto</span>\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <div className=\"space-y-4\">\n          {/* Camisetas Section */}\n          <Collapsible open={productsOpen} onOpenChange={setProductsOpen}>\n            <Card>\n              <CollapsibleTrigger className=\"w-full\" data-testid=\"collapsible-trigger-tshirts\">\n                <CardContent className=\"p-4 flex items-center justify-between hover-elevate\">\n                  <div className=\"flex items-center gap-3\">\n                    <Shirt className=\"h-5 w-5 text-muted-foreground\" />\n                    <div className=\"text-left\">\n                      <h2 className=\"text-lg font-medium lowercase\">produtos</h2>\n                      <p className=\"text-sm text-muted-foreground lowercase\">\n                        {sortedTshirts.length} {sortedTshirts.length === 1 ? 'item' : 'itens'}\n                      </p>\n                    </div>\n                  </div>\n                  {productsOpen ? (\n                    <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n                  ) : (\n                    <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n                  )}\n                </CardContent>\n              </CollapsibleTrigger>\n              \n              <CollapsibleContent>\n                <div className=\"px-4 pb-4 space-y-3\">\n                  {sortedTshirts.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground text-center py-8 lowercase\">\n                      nenhum produto cadastrado\n                    </p>\n                  ) : (\n                    sortedTshirts.map((product, index) => renderProductCard(product, index, sortedTshirts))\n                  )}\n                </div>\n              </CollapsibleContent>\n            </Card>\n          </Collapsible>\n\n          {/* Accessories Section */}\n          <Collapsible open={accessoriesOpen} onOpenChange={setAccessoriesOpen}>\n            <Card>\n              <CollapsibleTrigger className=\"w-full\" data-testid=\"collapsible-trigger-accessories\">\n                <CardContent className=\"p-4 flex items-center justify-between hover-elevate\">\n                  <div className=\"flex items-center gap-3\">\n                    <Package className=\"h-5 w-5 text-muted-foreground\" />\n                    <div className=\"text-left\">\n                      <h2 className=\"text-lg font-medium lowercase\">acess√≥rios</h2>\n                      <p className=\"text-sm text-muted-foreground lowercase\">\n                        {sortedAccessories.length} {sortedAccessories.length === 1 ? 'item' : 'itens'}\n                      </p>\n                    </div>\n                  </div>\n                  {accessoriesOpen ? (\n                    <ChevronDown className=\"h-5 w-5 text-muted-foreground\" />\n                  ) : (\n                    <ChevronRight className=\"h-5 w-5 text-muted-foreground\" />\n                  )}\n                </CardContent>\n              </CollapsibleTrigger>\n              \n              <CollapsibleContent>\n                <div className=\"px-4 pb-4 space-y-3\">\n                  {sortedAccessories.length === 0 ? (\n                    <p className=\"text-sm text-muted-foreground text-center py-8 lowercase\">\n                      nenhum acess√≥rio cadastrado\n                    </p>\n                  ) : (\n                    sortedAccessories.map((product, index) => renderProductCard(product, index, sortedAccessories))\n                  )}\n                </div>\n              </CollapsibleContent>\n            </Card>\n          </Collapsible>\n        </div>\n      )}\n\n      <AlertDialog open={!!deletingProduct} onOpenChange={() => setDeletingProduct(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"lowercase\">deletar produto?</AlertDialogTitle>\n            <AlertDialogDescription className=\"lowercase\">\n              tem certeza que deseja deletar \"{deletingProduct?.name}\"? esta a√ß√£o n√£o pode ser desfeita.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"lowercase\" data-testid=\"button-cancel-delete\">cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingProduct && deleteProductMutation.mutate(deletingProduct.id)}\n              className=\"lowercase\"\n              data-testid=\"button-confirm-delete\"\n            >\n              deletar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24927,"size_tokens":null},"server/types/express-session.d.ts":{"content":"import 'express-session';\n\ndeclare module 'express-session' {\n  interface SessionData {\n    isAdmin?: boolean;\n    userId?: string;\n    adminUsername?: string;\n  }\n}\n","path":null,"size_bytes":166,"size_tokens":null},"client/src/components/admin/ProductForm.tsx":{"content":"import { useState, useRef, useEffect, useMemo } from \"react\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { \n  Collapsible,\n  CollapsibleContent,\n  CollapsibleTrigger,\n} from \"@/components/ui/collapsible\";\nimport type { Color } from \"@shared/schema\";\nimport SizeChartEditor from \"./SizeChartEditor\";\nimport AdminProductReviews from \"./AdminProductReviews\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { \n  ArrowLeft, \n  Upload, \n  X,\n  Plus,\n  Trash2,\n  Image as ImageIcon,\n  ChevronDown,\n  ChevronUp,\n  ExternalLink,\n  Palette,\n  GripVertical\n} from \"lucide-react\";\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface ProductFormProps {\n  product?: any;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nconst productSchema = z.object({\n  sku: z.string().optional().nullable(),\n  slug: z.string().optional().nullable(),\n  name: z.string().min(1, \"Nome √© obrigat√≥rio\"),\n  description: z.string().min(1, \"Descri√ß√£o √© obrigat√≥ria\"),\n  price: z.string().min(1, \"Pre√ßo √© obrigat√≥rio\"),\n  originalPrice: z.string().optional(),\n  productType: z.enum([\"tshirt\", \"accessory\"]),\n  category: z.string().optional(),\n  isNew: z.boolean().default(false),\n  displayOrder: z.number().default(0),\n  customizable: z.boolean().default(false),\n  customizableFront: z.boolean().default(false),\n  customizableBack: z.boolean().default(false),\n  fabricTech: z.string().optional(),\n  fabricDescription: z.string().optional(),\n  careInstructions: z.string().optional(),\n  sizeChartImage: z.string().optional().nullable(),\n  sizesEnabled: z.boolean().default(false),\n  sizeChartEnabled: z.boolean().default(false),\n  fabricsEnabled: z.boolean().default(false),\n  reviewsEnabled: z.boolean().default(false),\n  status: z.enum([\"draft\", \"published\"]).default(\"draft\"),\n  previewToken: z.string().optional().nullable(),\n  rating: z.union([z.string(), z.number()]).optional(),\n  reviewsCount: z.union([z.string(), z.number()]).optional(),\n  userCity: z.string().optional(),\n  showInstallments: z.boolean().default(false),\n  installmentsMax: z.union([z.string(), z.number()]).default(12),\n  installmentsValue: z.union([z.string(), z.number()]).optional().nullable(),\n  installmentsInterestFree: z.boolean().default(true),\n  sectionLabel: z.string().optional().nullable(),\n  sectionTitle: z.string().optional().nullable(),\n  sectionSubtitle: z.string().optional().nullable(),\n}).refine((data) => {\n  if (data.customizable) {\n    return data.customizableFront || data.customizableBack;\n  }\n  return true;\n}, {\n  message: \"selecione pelo menos uma posi√ß√£o para a estampa (frente ou costas)\",\n  path: [\"customizable\"],\n});\n\ntype ProductFormData = z.infer<typeof productSchema>;\n\nconst AVAILABLE_SIZES = [\"Infantil\", \"PP\", \"P\", \"M\", \"G\", \"GG\", \"XG\", \"2XG\", \"3XG\"];\n\nexport default function ProductForm({ product, onClose, onSuccess }: ProductFormProps) {\n  const { toast } = useToast();\n  const [images, setImages] = useState<any[]>(product?.images || []);\n  const [colors, setColors] = useState<Color[]>([]);\n  const [fabrics, setFabrics] = useState<any[]>([]);\n  const [installmentOptions, setInstallmentOptions] = useState<any[]>([]);\n\n  // Load installment options if editing\n  useEffect(() => {\n    if (product?.id) {\n      fetch(`/api/products/${product.id}/installments`)\n        .then(res => res.json())\n        .then(data => {\n          if (Array.isArray(data)) {\n            setInstallmentOptions(data);\n          }\n        })\n        .catch(err => console.error(\"Error loading installments:\", err));\n    }\n  }, [product?.id]);\n\n  const [newColorName, setNewColorName] = useState(\"\");\n  const [newColorHex, setNewColorHex] = useState(\"#\");\n  const [newFabricName, setNewFabricName] = useState(\"\");\n  const [newFabricPrice, setNewFabricPrice] = useState(\"\");\n  const [selectedSizes, setSelectedSizes] = useState<string[]>(product?.sizes || []);\n  const [sizeChartImage, setSizeChartImage] = useState<string | null>(product?.sizeChartImage || null);\n  const [activeImageTab, setActiveImageTab] = useState<string>(\"presentation\");\n  const [uploadColorSelection, setUploadColorSelection] = useState<string>(\"presentation\");\n  const [previewImage, setPreviewImage] = useState<string | null>(null);\n  const [openSections, setOpenSections] = useState<Record<string, boolean>>({\n    basic: false,\n    images: false,\n    colors: false,\n    sizes: false,\n    options: false,\n    customizable: false,\n    fabric: false,\n    sizeChart: false,\n    reviews: false,\n    installments: false,\n    sectionTexts: false,\n  });\n\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const sizeChartInputRef = useRef<HTMLInputElement>(null);\n  const colorPickerRef = useRef<HTMLInputElement>(null);\n  const initializedRef = useRef<string | null>(null);\n\n  const form = useForm<ProductFormData>({\n    resolver: zodResolver(productSchema),\n    defaultValues: {\n      sku: product?.sku || \"\",\n      slug: product?.slug || \"\",\n      name: product?.name || \"\",\n      description: product?.description || \"\",\n      price: product?.price || \"\",\n      originalPrice: product?.originalPrice || \"\",\n      productType: product?.productType || \"tshirt\",\n      category: product?.category || \"\",\n      isNew: product?.isNew || false,\n      displayOrder: product?.displayOrder || 0,\n      customizable: product?.customizable || false,\n      customizableFront: product?.customizableFront || false,\n      customizableBack: product?.customizableBack || false,\n      fabricTech: product?.fabricTech?.join(\", \") || \"\",\n      fabricDescription: product?.fabricDescription || \"\",\n      careInstructions: product?.careInstructions || \"\",\n      sizeChartImage: product?.sizeChartImage || null,\n      sizesEnabled: product?.sizesEnabled || false,\n      sizeChartEnabled: product?.sizeChartEnabled || false,\n      fabricsEnabled: product?.fabricsEnabled || false,\n      reviewsEnabled: product?.reviewsEnabled || false,\n      status: product?.status || \"draft\",\n      previewToken: product?.previewToken || null,\n      rating: product?.rating || \"4.5\",\n      reviewsCount: product?.reviewsCount?.toString() || \"0\",\n      installmentsMax: product?.installmentsMax || 12,\n      installmentsValue: product?.installmentsValue || null,\n      installmentsInterestFree: product?.installmentsInterestFree !== false,\n      sectionLabel: product?.sectionLabel || \"\",\n      sectionTitle: product?.sectionTitle || \"\",\n      sectionSubtitle: product?.sectionSubtitle || \"\",\n    },\n  });\n\n  useEffect(() => {\n    const productId = product?.id || null;\n    console.log(\"üü£ [INIT_EFFECT] useEffect rodou! product?:\", !!product, \"initializedRef:\", initializedRef.current, \"productId:\", productId);\n    if (product && initializedRef.current !== productId) {\n      initializedRef.current = productId;\n      console.log(\"üü£ [INIT_EFFECT] Inicializando dados do produto. Colors raw:\", typeof product.colors, product.colors);\n      let parsedColors: Color[] = [];\n      \n      if (product.colors) {\n        if (typeof product.colors === 'string') {\n          try {\n            const parsed = JSON.parse(product.colors);\n            if (Array.isArray(parsed) && parsed[0]?.name && parsed[0]?.hex) {\n              parsedColors = parsed;\n            } else if (Array.isArray(parsed) && typeof parsed[0] === 'string') {\n              parsedColors = parsed.map((hex: string) => ({ name: hex, hex }));\n            }\n          } catch {\n            parsedColors = [];\n          }\n        } else if (Array.isArray(product.colors)) {\n          if (product.colors[0]?.name && product.colors[0]?.hex) {\n            parsedColors = product.colors;\n          } else if (typeof product.colors[0] === 'string') {\n            parsedColors = product.colors.map((hex: string) => ({ name: hex, hex }));\n          }\n        }\n      }\n      \n      setColors(parsedColors);\n\n      let parsedFabrics: any[] = [];\n      if (product.fabrics) {\n        if (typeof product.fabrics === 'string') {\n          try {\n            parsedFabrics = JSON.parse(product.fabrics);\n          } catch {\n            parsedFabrics = [];\n          }\n        } else if (Array.isArray(product.fabrics)) {\n          parsedFabrics = product.fabrics;\n        }\n      }\n      setFabrics(parsedFabrics);\n\n      setImages(product.images || []);\n      setSizeChartImage(product.sizeChartImage || null);\n      setSelectedSizes(product.sizes || []);\n      form.reset({\n        sku: product.sku || \"\",\n        slug: product.slug || \"\",\n        name: product.name || \"\",\n        description: product.description || \"\",\n        price: product.price || \"\",\n        originalPrice: product.originalPrice || \"\",\n        productType: product.productType || \"tshirt\",\n        category: product.category || \"\",\n        isNew: product.isNew || false,\n        displayOrder: product.displayOrder || 0,\n        customizable: product.customizable || false,\n        customizableFront: product.customizableFront || false,\n        customizableBack: product.customizableBack || false,\n        fabricTech: product.fabricTech?.join(\", \") || \"\",\n        fabricDescription: product.fabricDescription || \"\",\n        careInstructions: product.careInstructions || \"\",\n        sizeChartImage: product.sizeChartImage || null,\n        sizesEnabled: product.sizesEnabled || false,\n        sizeChartEnabled: product.sizeChartEnabled || false,\n        fabricsEnabled: product.fabricsEnabled || false,\n        showInstallments: product.showInstallments === true,\n        reviewsEnabled: product.reviewsEnabled || false,\n        status: product.status || \"draft\",\n        previewToken: product.previewToken || null,\n        rating: product.rating || \"4.5\",\n        reviewsCount: product.reviewsCount?.toString() || \"0\",\n        installmentsMax: product.installmentsMax || 12,\n        installmentsValue: product.installmentsValue || null,\n        installmentsInterestFree: product.installmentsInterestFree !== false,\n      });\n    }\n  }, [product]);\n\n  const createProductMutation = useMutation({\n    mutationFn: async (data: any) => {\n      console.log(\"üü° [MUTATION] mutationFn chamada!\");\n      console.log(\"üü° [MUTATION] data.colors:\", JSON.stringify(data.colors));\n      const endpoint = product ? `/api/admin/products/${product.id}` : \"/api/admin/products\";\n      const method = product ? \"PATCH\" : \"POST\";\n      console.log(\"üü° [MUTATION] Enviando para:\", method, endpoint);\n      const response = await apiRequest(method, endpoint, data);\n      console.log(\"üü° [MUTATION] Response status:\", response.status);\n      \n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"Erro ao salvar produto\");\n      }\n      \n      const result = await response.json();\n      \n      // Salvar op√ß√µes de parcelamento\n      const productId = product?.id || result.id || (result.product && result.product.id);\n      const showInstallments = data.showInstallments;\n      \n      if (productId && productId !== 'undefined' && showInstallments) {\n        await apiRequest(\"POST\", `/api/admin/products/${productId}/installments`, installmentOptions);\n      } else if (productId && productId !== 'undefined' && !showInstallments) {\n        console.log(\"Parcelamento desativado, pulando salvamento de op√ß√µes customizadas\");\n      }\n      \n      return result;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products'] });\n      if (product?.id) {\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/products', product.id] });\n      }\n      toast({\n        title: product ? \"produto atualizado\" : \"produto criado\",\n        description: \"as altera√ß√µes foram salvas com sucesso.\",\n      });\n      if (!product) {\n        onSuccess();\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel salvar o produto.\",\n      });\n    },\n  });\n\n  const uploadImageMutation = useMutation({\n    mutationFn: async (file: File) => {\n      if (!product?.id) {\n        throw new Error(\"salve o produto primeiro antes de adicionar imagens\");\n      }\n      const formData = new FormData();\n      formData.append('image', file);\n      \n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      \n      if (sessionId) {\n        headers['x-session-id'] = sessionId;\n      }\n      \n      const response = await fetch(`/api/admin/products/${product.id}/upload`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include',\n        headers,\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"erro ao fazer upload\");\n      }\n      return response.json();\n    },\n    onSuccess: async (data) => {\n      const imageType = uploadColorSelection === \"presentation\" ? \"presentation\" : \"carousel\";\n      const color = uploadColorSelection === \"presentation\" ? null : uploadColorSelection;\n      \n      try {\n        const result = await updateImageMetadataMutation.mutateAsync({\n          imageId: data.image.id,\n          imageType,\n          color: color || null,\n        });\n        \n        setImages([...images, result.image]);\n        toast({\n          title: \"imagem adicionada\",\n          description: \"a imagem foi carregada com sucesso.\",\n        });\n      } catch (error) {\n        console.error(\"Erro ao atualizar metadata:\", error);\n        toast({\n          variant: \"destructive\",\n          title: \"erro\",\n          description: \"erro ao associar imagem √† cor.\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    },\n  });\n\n  const updateImageMetadataMutation = useMutation({\n    mutationFn: async ({ imageId, imageType, color }: { imageId: string; imageType: string; color: string | null }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/products/images/${imageId}`, {\n        imageType,\n        color: color || null,\n      });\n      if (!response.ok) throw new Error(\"erro ao atualizar imagem\");\n      return response.json();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel atualizar a imagem.\",\n      });\n    },\n  });\n\n  const deleteImageMutation = useMutation({\n    mutationFn: async (imageId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/products/images/${imageId}`);\n      if (!response.ok) throw new Error(\"erro ao deletar imagem\");\n      return response.json();\n    },\n    onSuccess: (_, imageId) => {\n      setImages(images.filter(img => img.id !== imageId));\n      toast({\n        title: \"imagem removida\",\n        description: \"a imagem foi deletada com sucesso.\",\n      });\n    },\n  });\n\n  const updateImageOrderMutation = useMutation({\n    mutationFn: async ({ imageId, newOrder }: { imageId: string; newOrder: number }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/products/images/${imageId}`, {\n        sortOrder: newOrder,\n      });\n      if (!response.ok) throw new Error(\"erro ao reordenar\");\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"ordem alterada\",\n        description: \"a ordem das imagens foi atualizada.\",\n      });\n    },\n  });\n\n  const uploadSizeChartMutation = useMutation({\n    mutationFn: async (file: File) => {\n      if (!product?.id) {\n        throw new Error(\"salve o produto primeiro\");\n      }\n      const formData = new FormData();\n      formData.append('image', file);\n      \n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      \n      if (sessionId) {\n        headers['x-session-id'] = sessionId;\n      }\n      \n      const response = await fetch(`/api/admin/products/${product.id}/upload-size-chart`, {\n        method: 'POST',\n        body: formData,\n        credentials: 'include',\n        headers,\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.error || \"erro ao fazer upload\");\n      }\n      return response.json();\n    },\n    onSuccess: (data) => {\n      setSizeChartImage(data.sizeChartImage);\n      form.setValue('sizeChartImage', data.sizeChartImage);\n      toast({\n        title: \"tabela de medidas adicionada\",\n        description: \"a imagem foi carregada com sucesso.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel fazer upload.\",\n      });\n    },\n  });\n\n  const onSubmit = (data: ProductFormData) => {\n    console.log(\"üü¢ [SUBMIT] onSubmit chamado!\");\n    console.log(\"üü¢ [SUBMIT] colors state atual:\", JSON.stringify(colors));\n    console.log(\"üü¢ [SUBMIT] colors.length:\", colors.length);\n    console.log(\"üü¢ [SUBMIT] showInstallments:\", data.showInstallments);\n    console.log(\"üü¢ [SUBMIT] installmentOptions.length:\", installmentOptions.length);\n    if (data.customizable && !data.customizableFront && !data.customizableBack) {\n      toast({\n        variant: \"destructive\",\n        title: \"erro de valida√ß√£o\",\n        description: \"quando a posi√ß√£o das estampas est√° ativa, selecione pelo menos frente ou costas.\",\n      });\n      return;\n    }\n\n    // Validate custom installments only if installments are enabled\n    const showInstallments = data.showInstallments;\n    if (showInstallments) {\n      if (installmentOptions.length === 0) {\n        toast({\n          variant: \"destructive\",\n          title: \"erro de valida√ß√£o\",\n          description: \"quando o parcelamento est√° ativo, cadastre pelo menos uma parcela.\",\n        });\n        return;\n      }\n      const emptyInstallments = installmentOptions.filter(opt => opt.customValue === null || opt.customValue === \"\");\n      if (emptyInstallments.length > 0) {\n        toast({\n          variant: \"destructive\",\n          title: \"erro de valida√ß√£o\",\n          description: \"por favor, preencha o valor de todas as parcelas personalizadas ou remova as que n√£o ser√£o usadas.\",\n        });\n        return;\n      }\n    }\n\n    const submitData = {\n      ...data,\n      colors: colors,\n      fabrics: fabrics,\n      sizes: selectedSizes,\n      fabricTech: data.fabricTech ? data.fabricTech.split(',').map(t => t.trim()) : [],\n      rating: data.rating ? Number(data.rating) : 4.5,\n      reviewsCount: data.reviewsCount ? Number(data.reviewsCount) : 0,\n      installmentsMax: data.installmentsMax ? Number(data.installmentsMax) : 12,\n      installmentsValue: data.installmentsValue ? Number(data.installmentsValue) : null,\n    };\n\n    console.log(\"üü¢ [SUBMIT] submitData.colors:\", JSON.stringify(submitData.colors));\n    console.log(\"üü¢ [SUBMIT] submitData completo keys:\", Object.keys(submitData));\n    console.log(\"üü¢ [SUBMIT] chamando createProductMutation.mutate...\");\n\n    const onError = (errors: any) => {\n      console.log(\"üî¥ [SUBMIT] Form Errors:\", errors);\n      const errorMessages = Object.entries(errors)\n        .map(([key, value]: [string, any]) => {\n          if (value.message) return value.message;\n          if (value.root?.message) return value.root.message;\n          return null;\n        })\n        .filter(Boolean);\n\n      if (errorMessages.length > 0) {\n        toast({\n          variant: \"destructive\",\n          title: \"erro de valida√ß√£o\",\n          description: errorMessages[0] as string,\n        });\n      } else {\n        toast({\n          variant: \"destructive\",\n          title: \"erro\",\n          description: \"por favor, verifique os campos obrigat√≥rios.\",\n        });\n      }\n    };\n\n    createProductMutation.mutate(submitData);\n  };\n\n  const handleAddColor = () => {\n    console.log(\"üîµ [ADD_COLOR] Tentando adicionar cor:\", { name: newColorName, hex: newColorHex });\n    console.log(\"üîµ [ADD_COLOR] Colors antes:\", JSON.stringify(colors));\n    const hex = newColorHex.trim().toUpperCase();\n    if (!newColorName.trim() || hex.length !== 7) {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: \"preencha o nome e um c√≥digo hex v√°lido (#RRGGBB)\",\n      });\n      return;\n    }\n    const newColor = { name: newColorName.trim(), hex };\n    const newColors = [...colors, newColor];\n    console.log(\"üîµ [ADD_COLOR] Colors depois:\", JSON.stringify(newColors));\n    setColors(newColors);\n    setNewColorName(\"\");\n    setNewColorHex(\"#\");\n  };\n\n  const handleRemoveColor = (index: number) => {\n    setColors(colors.filter((_, i) => i !== index));\n  };\n\n  const handleMoveColor = (index: number, direction: 'up' | 'down') => {\n    const newColors = [...colors];\n    const targetIndex = direction === 'up' ? index - 1 : index + 1;\n    if (targetIndex < 0 || targetIndex >= newColors.length) return;\n    [newColors[index], newColors[targetIndex]] = [newColors[targetIndex], newColors[index]];\n    setColors(newColors);\n  };\n\n  const handleAddFabric = () => {\n    if (!newFabricName.trim()) {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: \"preencha o nome do tecido\",\n      });\n      return;\n    }\n    const newFabric = { \n      name: newFabricName, \n      description: \"\", \n      price: newFabricPrice ? parseFloat(newFabricPrice) : 0 \n    };\n    setFabrics([...fabrics, newFabric]);\n    setNewFabricName(\"\");\n    setNewFabricPrice(\"\");\n  };\n\n  const handleRemoveFabric = (index: number) => {\n    setFabrics(fabrics.filter((_, i) => i !== index));\n  };\n\n  const handleToggleSize = (size: string) => {\n    setSelectedSizes(prev =>\n      prev.includes(size)\n        ? prev.filter(s => s !== size)\n        : [...prev, size]\n    );\n  };\n\n  const toggleSection = (section: string) => {\n    setOpenSections(prev => ({\n      ...prev,\n      [section]: !prev[section]\n    }));\n  };\n\n  const productType = form.watch(\"productType\");\n  const currentPrice = form.watch(\"price\");\n  const originalPrice = form.watch(\"originalPrice\");\n\n  const discountPercentage = useMemo(() => {\n    const price = parseFloat(currentPrice || \"0\");\n    const original = parseFloat(originalPrice || \"0\");\n    if (price > 0 && original > 0 && original > price) {\n      return Math.round(((original - price) / original) * 100);\n    }\n    return null;\n  }, [currentPrice, originalPrice]);\n\n  return (\n    <div className=\"w-full\">\n      {/* Header Sticky */}\n      <Form {...form}>\n        <div className=\"sticky top-0 z-50 bg-background/95 backdrop-blur-xl border-b py-3 mb-5 px-4 sm:px-6\">\n          <div className=\"flex items-center gap-2\">\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={onClose}\n              data-testid=\"button-back\"\n              className=\"flex-shrink-0\"\n            >\n              <ArrowLeft className=\"h-4 w-4\" />\n            </Button>\n            <h1 className=\"text-sm font-light lowercase truncate flex-1\">\n              {product ? \"editar\" : \"novo\"} produto\n            </h1>\n            <FormField\n              control={form.control}\n              name=\"status\"\n              render={({ field }) => (\n                <FormItem className=\"flex items-center space-y-0\">\n                  <FormControl>\n                    <Select onValueChange={field.onChange} defaultValue={field.value}>\n                      <SelectTrigger className=\"h-9 w-[105px] rounded-lg text-xs border-0 bg-muted/50 lowercase\">\n                        <SelectValue placeholder=\"Status\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"draft\" className=\"text-xs lowercase\">rascunho</SelectItem>\n                        <SelectItem value=\"published\" className=\"text-xs lowercase\">publicado</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </FormControl>\n                </FormItem>\n              )}\n            />\n            {product && (\n              <Button\n                variant=\"outline\"\n                size=\"icon\"\n                className=\"flex-shrink-0 rounded-lg\"\n                asChild\n              >\n                <a \n                  href={`/${product.slug || product.sku || product.id}${product.previewToken ? `?preview=${product.previewToken}` : ''}`} \n                  target=\"_blank\" \n                  rel=\"noopener noreferrer\"\n                  data-testid=\"button-view-product\"\n                >\n                  <ExternalLink className=\"h-3.5 w-3.5\" />\n                </a>\n              </Button>\n            )}\n            <Button\n              onClick={() => {\n                form.handleSubmit(onSubmit, (errors) => {\n                  const firstError = Object.values(errors)[0];\n                  if (firstError?.message) {\n                    toast({\n                      variant: \"destructive\",\n                      title: \"erro de valida√ß√£o\",\n                      description: firstError.message as string,\n                    });\n                  }\n                })();\n              }}\n              disabled={createProductMutation.isPending}\n              className=\"lowercase flex-shrink-0 rounded-lg px-4\"\n              size=\"sm\"\n              data-testid=\"button-save-product-header\"\n            >\n              {createProductMutation.isPending ? \"salvando...\" : product ? \"salvar\" : \"criar\"}\n            </Button>\n          </div>\n        </div>\n\n        <form onSubmit={form.handleSubmit(onSubmit, (errors) => {\n          console.log(\"Validation Errors:\", errors);\n          const firstError = Object.values(errors)[0];\n          if (firstError?.message) {\n            toast({\n              variant: \"destructive\",\n              title: \"erro de valida√ß√£o\",\n              description: firstError.message as string,\n            });\n          }\n        })} className=\"px-4 sm:px-6 space-y-3\">\n          \n          {/* Basic Info */}\n          <Collapsible open={openSections.basic} onOpenChange={() => toggleSection('basic')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                  <CardTitle className=\"text-sm lowercase\">informa√ß√µes b√°sicas</CardTitle>\n                  <ChevronDown className={`h-4 w-4 transition-transform ${openSections.basic ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"slug\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">URL personalizada (slug)</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        value={field.value || \"\"}\n                        placeholder=\"ex: camiseta-teste\" \n                        data-testid=\"input-product-slug\" \n                        className=\"lowercase border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                        onChange={(e) => {\n                          const value = e.target.value.toLowerCase().replace(/\\s+/g, '-').replace(/[^a-z0-9-]/g, '');\n                          field.onChange(value);\n                        }}\n                      />\n                    </FormControl>\n                    <FormDescription className=\"text-xs text-muted-foreground/70 lowercase\">\n                      o link do produto ser√°: {window.location.host}/{field.value || 'seu-slug'}\n                    </FormDescription>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"sku\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">SKU (c√≥digo de refer√™ncia)</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        value={field.value || \"\"}\n                        placeholder=\"ex: CAM-PR-P\" \n                        data-testid=\"input-product-sku\" \n                        className=\"uppercase border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\" \n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"name\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">nome</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        value={field.value || \"\"}\n                        placeholder=\"ex: camiseta oudla\" \n                        data-testid=\"input-product-name\" \n                        className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"description\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">descri√ß√£o</FormLabel>\n                    <FormControl>\n                      <Textarea \n                        {...field} \n                        value={field.value || \"\"}\n                        placeholder=\"descreva...\" \n                        rows={2} \n                        data-testid=\"input-product-description\" \n                        className=\"border-0 bg-muted/50 rounded-xl px-4 py-3 text-sm focus-visible:ring-1 min-h-[80px]\"\n                      />\n                    </FormControl>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              <FormField\n                control={form.control}\n                name=\"productType\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">tipo</FormLabel>\n                    <Select onValueChange={field.onChange} value={field.value || \"\"}>\n                      <FormControl>\n                        <SelectTrigger data-testid=\"select-product-type\" className=\"h-11 rounded-xl text-sm border-0 bg-muted/50 px-4\">\n                          <SelectValue placeholder=\"selecione o tipo\" />\n                        </SelectTrigger>\n                      </FormControl>\n                      <SelectContent>\n                        <SelectItem value=\"tshirt\">camiseta</SelectItem>\n                        <SelectItem value=\"accessory\">acess√≥rio</SelectItem>\n                      </SelectContent>\n                    </Select>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {productType === \"accessory\" && (\n                <FormField\n                  control={form.control}\n                  name=\"category\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-medium lowercase\">categoria</FormLabel>\n                    <FormControl>\n                      <Input \n                        {...field} \n                        value={field.value || \"\"}\n                        placeholder=\"ex: bon√©s\" \n                        data-testid=\"input-product-category\" \n                        className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                      />\n                    </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              )}\n\n              <div className=\"space-y-2\">\n                <FormField\n                  control={form.control}\n                  name=\"price\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-medium lowercase\">pre√ßo (R$)</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          value={field.value || \"\"}\n                          type=\"number\" \n                          step=\"0.01\" \n                          placeholder=\"0.00\" \n                          data-testid=\"input-product-price\" \n                          className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"originalPrice\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-medium lowercase\">pre√ßo original</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          value={field.value || \"\"}\n                          type=\"number\" \n                          step=\"0.01\" \n                          placeholder=\"0.00\" \n                          data-testid=\"input-product-original-price\" \n                          className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                        />\n                      </FormControl>\n                      {discountPercentage && (\n                        <FormDescription className=\"text-xs lowercase text-primary font-medium\">\n                          desconto de {discountPercentage}%\n                        </FormDescription>\n                      )}\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Options */}\n          <Collapsible open={openSections.options} onOpenChange={() => toggleSection('options')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                  <CardTitle className=\"text-sm lowercase\">configura√ß√µes</CardTitle>\n                  <ChevronDown className={`h-4 w-4 transition-transform ${openSections.options ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"showInstallments\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">mostrar parcelamento</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch checked={field.value} onCheckedChange={field.onChange} data-testid=\"switch-show-installments\" />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"customizable\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">posi√ß√£o das estampas</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch \n                        checked={field.value} \n                        onCheckedChange={(checked) => {\n                          field.onChange(checked);\n                          if (!checked) {\n                            form.setValue(\"customizableFront\", false);\n                            form.setValue(\"customizableBack\", false);\n                          }\n                        }} \n                        data-testid=\"switch-customizable\" \n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"sizesEnabled\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">habilitar tamanhos</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch \n                        checked={field.value} \n                        onCheckedChange={field.onChange} \n                        data-testid=\"switch-sizes-enabled\" \n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"sizeChartEnabled\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">tabela de medidas</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch \n                        checked={field.value} \n                        onCheckedChange={field.onChange} \n                        data-testid=\"switch-size-chart-enabled\" \n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"fabricsEnabled\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">escolha de tecidos</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch \n                        checked={field.value} \n                        onCheckedChange={field.onChange} \n                        data-testid=\"switch-fabrics-enabled\" \n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"reviewsEnabled\"\n                render={({ field }) => (\n                  <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                    <div className=\"space-y-0.5\">\n                      <FormLabel className=\"text-sm lowercase font-medium\">habilitar avalia√ß√µes</FormLabel>\n                    </div>\n                    <FormControl>\n                      <Switch \n                        checked={field.value} \n                        onCheckedChange={field.onChange} \n                        data-testid=\"switch-reviews-enabled\" \n                        className=\"data-[state=checked]:bg-primary\"\n                      />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Installments - Aparece apenas quando ativado */}\n          {form.watch(\"showInstallments\") && (\n            <Collapsible open={openSections.installments} onOpenChange={() => toggleSection('installments')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">parcelamento</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.installments ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n              <div className=\"grid grid-cols-2 gap-3\">\n                <FormField\n                  control={form.control}\n                  name=\"installmentsMax\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-medium lowercase\">m√°x. parcelas</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          type=\"number\" \n                          min={1} \n                          max={24}\n                          onChange={(e) => field.onChange(parseInt(e.target.value) || 12)}\n                          data-testid=\"input-product-installments-max\" \n                          className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                <FormField\n                  control={form.control}\n                  name=\"installmentsValue\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-sm font-medium lowercase\">valor da parcela (opcional)</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          type=\"number\" \n                          step=\"0.01\"\n                          placeholder=\"valor fixo\"\n                          value={field.value || \"\"}\n                          onChange={(e) => field.onChange(e.target.value ? parseFloat(e.target.value) : null)}\n                          data-testid=\"input-product-installments-value\" \n                          className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\"\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n              </div>\n\n              <FormField\n                control={form.control}\n                name=\"installmentsInterestFree\"\n                render={({ field }) => (\n                  <FormItem className=\"flex flex-col justify-end py-3\">\n                    <div className=\"flex items-center space-x-2\">\n                      <FormControl>\n                        <Checkbox\n                          checked={field.value}\n                          onCheckedChange={field.onChange}\n                          data-testid=\"checkbox-product-installments-interest-free\"\n                        />\n                      </FormControl>\n                      <FormLabel className=\"text-sm lowercase font-medium cursor-pointer\">sem juros</FormLabel>\n                    </div>\n                    <FormMessage />\n                  </FormItem>\n                )}\n              />\n\n              {/* Custom Installments Editor */}\n              <div className=\"border-t pt-4 mt-4 space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <h4 className=\"text-sm font-medium lowercase\">parcelamento personalizado</h4>\n                  <Button \n                    type=\"button\" \n                    variant=\"outline\" \n                    className=\"rounded-xl h-9 lowercase\"\n                    onClick={() => {\n                      // Find the highest installment number and add 1\n                      const maxInstallments = installmentOptions.length > 0 \n                        ? Math.max(...installmentOptions.map(o => o.installments)) \n                        : 0;\n                      const nextNum = maxInstallments + 1;\n                      \n                      setInstallmentOptions([...installmentOptions, { \n                        installments: nextNum, \n                        isInterestFree: true,\n                        customValue: null \n                      }]);\n                    }}\n                  >\n                    <Plus className=\"h-3 w-3 mr-1\" /> adicionar parcela\n                  </Button>\n                </div>\n                \n                <div className=\"space-y-2\">\n                  {installmentOptions.sort((a,b) => a.installments - b.installments).map((opt, idx) => (\n                    <div key={idx} className=\"flex items-center gap-3 px-4 py-3.5 rounded-xl hover-elevate group\">\n                      <div className=\"flex-1 flex items-center gap-2\">\n                        <span className=\"text-sm text-muted-foreground w-8 font-medium\">{opt.installments}x</span>\n                        <Input \n                          type=\"number\" \n                          step=\"0.01\" \n                          placeholder=\"valor\" \n                          value={opt.customValue || \"\"} \n                          onChange={(e) => {\n                            const newOpts = [...installmentOptions];\n                            newOpts[idx].customValue = e.target.value ? parseFloat(e.target.value) : null;\n                            setInstallmentOptions(newOpts);\n                          }}\n                          className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 w-24\"\n                        />\n                      </div>\n                      <div className=\"flex items-center gap-2\">\n                        <Checkbox \n                          checked={opt.isInterestFree}\n                          onCheckedChange={(checked) => {\n                            const newOpts = [...installmentOptions];\n                            newOpts[idx].isInterestFree = !!checked;\n                            setInstallmentOptions(newOpts);\n                          }}\n                        />\n                        <span className=\"text-xs lowercase text-muted-foreground whitespace-nowrap\">sem acr√©scimo</span>\n                      </div>\n                      <Button \n                        type=\"button\" \n                        size=\"icon\" \n                        variant=\"ghost\" \n                        className=\"h-6 w-6\"\n                        onClick={() => {\n                          const filtered = installmentOptions.filter((_, i) => i !== idx);\n                          // Reorder installments to be sequential 1, 2, 3...\n                          const reordered = filtered\n                            .sort((a, b) => a.installments - b.installments)\n                            .map((opt, i) => ({\n                              ...opt,\n                              installments: i + 1\n                            }));\n                          setInstallmentOptions(reordered);\n                        }}\n                      >\n                        <Trash2 className=\"h-3 w-3\" />\n                      </Button>\n                    </div>\n                  ))}\n                  {installmentOptions.length === 0 && (\n                    <p className=\"text-xs text-muted-foreground text-center py-4 italic\">nenhuma parcela personalizada configurada</p>\n                  )}\n                </div>\n              </div>\n            </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          {/* Sizes */}\n          {form.watch(\"sizesEnabled\") && (\n            <Collapsible open={openSections.sizes} onOpenChange={() => toggleSection('sizes')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">tamanhos ({selectedSizes.length})</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.sizes ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n                <div className=\"grid grid-cols-3 gap-2.5\">\n                  {AVAILABLE_SIZES.map((size) => (\n                    <Button\n                      key={size}\n                      type=\"button\"\n                      onClick={() => handleToggleSize(size)}\n                      variant={selectedSizes.includes(size) ? \"default\" : \"outline\"}\n                      className=\"lowercase h-11 rounded-xl text-sm\"\n                    >\n                      {size}\n                    </Button>\n                  ))}\n                </div>\n              </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          {/* Size Chart - Aparece apenas quando ativado */}\n          {form.watch(\"sizeChartEnabled\") && product?.id && (\n            <Collapsible open={openSections.sizeChart} onOpenChange={() => toggleSection('sizeChart')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">tabela de medidas</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.sizeChart ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-6\">\n                <SizeChartEditor productId={product.id} selectedSizes={selectedSizes} />\n\n                <div className=\"border-t border-border/30 pt-5 space-y-4\">\n                  <p className=\"text-xs text-muted-foreground/60 lowercase\">imagem da tabela (opcional)</p>\n                  <input\n                    ref={sizeChartInputRef}\n                    type=\"file\"\n                    accept=\"image/*\"\n                    onChange={(e) => {\n                      if (e.target.files?.[0]) {\n                        uploadSizeChartMutation.mutate(e.target.files[0]);\n                      }\n                    }}\n                    className=\"hidden\"\n                    data-testid=\"input-size-chart\"\n                  />\n                  {sizeChartImage ? (\n                    <div className=\"space-y-3\">\n                      <div className=\"rounded-2xl overflow-hidden bg-muted/30\">\n                        <img src={sizeChartImage} alt=\"tabela de medidas\" className=\"w-full\" loading=\"lazy\" decoding=\"async\" />\n                      </div>\n                      <div className=\"flex gap-2\">\n                        <Button\n                          type=\"button\"\n                          onClick={() => sizeChartInputRef.current?.click()}\n                          className=\"flex-1 lowercase rounded-xl h-11 gap-2\"\n                          variant=\"outline\"\n                          disabled={uploadSizeChartMutation.isPending}\n                        >\n                          <Upload className=\"h-4 w-4\" />\n                          {uploadSizeChartMutation.isPending ? \"enviando...\" : \"trocar imagem\"}\n                        </Button>\n                        <Button\n                          type=\"button\"\n                          onClick={() => {\n                            setSizeChartImage(null);\n                            form.setValue('sizeChartImage', null);\n                          }}\n                          className=\"rounded-xl h-11 lowercase\"\n                          variant=\"ghost\"\n                          size=\"icon\"\n                        >\n                          <Trash2 className=\"h-4 w-4 text-destructive\" />\n                        </Button>\n                      </div>\n                    </div>\n                  ) : (\n                    <Button \n                      type=\"button\" \n                      onClick={() => sizeChartInputRef.current?.click()} \n                      className=\"w-full gap-2 lowercase rounded-xl h-11\"\n                      variant=\"outline\"\n                      disabled={uploadSizeChartMutation.isPending}\n                    >\n                      <Upload className=\"h-4 w-4\" />\n                      {uploadSizeChartMutation.isPending ? \"enviando...\" : \"enviar imagem da tabela\"}\n                    </Button>\n                  )}\n                </div>\n              </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          {/* Colors */}\n          <Collapsible open={openSections.colors} onOpenChange={() => toggleSection('colors')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-4 flex flex-row items-center justify-between gap-2 space-y-0\">\n                  <div className=\"flex items-center gap-3 flex-wrap\">\n                    <CardTitle className=\"text-sm lowercase\">cores</CardTitle>\n                    {colors.length > 0 && (\n                      <div className=\"flex items-center -space-x-1.5\">\n                        {colors.map((color, i) => (\n                          <div\n                            key={i}\n                            className=\"w-5 h-5 rounded-full ring-2 ring-background\"\n                            style={{ backgroundColor: color.hex }}\n                            title={color.name}\n                          />\n                        ))}\n                      </div>\n                    )}\n                  </div>\n                  <ChevronDown className={`h-4 w-4 transition-transform flex-shrink-0 ${openSections.colors ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-4 pb-2\">\n              {colors.length > 0 && (\n                <div className=\"space-y-1 mb-5\">\n                  {colors.map((color, i) => (\n                    <div\n                      key={i}\n                      className=\"flex items-center gap-4 px-4 py-3.5 rounded-xl group hover-elevate transition-colors\"\n                    >\n                      <div\n                        className=\"w-10 h-10 rounded-full ring-1 ring-border/30 flex-shrink-0 shadow-sm\"\n                        style={{ backgroundColor: color.hex }}\n                      />\n                      <div className=\"flex-1 min-w-0 flex flex-col gap-0.5\">\n                        <span className=\"text-sm lowercase font-medium leading-tight\">{color.name}</span>\n                        <span className=\"text-[11px] text-muted-foreground uppercase font-mono tracking-wider\">{color.hex}</span>\n                      </div>\n                      <div className=\"flex items-center gap-0.5 flex-shrink-0\">\n                        <Button\n                          type=\"button\"\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleMoveColor(i, 'up')}\n                          disabled={i === 0}\n                          className=\"invisible group-hover:visible\"\n                          data-testid={`button-move-color-up-${i}`}\n                        >\n                          <ChevronUp className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button\n                          type=\"button\"\n                          size=\"icon\"\n                          variant=\"ghost\"\n                          onClick={() => handleMoveColor(i, 'down')}\n                          disabled={i === colors.length - 1}\n                          className=\"invisible group-hover:visible\"\n                          data-testid={`button-move-color-down-${i}`}\n                        >\n                          <ChevronDown className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <button\n                          type=\"button\"\n                          onClick={() => handleRemoveColor(i)}\n                          className=\"invisible group-hover:visible text-muted-foreground/40 hover:text-destructive transition-all p-1.5 rounded-full\"\n                          data-testid={`button-remove-color-${i}`}\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n\n              {colors.length === 0 && (\n                <p className=\"text-center text-sm text-muted-foreground/60 lowercase py-8\">nenhuma cor adicionada</p>\n              )}\n\n              <div className=\"border-t border-border/40 pt-5 px-2\">\n                <input\n                  ref={colorPickerRef}\n                  type=\"color\"\n                  value={newColorHex.length === 7 ? newColorHex : '#000000'}\n                  onChange={(e) => setNewColorHex(e.target.value.toUpperCase())}\n                  className=\"sr-only\"\n                />\n                <div className=\"flex items-center gap-3\">\n                  <button\n                    type=\"button\"\n                    onClick={() => colorPickerRef.current?.click()}\n                    className=\"w-12 h-12 rounded-full ring-1 ring-border/30 flex-shrink-0 shadow-sm transition-all duration-200 relative group/picker cursor-pointer\"\n                    style={{ backgroundColor: newColorHex.length === 7 ? newColorHex : 'hsl(var(--muted))' }}\n                    data-testid=\"button-color-picker\"\n                  >\n                    <div className=\"absolute inset-0 rounded-full flex items-center justify-center bg-black/0 group-hover/picker:bg-black/20 transition-colors\">\n                      <Palette className=\"h-4 w-4 text-white opacity-0 group-hover/picker:opacity-100 transition-opacity drop-shadow-md\" />\n                    </div>\n                  </button>\n                  <div className=\"flex-1 flex flex-col gap-2\">\n                    <Input\n                      value={newColorName}\n                      onChange={(e) => setNewColorName(e.target.value)}\n                      placeholder=\"nome da cor\"\n                      className=\"text-sm h-11 border-0 bg-muted/50 rounded-xl px-4 focus-visible:ring-1 lowercase\"\n                      data-testid=\"input-color-name\"\n                    />\n                    <div className=\"flex gap-2\">\n                      <Input\n                        value={newColorHex}\n                        onChange={(e) => {\n                          let val = e.target.value.replace(/[^#0-9a-fA-F]/g, '');\n                          val = val.replace(/#/g, '');\n                          val = '#' + val.slice(0, 6);\n                          setNewColorHex(val);\n                        }}\n                        placeholder=\"#FFFFFF\"\n                        maxLength={7}\n                        className=\"text-sm h-11 w-32 border-0 bg-muted/50 rounded-xl px-4 uppercase font-mono tracking-wider focus-visible:ring-1\"\n                        data-testid=\"input-color-hex\"\n                      />\n                      <Button\n                        type=\"button\"\n                        onClick={handleAddColor}\n                        className=\"lowercase rounded-xl h-11 px-5 flex-1\"\n                        data-testid=\"button-add-color\"\n                      >\n                        adicionar\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Images */}\n          <Collapsible open={openSections.images} onOpenChange={() => toggleSection('images')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-4 flex flex-row items-center justify-between gap-2 space-y-0\">\n                  <div className=\"flex items-center gap-3 flex-wrap\">\n                    <CardTitle className=\"text-sm lowercase\">imagens</CardTitle>\n                    {images.length > 0 && (\n                      <span className=\"text-xs text-muted-foreground\">{images.length}</span>\n                    )}\n                  </div>\n                  <ChevronDown className={`h-4 w-4 transition-transform flex-shrink-0 ${openSections.images ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-4 pb-2 overflow-x-hidden\">\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={(e) => {\n                  if (e.target.files?.[0]) {\n                    uploadImageMutation.mutate(e.target.files[0]);\n                  }\n                }}\n                className=\"hidden\"\n                data-testid=\"input-product-image\"\n              />\n\n              <div className=\"px-2 mb-5\">\n                <div className=\"flex items-center gap-3\">\n                  <Select value={uploadColorSelection} onValueChange={setUploadColorSelection}>\n                    <SelectTrigger className=\"text-sm h-11 border-0 bg-muted/50 rounded-xl flex-1 px-4 focus:ring-1\">\n                      <SelectValue placeholder=\"categoria\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"presentation\">\n                        <span className=\"lowercase\">principal</span>\n                      </SelectItem>\n                      {colors.map((color) => (\n                        <SelectItem key={color.name} value={color.name}>\n                          <div className=\"flex items-center gap-2.5\">\n                            <div className=\"w-3.5 h-3.5 rounded-full ring-1 ring-border/30\" style={{ backgroundColor: color.hex }} />\n                            <span className=\"lowercase\">{color.name}</span>\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                  <Button \n                    type=\"button\" \n                    onClick={() => fileInputRef.current?.click()} \n                    className=\"gap-2.5 lowercase rounded-xl h-11 px-5 flex-shrink-0\" \n                    disabled={uploadImageMutation.isPending}\n                    data-testid=\"button-upload-image\"\n                  >\n                    <Upload className=\"h-4 w-4\" />\n                    {uploadImageMutation.isPending ? \"enviando...\" : \"enviar\"}\n                  </Button>\n                </div>\n              </div>\n\n              {images.length === 0 ? (\n                <p className=\"text-center text-sm text-muted-foreground/60 lowercase py-8\">nenhuma imagem adicionada</p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {/* Principal Images */}\n                  {(() => {\n                    const presentationImages = images.filter(img => img.imageType === \"presentation\").sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));\n                    return (\n                      <Collapsible defaultOpen={true}>\n                        <CollapsibleTrigger className=\"w-full flex items-center justify-between px-4 py-3 rounded-xl hover-elevate\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"w-8 h-8 rounded-lg bg-muted/80 flex items-center justify-center flex-shrink-0\">\n                              <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\n                            </div>\n                            <span className=\"text-sm lowercase font-medium\">principal</span>\n                            <span className=\"text-xs text-muted-foreground\">{presentationImages.length}</span>\n                          </div>\n                          <ChevronDown className=\"h-4 w-4 text-muted-foreground/60 transition-transform\" />\n                        </CollapsibleTrigger>\n                        <CollapsibleContent className=\"px-2 pb-2 pt-1\">\n                          {presentationImages.length === 0 ? (\n                            <p className=\"text-center text-sm text-muted-foreground/50 lowercase py-4\">sem imagens</p>\n                          ) : (\n                            <div className=\"space-y-1\">\n                              {presentationImages.map((img, idx, arr) => (\n                                <div key={img.id} className=\"flex items-center gap-3 px-3 py-2.5 rounded-xl group hover-elevate\">\n                                  <img src={img.imageUrl} alt=\"\" className=\"h-14 w-14 object-cover rounded-lg flex-shrink-0 cursor-pointer\" loading=\"lazy\" decoding=\"async\" onClick={() => setPreviewImage(img.imageUrl)} />\n                                  <div className=\"flex-1 min-w-0\">\n                                    <p className=\"text-sm lowercase text-muted-foreground\">imagem {idx + 1}</p>\n                                  </div>\n                                  <div className=\"flex items-center gap-0.5 flex-shrink-0\">\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => {\n                                      if (idx > 0) {\n                                        const prevImg = arr[idx - 1];\n                                        const newSortOrder = (prevImg.sortOrder || 0) - 1;\n                                        updateImageOrderMutation.mutate({ imageId: img.id, newOrder: newSortOrder });\n                                        setImages(prev => prev.map(i => i.id === img.id ? { ...i, sortOrder: newSortOrder } : i));\n                                      }\n                                    }} disabled={idx === 0} className=\"invisible group-hover:visible\">\n                                      <ChevronUp className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => {\n                                      if (idx < arr.length - 1) {\n                                        const nextImg = arr[idx + 1];\n                                        const newSortOrder = (nextImg.sortOrder || 0) + 1;\n                                        updateImageOrderMutation.mutate({ imageId: img.id, newOrder: newSortOrder });\n                                        setImages(prev => prev.map(i => i.id === img.id ? { ...i, sortOrder: newSortOrder } : i));\n                                      }\n                                    }} disabled={idx === arr.length - 1} className=\"invisible group-hover:visible\">\n                                      <ChevronDown className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => deleteImageMutation.mutate(img.id)} className=\"invisible group-hover:visible text-muted-foreground hover:text-destructive\">\n                                      <Trash2 className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          )}\n                        </CollapsibleContent>\n                      </Collapsible>\n                    );\n                  })()}\n\n                  {/* Color Image Groups */}\n                  {colors.map((color) => {\n                    const colorImages = images.filter(img => img.imageType === \"carousel\" && img.color === color.name).sort((a, b) => (a.sortOrder || 0) - (b.sortOrder || 0));\n                    return (\n                      <Collapsible key={color.name}>\n                        <CollapsibleTrigger className=\"w-full flex items-center justify-between px-4 py-3 rounded-xl hover-elevate\">\n                          <div className=\"flex items-center gap-3\">\n                            <div className=\"w-8 h-8 rounded-full ring-1 ring-border/30 flex-shrink-0\" style={{ backgroundColor: color.hex }} />\n                            <span className=\"text-sm lowercase font-medium\">{color.name}</span>\n                            <span className=\"text-xs text-muted-foreground\">{colorImages.length}</span>\n                          </div>\n                          <ChevronDown className=\"h-4 w-4 text-muted-foreground/60 transition-transform\" />\n                        </CollapsibleTrigger>\n                        <CollapsibleContent className=\"px-2 pb-2 pt-1\">\n                          {colorImages.length === 0 ? (\n                            <p className=\"text-center text-sm text-muted-foreground/50 lowercase py-4\">sem imagens</p>\n                          ) : (\n                            <div className=\"space-y-1\">\n                              {colorImages.map((img, idx, arr) => (\n                                <div key={img.id} className=\"flex items-center gap-3 px-3 py-2.5 rounded-xl group hover-elevate\">\n                                  <img src={img.imageUrl} alt=\"\" className=\"h-14 w-14 object-cover rounded-lg flex-shrink-0 cursor-pointer\" loading=\"lazy\" decoding=\"async\" onClick={() => setPreviewImage(img.imageUrl)} />\n                                  <div className=\"flex-1 min-w-0\">\n                                    <p className=\"text-sm lowercase text-muted-foreground\">imagem {idx + 1}</p>\n                                  </div>\n                                  <div className=\"flex items-center gap-0.5 flex-shrink-0\">\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => {\n                                      if (idx > 0) {\n                                        const prevImg = arr[idx - 1];\n                                        const newSortOrder = (prevImg.sortOrder || 0) - 1;\n                                        updateImageOrderMutation.mutate({ imageId: img.id, newOrder: newSortOrder });\n                                        setImages(prev => prev.map(i => i.id === img.id ? { ...i, sortOrder: newSortOrder } : i));\n                                      }\n                                    }} disabled={idx === 0} className=\"invisible group-hover:visible\">\n                                      <ChevronUp className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => {\n                                      if (idx < arr.length - 1) {\n                                        const nextImg = arr[idx + 1];\n                                        const newSortOrder = (nextImg.sortOrder || 0) + 1;\n                                        updateImageOrderMutation.mutate({ imageId: img.id, newOrder: newSortOrder });\n                                        setImages(prev => prev.map(i => i.id === img.id ? { ...i, sortOrder: newSortOrder } : i));\n                                      }\n                                    }} disabled={idx === arr.length - 1} className=\"invisible group-hover:visible\">\n                                      <ChevronDown className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                    <Button type=\"button\" size=\"icon\" variant=\"ghost\" onClick={() => deleteImageMutation.mutate(img.id)} className=\"invisible group-hover:visible text-muted-foreground hover:text-destructive\">\n                                      <Trash2 className=\"h-3.5 w-3.5\" />\n                                    </Button>\n                                  </div>\n                                </div>\n                              ))}\n                            </div>\n                          )}\n                        </CollapsibleContent>\n                      </Collapsible>\n                    );\n                  })}\n                </div>\n              )}\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Customizable - Aparece apenas quando ativado */}\n          {form.watch(\"customizable\") && (\n            <Collapsible open={openSections.customizable} onOpenChange={() => toggleSection('customizable')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">posi√ß√£o das estampas</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.customizable ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n                <FormField\n                  control={form.control}\n                  name=\"customizableFront\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel className=\"text-sm lowercase font-medium\">personalizar frente</FormLabel>\n                      </div>\n                      <FormControl>\n                        <Switch checked={field.value} onCheckedChange={field.onChange} data-testid=\"switch-customizable-front\" />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"customizableBack\"\n                  render={({ field }) => (\n                    <FormItem className=\"flex items-center justify-between px-4 py-4 rounded-xl hover-elevate\">\n                      <div className=\"space-y-0.5\">\n                        <FormLabel className=\"text-sm lowercase font-medium\">personalizar costas</FormLabel>\n                      </div>\n                      <FormControl>\n                        <Switch checked={field.value} onCheckedChange={field.onChange} data-testid=\"switch-customizable-back\" />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          {/* Fabrics */}\n          {form.watch(\"fabricsEnabled\") && (\n            <Collapsible open={openSections.fabrics} onOpenChange={() => toggleSection('fabrics')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">tecidos ({fabrics.length})</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.fabrics ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-5\">\n                {fabrics.length > 0 && (\n                  <div className=\"space-y-1.5\">\n                    {fabrics.map((fabric, i) => (\n                      <div key={i} className=\"rounded-2xl bg-muted/30 overflow-hidden group\">\n                        <div className=\"flex items-center gap-4 px-5 py-4\">\n                          <div className=\"w-10 h-10 rounded-xl bg-background/60 flex items-center justify-center flex-shrink-0\">\n                            <span className=\"text-base font-light text-muted-foreground\">{i + 1}</span>\n                          </div>\n                          <div className=\"flex-1 min-w-0\">\n                            <span className=\"text-sm font-medium lowercase block leading-tight\">{fabric.name}</span>\n                            <span className=\"text-[11px] text-muted-foreground/60\">\n                              {fabric.price > 0 ? `+ R$ ${Number(fabric.price).toFixed(2)}` : 'pre√ßo base'}\n                            </span>\n                          </div>\n                          <button\n                            type=\"button\"\n                            onClick={() => handleRemoveFabric(i)}\n                            className=\"text-muted-foreground/30 hover:text-destructive transition-colors p-1.5 rounded-full invisible group-hover:visible\"\n                            data-testid={`button-remove-fabric-${i}`}\n                          >\n                            <X className=\"h-4 w-4\" />\n                          </button>\n                        </div>\n                        <div className=\"px-5 pb-4\">\n                          <Textarea \n                            placeholder=\"descri√ß√£o do tecido (opcional)\" \n                            value={fabric.description || \"\"} \n                            onChange={(e) => {\n                              const updatedFabrics = [...fabrics];\n                              updatedFabrics[i].description = e.target.value;\n                              setFabrics(updatedFabrics);\n                            }}\n                            className=\"border-0 bg-background/60 rounded-xl px-4 py-3 text-sm focus-visible:ring-1 min-h-[70px] resize-none lowercase\"\n                          />\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n\n                {fabrics.length === 0 && (\n                  <div className=\"flex flex-col items-center justify-center py-8 gap-2\">\n                    <p className=\"text-xs text-muted-foreground/50 lowercase\">nenhum tecido adicionado</p>\n                  </div>\n                )}\n\n                <div className=\"border-t border-border/30 pt-5 space-y-3\">\n                  <Input \n                    value={newFabricName} \n                    onChange={(e) => setNewFabricName(e.target.value)} \n                    placeholder=\"nome do tecido\" \n                    className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 lowercase\" \n                  />\n                  <div className=\"flex gap-2\">\n                    <Input \n                      value={newFabricPrice} \n                      onChange={(e) => setNewFabricPrice(e.target.value)} \n                      placeholder=\"pre√ßo adicional (ex: 40)\" \n                      className=\"flex-1 border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\" \n                    />\n                    <Button \n                      type=\"button\" \n                      onClick={handleAddFabric} \n                      className=\"flex-shrink-0 rounded-xl h-11 px-5 lowercase gap-2\"\n                    >\n                      <Plus className=\"h-4 w-4\" /> adicionar\n                    </Button>\n                  </div>\n                </div>\n              </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          {/* Section Texts */}\n          <Collapsible open={openSections.sectionTexts} onOpenChange={() => toggleSection('sectionTexts')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                  <CardTitle className=\"text-sm lowercase\">textos da p√°gina</CardTitle>\n                  <ChevronDown className={`h-4 w-4 transition-transform ${openSections.sectionTexts ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-5 pb-3 space-y-5\">\n              <p className=\"text-xs text-muted-foreground/50 lowercase\">textos exibidos na se√ß√£o de personaliza√ß√£o do produto. deixe vazio para n√£o exibir.</p>\n\n              <div className=\"rounded-2xl bg-muted/30 p-5 space-y-4\">\n                <p className=\"text-[11px] text-muted-foreground/60 uppercase tracking-widest font-medium\">se√ß√£o de personaliza√ß√£o</p>\n                <FormField\n                  control={form.control}\n                  name=\"sectionLabel\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-xs font-medium lowercase text-muted-foreground/70\">etiqueta</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          value={field.value || \"\"}\n                          placeholder=\"ex: personalize\" \n                          className=\"border-0 bg-background/60 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 lowercase\"\n                          data-testid=\"input-section-label\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"sectionTitle\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-xs font-medium lowercase text-muted-foreground/70\">t√≠tulo</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          value={field.value || \"\"}\n                          placeholder=\"ex: escolha os detalhes da sua pe√ßa\" \n                          className=\"border-0 bg-background/60 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 lowercase\"\n                          data-testid=\"input-section-title\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n                <FormField\n                  control={form.control}\n                  name=\"sectionSubtitle\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-xs font-medium lowercase text-muted-foreground/70\">subt√≠tulo</FormLabel>\n                      <FormControl>\n                        <Input \n                          {...field} \n                          value={field.value || \"\"}\n                          placeholder=\"ex: selecione as op√ß√µes abaixo para adicionar √† sua mochila\" \n                          className=\"border-0 bg-background/60 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 lowercase\"\n                          data-testid=\"input-section-subtitle\"\n                        />\n                      </FormControl>\n                    </FormItem>\n                  )}\n                />\n              </div>\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Fabric */}\n          <Collapsible open={openSections.fabric} onOpenChange={() => toggleSection('fabric')}>\n            <CollapsibleTrigger className=\"w-full\">\n              <Card className=\"cursor-pointer hover:bg-accent/50\">\n                <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                  <CardTitle className=\"text-sm lowercase\">informa√ß√µes</CardTitle>\n                  <ChevronDown className={`h-4 w-4 transition-transform ${openSections.fabric ? 'rotate-180' : ''}`} />\n                </CardHeader>\n              </Card>\n            </CollapsibleTrigger>\n            <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n              <FormField\n                control={form.control}\n                name=\"fabricDescription\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">descri√ß√£o</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} placeholder=\"descreva...\" rows={2} className=\"border-0 bg-muted/50 rounded-xl px-4 py-3 text-sm focus-visible:ring-1 min-h-[80px]\" />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"fabricTech\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">tecnologias (separadas por v√≠rgula)</FormLabel>\n                    <FormControl>\n                      <Input {...field} placeholder=\"ex: lycra, algod√£o\" className=\"border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1\" />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n              <FormField\n                control={form.control}\n                name=\"careInstructions\"\n                render={({ field }) => (\n                  <FormItem>\n                    <FormLabel className=\"text-sm font-medium lowercase\">cuidados</FormLabel>\n                    <FormControl>\n                      <Textarea {...field} placeholder=\"lavar √† m√°quina...\" rows={2} className=\"border-0 bg-muted/50 rounded-xl px-4 py-3 text-sm focus-visible:ring-1 min-h-[80px]\" />\n                    </FormControl>\n                  </FormItem>\n                )}\n              />\n            </CollapsibleContent>\n          </Collapsible>\n\n          {/* Reviews - Aparece apenas quando ativado */}\n          {form.watch(\"reviewsEnabled\") && product?.id && (\n            <Collapsible open={openSections.reviews} onOpenChange={() => toggleSection('reviews')}>\n              <CollapsibleTrigger className=\"w-full\">\n                <Card className=\"cursor-pointer hover:bg-accent/50\">\n                  <CardHeader className=\"p-5 flex flex-row items-center justify-between space-y-0\">\n                    <CardTitle className=\"text-sm lowercase\">avalia√ß√µes</CardTitle>\n                    <ChevronDown className={`h-4 w-4 transition-transform ${openSections.reviews ? 'rotate-180' : ''}`} />\n                  </CardHeader>\n                </Card>\n              </CollapsibleTrigger>\n              <CollapsibleContent className=\"pt-5 pb-3 space-y-4\">\n                <div className=\"space-y-1\">\n                  <p className=\"text-xs text-muted-foreground lowercase\">ajuste a nota inicial e gerencie os coment√°rios dos clientes.</p>\n                </div>\n                <AdminProductReviews product={product} />\n              </CollapsibleContent>\n            </Collapsible>\n          )}\n\n          <div className=\"h-4\" />\n        </form>\n      </Form>\n\n      <Dialog open={!!previewImage} onOpenChange={() => setPreviewImage(null)}>\n        <DialogContent className=\"max-w-3xl p-2 rounded-2xl bg-background/95 backdrop-blur border-0\" data-testid=\"dialog-image-preview\">\n          <button\n            onClick={() => setPreviewImage(null)}\n            className=\"absolute top-3 right-3 z-10 h-8 w-8 rounded-full bg-background/80 backdrop-blur flex items-center justify-center text-muted-foreground hover:text-foreground transition-colors\"\n            data-testid=\"button-close-preview\"\n          >\n            <X className=\"h-4 w-4\" />\n          </button>\n          {previewImage && (\n            <img\n              src={previewImage}\n              alt=\"\"\n              className=\"w-full h-auto max-h-[80vh] object-contain rounded-xl\"\n              data-testid=\"img-preview-full\"\n            />\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":89395,"size_tokens":null},"server/reset-product-images.ts":{"content":"import { storage } from \"./storage\";\nimport { generate } from \"openai/core\";\n\ninterface ProductColor {\n  name: string;\n  hex: string;\n}\n\nconst CORE_COLORS: ProductColor[] = [\n  { name: \"Preto\", hex: \"#000000\" },\n  { name: \"Branco\", hex: \"#FFFFFF\" },\n  { name: \"Vermelho\", hex: \"#DC143C\" },\n  { name: \"Azul Marinho\", hex: \"#1F3C88\" },\n];\n\nasync function resetProductImages() {\n  console.log(\"üöÄ Iniciando reset de imagens dos produtos...\\n\");\n\n  // 1. Buscar todos os produtos ativos\n  const products = await storage.getProducts();\n  const activeProducts = products.filter(p => p.isActive);\n  \n  console.log(`‚úÖ Encontrados ${activeProducts.length} produtos ativos\\n`);\n\n  for (const product of activeProducts) {\n    console.log(`\\n${\"=\".repeat(60)}`);\n    console.log(`üì¶ Produto: ${product.name} (${product.id})`);\n    console.log(`${\"=\".repeat(60)}\\n`);\n\n    // 2. Deletar todas as imagens existentes do produto\n    const existingImages = await storage.getProductImages(product.id);\n    console.log(`üóëÔ∏è  Deletando ${existingImages.length} imagens antigas...`);\n    \n    for (const image of existingImages) {\n      await storage.deleteProductImage(image.id);\n    }\n    console.log(`‚úÖ Imagens antigas deletadas`);\n\n    // 3. Atualizar cores do produto\n    console.log(`\\nüé® Atualizando cores do produto...`);\n    await storage.updateProduct(product.id, {\n      colors: JSON.stringify(CORE_COLORS)\n    });\n    console.log(`‚úÖ Cores atualizadas: ${CORE_COLORS.map(c => c.name).join(\", \")}`);\n\n    console.log(`\\nüì∏ Gera√ß√£o de imagens conclu√≠da para ${product.name}\\n`);\n  }\n\n  console.log(`\\n${\"=\".repeat(60)}`);\n  console.log(\"üéâ Reset completo! Todas as imagens foram resetadas.\");\n  console.log(`${\"=\".repeat(60)}\\n`);\n}\n\n// Executar se for chamado diretamente\nif (import.meta.url === `file://${process.argv[1]}`) {\n  resetProductImages()\n    .then(() => {\n      console.log(\"‚úÖ Script conclu√≠do com sucesso!\");\n      process.exit(0);\n    })\n    .catch((error) => {\n      console.error(\"‚ùå Erro ao executar script:\", error);\n      process.exit(1);\n    });\n}\n\nexport { resetProductImages };\n","path":null,"size_bytes":2116,"size_tokens":null},"scripts/populate-images.ts":{"content":"import { storage } from \"../server/storage\";\n\nconst COLORS = [\n  { name: \"Preto\", hex: \"#000000\" },\n  { name: \"Branco\", hex: \"#FFFFFF\" },\n  { name: \"Vermelho\", hex: \"#DC143C\" },\n  { name: \"Azul Marinho\", hex: \"#1F3C88\" },\n];\n\nconst IMAGE_MAP = {\n  \"Preto\": {\n    product: \"/attached_assets/generated_images/black_tshirt_product_photo_2330bf67.png\",\n    lifestyle: \"/attached_assets/generated_images/black_tshirt_lifestyle_photo_62971e72.png\"\n  },\n  \"Branco\": {\n    product: \"/attached_assets/generated_images/white_tshirt_product_photo_8fd8990e.png\",\n    lifestyle: \"/attached_assets/generated_images/white_tshirt_lifestyle_photo_33503057.png\"\n  },\n  \"Vermelho\": {\n    product: \"/attached_assets/generated_images/red_tshirt_product_photo_8c7cd236.png\",\n    lifestyle: \"/attached_assets/generated_images/red_tshirt_lifestyle_photo_c869c162.png\"\n  },\n  \"Azul Marinho\": {\n    product: \"/attached_assets/generated_images/navy_blue_tshirt_photo_c1f89890.png\",\n    lifestyle: \"/attached_assets/generated_images/navy_tshirt_lifestyle_photo_5201e8bf.png\"\n  }\n};\n\nconst PRESENTATION_IMAGES = [\n  \"/attached_assets/generated_images/black_tshirt_presentation_b9645a49.png\",\n  \"/attached_assets/generated_images/tshirt_fabric_detail_8bf3ba12.png\"\n];\n\nasync function populateImages() {\n  console.log(\"üöÄ Iniciando popula√ß√£o de imagens...\\n\");\n\n  const products = await storage.getProducts();\n  const tshirts = products.filter(p => p.productType === \"tshirt\" && p.isActive);\n\n  console.log(`Encontrados ${tshirts.length} produtos de camiseta ativos\\n`);\n\n  for (const product of tshirts.slice(0, 3)) {\n    console.log(`\\n${\"=\".repeat(60)}`);\n    console.log(`üì¶ Processando: ${product.name}`);\n    console.log(`${\"=\".repeat(60)}\\n`);\n\n    // 1. Deletar imagens antigas\n    const existingImages = await storage.getProductImages(product.id);\n    for (const img of existingImages) {\n      await storage.deleteProductImage(img.id);\n    }\n    console.log(`‚úÖ Deletadas ${existingImages.length} imagens antigas`);\n\n    // 2. Atualizar cores\n    await storage.updateProduct(product.id, {\n      colors: JSON.stringify(COLORS)\n    });\n    console.log(`‚úÖ Cores atualizadas`);\n\n    // 3. Adicionar imagens de presentation\n    for (let i = 0; i < PRESENTATION_IMAGES.length; i++) {\n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: PRESENTATION_IMAGES[i],\n        altText: `${product.name} - apresenta√ß√£o ${i + 1}`,\n        imageType: \"presentation\",\n        color: null,\n        sortOrder: i\n      });\n    }\n    console.log(`‚úÖ Adicionadas ${PRESENTATION_IMAGES.length} imagens de apresenta√ß√£o`);\n\n    // 4. Adicionar imagens de carousel para cada cor\n    let colorIndex = 0;\n    for (const color of COLORS) {\n      const images = IMAGE_MAP[color.name as keyof typeof IMAGE_MAP];\n      \n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: images.product,\n        altText: `${product.name} ${color.name} - produto`,\n        imageType: \"carousel\",\n        color: color.name,\n        sortOrder: colorIndex * 2\n      });\n\n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: images.lifestyle,\n        altText: `${product.name} ${color.name} - lifestyle`,\n        imageType: \"carousel\",\n        color: color.name,\n        sortOrder: colorIndex * 2 + 1\n      });\n\n      colorIndex++;\n    }\n    console.log(`‚úÖ Adicionadas ${COLORS.length * 2} imagens de carousel (${COLORS.length} cores)`);\n  }\n\n  console.log(`\\n${\"=\".repeat(60)}`);\n  console.log(\"üéâ Popula√ß√£o completa!\");\n  console.log(`${\"=\".repeat(60)}\\n`);\n}\n\npopulateImages().catch(console.error);\n","path":null,"size_bytes":3649,"size_tokens":null},"scripts/populate-new-products.ts":{"content":"import { storage } from \"../server/storage\";\n\nconst COLORS = [\n  { name: \"Branco\", hex: \"#FFFFFF\" },\n  { name: \"Preto\", hex: \"#000000\" },\n  { name: \"Azul Marinho\", hex: \"#1a2742\" },\n  { name: \"Cinza\", hex: \"#9ca3af\" },\n];\n\nconst PRODUCTS_DATA = [\n  {\n    name: \"camiseta essencial cruz\",\n    description: \"Camiseta com design minimalista de cruz. Perfeita para o dia a dia com estilo e significado.\",\n    price: \"129.90\",\n    originalPrice: \"179.90\",\n    isNew: true,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_cross_tshirt_product_20abe436.png\",\n        lifestyle: \"/attached_assets/generated_images/white_cross_tshirt_lifestyle_0bd10795.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_cross_tshirt_product_45f7b071.png\",\n        lifestyle: \"/attached_assets/generated_images/black_cross_tshirt_lifestyle_45cae89e.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_cross_tshirt_product_8013ae3c.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_cross_tshirt_lifestyle_f13bd58d.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_cross_tshirt_product_08896eb3.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_cross_tshirt_lifestyle_78bee5b5.png\"\n      }\n    }\n  },\n  {\n    name: \"camiseta premium f√©\",\n    description: \"Camiseta premium com design elegante de f√©. Qualidade superior para quem valoriza o melhor.\",\n    price: \"149.90\",\n    isNew: false,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_faith_tshirt_product_f2f1c616.png\",\n        lifestyle: \"/attached_assets/generated_images/white_faith_tshirt_lifestyle_f729b011.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_faith_tshirt_product_8decd0c5.png\",\n        lifestyle: \"/attached_assets/generated_images/black_faith_tshirt_lifestyle_81a679e9.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_faith_tshirt_product_e808e3d2.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_faith_tshirt_lifestyle_5dad04e7.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_faith_tshirt_product_98c9212a.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_faith_tshirt_lifestyle_db820185.png\"\n      }\n    }\n  },\n  {\n    name: \"camiseta minimalista\",\n    description: \"Design minimalista e clean. Para quem aprecia a simplicidade com estilo.\",\n    price: \"119.90\",\n    originalPrice: \"159.90\",\n    isNew: true,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_minimalist_tshirt_product_a5698a09.png\",\n        lifestyle: \"/attached_assets/generated_images/white_minimalist_tshirt_lifestyle_5314c2ad.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_minimalist_tshirt_product_df23d670.png\",\n        lifestyle: \"/attached_assets/generated_images/black_minimalist_tshirt_lifestyle_d4d7dd73.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_minimalist_tshirt_product_9d8c701c.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_minimalist_tshirt_lifestyle_8a1fe5f1.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_minimalist_tshirt_product_66f381b9.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_minimalist_tshirt_lifestyle_6d4865bd.png\"\n      }\n    }\n  },\n  {\n    name: \"camiseta comunidade\",\n    description: \"Camiseta que celebra a uni√£o e comunidade. Perfeita para grupos e eventos.\",\n    price: \"139.90\",\n    isNew: false,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_community_tshirt_product_fd392c04.png\",\n        lifestyle: \"/attached_assets/generated_images/white_community_tshirt_lifestyle_314d92d4.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_community_tshirt_product_6a7884e8.png\",\n        lifestyle: \"/attached_assets/generated_images/black_community_tshirt_lifestyle_ced62a8a.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_community_tshirt_product_dd993a4d.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_community_tshirt_lifestyle_fda02c64.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_community_tshirt_product_caed87b4.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_community_tshirt_lifestyle_0c2a7140.png\"\n      }\n    }\n  },\n  {\n    name: \"camiseta esperan√ßa\",\n    description: \"Mensagem inspiradora de esperan√ßa. Vista-se com prop√≥sito e significado.\",\n    price: \"134.90\",\n    originalPrice: \"169.90\",\n    isNew: true,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_hope_tshirt_product_43244f93.png\",\n        lifestyle: \"/attached_assets/generated_images/white_hope_tshirt_lifestyle_42d85f64.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_hope_tshirt_product_00747f94.png\",\n        lifestyle: \"/attached_assets/generated_images/black_hope_tshirt_lifestyle_3a5bf592.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_hope_tshirt_product_e891d352.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_hope_tshirt_lifestyle_a026bed0.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_hope_tshirt_product_c13ed3f2.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_hope_tshirt_lifestyle_3c4ed1a4.png\"\n      }\n    }\n  },\n  {\n    name: \"camiseta amor\",\n    description: \"Design elegante com tema de amor. Ideal para casais e momentos especiais.\",\n    price: \"144.90\",\n    isNew: false,\n    images: {\n      \"Branco\": {\n        product: \"/attached_assets/generated_images/white_love_tshirt_product_1a2d5fe8.png\",\n        lifestyle: \"/attached_assets/generated_images/white_love_tshirt_lifestyle_56364376.png\"\n      },\n      \"Preto\": {\n        product: \"/attached_assets/generated_images/black_love_tshirt_product_95693831.png\",\n        lifestyle: \"/attached_assets/generated_images/black_love_tshirt_lifestyle_ce5e8f37.png\"\n      },\n      \"Azul Marinho\": {\n        product: \"/attached_assets/generated_images/navy_love_tshirt_product_a753b9dd.png\",\n        lifestyle: \"/attached_assets/generated_images/navy_love_tshirt_lifestyle_06576cb5.png\"\n      },\n      \"Cinza\": {\n        product: \"/attached_assets/generated_images/gray_love_tshirt_product_8eb3f1b8.png\",\n        lifestyle: \"/attached_assets/generated_images/gray_love_tshirt_lifestyle_57fbdeb0.png\"\n      }\n    }\n  }\n];\n\nconst ACCESSORIES_DATA = [\n  {\n    name: \"caneca faith\",\n    description: \"Caneca de cer√¢mica premium com design minimalista. Perfeita para momentos de reflex√£o.\",\n    price: \"45.00\",\n    category: \"caneca\",\n    images: [\n      \"/attached_assets/generated_images/luxury_faith_mug_product_bb4e381c.png\",\n      \"/attached_assets/generated_images/luxury_faith_mug_lifestyle_ea3a4712.png\"\n    ]\n  },\n  {\n    name: \"ecobag essentials\",\n    description: \"Ecobag sustent√°vel com design elegante. Estilo e consci√™ncia ambiental.\",\n    price: \"35.00\",\n    category: \"ecobag\",\n    images: [\n      \"/attached_assets/generated_images/luxury_ecobag_product_1bcc5814.png\",\n      \"/attached_assets/generated_images/luxury_ecobag_lifestyle_46b98401.png\"\n    ]\n  },\n  {\n    name: \"gorro comfort\",\n    description: \"Gorro de tric√¥ premium com bordado discreto. Eleg√¢ncia e conforto para o inverno.\",\n    price: \"55.00\",\n    category: \"gorro\",\n    images: [\n      \"/attached_assets/generated_images/luxury_beanie_product_69838035.png\",\n      \"/attached_assets/generated_images/luxury_beanie_lifestyle_31d6ed5f.png\"\n    ]\n  },\n  {\n    name: \"bon√© classic\",\n    description: \"Bon√© premium com bordado minimalista. Prote√ß√£o e estilo urbano.\",\n    price: \"65.00\",\n    category: \"bon√©\",\n    images: [\n      \"/attached_assets/generated_images/luxury_cap_product_5af45e6d.png\",\n      \"/attached_assets/generated_images/luxury_cap_lifestyle_a93afc16.png\"\n    ]\n  }\n];\n\nasync function populateNewProducts() {\n  console.log(\"üöÄ Iniciando popula√ß√£o de produtos com novas imagens...\\n\");\n\n  const existingProducts = await storage.getProducts();\n  console.log(`Encontrados ${existingProducts.length} produtos existentes\\n`);\n\n  // Delete all existing products\n  for (const product of existingProducts) {\n    console.log(`üóëÔ∏è  Deletando produto antigo: ${product.name}`);\n    const images = await storage.getProductImages(product.id);\n    for (const img of images) {\n      await storage.deleteProductImage(img.id);\n    }\n    // Note: Product will be cascade deleted when images are removed\n  }\n\n  console.log(\"\\nüì¶ Criando novos produtos...\\n\");\n\n  // Create T-shirt products\n  for (let i = 0; i < PRODUCTS_DATA.length; i++) {\n    const productData = PRODUCTS_DATA[i];\n    console.log(`\\n${\"=\".repeat(60)}`);\n    console.log(`üì¶ Criando: ${productData.name}`);\n    console.log(`${\"=\".repeat(60)}\\n`);\n\n    const product = await storage.createProduct({\n      name: productData.name,\n      description: productData.description,\n      price: productData.price,\n      originalPrice: productData.originalPrice,\n      productType: \"tshirt\",\n      colors: JSON.stringify(COLORS),\n      sizes: [\"P\", \"M\", \"G\", \"GG\"],\n      isNew: productData.isNew,\n      isActive: true,\n      displayOrder: i,\n      customizableFront: false,\n      customizableBack: false,\n      fabricTech: [\"n√£o encolhe\", \"seca r√°pido\"],\n      fabricDescription: \"Tecido premium com alta durabilidade\",\n      careInstructions: \"Lavar √† m√°quina em √°gua fria. N√£o usar alvejante.\",\n      rating: \"4.5\",\n      reviewsCount: 0\n    });\n\n    console.log(`‚úÖ Produto criado: ${product.id}`);\n\n    // Add presentation images (first color - Branco)\n    const presentationImages = productData.images[\"Branco\"];\n    await storage.addProductImage({\n      productId: product.id,\n      imageUrl: presentationImages.product,\n      altText: `${product.name} - apresenta√ß√£o 1`,\n      imageType: \"presentation\",\n      color: null,\n      sortOrder: 0\n    });\n\n    await storage.addProductImage({\n      productId: product.id,\n      imageUrl: presentationImages.lifestyle,\n      altText: `${product.name} - apresenta√ß√£o 2`,\n      imageType: \"presentation\",\n      color: null,\n      sortOrder: 1\n    });\n\n    console.log(`‚úÖ Adicionadas 2 imagens de apresenta√ß√£o`);\n\n    // Add carousel images for each color\n    let colorIndex = 0;\n    for (const color of COLORS) {\n      const images = productData.images[color.name];\n      \n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: images.product,\n        altText: `${product.name} ${color.name} - produto`,\n        imageType: \"carousel\",\n        color: color.name,\n        sortOrder: colorIndex * 2\n      });\n\n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: images.lifestyle,\n        altText: `${product.name} ${color.name} - lifestyle`,\n        imageType: \"carousel\",\n        color: color.name,\n        sortOrder: colorIndex * 2 + 1\n      });\n\n      colorIndex++;\n    }\n\n    console.log(`‚úÖ Adicionadas ${COLORS.length * 2} imagens de carousel (${COLORS.length} cores)`);\n  }\n\n  // Create accessory products\n  console.log(\"\\nüéí Criando acess√≥rios...\\n\");\n\n  for (let i = 0; i < ACCESSORIES_DATA.length; i++) {\n    const accessoryData = ACCESSORIES_DATA[i];\n    console.log(`\\n${\"=\".repeat(60)}`);\n    console.log(`üéí Criando: ${accessoryData.name}`);\n    console.log(`${\"=\".repeat(60)}\\n`);\n\n    const product = await storage.createProduct({\n      name: accessoryData.name,\n      description: accessoryData.description,\n      price: accessoryData.price,\n      productType: \"accessory\",\n      category: accessoryData.category,\n      isNew: false,\n      isActive: true,\n      displayOrder: 100 + i,\n      rating: \"4.5\",\n      reviewsCount: 0\n    });\n\n    console.log(`‚úÖ Acess√≥rio criado: ${product.id}`);\n\n    // Add presentation images\n    for (let j = 0; j < accessoryData.images.length; j++) {\n      await storage.addProductImage({\n        productId: product.id,\n        imageUrl: accessoryData.images[j],\n        altText: `${product.name} - imagem ${j + 1}`,\n        imageType: \"presentation\",\n        color: null,\n        sortOrder: j\n      });\n    }\n\n    console.log(`‚úÖ Adicionadas ${accessoryData.images.length} imagens`);\n  }\n\n  console.log(`\\n${\"=\".repeat(60)}`);\n  console.log(\"üéâ Popula√ß√£o completa!\");\n  console.log(`   - ${PRODUCTS_DATA.length} camisetas criadas`);\n  console.log(`   - ${ACCESSORIES_DATA.length} acess√≥rios criados`);\n  console.log(`${\"=\".repeat(60)}\\n`);\n}\n\npopulateNewProducts().catch(console.error).finally(() => process.exit());\n","path":null,"size_bytes":12969,"size_tokens":null},"scripts/create-tables.ts":{"content":"import { db } from '../server/db';\nimport { sql } from 'drizzle-orm';\n\nasync function createTables() {\n  console.log('üèóÔ∏è  Criando tabelas...\\n');\n\n  try {\n    // Create products table\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS products (\n        id varchar PRIMARY KEY DEFAULT gen_random_uuid(),\n        name text NOT NULL,\n        description text NOT NULL,\n        price decimal(10, 2) NOT NULL,\n        original_price decimal(10, 2),\n        product_type varchar(50) DEFAULT 'tshirt',\n        category text,\n        colors text,\n        sizes text[],\n        model_url text,\n        is_new boolean DEFAULT false,\n        is_active boolean DEFAULT true,\n        display_order integer DEFAULT 0,\n        customizable_front boolean DEFAULT false,\n        customizable_back boolean DEFAULT false,\n        fabric_tech text[],\n        fabric_description text,\n        care_instructions text,\n        size_guide text,\n        rating decimal(2, 1) DEFAULT 4.5,\n        reviews_count integer DEFAULT 0,\n        created_at timestamp DEFAULT CURRENT_TIMESTAMP,\n        updated_at timestamp DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n    console.log('‚úÖ Tabela products criada');\n\n    // Create product_images table\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS product_images (\n        id varchar PRIMARY KEY DEFAULT gen_random_uuid(),\n        product_id varchar NOT NULL REFERENCES products(id) ON DELETE CASCADE,\n        image_url text NOT NULL,\n        alt_text text,\n        image_type varchar(20) DEFAULT 'carousel',\n        color text,\n        sort_order integer DEFAULT 0,\n        created_at timestamp DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n    console.log('‚úÖ Tabela product_images criada');\n\n    // Create admin_users table\n    await db.execute(sql`\n      CREATE TABLE IF NOT EXISTS admin_users (\n        id varchar PRIMARY KEY DEFAULT gen_random_uuid(),\n        username text NOT NULL UNIQUE,\n        password_hash text NOT NULL,\n        is_active boolean DEFAULT true,\n        last_login timestamp,\n        created_at timestamp DEFAULT CURRENT_TIMESTAMP\n      )\n    `);\n    console.log('‚úÖ Tabela admin_users criada');\n\n    console.log('\\nüéâ Todas as tabelas foram criadas com sucesso!');\n  } catch (error) {\n    console.error('‚ùå Erro ao criar tabelas:', error);\n    throw error;\n  }\n}\n\ncreateTables().catch(console.error).finally(() => process.exit());\n","path":null,"size_bytes":2400,"size_tokens":null},"client/src/components/admin/BannerForm.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ArrowLeft, Upload, X, Link as LinkIcon, Package, Settings, Edit, Loader2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface Banner {\n  id: string;\n  title: string;\n  subtitle: string;\n  ctaText: string | null;\n  ctaLink: string | null;\n  productId: string | null;\n  imageUrl: string;\n  position: string;\n  showText: boolean;\n  sortOrder: number;\n  isActive: boolean;\n}\n\ninterface Product {\n  id: string;\n  name: string;\n  price: string;\n  isActive: boolean;\n  imageUrl: string | null;\n}\n\ninterface BannerFormProps {\n  banner: Banner | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport default function BannerForm({ banner, onClose, onSuccess }: BannerFormProps) {\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploading, setUploading] = useState(false);\n  const [isDragging, setIsDragging] = useState(false);\n  const [linkType, setLinkType] = useState<\"custom\" | \"product\">(\n    banner?.productId ? \"product\" : \"custom\"\n  );\n  const [formData, setFormData] = useState({\n    title: banner?.title || \"\",\n    subtitle: banner?.subtitle || \"\",\n    ctaText: banner?.ctaText || \"\",\n    ctaLink: banner?.ctaLink || \"\",\n    productId: banner?.productId || \"\",\n    imageUrl: banner?.imageUrl || \"\",\n    position: banner?.position || \"left\",\n    showText: banner?.showText !== false,\n    isActive: banner?.isActive !== false,\n    sortOrder: banner?.sortOrder || 0,\n  });\n\n  const { data: productsData } = useQuery<{ products: Product[] }>({\n    queryKey: ['/api/admin/products'],\n  });\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const url = banner \n        ? `/api/admin/banners/${banner.id}`\n        : \"/api/admin/banners\";\n      \n      // Prepare data based on link type\n      const dataToSend = {\n        ...data,\n        ctaLink: linkType === \"custom\" \n          ? (data.ctaLink.startsWith('http') || data.ctaLink.startsWith('/') ? data.ctaLink : `https://${data.ctaLink}`) \n          : null,\n        productId: linkType === \"product\" ? data.productId : null,\n      };\n      \n      const response = await apiRequest(\n        banner ? \"PATCH\" : \"POST\",\n        url,\n        dataToSend\n      );\n      \n      if (!response.ok) throw new Error(\"Erro ao salvar banner\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/banners'] });\n      toast({\n        title: banner ? \"Banner atualizado\" : \"Banner criado\",\n        description: \"As altera√ß√µes foram salvas com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel salvar o banner.\",\n      });\n    },\n  });\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n      toast({\n        variant: \"destructive\",\n        title: \"Formato inv√°lido\",\n        description: \"Por favor, selecione uma imagem.\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n      uploadFormData.append('type', 'banner');\n\n      const response = await fetch('/api/admin/upload-banner', {\n        method: 'POST',\n        credentials: 'include',\n        body: uploadFormData,\n      });\n\n      if (!response.ok) throw new Error(\"Erro no upload\");\n\n      const data = await response.json();\n      setFormData({ ...formData, imageUrl: data.imageUrl });\n      \n      toast({\n        title: \"Upload conclu√≠do\",\n        description: \"Imagem enviada com sucesso.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro no upload\",\n        description: \"N√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDrop = async (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n\n    const file = e.dataTransfer.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n      toast({\n        variant: \"destructive\",\n        title: \"Formato inv√°lido\",\n        description: \"Por favor, selecione uma imagem.\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n      uploadFormData.append('type', 'banner');\n\n      const response = await fetch('/api/admin/upload-banner', {\n        method: 'POST',\n        credentials: 'include',\n        body: uploadFormData,\n      });\n\n      if (!response.ok) throw new Error(\"Erro no upload\");\n\n      const data = await response.json();\n      setFormData((prev) => ({ ...prev, imageUrl: data.imageUrl }));\n\n      toast({\n        title: \"Upload conclu√≠do\",\n        description: \"Imagem enviada com sucesso.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro no upload\",\n        description: \"N√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(true);\n  };\n\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setIsDragging(false);\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    saveMutation.mutate(formData);\n  };\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div className=\"flex items-center gap-3\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={onClose}\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4\" />\n        </Button>\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-light lowercase\">\n            {banner ? \"editar banner\" : \"novo banner\"}\n          </h1>\n          <p className=\"text-sm text-muted-foreground lowercase\">\n            configure os detalhes do banner do carrossel\n          </p>\n        </div>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"max-w-4xl mx-auto space-y-8 pb-12\">\n        <input\n          type=\"file\"\n          ref={fileInputRef}\n          className=\"hidden\"\n          accept=\"image/*\"\n          onChange={handleImageUpload}\n          data-testid=\"input-file-upload\"\n        />\n        {/* Upload de Imagem - Se√ß√£o de Destaque */}\n        <section className=\"space-y-4\">\n          <div className=\"flex items-center gap-2 px-1\">\n            <Upload className=\"h-4 w-4 text-muted-foreground\" />\n            <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">m√≠dia do banner</h2>\n          </div>\n          <Card className=\"overflow-hidden border-white/5 bg-muted/20 backdrop-blur-sm transition-all hover:bg-muted/30\">\n            <CardContent className=\"p-0\">\n              {formData.imageUrl ? (\n                <div className=\"relative group aspect-[21/9] md:aspect-[21/7]\">\n                  <img\n                    src={formData.imageUrl}\n                    alt=\"Preview\"\n                    className=\"w-full h-full object-cover transition-transform duration-700 group-hover:scale-105\"\n                    loading=\"lazy\"\n                    decoding=\"async\"\n                  />\n                  <div className=\"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                    <Button\n                      type=\"button\"\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      className=\"rounded-full bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/20 lowercase\"\n                      onClick={() => setFormData({ ...formData, imageUrl: \"\" })}\n                    >\n                      <X className=\"h-4 w-4 mr-2\" />\n                      remover imagem\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div\n                  className={`aspect-[21/9] md:aspect-[21/7] flex flex-col items-center justify-center cursor-pointer group transition-all duration-300 ${isDragging ? 'bg-primary/10 ring-2 ring-primary/30 ring-inset' : ''}`}\n                  onClick={() => fileInputRef.current?.click()}\n                  onDrop={handleDrop}\n                  onDragOver={handleDragOver}\n                  onDragLeave={handleDragLeave}\n                  data-testid=\"dropzone-banner-image\"\n                >\n                  {uploading ? (\n                    <>\n                      <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground mb-4\" />\n                      <p className=\"text-sm font-medium lowercase mb-1\">enviando imagem...</p>\n                    </>\n                  ) : (\n                    <>\n                      <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-500\">\n                        <Upload className=\"h-6 w-6 text-muted-foreground group-hover:text-primary transition-colors\" />\n                      </div>\n                      <p className=\"text-sm font-medium lowercase mb-1\">{isDragging ? 'solte a imagem aqui' : 'clique ou arraste para upload'}</p>\n                      <p className=\"text-xs text-muted-foreground lowercase\">recomendado: 1920x800px</p>\n                    </>\n                  )}\n                </div>\n              )}\n            </CardContent>\n            <div className=\"px-6 py-4 bg-muted/40 border-t border-white/5\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"flex-1\">\n                  <Input\n                    id=\"imageUrl\"\n                    value={formData.imageUrl}\n                    onChange={(e) => setFormData({ ...formData, imageUrl: e.target.value })}\n                    placeholder=\"ou cole a URL da imagem aqui...\"\n                    disabled={uploading}\n                    className=\"bg-transparent border-none px-0 h-8 focus-visible:ring-0 placeholder:text-muted-foreground/50 lowercase\"\n                    data-testid=\"input-image-url\"\n                  />\n                </div>\n                {uploading && <Loader2 className=\"h-4 w-4 animate-spin text-muted-foreground\" />}\n              </div>\n            </div>\n          </Card>\n        </section>\n\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\n          {/* Textos e Conte√∫do */}\n          <section className=\"space-y-6\">\n            <div className=\"flex items-center gap-2 px-1\">\n              <Edit className=\"h-4 w-4 text-muted-foreground\" />\n              <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">conte√∫do e textos</h2>\n            </div>\n            \n            <div className=\"space-y-6\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70 ml-1\">t√≠tulo principal</Label>\n                <Input\n                  id=\"title\"\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  placeholder=\"ex: novos produtos\"\n                  required\n                  className=\"bg-muted/20 border-white/5 rounded-xl h-12 px-4 focus:bg-muted/30 transition-all lowercase\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"subtitle\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70 ml-1\">subt√≠tulo</Label>\n                <Textarea\n                  id=\"subtitle\"\n                  value={formData.subtitle}\n                  onChange={(e) => setFormData({ ...formData, subtitle: e.target.value })}\n                  placeholder=\"ex: conecte-se com sua comunidade\"\n                  required\n                  rows={4}\n                  className=\"bg-muted/20 border-white/5 rounded-xl px-4 py-3 focus:bg-muted/30 transition-all lowercase resize-none\"\n                  data-testid=\"input-subtitle\"\n                />\n              </div>\n            </div>\n          </section>\n\n          {/* Chamada para A√ß√£o e Links */}\n          <section className=\"space-y-6\">\n            <div className=\"flex items-center gap-2 px-1\">\n              <LinkIcon className=\"h-4 w-4 text-muted-foreground\" />\n              <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">chamada para a√ß√£o</h2>\n            </div>\n\n            <Card className=\"border-white/5 bg-muted/20 rounded-2xl overflow-hidden\">\n              <CardContent className=\"p-6 space-y-6\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"ctaText\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">texto do bot√£o</Label>\n                  <Input\n                    id=\"ctaText\"\n                    value={formData.ctaText}\n                    onChange={(e) => setFormData({ ...formData, ctaText: e.target.value })}\n                    placeholder=\"ex: ver produto\"\n                    className=\"bg-muted/40 border-none rounded-xl h-11 lowercase\"\n                    data-testid=\"input-cta-text\"\n                  />\n                </div>\n\n                <div className=\"space-y-4\">\n                  <Label className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">destino do clique</Label>\n                  <RadioGroup \n                    value={linkType} \n                    onValueChange={(value: \"custom\" | \"product\") => setLinkType(value)}\n                    className=\"grid grid-cols-2 gap-3\"\n                  >\n                    <div>\n                      <RadioGroupItem value=\"custom\" id=\"link-custom\" className=\"peer sr-only\" />\n                      <Label\n                        htmlFor=\"link-custom\"\n                        className=\"flex flex-col items-center justify-center rounded-xl border border-white/5 bg-muted/40 p-4 hover:bg-muted/60 peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 transition-all cursor-pointer\"\n                      >\n                        <LinkIcon className=\"mb-2 h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-xs lowercase font-medium\">link personalizado</span>\n                      </Label>\n                    </div>\n                    <div>\n                      <RadioGroupItem value=\"product\" id=\"link-product\" className=\"peer sr-only\" />\n                      <Label\n                        htmlFor=\"link-product\"\n                        className=\"flex flex-col items-center justify-center rounded-xl border border-white/5 bg-muted/40 p-4 hover:bg-muted/60 peer-data-[state=checked]:border-primary peer-data-[state=checked]:bg-primary/5 transition-all cursor-pointer\"\n                      >\n                        <Package className=\"mb-2 h-4 w-4 text-muted-foreground\" />\n                        <span className=\"text-xs lowercase font-medium\">produto do site</span>\n                      </Label>\n                    </div>\n                  </RadioGroup>\n                </div>\n\n                {linkType === \"custom\" ? (\n                  <div className=\"space-y-2 pt-2\">\n                    <Label htmlFor=\"ctaLink\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">URL de destino</Label>\n                    <Input\n                      id=\"ctaLink\"\n                      value={formData.ctaLink}\n                      onChange={(e) => setFormData({ ...formData, ctaLink: e.target.value })}\n                      placeholder=\"ex: /colecao ou https://...\"\n                      required\n                      className=\"bg-muted/40 border-none rounded-xl h-11 lowercase\"\n                      data-testid=\"input-cta-link\"\n                    />\n                  </div>\n                ) : (\n                  <div className=\"space-y-2 pt-2\">\n                    <Label htmlFor=\"productId\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">produto vinculado</Label>\n                    <Select\n                      value={formData.productId}\n                      onValueChange={(value) => setFormData({ ...formData, productId: value })}\n                    >\n                      <SelectTrigger data-testid=\"select-product\" className=\"h-auto min-h-12 py-3 rounded-xl bg-muted/40 border-none\">\n                        <SelectValue placeholder=\"escolha um produto\" />\n                      </SelectTrigger>\n                      <SelectContent className=\"rounded-xl border-white/10 bg-black/90 backdrop-blur-xl\">\n                        {productsData?.products?.map((product) => (\n                          <SelectItem key={product.id} value={product.id} className=\"rounded-lg focus:bg-white/10\">\n                            <div className=\"flex items-center gap-3\">\n                              {product.imageUrl ? (\n                                <img \n                                  src={product.imageUrl} \n                                  alt={product.name}\n                                  className=\"w-10 h-10 object-cover rounded-lg\"\n                                  loading=\"lazy\"\n                                  decoding=\"async\"\n                                />\n                              ) : (\n                                <div className=\"w-10 h-10 bg-muted/40 rounded-lg flex items-center justify-center text-[10px] text-muted-foreground\">\n                                  sem foto\n                                </div>\n                              )}\n                              <div className=\"flex flex-col text-left\">\n                                <span className=\"text-sm font-medium lowercase\">{product.name}</span>\n                                <span className=\"text-[10px] text-muted-foreground lowercase\">\n                                  R$ {product.price} {!product.isActive && \"‚Ä¢ rascunho\"}\n                                </span>\n                              </div>\n                            </div>\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </section>\n        </div>\n\n        {/* Configura√ß√µes Gerais - Layout Clean */}\n        <section className=\"space-y-6\">\n          <div className=\"flex items-center gap-2 px-1\">\n            <Settings className=\"h-4 w-4 text-muted-foreground\" />\n            <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">prefer√™ncias de exibi√ß√£o</h2>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"flex items-center justify-between p-5 rounded-2xl bg-muted/20 border border-white/5\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">texto</Label>\n                <p className=\"text-[11px] text-muted-foreground lowercase\">exibir na imagem</p>\n              </div>\n              <Switch\n                checked={formData.showText}\n                onCheckedChange={(checked) => setFormData({ ...formData, showText: checked })}\n                data-testid=\"switch-show-text\"\n              />\n            </div>\n\n            <div className=\"flex items-center justify-between p-5 rounded-2xl bg-muted/20 border border-white/5\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70\">status</Label>\n                <p className=\"text-[11px] text-muted-foreground lowercase\">banner vis√≠vel</p>\n              </div>\n              <Switch\n                checked={formData.isActive}\n                onCheckedChange={(checked) => setFormData({ ...formData, isActive: checked })}\n                data-testid=\"switch-is-active\"\n              />\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"position\" className=\"text-xs font-semibold uppercase tracking-widest text-muted-foreground/70 ml-1\">alinhamento</Label>\n              <Select\n                value={formData.position}\n                onValueChange={(value) => setFormData({ ...formData, position: value })}\n              >\n                <SelectTrigger data-testid=\"select-position\" className=\"h-12 rounded-2xl bg-muted/20 border-white/5 px-4\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent className=\"rounded-xl border-white/10 bg-black/90 backdrop-blur-xl\">\n                  <SelectItem value=\"left\" className=\"rounded-lg focus:bg-white/10 lowercase\">esquerda</SelectItem>\n                  <SelectItem value=\"center\" className=\"rounded-lg focus:bg-white/10 lowercase\">centro</SelectItem>\n                  <SelectItem value=\"right\" className=\"rounded-lg focus:bg-white/10 lowercase\">direita</SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n          </div>\n        </section>\n\n        {/* Bot√µes de A√ß√£o Final - Sticky Bottom Bar Style */}\n        <div className=\"flex items-center justify-end gap-4 pt-8 border-t border-white/5\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            onClick={onClose}\n            className=\"h-12 px-8 rounded-full text-muted-foreground hover:bg-muted/30 transition-all lowercase\"\n            data-testid=\"button-cancel\"\n          >\n            cancelar\n          </Button>\n          <Button\n            type=\"submit\"\n            disabled={\n              saveMutation.isPending || \n              uploading || \n              !formData.imageUrl ||\n              (linkType === \"custom\" && !formData.ctaLink) ||\n              (linkType === \"product\" && !formData.productId)\n            }\n            className=\"h-12 px-10 rounded-full bg-primary text-primary-foreground hover:scale-105 active:scale-95 transition-all lowercase shadow-lg shadow-primary/20\"\n            data-testid=\"button-save\"\n          >\n            {saveMutation.isPending ? \"salvando...\" : banner ? \"salvar altera√ß√µes\" : \"concluir e criar\"}\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","path":null,"size_bytes":23461,"size_tokens":null},"client/src/components/admin/ContentCardForm.tsx":{"content":"import { useState, useRef, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { ArrowLeft, Upload, X, Layout, Type, Link as LinkIcon, Package, Settings, Edit, Loader2, Trash2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport type { ContentCard } from \"@shared/schema\";\n\ninterface Product {\n  id: string;\n  name: string;\n  price: string;\n  isActive: boolean;\n  imageUrl: string | null;\n}\n\ninterface ContentCardFormProps {\n  card: ContentCard | null;\n  onClose: () => void;\n  onSuccess: () => void;\n}\n\nexport default function ContentCardForm({ card, onClose, onSuccess }: ContentCardFormProps) {\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [uploading, setUploading] = useState(false);\n  const [linkType, setLinkType] = useState<\"custom\" | \"product\">(\n    card?.productId ? \"product\" : \"custom\"\n  );\n  const [formData, setFormData] = useState({\n    cardType: card?.cardType || \"feature\",\n    title: card?.title || \"\",\n    subtitle: card?.subtitle || \"\",\n    ctaText: card?.ctaText || \"\",\n    ctaLink: card?.ctaLink || \"\",\n    productId: card?.productId || \"\",\n    imageUrl: card?.imageUrl || \"\",\n    position: card?.position || \"center\",\n    height: card?.height || \"medium\",\n    isActive: card?.isActive !== false,\n    sortOrder: card?.sortOrder || 0,\n  });\n\n  const { data: productsData } = useQuery<{ products: Product[] }>({\n    queryKey: ['/api/admin/products'],\n  });\n\n  const saveMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const url = card \n        ? `/api/admin/content-cards/${card.id}`\n        : \"/api/admin/content-cards\";\n      \n      const dataToSend = {\n        ...data,\n        ctaLink: linkType === \"custom\" ? data.ctaLink : null,\n        productId: linkType === \"product\" ? data.productId : null,\n        title: data.title || null,\n        subtitle: data.subtitle || null,\n        ctaText: data.ctaText || null,\n      };\n      \n      const response = await apiRequest(\n        card ? \"PATCH\" : \"POST\",\n        url,\n        dataToSend\n      );\n      \n      if (!response.ok) throw new Error(\"Erro ao salvar card\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/content-cards'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-cards'] });\n      toast({\n        title: card ? \"Card atualizado\" : \"Card criado\",\n        description: \"As altera√ß√µes foram salvas com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel salvar o card.\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => {\n      if (!card?.id) return;\n      const response = await apiRequest(\"DELETE\", `/api/admin/content-cards/${card.id}`);\n      if (!response.ok) throw new Error(\"Erro ao deletar\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/content-cards'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/content-cards'] });\n      toast({\n        title: \"Card deletado\",\n        description: \"O card foi removido com sucesso.\",\n      });\n      onSuccess();\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel deletar o card.\",\n      });\n    },\n  });\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    if (!file.type.startsWith('image/')) {\n      toast({\n        variant: \"destructive\",\n        title: \"Formato inv√°lido\",\n        description: \"Por favor, selecione uma imagem.\",\n      });\n      return;\n    }\n\n    setUploading(true);\n    try {\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n      uploadFormData.append('type', 'banner');\n\n      const response = await fetch('/api/admin/upload-banner', {\n        method: 'POST',\n        credentials: 'include',\n        body: uploadFormData,\n      });\n\n      if (!response.ok) throw new Error(\"Erro no upload\");\n\n      const data = await response.json();\n      setFormData({ ...formData, imageUrl: data.imageUrl });\n      \n      toast({\n        title: \"Upload conclu√≠do\",\n        description: \"Imagem enviada com sucesso.\",\n      });\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro no upload\",\n        description: \"N√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    } finally {\n      setUploading(false);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    saveMutation.mutate(formData);\n  };\n\n  const [showDeleteDialog, setShowDeleteDialog] = useState(false);\n\n  const handleDelete = () => {\n    setShowDeleteDialog(true);\n  };\n\n  return (\n    <div className=\"space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700\">\n      <div className=\"flex items-center gap-4\">\n        <Button\n          variant=\"ghost\"\n          size=\"icon\"\n          onClick={onClose}\n          className=\"rounded-full hover:bg-muted/50\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-5 w-5\" />\n        </Button>\n        <div>\n          <h1 className=\"text-3xl font-light lowercase tracking-tight\">\n            {card ? \"editar card\" : \"novo card de conte√∫do\"}\n          </h1>\n          <p className=\"text-sm text-muted-foreground lowercase opacity-70\">\n            personalize o destaque visual da sua p√°gina inicial\n          </p>\n        </div>\n      </div>\n\n      <form onSubmit={handleSubmit} className=\"max-w-5xl mx-auto space-y-10 pb-20\">\n        {/* M√≠dia e Visual - Apple Style */}\n        <section className=\"space-y-4\">\n          <div className=\"flex items-center gap-2 px-1\">\n            <Layout className=\"h-4 w-4 text-muted-foreground\" />\n            <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">imagem principal</h2>\n          </div>\n          \n          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n            <Card className=\"lg:col-span-2 overflow-hidden border-white/5 bg-muted/20 backdrop-blur-sm transition-all hover:bg-muted/30 rounded-[2rem]\">\n              <CardContent className=\"p-0\">\n                {formData.imageUrl ? (\n                  <div className=\"relative group aspect-video\">\n                    <img\n                      src={formData.imageUrl}\n                      alt=\"Preview\"\n                      className=\"w-full h-full object-cover transition-transform duration-1000 group-hover:scale-105\"\n                      loading=\"lazy\"\n                      decoding=\"async\"\n                    />\n                    <div className=\"absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                      <Button\n                        type=\"button\"\n                        variant=\"secondary\"\n                        size=\"sm\"\n                        className=\"rounded-full bg-white/10 backdrop-blur-md border-white/20 hover:bg-white/20 lowercase\"\n                        onClick={() => setFormData({ ...formData, imageUrl: \"\" })}\n                      >\n                        <X className=\"h-4 w-4 mr-2\" />\n                        remover imagem\n                      </Button>\n                    </div>\n                  </div>\n                ) : (\n                  <div\n                    className=\"aspect-video flex flex-col items-center justify-center cursor-pointer group\"\n                    onClick={() => fileInputRef.current?.click()}\n                  >\n                    <div className=\"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4 group-hover:scale-110 transition-transform duration-500\">\n                      <Upload className=\"h-6 w-6 text-muted-foreground group-hover:text-primary transition-colors\" />\n                    </div>\n                    <p className=\"text-sm font-medium lowercase mb-1\">clique para upload</p>\n                    <p className=\"text-xs text-muted-foreground lowercase\">imagem em alta resolu√ß√£o</p>\n                  </div>\n                )}\n              </CardContent>\n              <div className=\"px-6 py-4 bg-muted/40 border-t border-white/5\">\n                <Input\n                  id=\"imageUrl\"\n                  value={formData.imageUrl}\n                  onChange={(e) => setFormData({ ...formData, imageUrl: e.target.value })}\n                  placeholder=\"cole a URL da imagem aqui...\"\n                  disabled={uploading}\n                  className=\"bg-transparent border-none px-0 h-8 focus-visible:ring-0 placeholder:text-muted-foreground/50 lowercase\"\n                  data-testid=\"input-image-url\"\n                />\n              </div>\n            </Card>\n\n            <div className=\"space-y-6\">\n              <div className=\"p-6 rounded-3xl bg-muted/20 border border-white/5 space-y-4\">\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">tipo de card</Label>\n                  <Select\n                    value={formData.cardType}\n                    onValueChange={(value) => setFormData({ ...formData, cardType: value })}\n                  >\n                    <SelectTrigger className=\"h-12 rounded-2xl bg-muted/40 border-none px-4\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"rounded-2xl border-white/10 bg-black/90 backdrop-blur-xl\">\n                      <SelectItem value=\"feature\" className=\"rounded-xl focus:bg-white/10 lowercase\">Feature (Vertical)</SelectItem>\n                      <SelectItem value=\"lifestyle\" className=\"rounded-xl focus:bg-white/10 lowercase\">Lifestyle (Horizontal)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">altura da se√ß√£o</Label>\n                  <Select\n                    value={formData.height}\n                    onValueChange={(value) => setFormData({ ...formData, height: value })}\n                  >\n                    <SelectTrigger className=\"h-12 rounded-2xl bg-muted/40 border-none px-4\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"rounded-2xl border-white/10 bg-black/90 backdrop-blur-xl\">\n                      <SelectItem value=\"small\" className=\"rounded-xl focus:bg-white/10 lowercase\">Pequena (40vh)</SelectItem>\n                      <SelectItem value=\"medium\" className=\"rounded-xl focus:bg-white/10 lowercase\">M√©dia (50vh)</SelectItem>\n                      <SelectItem value=\"large\" className=\"rounded-xl focus:bg-white/10 lowercase\">Grande (80vh)</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n              </div>\n            </div>\n          </div>\n        </section>\n\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-10\">\n          {/* Conte√∫do e Textos */}\n          <section className=\"space-y-6\">\n            <div className=\"flex items-center gap-2 px-1\">\n              <Type className=\"h-4 w-4 text-muted-foreground\" />\n              <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">textos e conte√∫do</h2>\n            </div>\n            \n            <div className=\"space-y-6 p-8 rounded-[2rem] bg-muted/10 border border-white/5\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">t√≠tulo</Label>\n                <Input\n                  id=\"title\"\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  placeholder=\"ex: vista sua f√©\"\n                  className=\"bg-muted/20 border-white/5 rounded-2xl h-14 px-5 focus:bg-muted/30 transition-all text-lg lowercase\"\n                  data-testid=\"input-title\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"subtitle\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">subt√≠tulo</Label>\n                <Textarea\n                  id=\"subtitle\"\n                  value={formData.subtitle}\n                  onChange={(e) => setFormData({ ...formData, subtitle: e.target.value })}\n                  placeholder=\"ex: mais que roupas, um estilo de vida\"\n                  rows={4}\n                  className=\"bg-muted/20 border-white/5 rounded-2xl px-5 py-4 focus:bg-muted/30 transition-all lowercase resize-none leading-relaxed\"\n                  data-testid=\"input-subtitle\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">alinhamento do texto</Label>\n                <Select\n                  value={formData.position}\n                  onValueChange={(value) => setFormData({ ...formData, position: value })}\n                >\n                  <SelectTrigger className=\"h-12 rounded-2xl bg-muted/20 border-white/5 px-5\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent className=\"rounded-2xl border-white/10 bg-black/90 backdrop-blur-xl\">\n                    <SelectItem value=\"left\" className=\"rounded-xl lowercase\">esquerda</SelectItem>\n                    <SelectItem value=\"center\" className=\"rounded-xl lowercase\">centro</SelectItem>\n                    <SelectItem value=\"right\" className=\"rounded-xl lowercase\">direita</SelectItem>\n                    <SelectItem value=\"bottom\" className=\"rounded-xl lowercase\">embaixo</SelectItem>\n                  </SelectContent>\n                </Select>\n              </div>\n            </div>\n          </section>\n\n          {/* A√ß√£o e Produto */}\n          <section className=\"space-y-6\">\n            <div className=\"flex items-center gap-2 px-1\">\n              <LinkIcon className=\"h-4 w-4 text-muted-foreground\" />\n              <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">chamada para a√ß√£o</h2>\n            </div>\n\n            <div className=\"space-y-6 p-8 rounded-[2rem] bg-muted/10 border border-white/5\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"ctaText\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">texto do bot√£o</Label>\n                <Input\n                  id=\"ctaText\"\n                  value={formData.ctaText}\n                  onChange={(e) => setFormData({ ...formData, ctaText: e.target.value })}\n                  placeholder=\"ex: ver cole√ß√£o\"\n                  className=\"bg-muted/20 border-white/5 rounded-2xl h-14 px-5 lowercase shadow-inner\"\n                  data-testid=\"input-cta-text\"\n                />\n              </div>\n\n              <div className=\"space-y-4\">\n                <Label className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">tipo de link</Label>\n                <RadioGroup \n                  value={linkType} \n                  onValueChange={(value: \"custom\" | \"product\") => setLinkType(value)}\n                  className=\"grid grid-cols-2 gap-4\"\n                >\n                  <div>\n                    <RadioGroupItem value=\"custom\" id=\"link-custom\" className=\"peer sr-only\" />\n                    <Label\n                      htmlFor=\"link-custom\"\n                      className=\"flex flex-col items-center justify-center rounded-2xl border border-white/5 bg-muted/20 p-4 hover:bg-muted/40 peer-data-[state=checked]:border-primary/50 peer-data-[state=checked]:bg-primary/5 transition-all cursor-pointer\"\n                    >\n                      <LinkIcon className=\"mb-2 h-4 w-4 opacity-50\" />\n                      <span className=\"text-[11px] lowercase font-medium\">personalizado</span>\n                    </Label>\n                  </div>\n                  <div>\n                    <RadioGroupItem value=\"product\" id=\"link-product\" className=\"peer sr-only\" />\n                    <Label\n                      htmlFor=\"link-product\"\n                      className=\"flex flex-col items-center justify-center rounded-2xl border border-white/5 bg-muted/20 p-4 hover:bg-muted/40 peer-data-[state=checked]:border-primary/50 peer-data-[state=checked]:bg-primary/5 transition-all cursor-pointer\"\n                    >\n                      <Package className=\"mb-2 h-4 w-4 opacity-50\" />\n                      <span className=\"text-[11px] lowercase font-medium\">produto</span>\n                    </Label>\n                  </div>\n                </RadioGroup>\n              </div>\n\n              {linkType === \"custom\" ? (\n                <div className=\"space-y-2 pt-2\">\n                  <Label htmlFor=\"ctaLink\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">URL de destino</Label>\n                  <Input\n                    id=\"ctaLink\"\n                    value={formData.ctaLink}\n                    onChange={(e) => setFormData({ ...formData, ctaLink: e.target.value })}\n                    placeholder=\"ex: /sobre ou https://...\"\n                    className=\"bg-muted/20 border-white/5 rounded-2xl h-12 px-5 lowercase\"\n                    data-testid=\"input-cta-link\"\n                  />\n                </div>\n              ) : (\n                <div className=\"space-y-2 pt-2\">\n                  <Label htmlFor=\"productId\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">vincular produto</Label>\n                  <Select\n                    value={formData.productId}\n                    onValueChange={(value) => setFormData({ ...formData, productId: value })}\n                  >\n                    <SelectTrigger className=\"h-auto min-h-14 py-3 rounded-2xl bg-muted/20 border-white/5 px-5\">\n                      <SelectValue placeholder=\"escolha um produto\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"rounded-2xl border-white/10 bg-black/95 backdrop-blur-2xl\">\n                      {productsData?.products?.map((product) => (\n                        <SelectItem key={product.id} value={product.id} className=\"rounded-xl focus:bg-white/10 p-3\">\n                          <div className=\"flex items-center gap-3\">\n                            {product.imageUrl ? (\n                              <img src={product.imageUrl} alt=\"\" className=\"w-10 h-10 object-cover rounded-lg\" loading=\"lazy\" decoding=\"async\" />\n                            ) : (\n                              <div className=\"w-10 h-10 bg-muted/40 rounded-lg flex items-center justify-center text-[10px]\">sem foto</div>\n                            )}\n                            <div className=\"flex flex-col text-left\">\n                              <span className=\"text-sm font-medium lowercase\">{product.name}</span>\n                              <span className=\"text-[10px] text-muted-foreground lowercase\">R$ {product.price}</span>\n                            </div>\n                          </div>\n                        </SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n              )}\n            </div>\n          </section>\n        </div>\n\n        {/* Prefer√™ncias e Ordem */}\n        <section className=\"space-y-6\">\n          <div className=\"flex items-center gap-2 px-1\">\n            <Settings className=\"h-4 w-4 text-muted-foreground\" />\n            <h2 className=\"text-sm font-medium lowercase text-muted-foreground tracking-tight\">prefer√™ncias do sistema</h2>\n          </div>\n\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n            <div className=\"flex items-center justify-between p-6 rounded-[2rem] bg-muted/10 border border-white/5\">\n              <div className=\"space-y-0.5\">\n                <Label className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60\">visibilidade</Label>\n                <p className=\"text-xs text-muted-foreground lowercase\">card ativo no site</p>\n              </div>\n              <Switch\n                checked={formData.isActive}\n                onCheckedChange={(checked) => setFormData({ ...formData, isActive: checked })}\n                data-testid=\"switch-is-active\"\n              />\n            </div>\n\n            <div className=\"p-6 rounded-[2rem] bg-muted/10 border border-white/5 space-y-2\">\n              <Label htmlFor=\"sortOrder\" className=\"text-[10px] font-bold uppercase tracking-widest text-muted-foreground/60 ml-1\">ordem</Label>\n              <Input\n                id=\"sortOrder\"\n                type=\"number\"\n                value={formData.sortOrder}\n                onChange={(e) => setFormData({ ...formData, sortOrder: parseInt(e.target.value) || 0 })}\n                className=\"bg-transparent border-none h-8 px-1 focus-visible:ring-0 text-xl font-medium\"\n                data-testid=\"input-sort-order\"\n              />\n              <p className=\"text-[10px] text-muted-foreground lowercase ml-1\">maior aparece primeiro</p>\n            </div>\n          </div>\n        </section>\n\n        {/* Action Buttons - Integrated into Flow */}\n        <div className=\"flex flex-col sm:flex-row items-center justify-end gap-4 pt-6 border-t border-white/5\">\n          {card && (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              onClick={handleDelete}\n              className=\"w-full sm:w-auto h-12 px-6 rounded-2xl text-muted-foreground hover:text-destructive hover:bg-destructive/10 transition-all lowercase\"\n            >\n              <Trash2 className=\"h-5 w-5 mr-2\" />\n              deletar card\n            </Button>\n          )}\n          <div className=\"flex-1\" />\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            onClick={onClose}\n            className=\"w-full sm:w-auto h-12 px-8 rounded-2xl text-muted-foreground hover:bg-white/5 transition-all lowercase\"\n          >\n            cancelar\n          </Button>\n          <Button\n            type=\"submit\"\n            disabled={saveMutation.isPending || uploading || !formData.imageUrl}\n            className=\"w-full sm:w-auto h-12 px-10 rounded-2xl bg-primary text-primary-foreground hover:scale-[1.02] active:scale-95 transition-all shadow-lg shadow-primary/20 lowercase font-semibold\"\n          >\n            {saveMutation.isPending ? <Loader2 className=\"h-5 w-5 animate-spin\" /> : \"salvar altera√ß√µes\"}\n          </Button>\n        </div>\n      </form>\n\n      <AlertDialog open={showDeleteDialog} onOpenChange={setShowDeleteDialog}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"lowercase\">deletar card?</AlertDialogTitle>\n            <AlertDialogDescription className=\"lowercase\">\n              essa a√ß√£o n√£o pode ser desfeita. o card ser√° removido permanentemente.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"lowercase\">cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              className=\"bg-destructive text-destructive-foreground lowercase\"\n              onClick={() => {\n                deleteMutation.mutate();\n                setShowDeleteDialog(false);\n              }}\n            >\n              deletar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":24908,"size_tokens":null},"client/src/components/admin/AdminContentCards.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Edit, Palette, Image } from \"lucide-react\";\nimport ContentCardForm from \"./ContentCardForm\";\nimport type { ContentCard } from \"@shared/schema\";\n\nexport default function AdminContentCards() {\n  const [editingCard, setEditingCard] = useState<ContentCard | null>(null);\n\n  const { data: cardsData, isLoading } = useQuery<{ cards: ContentCard[] }>({\n    queryKey: ['/api/admin/content-cards'],\n  });\n\n  const cards = cardsData?.cards || [];\n  \n  const featureCard = cards.find(c => c.cardType === 'feature');\n  const lifestyleCard = cards.find(c => c.cardType === 'lifestyle');\n\n  const handleClose = () => {\n    setEditingCard(null);\n  };\n\n  const handleSuccess = () => {\n    handleClose();\n  };\n\n  if (editingCard) {\n    return (\n      <ContentCardForm\n        card={editingCard}\n        onClose={handleClose}\n        onSuccess={handleSuccess}\n      />\n    );\n  }\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-4 md:space-y-6\">\n        <div>\n          <h1 className=\"text-2xl md:text-3xl font-light lowercase\">cards de conte√∫do</h1>\n          <p className=\"text-sm text-muted-foreground lowercase\">\n            edite os 2 banners fixos da home\n          </p>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          {[1, 2].map((i) => (\n            <Card key={i} className=\"overflow-hidden\">\n              <CardHeader className=\"border-b bg-muted/30\">\n                <div className=\"h-6 w-32 bg-muted animate-pulse rounded\" />\n              </CardHeader>\n              <div className=\"aspect-video bg-muted animate-pulse\" />\n              <CardContent className=\"p-4 space-y-3\">\n                <div className=\"h-4 w-3/4 bg-muted animate-pulse rounded\" />\n                <div className=\"h-3 w-1/2 bg-muted animate-pulse rounded\" />\n                <div className=\"h-10 w-full bg-muted animate-pulse rounded\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-4 md:space-y-6\">\n      <div>\n        <h1 className=\"text-2xl md:text-3xl font-light lowercase\">cards de conte√∫do</h1>\n        <p className=\"text-sm text-muted-foreground lowercase\">\n          edite os 2 banners fixos da home\n        </p>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        <Card className=\"overflow-hidden\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-2\">\n              <Palette className=\"h-5 w-5\" />\n              <CardTitle className=\"text-lg lowercase\">feature banner</CardTitle>\n            </div>\n          </CardHeader>\n          {featureCard ? (\n            <>\n              <div className=\"aspect-video bg-muted overflow-hidden\">\n                <img\n                  src={featureCard.imageUrl}\n                  alt={featureCard.title || 'Feature Banner'}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                />\n              </div>\n              <CardContent className=\"p-4 space-y-3\">\n                <div className=\"space-y-1\">\n                  <h3 className=\"font-medium lowercase\">\n                    {featureCard.title || 'sem t√≠tulo'}\n                  </h3>\n                  {featureCard.subtitle && (\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      {featureCard.subtitle}\n                    </p>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className={`h-2 w-2 rounded-full ${featureCard.isActive ? 'bg-green-500' : 'bg-muted-foreground'}`} />\n                  <span className=\"text-xs text-muted-foreground lowercase\">\n                    {featureCard.isActive ? 'ativo' : 'inativo'}\n                  </span>\n                </div>\n                <Button \n                  onClick={() => setEditingCard(featureCard)}\n                  className=\"w-full lowercase\"\n                  data-testid=\"button-edit-feature\"\n                >\n                  <Edit className=\"h-4 w-4 mr-2\" />\n                  editar\n                </Button>\n              </CardContent>\n            </>\n          ) : (\n            <CardContent className=\"p-12 text-center\">\n              <Image className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n              <p className=\"text-muted-foreground lowercase mb-4\">\n                feature banner n√£o configurado\n              </p>\n              <p className=\"text-xs text-muted-foreground lowercase mb-4\">\n                este banner precisa ser criado no banco de dados\n              </p>\n            </CardContent>\n          )}\n        </Card>\n\n        <Card className=\"overflow-hidden\">\n          <CardHeader className=\"border-b bg-muted/30\">\n            <div className=\"flex items-center gap-2\">\n              <Image className=\"h-5 w-5\" />\n              <CardTitle className=\"text-lg lowercase\">lifestyle banner</CardTitle>\n            </div>\n          </CardHeader>\n          {lifestyleCard ? (\n            <>\n              <div className=\"aspect-video bg-muted overflow-hidden\">\n                <img\n                  src={lifestyleCard.imageUrl}\n                  alt={lifestyleCard.title || 'Lifestyle Banner'}\n                  className=\"w-full h-full object-cover\"\n                  loading=\"lazy\"\n                  decoding=\"async\"\n                />\n              </div>\n              <CardContent className=\"p-4 space-y-3\">\n                <div className=\"space-y-1\">\n                  <h3 className=\"font-medium lowercase\">\n                    {lifestyleCard.title || 'sem t√≠tulo'}\n                  </h3>\n                  {lifestyleCard.subtitle && (\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      {lifestyleCard.subtitle}\n                    </p>\n                  )}\n                </div>\n                <div className=\"flex items-center gap-2\">\n                  <div className={`h-2 w-2 rounded-full ${lifestyleCard.isActive ? 'bg-green-500' : 'bg-muted-foreground'}`} />\n                  <span className=\"text-xs text-muted-foreground lowercase\">\n                    {lifestyleCard.isActive ? 'ativo' : 'inativo'}\n                  </span>\n                </div>\n                <Button \n                  onClick={() => setEditingCard(lifestyleCard)}\n                  className=\"w-full lowercase\"\n                  data-testid=\"button-edit-lifestyle\"\n                >\n                  <Edit className=\"h-4 w-4 mr-2\" />\n                  editar\n                </Button>\n              </CardContent>\n            </>\n          ) : (\n            <CardContent className=\"p-12 text-center\">\n              <Image className=\"h-12 w-12 mx-auto mb-4 text-muted-foreground\" />\n              <p className=\"text-muted-foreground lowercase mb-4\">\n                lifestyle banner n√£o configurado\n              </p>\n              <p className=\"text-xs text-muted-foreground lowercase mb-4\">\n                este banner precisa ser criado no banco de dados\n              </p>\n            </CardContent>\n          )}\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7452,"size_tokens":null},"client/src/components/admin/AdminCtaBanner.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { Upload, X, Loader2 } from \"lucide-react\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\nexport default function AdminCtaBanner() {\n  const { toast } = useToast();\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const [formData, setFormData] = useState({\n    tagLabel: \"\",\n    title: \"\",\n    description: \"\",\n    buttonText: \"\",\n    buttonBgColor: \"#ffffff\",\n  });\n\n  const { data: configData, isLoading } = useQuery<{ config: any }>({\n    queryKey: ['/api/admin/cta-banner'],\n  });\n\n  // Initialize form with config data when it loads\n  useState(() => {\n    if (configData?.config) {\n      setFormData({\n        tagLabel: configData.config.tagLabel || \"\",\n        title: configData.config.title || \"\",\n        description: configData.config.description || \"\",\n        buttonText: configData.config.buttonText || \"\",\n        buttonBgColor: configData.config.buttonBgColor || \"#ffffff\",\n      });\n    }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"PUT\", \"/api/admin/cta-banner\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n      toast({\n        title: \"Banner atualizado\",\n        description: \"As configura√ß√µes foram salvas com sucesso!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar o banner.\",\n      });\n    }\n  });\n\n  const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    setIsUploading(true);\n    try {\n      const uploadFormData = new FormData();\n      uploadFormData.append('image', file);\n\n      // Use fetch directly for file uploads (not apiRequest which sets JSON headers)\n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      if (sessionId) {\n        headers['x-session-id'] = sessionId;\n      }\n\n      const response = await fetch(\"/api/admin/cta-banner/image\", {\n        method: \"POST\",\n        headers,\n        body: uploadFormData,\n      });\n\n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n        toast({\n          title: \"Imagem atualizada\",\n          description: \"A imagem de fundo foi atualizada com sucesso!\",\n        });\n      } else {\n        throw new Error('Upload failed');\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel fazer upload da imagem.\",\n      });\n    } finally {\n      setIsUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleRemoveImage = async () => {\n    try {\n      const response = await apiRequest(\"PUT\", \"/api/admin/cta-banner\", {\n        backgroundImageUrl: null\n      });\n      \n      if (response.ok) {\n        queryClient.invalidateQueries({ queryKey: ['/api/admin/cta-banner'] });\n        queryClient.invalidateQueries({ queryKey: ['/api/cta-banner'] });\n        toast({\n          title: \"Imagem removida\",\n          description: \"A imagem de fundo foi removida.\",\n        });\n      }\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel remover a imagem.\",\n      });\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateMutation.mutate(formData);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        <div>\n          <h1 className=\"text-3xl font-light lowercase mb-2\">banner cta</h1>\n          <p className=\"text-muted-foreground lowercase\">carregando...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const currentImage = configData?.config?.backgroundImageUrl;\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-3xl font-light lowercase mb-2\">banner cta</h1>\n        <p className=\"text-muted-foreground lowercase\">configurar o banner \"ver todos os produtos\"</p>\n      </div>\n\n      <div className=\"grid gap-6 lg:grid-cols-2\">\n        {/* Image Upload Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"lowercase\">imagem de fundo</CardTitle>\n            <CardDescription className=\"lowercase\">\n              fa√ßa upload da imagem de fundo do banner (recomendado: 1920x800px)\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {currentImage ? (\n              <div className=\"space-y-4\">\n                <div className=\"relative aspect-[16/9] overflow-hidden rounded-md border\">\n                  <img\n                    src={currentImage}\n                    alt=\"Banner background\"\n                    className=\"w-full h-full object-cover\"\n                    loading=\"lazy\"\n                    decoding=\"async\"\n                  />\n                </div>\n                <div className=\"flex gap-2\">\n                  <Button\n                    variant=\"outline\"\n                    size=\"sm\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={isUploading}\n                    className=\"lowercase flex-1\"\n                    data-testid=\"button-upload-cta-image\"\n                  >\n                    <Upload className=\"h-4 w-4 mr-2\" />\n                    {isUploading ? \"enviando...\" : \"trocar imagem\"}\n                  </Button>\n                  <Button\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    onClick={handleRemoveImage}\n                    className=\"lowercase\"\n                    data-testid=\"button-remove-cta-image\"\n                  >\n                    <X className=\"h-4 w-4 mr-2\" />\n                    remover\n                  </Button>\n                </div>\n              </div>\n            ) : (\n              <div className=\"flex flex-col items-center justify-center border-2 border-dashed rounded-md p-12 space-y-4\">\n                <Upload className=\"h-12 w-12 text-muted-foreground\" />\n                <div className=\"text-center space-y-2\">\n                  <p className=\"text-sm text-muted-foreground lowercase\">\n                    nenhuma imagem de fundo\n                  </p>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => fileInputRef.current?.click()}\n                    disabled={isUploading}\n                    className=\"lowercase\"\n                    data-testid=\"button-upload-cta-image\"\n                  >\n                    {isUploading ? (\n                      <>\n                        <Loader2 className=\"h-4 w-4 mr-2 animate-spin\" />\n                        enviando...\n                      </>\n                    ) : (\n                      <>\n                        <Upload className=\"h-4 w-4 mr-2\" />\n                        fazer upload\n                      </>\n                    )}\n                  </Button>\n                </div>\n              </div>\n            )}\n            <input\n              ref={fileInputRef}\n              type=\"file\"\n              accept=\"image/*\"\n              onChange={handleImageUpload}\n              className=\"hidden\"\n            />\n          </CardContent>\n        </Card>\n\n        {/* Configuration Form Card */}\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"lowercase\">textos e cores</CardTitle>\n            <CardDescription className=\"lowercase\">configure os textos e cores do banner</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"tagLabel\" className=\"lowercase\">label superior</Label>\n                <Input\n                  id=\"tagLabel\"\n                  value={formData.tagLabel}\n                  onChange={(e) => setFormData({ ...formData, tagLabel: e.target.value })}\n                  placeholder=\"ex: cole√ß√£o completa\"\n                  data-testid=\"input-cta-tag-label\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"title\" className=\"lowercase\">t√≠tulo</Label>\n                <Input\n                  id=\"title\"\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  placeholder=\"ex: explore toda a cole√ß√£o\"\n                  required\n                  data-testid=\"input-cta-title\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"description\" className=\"lowercase\">descri√ß√£o</Label>\n                <Textarea\n                  id=\"description\"\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"ex: descubra pe√ßas √∫nicas...\"\n                  rows={3}\n                  data-testid=\"input-cta-description\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"buttonText\" className=\"lowercase\">texto do bot√£o</Label>\n                <Input\n                  id=\"buttonText\"\n                  value={formData.buttonText}\n                  onChange={(e) => setFormData({ ...formData, buttonText: e.target.value })}\n                  placeholder=\"ex: ver todos os produtos\"\n                  required\n                  data-testid=\"input-cta-button-text\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"buttonBgColor\" className=\"lowercase\">cor de fundo do bot√£o</Label>\n                <div className=\"flex gap-2\">\n                  <Input\n                    id=\"buttonBgColor\"\n                    type=\"color\"\n                    value={formData.buttonBgColor}\n                    onChange={(e) => setFormData({ ...formData, buttonBgColor: e.target.value })}\n                    className=\"w-16 h-10 p-1\"\n                    data-testid=\"input-cta-button-color\"\n                  />\n                  <Input\n                    value={formData.buttonBgColor}\n                    onChange={(e) => setFormData({ ...formData, buttonBgColor: e.target.value })}\n                    placeholder=\"#ffffff\"\n                    className=\"flex-1\"\n                  />\n                </div>\n                <p className=\"text-xs text-muted-foreground lowercase\">\n                  cor em formato hexadecimal (ex: #ffffff)\n                </p>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full lowercase\"\n                disabled={updateMutation.isPending}\n                data-testid=\"button-save-cta-config\"\n              >\n                {updateMutation.isPending ? \"salvando...\" : \"salvar configura√ß√µes\"}\n              </Button>\n            </form>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":11909,"size_tokens":null},"client/src/components/admin/AdminFAQ.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogFooter,\n} from \"@/components/ui/dialog\";\nimport { \n  Plus, \n  Edit, \n  Trash2, \n  MoveUp,\n  MoveDown,\n  Eye,\n  EyeOff\n} from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface Faq {\n  id: string;\n  question: string;\n  answer: string;\n  category: string;\n  sortOrder: number;\n  isActive: boolean;\n}\n\nconst categoryLabels: Record<string, string> = {\n  geral: \"Geral\",\n  envio: \"Envio\",\n  produto: \"Produto\",\n  pagamento: \"Pagamento\",\n  devolucao: \"Devolu√ß√£o\",\n};\n\nexport default function AdminFAQ() {\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editingFaq, setEditingFaq] = useState<Faq | null>(null);\n  const [deletingFaq, setDeletingFaq] = useState<Faq | null>(null);\n  const [formData, setFormData] = useState({\n    question: \"\",\n    answer: \"\",\n    category: \"geral\",\n    sortOrder: 0,\n    isActive: true,\n  });\n\n  const { data: faqsData, isLoading } = useQuery<{ faqs: Faq[] }>({\n    queryKey: ['/api/admin/faqs'],\n  });\n\n  const createMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/faqs\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/faqs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/faqs'] });\n      toast({ \n        title: \"FAQ criado\",\n        description: \"A pergunta foi adicionada com sucesso!\" \n      });\n      setShowForm(false);\n      setFormData({\n        question: \"\",\n        answer: \"\",\n        category: \"geral\",\n        sortOrder: 0,\n        isActive: true,\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel criar o FAQ.\",\n      });\n    }\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async ({ id, data }: { id: string; data: Partial<typeof formData> }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/faqs/${id}`, data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/faqs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/faqs'] });\n      toast({ \n        title: \"FAQ atualizado\",\n        description: \"A pergunta foi atualizada com sucesso!\" \n      });\n      setShowForm(false);\n      setEditingFaq(null);\n      setFormData({\n        question: \"\",\n        answer: \"\",\n        category: \"geral\",\n        sortOrder: 0,\n        isActive: true,\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel atualizar o FAQ.\",\n      });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/faqs/${id}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/faqs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/faqs'] });\n      toast({ \n        title: \"FAQ deletado\",\n        description: \"A pergunta foi removida com sucesso!\" \n      });\n      setDeletingFaq(null);\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel deletar o FAQ.\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (editingFaq) {\n      updateMutation.mutate({ id: editingFaq.id, data: formData });\n    } else {\n      createMutation.mutate(formData);\n    }\n  };\n\n  const handleEdit = (faq: Faq) => {\n    setEditingFaq(faq);\n    setFormData({\n      question: faq.question,\n      answer: faq.answer,\n      category: faq.category,\n      sortOrder: faq.sortOrder,\n      isActive: faq.isActive,\n    });\n  };\n\n  const handleCancelEdit = () => {\n    setEditingFaq(null);\n    setFormData({\n      question: \"\",\n      answer: \"\",\n      category: \"geral\",\n      sortOrder: 0,\n      isActive: true,\n    });\n  };\n\n  const handleToggleActive = (faq: Faq) => {\n    updateMutation.mutate({ \n      id: faq.id, \n      data: { isActive: !faq.isActive } \n    });\n  };\n\n  const reorderMutation = useMutation({\n    mutationFn: async (updates: { id: string; sortOrder: number }[]) => {\n      const responses = await Promise.all(\n        updates.map(async ({ id, sortOrder }) => {\n          const response = await apiRequest(\"PATCH\", `/api/admin/faqs/${id}`, { sortOrder });\n          if (!response.ok) {\n            throw new Error(`Failed to update FAQ ${id}`);\n          }\n          return response.json();\n        })\n      );\n      return responses;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/faqs'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/faqs'] });\n      toast({\n        title: \"Ordem atualizada\",\n        description: \"A ordem dos FAQs foi alterada com sucesso!\",\n      });\n    },\n    onError: () => {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro\",\n        description: \"N√£o foi poss√≠vel reordenar os FAQs.\",\n      });\n    }\n  });\n\n  const handleMoveUp = (faq: Faq, categoryFaqs: Faq[], localIndex: number) => {\n    if (localIndex === 0) return;\n    const prevFaq = categoryFaqs[localIndex - 1];\n    \n    reorderMutation.mutate([\n      { id: faq.id, sortOrder: prevFaq.sortOrder },\n      { id: prevFaq.id, sortOrder: faq.sortOrder }\n    ]);\n  };\n\n  const handleMoveDown = (faq: Faq, categoryFaqs: Faq[], localIndex: number) => {\n    if (localIndex === categoryFaqs.length - 1) return;\n    const nextFaq = categoryFaqs[localIndex + 1];\n    \n    reorderMutation.mutate([\n      { id: faq.id, sortOrder: nextFaq.sortOrder },\n      { id: nextFaq.id, sortOrder: faq.sortOrder }\n    ]);\n  };\n\n  const faqs = faqsData?.faqs || [];\n  const groupedFaqs = faqs.reduce((acc: Record<string, Faq[]>, faq: Faq) => {\n    if (!acc[faq.category]) {\n      acc[faq.category] = [];\n    }\n    acc[faq.category].push(faq);\n    return acc;\n  }, {} as Record<string, Faq[]>);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-2xl sm:text-3xl font-light lowercase mb-2\">d√∫vidas frequentes</h1>\n          <p className=\"text-sm sm:text-base text-muted-foreground lowercase\">gerencie as perguntas frequentes da loja</p>\n        </div>\n        <Button\n          onClick={() => setShowForm(!showForm)}\n          data-testid=\"button-add-faq\"\n          className=\"lowercase w-full sm:w-auto\"\n        >\n          <Plus className=\"h-4 w-4 mr-2\" />\n          adicionar pergunta\n        </Button>\n      </div>\n\n      {showForm && !editingFaq && (\n        <Card>\n          <CardContent className=\"pt-6\">\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div className=\"grid gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"question\" className=\"lowercase\">pergunta</Label>\n                  <Input\n                    id=\"question\"\n                    value={formData.question}\n                    onChange={(e) => setFormData({ ...formData, question: e.target.value })}\n                    placeholder=\"Digite a pergunta...\"\n                    required\n                    data-testid=\"input-faq-question\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"answer\" className=\"lowercase\">resposta</Label>\n                  <Textarea\n                    id=\"answer\"\n                    value={formData.answer}\n                    onChange={(e) => setFormData({ ...formData, answer: e.target.value })}\n                    placeholder=\"Digite a resposta...\"\n                    required\n                    rows={5}\n                    data-testid=\"input-faq-answer\"\n                  />\n                </div>\n\n                <div className=\"grid sm:grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"category\" className=\"lowercase\">categoria</Label>\n                    <Select\n                      value={formData.category}\n                      onValueChange={(value) => setFormData({ ...formData, category: value })}\n                    >\n                      <SelectTrigger id=\"category\" data-testid=\"select-faq-category\">\n                        <SelectValue placeholder=\"selecione a categoria\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {Object.entries(categoryLabels).map(([value, label]) => (\n                          <SelectItem key={value} value={value}>{label}</SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"sortOrder\" className=\"lowercase\">ordem</Label>\n                    <Input\n                      id=\"sortOrder\"\n                      type=\"number\"\n                      value={formData.sortOrder}\n                      onChange={(e) => setFormData({ ...formData, sortOrder: parseInt(e.target.value) })}\n                      min=\"0\"\n                      data-testid=\"input-faq-sort-order\"\n                    />\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex flex-col sm:flex-row gap-2\">\n                <Button \n                  type=\"submit\" \n                  className=\"lowercase w-full sm:w-auto\" \n                  disabled={createMutation.isPending || updateMutation.isPending}\n                  data-testid=\"button-save-faq\"\n                >\n                  {createMutation.isPending || updateMutation.isPending \n                    ? \"salvando...\" \n                    : \"criar pergunta\"}\n                </Button>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  onClick={() => setShowForm(false)}\n                  className=\"lowercase w-full sm:w-auto\"\n                >\n                  cancelar\n                </Button>\n              </div>\n            </form>\n          </CardContent>\n        </Card>\n      )}\n\n      <Dialog open={!!editingFaq} onOpenChange={(open) => !open && handleCancelEdit()}>\n        <DialogContent className=\"max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"lowercase\">editar pergunta</DialogTitle>\n          </DialogHeader>\n          <form onSubmit={handleSubmit} className=\"space-y-4\">\n            <div className=\"grid gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-question\" className=\"lowercase\">pergunta</Label>\n                <Input\n                  id=\"edit-question\"\n                  value={formData.question}\n                  onChange={(e) => setFormData({ ...formData, question: e.target.value })}\n                  placeholder=\"Digite a pergunta...\"\n                  required\n                  data-testid=\"input-faq-question-edit\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"edit-answer\" className=\"lowercase\">resposta</Label>\n                <Textarea\n                  id=\"edit-answer\"\n                  value={formData.answer}\n                  onChange={(e) => setFormData({ ...formData, answer: e.target.value })}\n                  placeholder=\"Digite a resposta...\"\n                  required\n                  rows={5}\n                  data-testid=\"input-faq-answer-edit\"\n                />\n              </div>\n\n              <div className=\"grid sm:grid-cols-2 gap-4\">\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-category\" className=\"lowercase\">categoria</Label>\n                  <Select\n                    value={formData.category}\n                    onValueChange={(value) => setFormData({ ...formData, category: value })}\n                  >\n                    <SelectTrigger id=\"edit-category\" data-testid=\"select-faq-category-edit\">\n                      <SelectValue placeholder=\"selecione a categoria\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      {Object.entries(categoryLabels).map(([value, label]) => (\n                        <SelectItem key={value} value={value}>{label}</SelectItem>\n                      ))}\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"edit-sortOrder\" className=\"lowercase\">ordem</Label>\n                  <Input\n                    id=\"edit-sortOrder\"\n                    type=\"number\"\n                    value={formData.sortOrder}\n                    onChange={(e) => setFormData({ ...formData, sortOrder: parseInt(e.target.value) })}\n                    min=\"0\"\n                    data-testid=\"input-faq-sort-order-edit\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            <DialogFooter>\n              <Button \n                type=\"button\" \n                variant=\"outline\" \n                onClick={handleCancelEdit}\n                className=\"lowercase\"\n              >\n                cancelar\n              </Button>\n              <Button \n                type=\"submit\" \n                className=\"lowercase\" \n                disabled={createMutation.isPending || updateMutation.isPending}\n                data-testid=\"button-save-faq-edit\"\n              >\n                {updateMutation.isPending ? \"salvando...\" : \"atualizar pergunta\"}\n              </Button>\n            </DialogFooter>\n          </form>\n        </DialogContent>\n      </Dialog>\n\n      {isLoading ? (\n        <div className=\"text-center py-8 text-muted-foreground lowercase\">\n          carregando...\n        </div>\n      ) : faqs.length === 0 ? (\n        <div className=\"text-center py-12 text-muted-foreground\">\n          <p className=\"lowercase mb-4\">nenhuma pergunta cadastrada ainda</p>\n          <Button onClick={() => setShowForm(true)} variant=\"outline\" className=\"lowercase\">\n            <Plus className=\"h-4 w-4 mr-2\" />\n            adicionar primeira pergunta\n          </Button>\n        </div>\n      ) : (\n        <div className=\"space-y-6\">\n          {Object.entries(groupedFaqs).map(([category, categoryFaqs]: [string, Faq[]]) => (\n            <div key={category}>\n              <h2 className=\"text-lg sm:text-xl font-medium lowercase mb-4 text-foreground\">\n                {categoryLabels[category] || category}\n              </h2>\n              <div className=\"space-y-4\">\n                {categoryFaqs.map((faq: Faq, index: number) => (\n                  <Card key={faq.id}>\n                    <CardContent className=\"pt-6\">\n                      <div className=\"space-y-4\">\n                        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-4\">\n                          <div className=\"flex-1 min-w-0\">\n                            <div className=\"flex items-center gap-2 mb-2 flex-wrap\">\n                              <h3 className=\"font-medium lowercase text-sm sm:text-base break-words\">{faq.question}</h3>\n                              {!faq.isActive && (\n                                <Badge variant=\"secondary\" className=\"lowercase text-xs\">inativo</Badge>\n                              )}\n                            </div>\n                            <p className=\"text-xs sm:text-sm text-muted-foreground lowercase break-words\">{faq.answer}</p>\n                          </div>\n                          <div className=\"flex gap-1 flex-wrap sm:flex-nowrap sm:flex-shrink-0\">\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleToggleActive(faq)}\n                              data-testid={`button-toggle-faq-${faq.id}`}\n                            >\n                              {faq.isActive ? (\n                                <Eye className=\"h-4 w-4\" />\n                              ) : (\n                                <EyeOff className=\"h-4 w-4\" />\n                              )}\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleMoveUp(faq, categoryFaqs, index)}\n                              disabled={index === 0 || reorderMutation.isPending}\n                              data-testid={`button-move-up-faq-${faq.id}`}\n                            >\n                              <MoveUp className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleMoveDown(faq, categoryFaqs, index)}\n                              disabled={index === categoryFaqs.length - 1 || reorderMutation.isPending}\n                              data-testid={`button-move-down-faq-${faq.id}`}\n                            >\n                              <MoveDown className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => handleEdit(faq)}\n                              data-testid={`button-edit-faq-${faq.id}`}\n                            >\n                              <Edit className=\"h-4 w-4\" />\n                            </Button>\n                            <Button\n                              variant=\"ghost\"\n                              size=\"icon\"\n                              onClick={() => setDeletingFaq(faq)}\n                              data-testid={`button-delete-faq-${faq.id}`}\n                            >\n                              <Trash2 className=\"h-4 w-4\" />\n                            </Button>\n                          </div>\n                        </div>\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            </div>\n          ))}\n        </div>\n      )}\n\n      <AlertDialog open={!!deletingFaq} onOpenChange={() => setDeletingFaq(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"lowercase\">confirmar exclus√£o</AlertDialogTitle>\n            <AlertDialogDescription className=\"lowercase\">\n              tem certeza que deseja excluir esta pergunta? esta a√ß√£o n√£o pode ser desfeita.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"lowercase\">cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              onClick={() => deletingFaq && deleteMutation.mutate(deletingFaq.id)}\n              className=\"lowercase\"\n            >\n              excluir\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":20221,"size_tokens":null},"client/src/pages/FAQ.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n  Accordion,\n  AccordionContent,\n  AccordionItem,\n  AccordionTrigger,\n} from \"@/components/ui/accordion\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport Footer from \"@/components/Footer\";\n\ninterface Faq {\n  id: string;\n  question: string;\n  answer: string;\n  category: string;\n  sortOrder: number;\n  isActive: boolean;\n}\n\nconst categoryLabels: Record<string, string> = {\n  geral: \"geral\",\n  envio: \"envio e entrega\",\n  produto: \"produtos\",\n  pagamento: \"pagamento\",\n  devolucao: \"trocas e devolu√ß√µes\",\n};\n\nexport default function FAQ() {\n  const { data: faqsData, isLoading } = useQuery<{ faqs: Faq[] }>({\n    queryKey: ['/api/faqs'],\n  });\n\n  const faqs = faqsData?.faqs || [];\n  \n  const groupedFaqs = faqs.reduce((acc, faq) => {\n    if (!acc[faq.category]) {\n      acc[faq.category] = [];\n    }\n    acc[faq.category].push(faq);\n    return acc;\n  }, {} as Record<string, Faq[]>);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <main className=\"py-16 px-4\">\n        <div className=\"container mx-auto max-w-4xl\">\n          <div className=\"text-center mb-12\">\n            <h1 className=\"text-4xl md:text-5xl font-light lowercase mb-4 text-foreground\">\n              d√∫vidas frequentes\n            </h1>\n            <p className=\"text-muted-foreground lowercase max-w-2xl mx-auto\">\n              encontre respostas para as perguntas mais comuns sobre nossa loja, produtos e servi√ßos\n            </p>\n          </div>\n\n          {isLoading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"animate-pulse space-y-4\">\n                <div className=\"h-8 bg-muted rounded w-full max-w-md mx-auto\" />\n                <div className=\"h-24 bg-muted rounded w-full\" />\n                <div className=\"h-24 bg-muted rounded w-full\" />\n                <div className=\"h-24 bg-muted rounded w-full\" />\n              </div>\n            </div>\n          ) : faqs.length === 0 ? (\n            <Card>\n              <CardContent className=\"py-12 text-center\">\n                <p className=\"text-muted-foreground lowercase\">\n                  nenhuma pergunta frequente dispon√≠vel no momento\n                </p>\n              </CardContent>\n            </Card>\n          ) : (\n            <div className=\"space-y-12\">\n              {Object.entries(groupedFaqs).map(([category, categoryFaqs]) => (\n                <div key={category}>\n                  <h2 className=\"text-2xl md:text-3xl font-light lowercase mb-6 text-foreground\">\n                    {categoryLabels[category] || category}\n                  </h2>\n                  <Accordion type=\"single\" collapsible className=\"space-y-4\">\n                    {categoryFaqs.map((faq) => (\n                      <AccordionItem\n                        key={faq.id}\n                        value={faq.id}\n                        className=\"border rounded-md px-6 py-2\"\n                      >\n                        <AccordionTrigger \n                          className=\"lowercase text-left hover:no-underline\"\n                          data-testid={`faq-question-${faq.id}`}\n                        >\n                          <span className=\"font-medium\">{faq.question}</span>\n                        </AccordionTrigger>\n                        <AccordionContent \n                          className=\"text-muted-foreground lowercase pt-2\"\n                          data-testid={`faq-answer-${faq.id}`}\n                        >\n                          {faq.answer}\n                        </AccordionContent>\n                      </AccordionItem>\n                    ))}\n                  </Accordion>\n                </div>\n              ))}\n            </div>\n          )}\n\n          <div className=\"mt-16 text-center\">\n            <Card className=\"bg-muted/30\">\n              <CardContent className=\"py-8\">\n                <h3 className=\"text-xl font-light lowercase mb-3 text-foreground\">\n                  n√£o encontrou o que procura?\n                </h3>\n                <p className=\"text-muted-foreground lowercase mb-6\">\n                  entre em contato conosco e teremos prazer em ajudar\n                </p>\n                <div className=\"flex flex-col sm:flex-row gap-3 justify-center\">\n                  <a\n                    href=\"mailto:sac@oudla.com\"\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background bg-primary text-primary-foreground hover-elevate active-elevate-2 h-9 px-4 py-2 lowercase\"\n                    data-testid=\"link-contact-email\"\n                  >\n                    enviar email\n                  </a>\n                  <a\n                    href=\"https://wa.me/5511999999999\"\n                    target=\"_blank\"\n                    rel=\"noopener noreferrer\"\n                    className=\"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background border border-input hover-elevate active-elevate-2 h-9 px-4 py-2 lowercase\"\n                    data-testid=\"link-contact-whatsapp\"\n                  >\n                    falar no whatsapp\n                  </a>\n                </div>\n              </CardContent>\n            </Card>\n          </div>\n        </div>\n      </main>\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":5675,"size_tokens":null},"server/checkout-routes.ts":{"content":"import { Router } from \"express\";\nimport { z } from \"zod\";\nimport { storage } from \"./storage\";\nimport PDFDocument from \"pdfkit\";\nimport rateLimit from \"express-rate-limit\";\nimport { sendOrderConfirmationEmail } from \"./email\";\nimport {\n  createPreferenceClient,\n  createPaymentClient,\n  validateWebhookSignature,\n  getEnvironmentInfo,\n  getPublicKey\n} from \"./mercadopago\";\n\nconst router = Router();\n\nconst checkoutLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 10,\n  message: 'Muitas tentativas de checkout. Tente novamente mais tarde.',\n  standardHeaders: true,\n  legacyHeaders: false,\n  handler: (req: any, res: any) => {\n    console.warn(`Rate limit excedido para IP: ${req.ip}`);\n    res.status(429).json({ error: 'Too many requests. Try again later.' });\n  }\n});\n\nfunction validateCPF(cpf: string): boolean {\n  const cleanCpf = cpf.replace(/\\D/g, '');\n  if (cleanCpf.length !== 11) return false;\n  if (/^(\\d)\\1{10}$/.test(cleanCpf)) return false;\n  \n  let sum = 0;\n  let remainder;\n  \n  for (let i = 1; i <= 9; i++) {\n    sum += parseInt(cleanCpf.substring(i - 1, i)) * (11 - i);\n  }\n  \n  remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(cleanCpf.substring(9, 10))) return false;\n  \n  sum = 0;\n  for (let i = 1; i <= 10; i++) {\n    sum += parseInt(cleanCpf.substring(i - 1, i)) * (12 - i);\n  }\n  \n  remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(cleanCpf.substring(10, 11))) return false;\n  \n  return true;\n}\n\nconst checkoutItemSchema = z.object({\n  productId: z.string(),\n  productName: z.string(),\n  productImage: z.string(),\n  size: z.string().optional().nullable(),\n  color: z.object({\n    name: z.string(),\n    hex: z.string(),\n  }).optional().nullable(),\n  fabric: z.object({\n    name: z.string(),\n    price: z.number(),\n  }).optional().nullable(),\n  printPosition: z.string().optional().nullable(),\n  unitPrice: z.string(),\n  quantity: z.number().int().positive(),\n  subtotal: z.string(),\n});\n\nconst checkoutSchema = z.object({\n  customerName: z.string().min(3),\n  customerEmail: z.string().email(),\n  customerPhone: z.string().refine((val) => {\n    const numbers = val.replace(/\\D/g, '');\n    return numbers.length === 10 || numbers.length === 11;\n  }, \"Telefone deve ter 10 ou 11 d√≠gitos\"),\n  customerCpf: z.string().refine((val) => {\n    return validateCPF(val);\n  }, \"CPF inv√°lido\"),\n  zipCode: z.string().refine((val) => {\n    const numbers = val.replace(/\\D/g, '');\n    return numbers.length === 8;\n  }, \"CEP deve ter 8 d√≠gitos\"),\n  street: z.string().min(3),\n  number: z.string().min(1),\n  complement: z.string().optional(),\n  neighborhood: z.string().min(2),\n  city: z.string().min(2),\n  state: z.string().length(2),\n  items: z.array(checkoutItemSchema).min(1),\n  subtotal: z.string(),\n  discountAmount: z.string().optional(),\n  shippingCost: z.string(),\n  totalAmount: z.string(),\n  userAgent: z.string().optional(),\n  deviceType: z.string().optional(),\n  browserName: z.string().optional(),\n  browserVersion: z.string().optional(),\n  osName: z.string().optional(),\n  osVersion: z.string().optional(),\n  screenResolution: z.string().optional(),\n});\n\nfunction generateOrderNumber(): string {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0');\n  const day = String(now.getDate()).padStart(2, '0');\n  const dateStr = `${year}${month}${day}`;\n  \n  const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');\n  \n  return `OUDLA-${dateStr}-${random}`;\n}\n\nrouter.post(\"/create-order\", checkoutLimiter, async (req, res) => {\n  try {\n    const data = checkoutSchema.parse(req.body);\n\n    const itemsSubtotal = data.items.reduce((sum, item) => {\n      const unitPrice = parseFloat(item.unitPrice);\n      const itemTotal = unitPrice * item.quantity;\n      return sum + itemTotal;\n    }, 0);\n    \n    const discountAmount = parseFloat(data.discountAmount || \"0\");\n    const shippingCost = parseFloat(data.shippingCost);\n    const expectedTotal = itemsSubtotal - discountAmount + shippingCost;\n    const clientTotal = parseFloat(data.totalAmount);\n    \n    const priceDifference = Math.abs(expectedTotal - clientTotal);\n    if (priceDifference > 0.01) {\n      console.error(\"Pre√ßo total n√£o corresponde aos itens:\", {\n        expectedTotal: expectedTotal.toFixed(2),\n        clientTotal: clientTotal.toFixed(2),\n        difference: priceDifference.toFixed(2),\n        items: data.items.length\n      });\n      return res.status(400).json({ \n        error: \"Pre√ßo total inv√°lido.\",\n        expected: expectedTotal.toFixed(2),\n        received: clientTotal.toFixed(2)\n      });\n    }\n\n    const orderNumber = generateOrderNumber();\n\n    const orderItemsForDb = data.items.map((item) => ({\n      productId: item.productId,\n      productName: item.productName,\n      productImage: item.productImage,\n      size: item.size || \"Padr√£o\",\n      color: item.color ? JSON.stringify(item.color) : JSON.stringify({ name: \"Padr√£o\", hex: \"#000000\" }),\n      fabric: item.fabric ? JSON.stringify(item.fabric) : null,\n      printPosition: item.printPosition,\n      unitPrice: item.unitPrice,\n      quantity: item.quantity,\n      subtotal: item.subtotal,\n    }));\n\n    const clientIp = req.ip || req.headers['x-forwarded-for'] || req.headers['x-real-ip'] || 'unknown';\n    \n    const order = await storage.createOrder(\n      {\n        orderNumber,\n        customerName: data.customerName,\n        customerEmail: data.customerEmail,\n        customerPhone: data.customerPhone,\n        customerCpf: data.customerCpf,\n        zipCode: data.zipCode,\n        street: data.street,\n        number: data.number,\n        complement: data.complement,\n        neighborhood: data.neighborhood,\n        city: data.city,\n        state: data.state,\n        subtotal: data.subtotal,\n        discountAmount: data.discountAmount || \"0\",\n        shippingCost: data.shippingCost,\n        totalAmount: data.totalAmount,\n        orderStatus: \"pending\",\n        customerIp: typeof clientIp === 'string' ? clientIp : clientIp[0],\n        userAgent: data.userAgent,\n        deviceType: data.deviceType,\n        browserName: data.browserName,\n        browserVersion: data.browserVersion,\n        osName: data.osName,\n        osVersion: data.osVersion,\n        screenResolution: data.screenResolution,\n      },\n      orderItemsForDb\n    );\n    \n    console.log(\"Pedido criado:\", {\n      orderId: order.id,\n      orderNumber: order.orderNumber,\n    });\n\n    res.json({\n      success: true,\n      orderId: order.id,\n      orderNumber: order.orderNumber,\n      message: \"Pedido criado com sucesso. Aguardando integra√ß√£o com gateway de pagamento.\",\n    });\n  } catch (error) {\n    console.error(\"Erro ao criar pedido:\", error);\n    \n    if (error instanceof z.ZodError) {\n      return res.status(400).json({\n        success: false,\n        error: \"Dados inv√°lidos\",\n        details: error.errors,\n      });\n    }\n\n    res.status(500).json({\n      success: false,\n      error: \"Erro ao processar pedido\",\n    });\n  }\n});\n\nfunction validateOrderNumber(orderNumber: string): boolean {\n  return /^OUDLA-\\d{8}-\\d{4}$/.test(orderNumber);\n}\n\nrouter.get(\"/order/:orderNumber\", async (req, res) => {\n  try {\n    const { orderNumber } = req.params;\n    \n    if (!validateOrderNumber(orderNumber)) {\n      return res.status(400).json({\n        success: false,\n        error: \"N√∫mero de pedido inv√°lido\"\n      });\n    }\n    \n    const order = await storage.getOrderByOrderNumber(orderNumber);\n    \n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        error: \"Pedido n√£o encontrado\"\n      });\n    }\n    \n    const items = await storage.getOrderItems(order.id);\n    \n    res.json({\n      success: true,\n      order: {\n        id: order.id,\n        orderNumber: order.orderNumber,\n        customerName: order.customerName,\n        customerEmail: order.customerEmail,\n        customerPhone: order.customerPhone,\n        street: order.street,\n        number: order.number,\n        complement: order.complement,\n        neighborhood: order.neighborhood,\n        city: order.city,\n        state: order.state,\n        zipCode: order.zipCode,\n        subtotal: order.subtotal,\n        shippingCost: order.shippingCost,\n        totalAmount: order.totalAmount,\n        orderStatus: order.orderStatus,\n        paymentStatus: order.paymentStatus,\n        paymentMethod: order.paymentMethod,\n        paymentInstallments: order.paymentInstallments,\n        createdAt: order.createdAt,\n        paidAt: order.paidAt,\n        items: items.map(item => ({\n          productName: item.productName,\n          productImage: item.productImage,\n          size: item.size,\n          color: item.color ? JSON.parse(item.color as string) : null,\n          printPosition: item.printPosition,\n          quantity: item.quantity,\n          unitPrice: item.unitPrice,\n          subtotal: item.subtotal\n        }))\n      }\n    });\n  } catch (error) {\n    console.error(\"Erro ao buscar pedido:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Erro ao buscar pedido\"\n    });\n  }\n});\n\nrouter.get(\"/receipt/:orderNumber\", async (req, res) => {\n  try {\n    const { orderNumber } = req.params;\n    \n    if (!validateOrderNumber(orderNumber)) {\n      return res.status(400).json({\n        success: false,\n        error: \"N√∫mero de pedido inv√°lido\"\n      });\n    }\n    \n    const order = await storage.getOrderByOrderNumber(orderNumber);\n    \n    if (!order) {\n      return res.status(404).json({\n        success: false,\n        error: \"Pedido n√£o encontrado\"\n      });\n    }\n    \n    const items = await storage.getOrderItems(order.id);\n    \n    const doc = new PDFDocument({ size: 'A4', margin: 50 });\n    \n    res.setHeader('Content-Type', 'application/pdf');\n    res.setHeader('Content-Disposition', `attachment; filename=comprovante-${orderNumber}.pdf`);\n    \n    doc.pipe(res);\n    \n    doc.fontSize(20).text('OUDLA', { align: 'center' });\n    doc.moveDown(0.5);\n    doc.fontSize(16).text('Comprovante de Pedido', { align: 'center' });\n    doc.moveDown(2);\n    \n    doc.fontSize(12).font('Helvetica-Bold').text(`Pedido: ${order.orderNumber}`);\n    doc.font('Helvetica');\n    doc.fontSize(10).text(`Data: ${order.createdAt ? new Date(order.createdAt).toLocaleDateString('pt-BR') : 'N/A'}`);\n    if (order.paidAt) {\n      const paidDate = new Date(order.paidAt);\n      doc.text(`Pago em: ${paidDate.toLocaleDateString('pt-BR')}`);\n    }\n    doc.moveDown(1.5);\n    \n    doc.fontSize(14).text('Dados do Cliente', { underline: true });\n    doc.moveDown(0.5);\n    doc.fontSize(10);\n    doc.text(`Nome: ${order.customerName}`);\n    doc.text(`Email: ${order.customerEmail}`);\n    doc.text(`Telefone: ${order.customerPhone}`);\n    doc.moveDown(1.5);\n    \n    doc.fontSize(14).text('Endere√ßo de Entrega', { underline: true });\n    doc.moveDown(0.5);\n    doc.fontSize(10);\n    doc.text(`${order.street}, ${order.number}`);\n    if (order.complement) {\n      doc.text(order.complement);\n    }\n    doc.text(`${order.neighborhood}`);\n    doc.text(`${order.city} - ${order.state}`);\n    doc.text(`CEP: ${order.zipCode}`);\n    doc.moveDown(1.5);\n    \n    doc.fontSize(14).text('Itens do Pedido', { underline: true });\n    doc.moveDown(0.5);\n    \n    items.forEach((item, index) => {\n      const color = item.color ? JSON.parse(item.color as string) : null;\n      doc.fontSize(10);\n      doc.text(`${index + 1}. ${item.productName}`, { continued: false });\n      doc.fontSize(9);\n      doc.text(`   Tamanho: ${item.size} | Quantidade: ${item.quantity}`);\n      if (color) {\n        doc.text(`   Cor: ${color.name}`);\n      }\n      if (item.printPosition) {\n        doc.text(`   Estampa: ${item.printPosition}`);\n      }\n      doc.text(`   Valor unit√°rio: R$ ${item.unitPrice}`);\n      doc.font('Helvetica-Bold').text(`   Subtotal: R$ ${item.subtotal}`);\n      doc.font('Helvetica');\n      doc.moveDown(0.5);\n    });\n    \n    doc.moveDown(1);\n    doc.fontSize(10);\n    doc.text(`Subtotal: R$ ${order.subtotal}`, { align: 'right' });\n    doc.text(`Frete: R$ ${order.shippingCost}`, { align: 'right' });\n    doc.moveDown(0.5);\n    doc.fontSize(12).font('Helvetica-Bold');\n    doc.text(`TOTAL: R$ ${order.totalAmount}`, { align: 'right' });\n    doc.font('Helvetica');\n    \n    if (order.paymentMethod) {\n      doc.moveDown(1.5);\n      doc.fontSize(14).text('Forma de Pagamento', { underline: true });\n      doc.moveDown(0.5);\n      doc.fontSize(10);\n      doc.text(`M√©todo: ${order.paymentMethod}`);\n      if (order.paymentInstallments && order.paymentInstallments > 1) {\n        doc.text(`Parcelas: ${order.paymentInstallments}x`);\n      }\n      doc.text(`Status: ${order.paymentStatus || 'Pendente'}`);\n    }\n    \n    if (order.verificationCode) {\n      doc.moveDown(1.5);\n      doc.fontSize(14).text('C√≥digo de Verifica√ß√£o', { underline: true });\n      doc.moveDown(0.5);\n      doc.fontSize(12).font('Helvetica-Bold');\n      doc.text(order.verificationCode, { align: 'center' });\n      doc.font('Helvetica');\n      doc.fontSize(8).fillColor('gray');\n      doc.text('Use este c√≥digo para validar a autenticidade do seu pedido.', { align: 'center' });\n      doc.fillColor('black');\n    }\n\n    doc.moveDown(2);\n    doc.fillColor('gray');\n    doc.fontSize(8).text('Este √© um documento gerado automaticamente.', { align: 'center' });\n    doc.text(`Gerado em: ${new Date().toLocaleString('pt-BR')}`, { align: 'center' });\n    doc.fillColor('black');\n    \n    doc.end();\n  } catch (error) {\n    console.error(\"Erro ao gerar comprovante:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Erro ao gerar comprovante\"\n    });\n  }\n});\n\nrouter.get(\"/mp-config\", (req, res) => {\n  try {\n    const envInfo = getEnvironmentInfo();\n    res.json({\n      success: true,\n      publicKey: envInfo.publicKey,\n      isProduction: envInfo.isProduction\n    });\n  } catch (error) {\n    console.error(\"Erro ao obter configura√ß√£o MP:\", error);\n    res.status(500).json({ success: false, error: \"Erro ao obter configura√ß√£o\" });\n  }\n});\n\nrouter.get(\"/gateway-settings\", async (req, res) => {\n  try {\n    const keys = [\n      \"gateway_pix_enabled\", \"gateway_credit_card_enabled\",\n      \"gateway_debit_card_enabled\", \"gateway_boleto_enabled\",\n      \"gateway_max_installments\", \"gateway_free_installments\",\n      \"gateway_auto_return\", \"gateway_expiration_hours\",\n      \"gateway_statement_descriptor\", \"gateway_binary_mode\",\n      \"gateway_excluded_methods\", \"gateway_excluded_types\"\n    ];\n    const settings: Record<string, string> = {};\n    for (const key of keys) {\n      const setting = await storage.getSiteSettingByKey(key);\n      settings[key] = setting?.value || \"\";\n    }\n    res.json({ success: true, settings });\n  } catch (error) {\n    res.status(500).json({ success: false, error: \"Erro ao buscar configura√ß√µes\" });\n  }\n});\n\nrouter.post(\"/create-preference\", checkoutLimiter, async (req, res) => {\n  try {\n    const { orderId } = req.body;\n    \n    if (!orderId) {\n      return res.status(400).json({ success: false, error: \"orderId √© obrigat√≥rio\" });\n    }\n\n    const order = await storage.getOrder(orderId);\n    if (!order) {\n      return res.status(404).json({ success: false, error: \"Pedido n√£o encontrado\" });\n    }\n\n    const items = await storage.getOrderItems(orderId);\n    if (!items.length) {\n      return res.status(400).json({ success: false, error: \"Pedido sem itens\" });\n    }\n\n    const baseUrl = process.env.APP_URL\n      || (process.env.REPLIT_DOMAINS ? `https://${process.env.REPLIT_DOMAINS.split(\",\")[0]}` : null)\n      || (process.env.REPLIT_DEV_DOMAIN ? `https://${process.env.REPLIT_DEV_DOMAIN}` : null)\n      || \"http://localhost:5000\";\n\n    const gatewayKeys = [\n      \"gateway_pix_enabled\", \"gateway_credit_card_enabled\",\n      \"gateway_debit_card_enabled\", \"gateway_boleto_enabled\",\n      \"gateway_max_installments\", \"gateway_free_installments\",\n      \"gateway_auto_return\", \"gateway_expiration_hours\",\n      \"gateway_statement_descriptor\", \"gateway_binary_mode\",\n      \"gateway_excluded_methods\", \"gateway_excluded_types\"\n    ];\n    const gatewaySettings: Record<string, string> = {};\n    for (const key of gatewayKeys) {\n      const setting = await storage.getSiteSettingByKey(key);\n      gatewaySettings[key] = setting?.value || \"\";\n    }\n\n    const excludedMethods: Array<{ id: string }> = [];\n    if (gatewaySettings.gateway_pix_enabled === \"false\") excludedMethods.push({ id: \"pix\" });\n    if (gatewaySettings.gateway_credit_card_enabled === \"false\") {\n      excludedMethods.push({ id: \"visa\" }, { id: \"master\" }, { id: \"amex\" }, { id: \"elo\" }, { id: \"hipercard\" });\n    }\n    if (gatewaySettings.gateway_debit_card_enabled === \"false\") {\n      excludedMethods.push({ id: \"debvisa\" }, { id: \"debmaster\" }, { id: \"debelo\" });\n    }\n    const customExcluded = gatewaySettings.gateway_excluded_methods;\n    if (customExcluded) {\n      customExcluded.split(\",\").map(m => m.trim()).filter(Boolean).forEach(m => excludedMethods.push({ id: m }));\n    }\n\n    const excludedTypes: Array<{ id: string }> = [];\n    if (gatewaySettings.gateway_boleto_enabled === \"false\") excludedTypes.push({ id: \"ticket\" });\n    const customExcludedTypes = gatewaySettings.gateway_excluded_types;\n    if (customExcludedTypes) {\n      customExcludedTypes.split(\",\").map(t => t.trim()).filter(Boolean).forEach(t => excludedTypes.push({ id: t }));\n    }\n\n    const maxInstallments = parseInt(gatewaySettings.gateway_max_installments) || 12;\n    const expirationHours = parseInt(gatewaySettings.gateway_expiration_hours) || 24;\n    const statementDescriptor = gatewaySettings.gateway_statement_descriptor || \"OUDLA\";\n    const autoReturn = gatewaySettings.gateway_auto_return || \"approved\";\n    const binaryMode = gatewaySettings.gateway_binary_mode === \"true\";\n\n    const discountAmount = parseFloat(order.discountAmount as string || \"0\");\n    const itemsSubtotal = items.reduce((sum, item) => {\n      return sum + parseFloat(item.unitPrice as string) * item.quantity;\n    }, 0);\n    const discountRatio = itemsSubtotal > 0 && discountAmount > 0 ? discountAmount / itemsSubtotal : 0;\n\n    const preferenceItems = items.map(item => {\n      const unitPrice = parseFloat(item.unitPrice as string);\n      const discountedPrice = discountRatio > 0\n        ? Math.round((unitPrice * (1 - discountRatio)) * 100) / 100\n        : unitPrice;\n      const colorData = item.color ? (() => { try { return JSON.parse(item.color as string); } catch { return null; } })() : null;\n      const fabricData = item.fabric ? (() => { try { return JSON.parse(item.fabric as string); } catch { return null; } })() : null;\n      \n      const descParts = [\n        item.size ? `Tam: ${item.size}` : null,\n        colorData?.name ? `Cor: ${colorData.name}` : null,\n        fabricData?.name ? `Tecido: ${fabricData.name}` : null,\n        item.printPosition ? `Estampa: ${item.printPosition}` : null,\n      ].filter(Boolean).join(' | ');\n      \n      return {\n        id: item.productId,\n        title: item.productName,\n        description: descParts || item.productName,\n        quantity: item.quantity,\n        currency_id: \"BRL\",\n        unit_price: discountedPrice,\n        picture_url: item.productImage || undefined,\n      };\n    });\n\n    const shippingCost = parseFloat(order.shippingCost as string || \"0\");\n    if (shippingCost > 0) {\n      preferenceItems.push({\n        id: \"shipping\",\n        title: \"Frete - Entrega\",\n        description: `Entrega para ${order.city} - ${order.state} (CEP: ${order.zipCode})`,\n        quantity: 1,\n        currency_id: \"BRL\",\n        unit_price: shippingCost,\n        picture_url: undefined,\n      });\n    }\n\n    const preference = createPreferenceClient();\n\n    const preferenceBody: any = {\n      items: preferenceItems,\n      payer: {\n        name: order.customerName.split(\" \")[0],\n        surname: order.customerName.split(\" \").slice(1).join(\" \") || \"\",\n        email: order.customerEmail,\n        phone: {\n          area_code: order.customerPhone?.substring(0, 2) || \"\",\n          number: order.customerPhone?.substring(2) || \"\"\n        },\n        address: {\n          zip_code: order.zipCode.replace(/\\D/g, \"\"),\n          street_name: order.street,\n          street_number: order.number\n        }\n      },\n      back_urls: {\n        success: `${baseUrl}/pagamento/sucesso?order=${order.orderNumber}`,\n        failure: `${baseUrl}/pagamento/falha?order=${order.orderNumber}`,\n        pending: `${baseUrl}/pagamento/pendente?order=${order.orderNumber}`\n      },\n      statement_descriptor: statementDescriptor.substring(0, 16),\n      external_reference: order.orderNumber,\n      notification_url: `${baseUrl}/api/checkout/webhook`,\n      expires: true,\n      expiration_date_from: new Date().toISOString(),\n      expiration_date_to: new Date(Date.now() + expirationHours * 60 * 60 * 1000).toISOString(),\n      binary_mode: binaryMode,\n    };\n\n    if (autoReturn && autoReturn !== \"none\") {\n      preferenceBody.auto_return = autoReturn;\n    }\n\n    if (excludedMethods.length > 0) {\n      preferenceBody.payment_methods = {\n        ...preferenceBody.payment_methods,\n        excluded_payment_methods: excludedMethods\n      };\n    }\n    if (excludedTypes.length > 0) {\n      preferenceBody.payment_methods = {\n        ...preferenceBody.payment_methods,\n        excluded_payment_types: excludedTypes\n      };\n    }\n    preferenceBody.payment_methods = {\n      ...preferenceBody.payment_methods,\n      installments: maxInstallments,\n    };\n    \n    const preferenceData = await preference.create({\n      body: preferenceBody\n    });\n\n    if (!preferenceData.id) {\n      throw new Error(\"Falha ao criar prefer√™ncia no Mercado Pago\");\n    }\n\n    await storage.updateOrderPreference(order.id, preferenceData.id);\n\n    const envInfo = getEnvironmentInfo();\n\n    console.log(\"‚úÖ [MP] Prefer√™ncia criada:\", {\n      preferenceId: preferenceData.id,\n      orderNumber: order.orderNumber,\n      total: order.totalAmount,\n      initPoint: preferenceData.init_point,\n      sandboxInitPoint: preferenceData.sandbox_init_point,\n      isProduction: envInfo.isProduction\n    });\n    \n    res.json({\n      success: true,\n      preferenceId: preferenceData.id,\n      initPoint: preferenceData.init_point,\n      sandboxInitPoint: preferenceData.sandbox_init_point,\n      isProduction: envInfo.isProduction\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå [MP] Erro ao criar prefer√™ncia:\", error);\n    res.status(500).json({\n      success: false,\n      error: \"Erro ao criar prefer√™ncia de pagamento\",\n      details: error.message\n    });\n  }\n});\n\nrouter.post(\"/webhook\", async (req, res) => {\n  try {\n    const xSignature = req.headers[\"x-signature\"] as string;\n    const xRequestId = req.headers[\"x-request-id\"] as string;\n    const dataId = req.query[\"data.id\"] as string || req.body?.data?.id;\n    const type = req.query.type as string || req.body?.type;\n\n    console.log(\"üì• [MP] Webhook recebido:\", { type, dataId });\n\n    if (xSignature && xRequestId && dataId) {\n      const isValid = validateWebhookSignature(xSignature, xRequestId, dataId);\n      if (!isValid) {\n        console.error(\"‚ùå [MP] Assinatura do webhook inv√°lida\");\n        return res.status(401).send(\"Unauthorized\");\n      }\n    }\n\n    if (type === \"payment\" && dataId) {\n      try {\n        const paymentClient = createPaymentClient();\n        const payment = await paymentClient.get({ id: dataId });\n\n        if (!payment) {\n          console.error(\"‚ùå [MP] Pagamento n√£o encontrado:\", dataId);\n          return res.status(200).send(\"OK\");\n        }\n\n        const externalReference = payment.external_reference;\n        if (!externalReference) {\n          console.error(\"‚ùå [MP] Pagamento sem external_reference\");\n          return res.status(200).send(\"OK\");\n        }\n\n        const order = await storage.getOrderByOrderNumber(externalReference);\n        if (!order) {\n          console.error(\"‚ùå [MP] Pedido n√£o encontrado:\", externalReference);\n          return res.status(200).send(\"OK\");\n        }\n\n        const status = payment.status;\n        const paymentMethod = payment.payment_method_id;\n        const paymentTypeId = payment.payment_type_id;\n        const installments = payment.installments;\n\n        let orderStatus = order.orderStatus;\n        if (status === \"approved\") {\n          orderStatus = \"paid\";\n        } else if (status === \"rejected\" || status === \"cancelled\") {\n          orderStatus = \"failed\";\n        } else if (status === \"pending\" || status === \"in_process\") {\n          orderStatus = \"pending\";\n        }\n\n        await storage.updateOrderPaymentStatus(\n          order.id,\n          status || \"unknown\",\n          dataId,\n          paymentMethod || undefined,\n          paymentTypeId || undefined,\n          installments || undefined\n        );\n\n        if (orderStatus !== order.orderStatus) {\n          await storage.updateOrder(order.id, { orderStatus });\n        }\n\n        if (status === \"approved\" && order.paymentStatus !== \"approved\") {\n          await storage.markOrderAsPaid(order.id);\n          \n          try {\n            const paidOrder = await storage.getOrder(order.id);\n            if (paidOrder) {\n              const orderItems = await storage.getOrderItems(order.id);\n              await sendOrderConfirmationEmail(paidOrder, orderItems);\n              console.log(\"‚úÖ [EMAIL] Email de confirma√ß√£o enviado para\", order.customerEmail);\n            }\n          } catch (emailError) {\n            console.error(\"‚ùå [EMAIL] Falha ao enviar email de confirma√ß√£o:\", emailError);\n          }\n        } else if (status === \"approved\") {\n          await storage.markOrderAsPaid(order.id);\n        }\n\n        console.log(\"‚úÖ [MP] Pedido atualizado:\", {\n          orderNumber: externalReference,\n          paymentStatus: status,\n          orderStatus\n        });\n      } catch (paymentError) {\n        console.error(\"‚ùå [MP] Erro ao processar pagamento:\", paymentError);\n      }\n    }\n\n    res.status(200).send(\"OK\");\n  } catch (error) {\n    console.error(\"‚ùå [MP] Erro no webhook:\", error);\n    res.status(200).send(\"OK\");\n  }\n});\n\nrouter.get(\"/payment-status/:orderNumber\", async (req, res) => {\n  try {\n    const { orderNumber } = req.params;\n    \n    if (!validateOrderNumber(orderNumber)) {\n      return res.status(400).json({ success: false, error: \"N√∫mero de pedido inv√°lido\" });\n    }\n\n    const order = await storage.getOrderByOrderNumber(orderNumber);\n    if (!order) {\n      return res.status(404).json({ success: false, error: \"Pedido n√£o encontrado\" });\n    }\n\n    res.json({\n      success: true,\n      orderNumber: order.orderNumber,\n      orderStatus: order.orderStatus,\n      paymentStatus: order.paymentStatus,\n      paymentMethod: order.paymentMethod,\n      paymentInstallments: order.paymentInstallments,\n      totalAmount: order.totalAmount,\n      paidAt: order.paidAt,\n      verificationCode: order.verificationCode\n    });\n  } catch (error) {\n    console.error(\"Erro ao buscar status:\", error);\n    res.status(500).json({ success: false, error: \"Erro ao buscar status\" });\n  }\n});\n\nexport default router;\n","path":null,"size_bytes":27208,"size_tokens":null},"client/src/pages/CheckoutPending.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Clock } from \"lucide-react\";\n\nexport default function CheckoutPending() {\n  const [, setLocation] = useLocation();\n  const [orderNumber, setOrderNumber] = useState<string>(\"\");\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const externalReference = params.get(\"external_reference\");\n    if (externalReference) {\n      setOrderNumber(externalReference);\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"max-w-md w-full p-8 text-center space-y-6\">\n        <div className=\"flex justify-center\">\n          <div className=\"bg-yellow-500/10 p-4 rounded-full\">\n            <Clock className=\"h-16 w-16 text-yellow-600\" />\n          </div>\n        </div>\n        \n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl font-light lowercase\">pagamento pendente</h1>\n          <p className=\"text-muted-foreground lowercase\">\n            estamos aguardando a confirma√ß√£o do pagamento\n          </p>\n        </div>\n\n        {orderNumber && (\n          <div className=\"bg-muted/30 rounded-lg p-4\">\n            <p className=\"text-sm text-muted-foreground lowercase mb-1\">\n              n√∫mero do pedido\n            </p>\n            <p className=\"text-xl font-medium\" data-testid=\"text-order-number\">\n              {orderNumber}\n            </p>\n          </div>\n        )}\n\n        <div className=\"space-y-3 pt-4\">\n          <p className=\"text-sm text-muted-foreground lowercase\">\n            assim que o pagamento for confirmado, enviaremos um email com os detalhes do seu pedido\n          </p>\n          \n          <Button\n            className=\"w-full\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-go-home\"\n          >\n            voltar para a home\n          </Button>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2079,"size_tokens":null},"client/src/pages/CheckoutSuccess.tsx":{"content":"import { useEffect, useState, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { CheckCircle2, Package, MapPin, Download, Home } from \"lucide-react\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\n\ninterface OrderItem {\n  productName: string;\n  productImage: string;\n  size: string;\n  color: { name: string; hex: string } | null;\n  printPosition: string | null;\n  quantity: number;\n  unitPrice: string;\n  subtotal: string;\n}\n\ninterface OrderData {\n  id: string;\n  orderNumber: string;\n  customerName: string;\n  customerEmail: string;\n  customerPhone: string;\n  street: string;\n  number: string;\n  complement: string | null;\n  neighborhood: string;\n  city: string;\n  state: string;\n  zipCode: string;\n  subtotal: string;\n  shippingCost: string;\n  totalAmount: string;\n  orderStatus: string;\n  paymentStatus: string | null;\n  paymentMethod: string | null;\n  paymentInstallments: number | null;\n  createdAt: string;\n  paidAt: string | null;\n  items: OrderItem[];\n}\n\ndeclare global {\n  interface Window {\n    fbq?: (action: string, event: string, params?: Record<string, any>) => void;\n  }\n}\n\nexport default function CheckoutSuccess() {\n  const [, setLocation] = useLocation();\n  const { items, clearAll } = useMochila();\n  const [orderNumber, setOrderNumber] = useState<string>(\"\");\n  const clearedRef = useRef(false);\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const externalReference = params.get(\"external_reference\");\n    if (externalReference) {\n      setOrderNumber(externalReference);\n    }\n    \n    if (items.length > 0 && !clearedRef.current) {\n      clearedRef.current = true;\n      clearAll();\n    }\n  }, [items, clearAll]);\n\n  const { data: orderData, isLoading } = useQuery<{ success: boolean; order: OrderData }>({\n    queryKey: ['/api/checkout/order', orderNumber],\n    enabled: !!orderNumber,\n    queryFn: async () => {\n      const response = await fetch(`/api/checkout/order/${orderNumber}`);\n      if (!response.ok) {\n        throw new Error('Falha ao buscar pedido');\n      }\n      return response.json();\n    }\n  });\n\n  useEffect(() => {\n    if (orderData?.order && window.fbq) {\n      window.fbq('track', 'Purchase', {\n        value: parseFloat(orderData.order.totalAmount),\n        currency: 'BRL',\n        content_ids: orderData.order.items.map(item => item.productName),\n        content_type: 'product',\n        num_items: orderData.order.items.reduce((acc, item) => acc + item.quantity, 0)\n      });\n    }\n  }, [orderData]);\n\n  const handleDownloadReceipt = () => {\n    if (orderNumber) {\n      window.open(`/api/checkout/receipt/${orderNumber}`, '_blank');\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n        <Card className=\"max-w-2xl w-full p-8\">\n          <div className=\"flex items-center justify-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-primary\"></div>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  const order = orderData?.order;\n\n  return (\n    <div className=\"min-h-screen px-4 py-12 bg-background\">\n      <div className=\"max-w-2xl mx-auto space-y-6\">\n        <Card className=\"p-8 text-center\">\n          <div className=\"flex justify-center mb-6\">\n            <div className=\"bg-primary/10 p-4 rounded-full\">\n              <CheckCircle2 className=\"h-16 w-16 text-primary\" data-testid=\"icon-success\" />\n            </div>\n          </div>\n          \n          <div className=\"space-y-2 mb-6\">\n            <h1 className=\"text-3xl font-light lowercase\">pagamento aprovado!</h1>\n            <p className=\"text-muted-foreground lowercase\">\n              seu pedido foi confirmado com sucesso\n            </p>\n          </div>\n\n          {orderNumber && (\n            <div className=\"bg-muted/30 rounded-lg p-4 mb-6\">\n              <p className=\"text-sm text-muted-foreground lowercase mb-1\">\n                n√∫mero do pedido\n              </p>\n              <p className=\"text-2xl font-medium\" data-testid=\"text-order-number\">\n                {orderNumber}\n              </p>\n            </div>\n          )}\n\n          <div className=\"space-y-3\">\n            <p className=\"text-sm text-muted-foreground lowercase\">\n              enviamos um email para <strong>{order?.customerEmail}</strong> com os detalhes do seu pedido\n            </p>\n          </div>\n        </Card>\n\n        {order && (\n          <>\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 lowercase\">\n                  <Package className=\"h-5 w-5\" />\n                  itens do pedido\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {order.items.map((item, index) => (\n                  <div key={index} className=\"flex gap-4\" data-testid={`order-item-${index}`}>\n                    <img\n                      src={item.productImage}\n                      alt={item.productName}\n                      className=\"w-20 h-20 object-cover rounded-md\"\n                      loading=\"lazy\"\n                      decoding=\"async\"\n                    />\n                    <div className=\"flex-1\">\n                      <h3 className=\"font-medium lowercase\">{item.productName}</h3>\n                      <div className=\"text-sm text-muted-foreground space-y-1\">\n                        <p>tamanho: {item.size}</p>\n                        {item.color && (\n                          <p className=\"flex items-center gap-2\">\n                            cor: {item.color.name}\n                            <span\n                              className=\"w-4 h-4 rounded-full border\"\n                              style={{ backgroundColor: item.color.hex }}\n                            />\n                          </p>\n                        )}\n                        {item.printPosition && <p>estampa: {item.printPosition}</p>}\n                        <p>quantidade: {item.quantity}</p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"font-medium\">R$ {item.subtotal}</p>\n                    </div>\n                  </div>\n                ))}\n\n                <Separator />\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground lowercase\">subtotal</span>\n                    <span>R$ {order.subtotal}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground lowercase\">frete</span>\n                    <span>R$ {order.shippingCost}</span>\n                  </div>\n                  <Separator />\n                  <div className=\"flex justify-between font-semibold text-lg\">\n                    <span className=\"lowercase\">total</span>\n                    <span data-testid=\"text-total\">R$ {order.totalAmount}</span>\n                  </div>\n                </div>\n\n                {order.paymentMethod && (\n                  <div className=\"bg-muted/30 rounded-lg p-4 text-sm\">\n                    <p className=\"text-muted-foreground lowercase mb-1\">forma de pagamento</p>\n                    <p className=\"font-medium lowercase\">\n                      {order.paymentMethod}\n                      {order.paymentInstallments && order.paymentInstallments > 1 && \n                        ` (${order.paymentInstallments}x)`\n                      }\n                    </p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2 lowercase\">\n                  <MapPin className=\"h-5 w-5\" />\n                  endere√ßo de entrega\n                </CardTitle>\n              </CardHeader>\n              <CardContent>\n                <div className=\"text-sm space-y-1\">\n                  <p className=\"font-medium\">{order.customerName}</p>\n                  <p>{order.street}, {order.number}</p>\n                  {order.complement && <p>{order.complement}</p>}\n                  <p>{order.neighborhood}</p>\n                  <p>{order.city} - {order.state}</p>\n                  <p>CEP: {order.zipCode}</p>\n                  <p className=\"pt-2 text-muted-foreground\">Telefone: {order.customerPhone}</p>\n                </div>\n              </CardContent>\n            </Card>\n          </>\n        )}\n\n        <div className=\"flex flex-col sm:flex-row gap-3\">\n          <Button\n            variant=\"outline\"\n            className=\"flex-1\"\n            onClick={handleDownloadReceipt}\n            data-testid=\"button-download-receipt\"\n          >\n            <Download className=\"mr-2 h-4 w-4\" />\n            baixar comprovante\n          </Button>\n          <Button\n            className=\"flex-1\"\n            onClick={() => setLocation(\"/\")}\n            data-testid=\"button-go-home\"\n          >\n            <Home className=\"mr-2 h-4 w-4\" />\n            voltar para a home\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9467,"size_tokens":null},"client/src/components/admin/AdminOrders.tsx":{"content":"import { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { \n  Table,\n  TableBody,\n  TableCell,\n  TableHead,\n  TableHeader,\n  TableRow,\n} from \"@/components/ui/table\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useState, useEffect, useRef, useMemo } from \"react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { Eye, Loader2, Package, Mail, MailCheck, MailX, Phone, MapPin, MessageCircle, Navigation, Search, Archive, ArchiveRestore, Trash2, AlertTriangle, Save, MoreVertical, ArrowUpDown, ArrowUp, ArrowDown, Truck, Shield } from \"lucide-react\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { SiWhatsapp } from \"react-icons/si\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface Order {\n  id: string;\n  orderNumber: string;\n  customerName: string;\n  customerEmail: string;\n  customerPhone: string;\n  customerCpf: string;\n  zipCode: string;\n  street: string;\n  number: string;\n  complement?: string;\n  neighborhood: string;\n  city: string;\n  state: string;\n  subtotal: string;\n  shippingCost: string;\n  totalAmount: string;\n  orderStatus: string;\n  trackingCode?: string;\n  refundReason?: string;\n  paymentStatus?: string;\n  paymentId?: string;\n  paymentMethod?: string;\n  paymentTypeId?: string;\n  paymentInstallments?: number;\n  verificationCode?: string;\n  internalNotes?: string;\n  confirmationEmailSentAt?: string;\n  trackingEmailSentAt?: string;\n  archivedAt?: string;\n  deletedAt?: string;\n  createdAt: string;\n  paidAt?: string;\n  customerIp?: string;\n  userAgent?: string;\n  deviceType?: string;\n  browserName?: string;\n  browserVersion?: string;\n  osName?: string;\n  osVersion?: string;\n  screenResolution?: string;\n  emailDeliveredAt?: string;\n  emailOpenedAt?: string;\n  emailComplainedAt?: string;\n  emailFailedAt?: string;\n  emailFailureReason?: string;\n}\n\ninterface OrderItem {\n  id: string;\n  productName: string;\n  productImage: string;\n  size: string;\n  color: string;\n  printPosition?: string;\n  unitPrice: string;\n  quantity: number;\n  subtotal: string;\n}\n\ninterface OrderWithItems extends Order {\n  items: OrderItem[];\n  paymentPreferenceId?: string;\n}\n\nconst orderStatusMap: Record<string, { label: string; className: string }> = {\n  pending: { label: \"pendente\", className: \"bg-slate-100 text-slate-700 dark:bg-slate-800 dark:text-slate-300\" },\n  paid: { label: \"pago\", className: \"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400\" },\n  shipped: { label: \"enviado\", className: \"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400\" },\n  failed: { label: \"falhou\", className: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\" },\n  cancelled: { label: \"cancelado\", className: \"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400\" },\n  delivered: { label: \"entregue\", className: \"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400\" },\n  refunded: { label: \"estornado\", className: \"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400\" },\n};\n\nconst paymentStatusMap: Record<string, { label: string; variant: \"default\" | \"secondary\" | \"destructive\" | \"outline\" }> = {\n  pending: { label: \"Pendente\", variant: \"secondary\" },\n  approved: { label: \"Aprovado\", variant: \"default\" },\n  rejected: { label: \"Rejeitado\", variant: \"destructive\" },\n  cancelled: { label: \"Cancelado\", variant: \"outline\" },\n  in_process: { label: \"Processando\", variant: \"secondary\" },\n};\n\ntype SortField = 'orderNumber' | 'customerName' | 'createdAt' | 'totalAmount' | 'orderStatus' | 'paymentStatus';\ntype SortDirection = 'asc' | 'desc';\n\nexport default function AdminOrders() {\n  const [selectedOrderId, setSelectedOrderId] = useState<string | null>(null);\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [debouncedSearchTerm, setDebouncedSearchTerm] = useState(\"\");\n  const [statusFilter, setStatusFilter] = useState(\"all\");\n  const [filterTab, setFilterTab] = useState<'all' | 'archived' | 'deleted' | 'delivered' | 'refunded' | 'shipped'>('all');\n  const [internalNotes, setInternalNotes] = useState(\"\");\n  const [selectedOrderIds, setSelectedOrderIds] = useState<string[]>([]);\n  const [showOnlyWithNotes, setShowOnlyWithNotes] = useState(false);\n  const [sortField, setSortField] = useState<SortField>('createdAt');\n  const [sortDirection, setSortDirection] = useState<SortDirection>('desc');\n  const notesTextareaRef = useRef<HTMLTextAreaElement>(null);\n  const { toast } = useToast();\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      setDebouncedSearchTerm(searchTerm);\n    }, 300);\n    return () => clearTimeout(timer);\n  }, [searchTerm]);\n\n  const { data: orders, isLoading } = useQuery<Order[]>({\n    queryKey: ['/api/admin/orders', { includeAll: 'true' }],\n  });\n\n  const { data: selectedOrder, isLoading: isLoadingDetails } = useQuery<OrderWithItems>({\n    queryKey: ['/api/admin/orders', selectedOrderId],\n    enabled: !!selectedOrderId,\n  });\n\n  useEffect(() => {\n    if (selectedOrder) {\n      setInternalNotes(selectedOrder.internalNotes || \"\");\n      if (notesTextareaRef.current) {\n        notesTextareaRef.current.blur();\n      }\n    }\n  }, [selectedOrder]);\n\n  useEffect(() => {\n    setSelectedOrderIds([]);\n  }, [filterTab]);\n\n  const saveNotesMutation = useMutation({\n    mutationFn: async () => {\n      if (!selectedOrderId) return;\n      return apiRequest('PATCH', `/api/admin/orders/${selectedOrderId}`, { internalNotes });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Observa√ß√µes salvas com sucesso\" });\n      // Remove focus from textarea after saving\n      if (notesTextareaRef.current) {\n        notesTextareaRef.current.blur();\n      }\n    },\n    onError: () => {\n      toast({ title: \"Erro ao salvar observa√ß√µes\", variant: \"destructive\" });\n    }\n  });\n\n  const archiveMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      return apiRequest('PATCH', `/api/admin/orders/${orderId}/archive`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedido arquivado com sucesso\" });\n      setSelectedOrderId(null);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao arquivar pedido\", variant: \"destructive\" });\n    }\n  });\n\n  const unarchiveMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      return apiRequest('PATCH', `/api/admin/orders/${orderId}/unarchive`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedido desarquivado com sucesso\" });\n      setSelectedOrderId(null);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao desarquivar pedido\", variant: \"destructive\" });\n    }\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      return apiRequest('DELETE', `/api/admin/orders/${orderId}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedido removido com sucesso\" });\n      setSelectedOrderId(null);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao remover pedido\", variant: \"destructive\" });\n    }\n  });\n\n  const hardDeleteMutation = useMutation({\n    mutationFn: async (orderId: string) => {\n      return apiRequest('DELETE', `/api/admin/orders/${orderId}/permanent`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedido deletado permanentemente\" });\n      setSelectedOrderId(null);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao deletar pedido permanentemente\", variant: \"destructive\" });\n    }\n  });\n\n  const bulkArchiveMutation = useMutation({\n    mutationFn: async (orderIds: string[]) => {\n      return apiRequest('POST', '/api/admin/orders/bulk/archive', { orderIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedidos arquivados com sucesso\" });\n      setSelectedOrderIds([]);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao arquivar pedidos\", variant: \"destructive\" });\n    }\n  });\n\n  const bulkUnarchiveMutation = useMutation({\n    mutationFn: async (orderIds: string[]) => {\n      return apiRequest('POST', '/api/admin/orders/bulk/unarchive', { orderIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedidos desarquivados com sucesso\" });\n      setSelectedOrderIds([]);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao desarquivar pedidos\", variant: \"destructive\" });\n    }\n  });\n\n  const bulkDeleteMutation = useMutation({\n    mutationFn: async (orderIds: string[]) => {\n      return apiRequest('POST', '/api/admin/orders/bulk/delete', { orderIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedidos removidos com sucesso\" });\n      setSelectedOrderIds([]);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao remover pedidos\", variant: \"destructive\" });\n    }\n  });\n\n  const bulkRestoreMutation = useMutation({\n    mutationFn: async (orderIds: string[]) => {\n      return apiRequest('POST', '/api/admin/orders/bulk/restore', { orderIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedidos restaurados com sucesso\" });\n      setSelectedOrderIds([]);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao restaurar pedidos\", variant: \"destructive\" });\n    }\n  });\n\n  const bulkHardDeleteMutation = useMutation({\n    mutationFn: async (orderIds: string[]) => {\n      return apiRequest('POST', '/api/admin/orders/bulk/permanent-delete', { orderIds });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: \"Pedidos deletados permanentemente\" });\n      setSelectedOrderIds([]);\n    },\n    onError: () => {\n      toast({ title: \"Erro ao deletar pedidos permanentemente\", variant: \"destructive\" });\n    }\n  });\n\n  const formatPrice = (value: string) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(parseFloat(value));\n  };\n\n  const formatDate = (dateString: string) => {\n    return format(new Date(dateString), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR });\n  };\n\n  const filteredOrders = useMemo(() => {\n    if (!orders) return undefined;\n    \n    let result = [...orders];\n    \n    if (filterTab === 'all') {\n      result = result.filter(o => !o.archivedAt && !o.deletedAt);\n    } else if (filterTab === 'archived') {\n      result = result.filter(o => o.archivedAt && !o.deletedAt);\n    } else if (filterTab === 'deleted') {\n      result = result.filter(o => !!o.deletedAt);\n    } else if (filterTab === 'shipped') {\n      result = result.filter(o => o.orderStatus === 'shipped' && !o.archivedAt && !o.deletedAt);\n    } else if (filterTab === 'delivered') {\n      result = result.filter(o => o.orderStatus === 'delivered' && !o.archivedAt && !o.deletedAt);\n    } else if (filterTab === 'refunded') {\n      result = result.filter(o => o.orderStatus === 'refunded' && !o.archivedAt && !o.deletedAt);\n    }\n    \n    if (statusFilter && statusFilter !== 'all') {\n      if (statusFilter === 'paid') {\n        result = result.filter(o => o.paymentStatus === 'approved');\n      } else {\n        result = result.filter(o => o.orderStatus === statusFilter);\n      }\n    }\n    \n    if (debouncedSearchTerm.trim()) {\n      const search = debouncedSearchTerm.toLowerCase();\n      result = result.filter(o =>\n        (o.customerName && o.customerName.toLowerCase().includes(search)) ||\n        (o.customerEmail && o.customerEmail.toLowerCase().includes(search)) ||\n        (o.customerCpf && o.customerCpf.toLowerCase().includes(search)) ||\n        (o.customerPhone && o.customerPhone.toLowerCase().includes(search)) ||\n        (o.orderNumber && o.orderNumber.toLowerCase().includes(search)) ||\n        (o.verificationCode && o.verificationCode.toLowerCase().includes(search)) ||\n        (o.city && o.city.toLowerCase().includes(search)) ||\n        (o.state && o.state.toLowerCase().includes(search))\n      );\n    }\n    \n    if (showOnlyWithNotes) {\n      result = result.filter(o => o.internalNotes && o.internalNotes.trim().length > 0);\n    }\n    \n    const sortFieldMap: Record<SortField, keyof Order> = {\n      orderNumber: 'orderNumber',\n      customerName: 'customerName',\n      createdAt: 'createdAt',\n      totalAmount: 'totalAmount',\n      orderStatus: 'orderStatus',\n      paymentStatus: 'paymentStatus',\n    };\n    \n    const field = sortFieldMap[sortField] || 'createdAt';\n    result.sort((a, b) => {\n      const aVal = (a[field] ?? '') as string;\n      const bVal = (b[field] ?? '') as string;\n      \n      if (field === 'totalAmount') {\n        const diff = parseFloat(aVal) - parseFloat(bVal);\n        return sortDirection === 'asc' ? diff : -diff;\n      }\n      \n      const cmp = aVal.localeCompare(bVal);\n      return sortDirection === 'asc' ? cmp : -cmp;\n    });\n    \n    return result;\n  }, [orders, filterTab, statusFilter, debouncedSearchTerm, showOnlyWithNotes, sortField, sortDirection]);\n\n  const handleSelectAll = () => {\n    if (selectedOrderIds.length === filteredOrders?.length) {\n      setSelectedOrderIds([]);\n    } else {\n      setSelectedOrderIds(filteredOrders?.map(o => o.id) || []);\n    }\n  };\n\n  const handleSelectOrder = (orderId: string) => {\n    setSelectedOrderIds(prev => \n      prev.includes(orderId) \n        ? prev.filter(id => id !== orderId)\n        : [...prev, orderId]\n    );\n  };\n\n  const isAllSelected = filteredOrders && filteredOrders.length > 0 && selectedOrderIds.length === filteredOrders.length;\n  const isSomeSelected = selectedOrderIds.length > 0 && selectedOrderIds.length < (filteredOrders?.length || 0);\n\n  const handleSort = (field: SortField) => {\n    if (sortField === field) {\n      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc');\n    } else {\n      setSortField(field);\n      setSortDirection('desc');\n    }\n  };\n\n  const SortButton = ({ field, children }: { field: SortField; children: React.ReactNode }) => {\n    const isActive = sortField === field;\n    return (\n      <button\n        onClick={() => handleSort(field)}\n        className=\"flex items-center gap-1 hover-elevate active-elevate-2 -m-2 p-2 rounded\"\n        data-testid={`sort-${field}`}\n      >\n        <span className={isActive ? 'font-semibold' : ''}>{children}</span>\n        {isActive ? (\n          sortDirection === 'asc' ? (\n            <ArrowUp className=\"h-3 w-3\" />\n          ) : (\n            <ArrowDown className=\"h-3 w-3\" />\n          )\n        ) : (\n          <ArrowUpDown className=\"h-3 w-3 opacity-40\" />\n        )}\n      </button>\n    );\n  };\n\n  const [isStatusDialogOpen, setIsStatusDialogOpen] = useState(false);\n  const [pendingStatusChange, setPendingStatusChange] = useState<{ id: string; status: string } | null>(null);\n  const [statusMetadata, setStatusMetadata] = useState({ trackingCode: \"\", refundReason: \"\" });\n\n  const updateStatus = async (orderId: string, status: string, metadata?: { trackingCode?: string; refundReason?: string }) => {\n    try {\n      await apiRequest('PATCH', `/api/admin/orders/${orderId}/status`, { \n        status,\n        ...metadata \n      });\n      await queryClient.refetchQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: `pedido marcado como ${orderStatusMap[status]?.label.toLowerCase()}` });\n      setSelectedOrderId(null);\n      setIsStatusDialogOpen(false);\n      setPendingStatusChange(null);\n      setStatusMetadata({ trackingCode: \"\", refundReason: \"\" });\n    } catch (err) {\n      toast({ title: \"erro ao atualizar pedido\", variant: \"destructive\" });\n    }\n  };\n\n  const handleStatusClick = (orderId: string, status: string) => {\n    if (status === 'shipped' || status === 'refunded') {\n      setPendingStatusChange({ id: orderId, status });\n      setIsStatusDialogOpen(true);\n    } else {\n      updateStatus(orderId, status);\n    }\n  };\n\n  const updateBulkStatus = async (status: string) => {\n    if (status === 'refunded') {\n      const reason = window.prompt('por favor, informe o motivo do estorno para os pedidos selecionados:');\n      if (reason === null) return;\n      if (!reason.trim()) {\n        toast({\n          title: \"erro\",\n          description: \"o motivo do estorno √© obrigat√≥rio\",\n          variant: \"destructive\"\n        });\n        return;\n      }\n      try {\n        await apiRequest('POST', '/api/admin/orders/bulk/status', { orderIds: selectedOrderIds, status, refundReason: reason });\n        await queryClient.refetchQueries({ queryKey: ['/api/admin/orders'] });\n        toast({ title: `${selectedOrderIds.length} pedidos marcados como estornados` });\n        setSelectedOrderIds([]);\n        setSelectedOrderId(null);\n      } catch (err) {\n        toast({ title: \"erro ao atualizar pedidos\", variant: \"destructive\" });\n      }\n      return;\n    }\n\n    try {\n      await apiRequest('POST', '/api/admin/orders/bulk/status', { orderIds: selectedOrderIds, status });\n      await queryClient.refetchQueries({ queryKey: ['/api/admin/orders'] });\n      toast({ title: `${selectedOrderIds.length} pedidos marcados como ${orderStatusMap[status]?.label.toLowerCase()}` });\n      setSelectedOrderIds([]);\n      setSelectedOrderId(null);\n    } catch (err) {\n      toast({ title: \"erro ao atualizar pedidos\", variant: \"destructive\" });\n    }\n  };\n\n  const getStatusColor = (status: string) => {\n    switch (status) {\n      case 'shipped': return 'border-blue-100 bg-blue-50/20 dark:border-blue-900/10 dark:bg-blue-900/5';\n      case 'delivered': return 'border-emerald-100 bg-emerald-50/20 dark:border-emerald-900/10 dark:bg-emerald-900/5';\n      case 'refunded': return 'border-red-100 bg-red-50/20 dark:border-red-900/10 dark:bg-red-900/5';\n      case 'paid': return 'border-emerald-100 bg-emerald-50/20 dark:border-emerald-900/10 dark:bg-emerald-900/5';\n      default: return 'border-border bg-card';\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-1\">\n        <h2 className=\"text-2xl font-semibold lowercase tracking-tight\">pedidos</h2>\n        <p className=\"text-sm text-muted-foreground/70 lowercase\">\n          gerencie todos os pedidos da loja\n        </p>\n      </div>\n\n      <div className=\"lg:hidden\">\n        <Select \n          value={filterTab} \n          onValueChange={(v) => {\n            setFilterTab(v as any);\n            setStatusFilter(\"all\");\n            setSearchTerm(\"\");\n            setShowOnlyWithNotes(false);\n          }}\n        >\n          <SelectTrigger className=\"w-full lowercase rounded-xl border-0 bg-muted/40 h-10\" data-testid=\"select-orders-tab-mobile\">\n            <SelectValue placeholder=\"selecionar visualiza√ß√£o\" />\n          </SelectTrigger>\n          <SelectContent>\n            <SelectItem value=\"all\" className=\"lowercase\">todos</SelectItem>\n            <SelectItem value=\"shipped\" className=\"lowercase\">enviados</SelectItem>\n            <SelectItem value=\"delivered\" className=\"lowercase\">entregues</SelectItem>\n            <SelectItem value=\"refunded\" className=\"lowercase\">estornados</SelectItem>\n            <SelectItem value=\"archived\" className=\"lowercase\">arquivados</SelectItem>\n            <SelectItem value=\"deleted\" className=\"lowercase\">removidos</SelectItem>\n          </SelectContent>\n        </Select>\n      </div>\n\n      <Tabs \n        value={filterTab} \n        onValueChange={(v) => {\n          setFilterTab(v as any);\n          setStatusFilter(\"all\");\n          setSearchTerm(\"\");\n          setShowOnlyWithNotes(false);\n        }} \n        className=\"w-full\"\n      >\n        <TabsList className=\"hidden lg:flex w-auto gap-1 bg-muted/30 p-1 rounded-full\">\n          <TabsTrigger value=\"all\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-all-orders\">\n            todos\n          </TabsTrigger>\n          <TabsTrigger value=\"shipped\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-shipped-orders\">\n            enviados\n          </TabsTrigger>\n          <TabsTrigger value=\"delivered\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-delivered-orders\">\n            entregues\n          </TabsTrigger>\n          <TabsTrigger value=\"refunded\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-refunded-orders\">\n            estornados\n          </TabsTrigger>\n          <TabsTrigger value=\"archived\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-archived-orders\">\n            arquivados\n          </TabsTrigger>\n          <TabsTrigger value=\"deleted\" className=\"lowercase rounded-full px-5 text-[13px] data-[state=active]:shadow-sm\" data-testid=\"tab-deleted-orders\">\n            removidos\n          </TabsTrigger>\n        </TabsList>\n\n        <TabsContent value={filterTab} className=\"space-y-4 mt-6\">\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3.5 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground/40\" />\n              <Input\n                placeholder=\"buscar por email, cpf, nome, cidade, sku...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"pl-10 h-10 bg-muted/40 border-0 rounded-xl text-[13px] lowercase focus-visible:ring-1 focus-visible:ring-foreground/10 placeholder:text-muted-foreground/40\"\n                data-testid=\"input-search-orders\"\n              />\n            </div>\n            <div className=\"flex gap-2 w-full sm:w-auto items-center\">\n                <Select value={statusFilter} onValueChange={setStatusFilter}>\n                  <SelectTrigger className=\"flex-1 sm:w-[180px] h-10 rounded-xl border-0 bg-muted/40 text-[13px] lowercase focus:ring-0 shadow-none\" data-testid=\"select-status-filter\">\n                    <SelectValue placeholder=\"filtrar por status\" />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"all\" className=\"lowercase italic\">todos os status</SelectItem>\n                    <SelectItem value=\"pending\" className=\"lowercase\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-2 h-2 rounded-full bg-amber-400 shadow-[0_0_8px_rgba(251,191,36,0.4)]\" />\n                        <span>pendente</span>\n                      </div>\n                    </SelectItem>\n                    <SelectItem value=\"paid\" className=\"lowercase\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]\" />\n                        <span>pago</span>\n                      </div>\n                    </SelectItem>\n                    <SelectItem value=\"failed\" className=\"lowercase\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-2 h-2 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]\" />\n                        <span>falhou</span>\n                      </div>\n                    </SelectItem>\n                    <SelectItem value=\"cancelled\" className=\"lowercase\">\n                      <div className=\"flex items-center gap-2\">\n                        <div className=\"w-2 h-2 rounded-full bg-slate-400 shadow-[0_0_8px_rgba(148,163,184,0.4)]\" />\n                        <span>cancelado</span>\n                      </div>\n                    </SelectItem>\n                  </SelectContent>\n                </Select>\n                <Button\n                  variant={showOnlyWithNotes ? \"default\" : \"ghost\"}\n                  size=\"icon\"\n                  onClick={() => setShowOnlyWithNotes(!showOnlyWithNotes)}\n                  className=\"flex-shrink-0 rounded-full\"\n                  data-testid=\"button-filter-with-notes\"\n                >\n                  <MessageCircle className={`h-4 w-4 ${showOnlyWithNotes ? 'fill-current' : ''}`} />\n                </Button>\n              </div>\n          </div>\n\n          {orders && (\n            <p className=\"text-[11px] text-muted-foreground/30 lowercase font-normal tracking-wide px-1\">\n              exibindo {filteredOrders?.length || 0} {\n                statusFilter === 'all' \n                  ? (filterTab === 'all' ? 'pedidos' : filterTab === 'archived' ? 'pedidos arquivados' : filterTab === 'deleted' ? 'pedidos removidos' : filterTab === 'shipped' ? 'pedidos enviados' : filterTab === 'delivered' ? 'pedidos entregues' : 'pedidos estornados')\n                  : `${statusFilter === 'paid' ? 'pedidos pagos' : statusFilter === 'pending' ? 'pedidos pendentes' : statusFilter === 'failed' ? 'pedidos que falharam' : 'pedidos cancelados'}`\n              }\n            </p>\n          )}\n\n          {/* Mobile Select All Action Bar - Only visible when at least one item is selected */}\n          {selectedOrderIds.length > 0 && (\n            <div className=\"lg:hidden flex items-center justify-between p-2 bg-muted/30 rounded-lg border border-border/50 animate-in fade-in slide-in-from-top-2 duration-200\">\n              <div className=\"flex items-center gap-3 ml-1\">\n                <Checkbox\n                  id=\"mobile-select-all\"\n                  checked={isAllSelected}\n                  onCheckedChange={handleSelectAll}\n                  className={isSomeSelected ? \"data-[state=unchecked]:bg-primary/50\" : \"\"}\n                />\n                <label \n                  htmlFor=\"mobile-select-all\" \n                  className=\"text-sm font-medium lowercase cursor-pointer\"\n                >\n                  selecionar tudo ({filteredOrders?.length || 0})\n                </label>\n              </div>\n              <Badge variant=\"secondary\" className=\"lowercase\">\n                {selectedOrderIds.length} selecionados\n              </Badge>\n            </div>\n          )}\n\n          {filteredOrders && filteredOrders.length === 0 ? (\n            <Card className=\"p-12 text-center\">\n              <Package className=\"h-12 w-12 mx-auto text-muted-foreground mb-4\" />\n              <p className=\"text-lg font-medium lowercase mb-2\">nenhum pedido encontrado</p>\n              <p className=\"text-sm text-muted-foreground lowercase\">\n                {searchTerm || statusFilter !== 'all' || showOnlyWithNotes\n                  ? 'tente ajustar os filtros de busca'\n                  : 'os pedidos aparecer√£o aqui assim que forem realizados'}\n              </p>\n            </Card>\n          ) : (\n            <>\n              {selectedOrderIds.length > 0 && (\n                <div className=\"flex items-center gap-2 p-4 bg-muted rounded-lg\">\n                  <span className=\"text-sm font-medium lowercase\">\n                    {selectedOrderIds.length} {selectedOrderIds.length === 1 ? 'pedido selecionado' : 'pedidos selecionados'}\n                  </span>\n                  <div className=\"flex gap-2 ml-auto flex-wrap justify-end\">\n                    {filterTab === 'all' && (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => updateBulkStatus('shipped')}\n                          className=\"gap-2\"\n                        >\n                          <Truck className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">marcar enviado</span>\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => updateBulkStatus('delivered')}\n                          className=\"gap-2\"\n                        >\n                          <Package className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">marcar entregue</span>\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => bulkArchiveMutation.mutate(selectedOrderIds)}\n                          disabled={bulkArchiveMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-archive\"\n                        >\n                          <Archive className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">arquivar</span>\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => bulkDeleteMutation.mutate(selectedOrderIds)}\n                          disabled={bulkDeleteMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-delete\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">remover</span>\n                        </Button>\n                      </>\n                    )}\n                    {filterTab === 'shipped' && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => updateBulkStatus('delivered')}\n                        className=\"gap-2\"\n                      >\n                        <Package className=\"h-4 w-4\" />\n                        <span className=\"hidden sm:inline lowercase\">marcar entregue</span>\n                      </Button>\n                    )}\n                    {filterTab === 'delivered' && (\n                      <Button\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={() => updateBulkStatus('refunded')}\n                        className=\"gap-2\"\n                      >\n                        <AlertTriangle className=\"h-4 w-4\" />\n                        <span className=\"hidden sm:inline lowercase\">estornar</span>\n                      </Button>\n                    )}\n                    {filterTab === 'archived' && (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => bulkUnarchiveMutation.mutate(selectedOrderIds)}\n                          disabled={bulkUnarchiveMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-unarchive\"\n                        >\n                          <ArchiveRestore className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">desarquivar</span>\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => bulkDeleteMutation.mutate(selectedOrderIds)}\n                          disabled={bulkDeleteMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-delete-archived\"\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">remover</span>\n                        </Button>\n                      </>\n                    )}\n                    {filterTab === 'deleted' && (\n                      <>\n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => bulkRestoreMutation.mutate(selectedOrderIds)}\n                          disabled={bulkRestoreMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-restore\"\n                        >\n                          <ArchiveRestore className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">restaurar</span>\n                        </Button>\n                        <Button\n                          size=\"sm\"\n                          variant=\"destructive\"\n                          onClick={() => bulkHardDeleteMutation.mutate(selectedOrderIds)}\n                          disabled={bulkHardDeleteMutation.isPending}\n                          className=\"gap-2\"\n                          data-testid=\"button-bulk-hard-delete\"\n                        >\n                          <AlertTriangle className=\"h-4 w-4\" />\n                          <span className=\"hidden sm:inline lowercase\">deletar</span>\n                        </Button>\n                      </>\n                    )}\n                    <Button\n                      size=\"sm\"\n                      variant=\"ghost\"\n                      onClick={() => setSelectedOrderIds([])}\n                      data-testid=\"button-clear-selection\"\n                    >\n                      <span className=\"lowercase\">limpar</span>\n                    </Button>\n                  </div>\n                </div>\n              )}\n\n              {/* Mobile Order Cards */}\n              <div className=\"grid grid-cols-1 gap-4 lg:hidden\">\n                {filteredOrders?.map((order) => {\n                  const statusInfo = orderStatusMap[order.orderStatus] || orderStatusMap.pending;\n                  const statusColorClass = getStatusColor(order.orderStatus);\n                  const hasNotes = order.internalNotes && order.internalNotes.trim().length > 0;\n                  return (\n                    <Card \n                      key={order.id} \n                      className={`p-4 space-y-3 cursor-pointer active:bg-muted/50 transition-all border-2 ${statusColorClass} ${\n                        hasNotes ? \"ring-1 ring-primary/20 shadow-sm\" : \"\"\n                      }`}\n                      onClick={() => setSelectedOrderId(order.id)}\n                    >\n                      <div className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center gap-3\">\n                          <div onClick={(e) => e.stopPropagation()}>\n                            <Checkbox\n                              checked={selectedOrderIds.includes(order.id)}\n                              onCheckedChange={() => handleSelectOrder(order.id)}\n                              aria-label={`Selecionar pedido ${order.orderNumber}`}\n                            />\n                          </div>\n                          <div className=\"flex items-center gap-2\">\n                            <div className={`w-2 h-2 rounded-full shrink-0 ${\n                              order.paymentStatus === 'approved' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]' :\n                              order.paymentStatus === 'rejected' || order.orderStatus === 'failed' ? 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]' :\n                              order.paymentStatus === 'cancelled' || order.orderStatus === 'cancelled' ? 'bg-slate-400 shadow-[0_0_8px_rgba(148,163,184,0.4)]' :\n                              'bg-amber-400 shadow-[0_0_8px_rgba(251,191,36,0.4)]'\n                            }`} />\n                            <span className=\"font-medium text-sm\">#{order.orderNumber}</span>\n                            {hasNotes && (\n                              <Badge variant=\"default\" className=\"h-5 px-1.5 gap-1 text-[10px] cursor-pointer\">\n                                <MessageCircle className=\"h-3 w-3\" />\n                                <span className=\"hidden sm:inline lowercase\">observa√ß√£o</span>\n                              </Badge>\n                            )}\n                          </div>\n                        </div>\n                        <Badge className={`text-[10px] lowercase border-none ${statusInfo.className}`}>\n                          {statusInfo.label}\n                        </Badge>\n                      </div>\n                      \n                      <div className=\"space-y-1\">\n                        <p className=\"text-sm font-medium\">{order.customerName}</p>\n                        <p className=\"text-xs text-muted-foreground lowercase\">\n                          {formatDate(order.createdAt)}\n                        </p>\n                      </div>\n\n                      <div className=\"flex items-center justify-between pt-2 border-t\">\n                        <span className=\"font-semibold text-sm\">{formatPrice(order.totalAmount)}</span>\n                        <div className=\"flex items-center gap-2\">\n                          {order.internalNotes && <MessageCircle className=\"h-4 w-4 text-primary\" />}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            className=\"h-8 w-8 p-0\"\n                            data-testid={`button-view-order-mobile-${order.orderNumber}`}\n                          >\n                            <Eye className=\"h-4 w-4\" />\n                          </Button>\n                          <div onClick={(e) => e.stopPropagation()}>\n                            <DropdownMenu>\n                              <DropdownMenuTrigger asChild>\n                                <Button variant=\"ghost\" size=\"sm\" className=\"h-8 w-8 p-0\">\n                                  <MoreVertical className=\"h-4 w-4\" />\n                                </Button>\n                              </DropdownMenuTrigger>\n                              <DropdownMenuContent align=\"end\" className=\"lowercase\">\n                                {filterTab === 'all' && (\n                                  <>\n                                    <DropdownMenuItem \n                                      onClick={(e) => {\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                        updateStatus(order.id, 'shipped');\n                                      }} \n                                      className=\"gap-2\"\n                                    >\n                                      <Truck className=\"h-4 w-4\" /> marcar como enviado\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem \n                                      onClick={(e) => {\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                        updateStatus(order.id, 'delivered');\n                                      }} \n                                      className=\"gap-2\"\n                                    >\n                                      <Package className=\"h-4 w-4\" /> marcar como entregue\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem \n                                      onClick={(e) => {\n                                        e.preventDefault();\n                                        e.stopPropagation();\n                                        updateStatus(order.id, 'refunded');\n                                      }} \n                                      className=\"gap-2\"\n                                    >\n                                      <AlertTriangle className=\"h-4 w-4\" /> estornar\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem onClick={() => archiveMutation.mutate(order.id)} className=\"gap-2\">\n                                      <Archive className=\"h-4 w-4\" /> arquivar\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem onClick={() => deleteMutation.mutate(order.id)} className=\"gap-2 text-destructive\">\n                                      <Trash2 className=\"h-4 w-4\" /> remover\n                                    </DropdownMenuItem>\n                                  </>\n                                )}\n                                {filterTab === 'archived' && (\n                                  <>\n                                    <DropdownMenuItem onClick={() => unarchiveMutation.mutate(order.id)} className=\"gap-2\">\n                                      <ArchiveRestore className=\"h-4 w-4\" /> desarquivar\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem onClick={() => deleteMutation.mutate(order.id)} className=\"gap-2 text-destructive\">\n                                      <Trash2 className=\"h-4 w-4\" /> remover\n                                    </DropdownMenuItem>\n                                  </>\n                                )}\n                                {filterTab === 'deleted' && (\n                                  <>\n                                    <DropdownMenuItem onClick={() => bulkRestoreMutation.mutate([order.id])} className=\"gap-2\">\n                                      <ArchiveRestore className=\"h-4 w-4\" /> restaurar\n                                    </DropdownMenuItem>\n                                    <DropdownMenuItem onClick={() => hardDeleteMutation.mutate(order.id)} className=\"gap-2 text-destructive\">\n                                      <AlertTriangle className=\"h-4 w-4\" /> deletar permanentemente\n                                    </DropdownMenuItem>\n                                  </>\n                                )}\n                              </DropdownMenuContent>\n                            </DropdownMenu>\n                          </div>\n                        </div>\n                      </div>\n                    </Card>\n                  );\n                })}\n              </div>\n\n              {/* Desktop Table */}\n              <div className=\"hidden lg:block\">\n                <Card className=\"overflow-hidden\">\n                  <Table>\n                    <TableHeader>\n                      <TableRow>\n                        <TableHead className=\"w-[50px]\">\n                          <Checkbox\n                            checked={isAllSelected}\n                            onCheckedChange={handleSelectAll}\n                            aria-label=\"Selecionar todos\"\n                            data-testid=\"checkbox-select-all\"\n                            className={isSomeSelected ? \"data-[state=unchecked]:bg-primary/50\" : \"\"}\n                          />\n                        </TableHead>\n                        <TableHead className=\"lowercase\">\n                          <SortButton field=\"orderNumber\">n√∫mero</SortButton>\n                        </TableHead>\n                        <TableHead className=\"lowercase\">\n                          <SortButton field=\"customerName\">cliente</SortButton>\n                        </TableHead>\n                        <TableHead className=\"lowercase\">\n                          <SortButton field=\"createdAt\">data</SortButton>\n                        </TableHead>\n                        <TableHead className=\"lowercase\">\n                          <SortButton field=\"totalAmount\">total</SortButton>\n                        </TableHead>\n                        <TableHead className=\"lowercase\">\n                          <SortButton field=\"orderStatus\">status</SortButton>\n                        </TableHead>\n                        <TableHead className=\"lowercase w-[100px]\">a√ß√µes</TableHead>\n                      </TableRow>\n                    </TableHeader>\n                    <TableBody>\n                      {filteredOrders?.map((order) => {\n                        const statusInfo = orderStatusMap[order.orderStatus] || orderStatusMap.pending;\n                        return (\n                          <TableRow \n                            key={order.id}\n                            className={`hover-elevate transition-colors border-l-4 ${getStatusColor(order.orderStatus)}`}\n                            data-testid={`row-order-${order.id}`}\n                          >\n                            <TableCell onClick={(e) => e.stopPropagation()}>\n                              <Checkbox\n                                checked={selectedOrderIds.includes(order.id)}\n                                onCheckedChange={() => handleSelectOrder(order.id)}\n                                aria-label={`Selecionar pedido ${order.orderNumber}`}\n                                data-testid={`checkbox-order-${order.id}`}\n                              />\n                            </TableCell>\n                            <TableCell \n                              className=\"font-medium cursor-pointer\"\n                              onClick={() => setSelectedOrderId(order.id)}\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                <div className={`w-2 h-2 rounded-full shrink-0 ${\n                                  order.paymentStatus === 'approved' || order.orderStatus === 'paid' || order.orderStatus === 'shipped' || order.orderStatus === 'delivered' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]' :\n                                  order.paymentStatus === 'rejected' || order.orderStatus === 'failed' ? 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]' :\n                                  order.paymentStatus === 'cancelled' || order.orderStatus === 'cancelled' ? 'bg-slate-400 shadow-[0_0_8px_rgba(148,163,184,0.4)]' :\n                                  'bg-amber-400 shadow-[0_0_8px_rgba(251,191,36,0.4)]'\n                                }`} />\n                                <div className=\"flex flex-col\">\n                                  <span>{order.orderNumber}</span>\n                                  <span className=\"text-[11px] font-medium text-slate-500 dark:text-slate-400 lowercase leading-none mt-1\">\n                                    {paymentStatusMap[order.paymentStatus || 'pending']?.label.toLowerCase()}\n                                  </span>\n                                </div>\n                                {order.internalNotes && order.internalNotes.trim().length > 0 ? (\n                                  <MessageCircle className=\"h-4 w-4 text-primary fill-primary\" data-testid={`icon-has-notes-${order.id}`} />\n                                ) : (\n                                  <MessageCircle className=\"h-4 w-4 text-muted-foreground/10\" />\n                                )}\n                              </div>\n                            </TableCell>\n                            <TableCell \n                              className=\"cursor-pointer\"\n                              onClick={() => setSelectedOrderId(order.id)}\n                            >\n                              <div className=\"flex flex-col\">\n                                <span className=\"font-medium\">{order.customerName}</span>\n                                <span className=\"text-xs text-muted-foreground lowercase\">\n                                  {order.customerEmail}\n                                </span>\n                              </div>\n                            </TableCell>\n                            <TableCell \n                              className=\"text-sm cursor-pointer\"\n                              onClick={() => setSelectedOrderId(order.id)}\n                            >\n                              {formatDate(order.createdAt)}\n                            </TableCell>\n                            <TableCell \n                              className=\"font-medium cursor-pointer\"\n                              onClick={() => setSelectedOrderId(order.id)}\n                            >\n                              {formatPrice(order.totalAmount)}\n                            </TableCell>\n                            <TableCell \n                              className=\"cursor-pointer\"\n                              onClick={() => setSelectedOrderId(order.id)}\n                            >\n                              <div className=\"flex items-center gap-2\">\n                                <Badge className={`lowercase border-none ${statusInfo.className}`}>\n                                  {statusInfo.label}\n                                </Badge>\n                                {order.confirmationEmailSentAt ? (\n                                  <span data-testid={`icon-email-sent-${order.id}`}><MailCheck className=\"h-3.5 w-3.5 text-emerald-500\" /></span>\n                                ) : order.paymentStatus === 'approved' ? (\n                                  <span data-testid={`icon-email-not-sent-${order.id}`}><MailX className=\"h-3.5 w-3.5 text-muted-foreground/40\" /></span>\n                                ) : null}\n                              </div>\n                            </TableCell>\n                            <TableCell>\n                              <div className=\"flex gap-2\" onClick={(e) => e.stopPropagation()}>\n                                {!order.archivedAt && !order.deletedAt && (\n                                  <>\n                                    <Button\n                                      size=\"icon\"\n                                      variant=\"ghost\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        archiveMutation.mutate(order.id);\n                                      }}\n                                      data-testid={`button-archive-${order.id}`}\n                                    >\n                                      <Archive className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button\n                                      size=\"icon\"\n                                      variant=\"ghost\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        deleteMutation.mutate(order.id);\n                                      }}\n                                      data-testid={`button-delete-${order.id}`}\n                                    >\n                                      <Trash2 className=\"h-4 w-4\" />\n                                    </Button>\n                                  </>\n                                )}\n                                {order.archivedAt && !order.deletedAt && (\n                                  <Button\n                                    size=\"icon\"\n                                    variant=\"ghost\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      unarchiveMutation.mutate(order.id);\n                                    }}\n                                    data-testid={`button-unarchive-${order.id}`}\n                                  >\n                                    <ArchiveRestore className=\"h-4 w-4\" />\n                                  </Button>\n                                )}\n                                {order.deletedAt && (\n                                  <>\n                                    <Button\n                                      size=\"icon\"\n                                      variant=\"ghost\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        bulkRestoreMutation.mutate([order.id]);\n                                      }}\n                                      data-testid={`button-restore-${order.id}`}\n                                    >\n                                      <ArchiveRestore className=\"h-4 w-4\" />\n                                    </Button>\n                                    <Button\n                                      size=\"icon\"\n                                      variant=\"ghost\"\n                                      onClick={(e) => {\n                                        e.stopPropagation();\n                                        hardDeleteMutation.mutate(order.id);\n                                      }}\n                                      data-testid={`button-hard-delete-${order.id}`}\n                                    >\n                                      <Trash2 className=\"h-4 w-4 text-destructive\" />\n                                    </Button>\n                                  </>\n                                )}\n                              </div>\n                            </TableCell>\n                          </TableRow>\n                        );\n                      })}\n                    </TableBody>\n                  </Table>\n                </Card>\n              </div>\n            </>\n          )}\n        </TabsContent>\n      </Tabs>\n\n      <Dialog open={!!selectedOrderId} onOpenChange={() => setSelectedOrderId(null)}>\n        <DialogContent className=\"max-w-3xl max-h-[90vh] overflow-y-auto\">\n          <DialogHeader>\n            <DialogTitle className=\"lowercase\">detalhes do pedido</DialogTitle>\n            <div className=\"flex flex-col gap-2\">\n              <DialogDescription className=\"lowercase flex items-center gap-2\">\n                #{selectedOrder?.orderNumber}\n                <div className=\"flex items-center gap-1.5 ml-2\">\n                  <div className={`w-2 h-2 rounded-full ${\n                    selectedOrder?.paymentStatus === 'approved' || selectedOrder?.orderStatus === 'paid' || selectedOrder?.orderStatus === 'shipped' || selectedOrder?.orderStatus === 'delivered' ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]' :\n                    selectedOrder?.paymentStatus === 'rejected' || selectedOrder?.orderStatus === 'failed' ? 'bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.4)]' :\n                    selectedOrder?.paymentStatus === 'cancelled' || selectedOrder?.orderStatus === 'cancelled' ? 'bg-slate-400 shadow-[0_0_8px_rgba(148,163,184,0.4)]' :\n                    'bg-amber-400 shadow-[0_0_8px_rgba(251,191,36,0.4)]'\n                  }`} />\n                  <span className=\"text-[13px] font-medium text-slate-600 dark:text-slate-400 lowercase\">\n                    {paymentStatusMap[selectedOrder?.paymentStatus || 'pending']?.label.toLowerCase()}\n                  </span>\n                </div>\n              </DialogDescription>\n            </div>\n            {selectedOrder?.verificationCode && (\n              <div className=\"mt-3 flex items-center gap-2 bg-emerald-50 dark:bg-emerald-900/20 border border-emerald-100 dark:border-emerald-800 p-3 rounded-lg animate-in fade-in slide-in-from-top-1 duration-300\">\n                <Shield className=\"h-4 w-4 text-emerald-600 dark:text-emerald-400\" />\n                <div className=\"flex flex-col\">\n                  <span className=\"text-[10px] uppercase tracking-wider font-semibold text-emerald-600/70 dark:text-emerald-400/70\">c√≥digo de verifica√ß√£o</span>\n                  <span className=\"text-sm font-mono font-bold text-emerald-900 dark:text-emerald-100 tracking-widest\">{selectedOrder.verificationCode}</span>\n                </div>\n              </div>\n            )}\n            {selectedOrder?.trackingCode && (\n              <div className=\"mt-3 flex items-center gap-2 bg-blue-50 dark:bg-blue-900/20 border border-blue-100 dark:border-blue-800 p-3 rounded-lg animate-in fade-in slide-in-from-top-1 duration-300\">\n                <Truck className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                <div className=\"flex flex-col\">\n                  <span className=\"text-[10px] uppercase tracking-wider font-semibold text-blue-600/70 dark:text-blue-400/70\">C√≥digo de Rastreio</span>\n                  <span className=\"text-sm font-mono font-medium text-blue-900 dark:text-blue-100\">{selectedOrder.trackingCode}</span>\n                </div>\n              </div>\n            )}\n          </DialogHeader>\n\n          {isLoadingDetails ? (\n            <div className=\"flex items-center justify-center p-12\">\n              <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n            </div>\n          ) : selectedOrder ? (\n            <div className=\"space-y-6\">\n              {/* Internal Notes - First Priority */}\n              <Card className=\"p-4 space-y-3\">\n                <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                  <MessageCircle className=\"h-4 w-4\" />\n                  observa√ß√µes internas\n                </div>\n                <Separator />\n                <div className=\"space-y-3\">\n                  <Textarea\n                    ref={notesTextareaRef}\n                    placeholder=\"adicione observa√ß√µes sobre este pedido...\"\n                    value={internalNotes}\n                    onChange={(e) => setInternalNotes(e.target.value)}\n                    className=\"min-h-[100px] resize-none lowercase\"\n                    data-testid=\"textarea-internal-notes\"\n                  />\n                  <div className=\"flex gap-2\">\n                    <Button\n                      onClick={() => saveNotesMutation.mutate()}\n                      disabled={saveNotesMutation.isPending}\n                      size=\"sm\"\n                      className=\"gap-2\"\n                      data-testid=\"button-save-notes\"\n                    >\n                      <Save className=\"h-4 w-4\" />\n                      <span className=\"lowercase\">salvar observa√ß√µes</span>\n                    </Button>\n                  </div>\n                </div>\n              </Card>\n\n              {/* Status Specific Info */}\n              {selectedOrder.orderStatus === 'shipped' && selectedOrder.trackingCode && (\n                <Card className=\"p-4 bg-blue-50/30 border-blue-200 dark:bg-blue-950/20 dark:border-blue-900/50\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase text-blue-700 dark:text-blue-400\">\n                    <Truck className=\"h-4 w-4\" />\n                    c√≥digo de rastreio: <span className=\"font-bold uppercase tracking-wider\">{selectedOrder.trackingCode}</span>\n                  </div>\n                </Card>\n              )}\n\n              {selectedOrder.orderStatus === 'refunded' && selectedOrder.refundReason && (\n                <Card className=\"p-4 bg-red-50/30 border-red-200 dark:bg-red-950/20 dark:border-red-900/50\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase text-red-700 dark:text-red-400\">\n                    <AlertTriangle className=\"h-4 w-4\" />\n                    motivo do estorno: <span className=\"font-normal italic\">{selectedOrder.refundReason}</span>\n                  </div>\n                </Card>\n              )}\n\n              <Card className=\"p-4 space-y-3\">\n                <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                  <Mail className=\"h-4 w-4\" />\n                  notifica√ß√µes por email\n                </div>\n                <Separator />\n                <div className=\"space-y-2\">\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    {selectedOrder.confirmationEmailSentAt ? (\n                      <MailCheck className=\"h-4 w-4 text-emerald-500\" />\n                    ) : (\n                      <MailX className=\"h-4 w-4 text-muted-foreground/40\" />\n                    )}\n                    <span className=\"lowercase\">\n                      {selectedOrder.confirmationEmailSentAt \n                        ? `confirma√ß√£o enviada em ${format(new Date(selectedOrder.confirmationEmailSentAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}`\n                        : \"confirma√ß√£o n√£o enviada\"}\n                    </span>\n                  </div>\n                  <div className=\"flex items-center gap-2 text-sm\">\n                    {selectedOrder.trackingEmailSentAt ? (\n                      <MailCheck className=\"h-4 w-4 text-emerald-500\" />\n                    ) : (\n                      <MailX className=\"h-4 w-4 text-muted-foreground/40\" />\n                    )}\n                    <span className=\"lowercase\">\n                      {selectedOrder.trackingEmailSentAt \n                        ? `rastreio enviado em ${format(new Date(selectedOrder.trackingEmailSentAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}`\n                        : \"rastreio n√£o enviado\"}\n                    </span>\n                  </div>\n                  {selectedOrder.emailDeliveredAt && (\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <MailCheck className=\"h-4 w-4 text-blue-500\" />\n                      <span className=\"lowercase\">\n                        entregue na caixa de entrada em {format(new Date(selectedOrder.emailDeliveredAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}\n                      </span>\n                    </div>\n                  )}\n                  {selectedOrder.emailOpenedAt && (\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <Eye className=\"h-4 w-4 text-violet-500\" />\n                      <span className=\"lowercase\">\n                        aberto pelo cliente em {format(new Date(selectedOrder.emailOpenedAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}\n                      </span>\n                    </div>\n                  )}\n                  {selectedOrder.emailComplainedAt && (\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <AlertTriangle className=\"h-4 w-4 text-amber-500\" />\n                      <span className=\"lowercase\">\n                        marcado como spam em {format(new Date(selectedOrder.emailComplainedAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}\n                      </span>\n                    </div>\n                  )}\n                  {selectedOrder.emailFailedAt && (\n                    <div className=\"flex items-center gap-2 text-sm\">\n                      <MailX className=\"h-4 w-4 text-red-500\" />\n                      <span className=\"lowercase\">\n                        falha na entrega em {format(new Date(selectedOrder.emailFailedAt), \"dd/MM/yyyy '√†s' HH:mm\", { locale: ptBR })}\n                        {selectedOrder.emailFailureReason && ` - ${selectedOrder.emailFailureReason}`}\n                      </span>\n                    </div>\n                  )}\n                </div>\n              </Card>\n\n              {/* Quick Actions - Apple Style */}\n              <div className=\"space-y-4\">\n                <div className=\"grid grid-cols-2 sm:grid-cols-3 gap-3\">\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => handleStatusClick(selectedOrder.id, 'shipped')}\n                    className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                    disabled={selectedOrder.orderStatus === 'shipped' || selectedOrder.orderStatus === 'delivered' || selectedOrder.orderStatus === 'refunded'}\n                  >\n                    <div className=\"w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center text-blue-600 dark:text-blue-400 group-disabled:opacity-50\">\n                      <Truck className=\"h-5 w-5\" />\n                    </div>\n                    <span className=\"text-[11px] font-medium lowercase tracking-tight\">enviado</span>\n                  </Button>\n\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => handleStatusClick(selectedOrder.id, 'delivered')}\n                    className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                    disabled={selectedOrder.orderStatus !== 'shipped'}\n                  >\n                    <div className=\"w-10 h-10 rounded-full bg-green-100 dark:bg-green-900/30 flex items-center justify-center text-green-600 dark:text-green-400 group-disabled:opacity-50\">\n                      <Package className=\"h-5 w-5\" />\n                    </div>\n                    <span className=\"text-[11px] font-medium lowercase tracking-tight\">entregue</span>\n                  </Button>\n\n                  <Button\n                    size=\"lg\"\n                    variant=\"outline\"\n                    onClick={() => handleStatusClick(selectedOrder.id, 'refunded')}\n                    className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                    disabled={selectedOrder.orderStatus === 'refunded'}\n                  >\n                    <div className=\"w-10 h-10 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center text-red-600 dark:text-red-400 group-disabled:opacity-50\">\n                      <AlertTriangle className=\"h-5 w-5\" />\n                    </div>\n                    <span className=\"text-[11px] font-medium lowercase tracking-tight\">estornar</span>\n                  </Button>\n\n                  {!selectedOrder.archivedAt && !selectedOrder.deletedAt && (\n                    <Button\n                      size=\"lg\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        archiveMutation.mutate(selectedOrder.id);\n                        setSelectedOrderId(null);\n                      }}\n                      className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                      data-testid=\"button-archive-order-quick\"\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-orange-50 dark:bg-orange-900/20 flex items-center justify-center text-orange-500\">\n                        <Archive className=\"h-5 w-5\" />\n                      </div>\n                      <span className=\"text-[11px] font-medium lowercase tracking-tight\">arquivar</span>\n                    </Button>\n                  )}\n\n                  {selectedOrder.archivedAt && !selectedOrder.deletedAt && (\n                    <Button\n                      size=\"lg\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        unarchiveMutation.mutate(selectedOrder.id);\n                        setSelectedOrderId(null);\n                      }}\n                      className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                      data-testid=\"button-unarchive-order-quick\"\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-900/20 flex items-center justify-center text-blue-500\">\n                        <ArchiveRestore className=\"h-5 w-5\" />\n                      </div>\n                      <span className=\"text-[11px] font-medium lowercase tracking-tight\">desarquivar</span>\n                    </Button>\n                  )}\n\n                  {!selectedOrder.deletedAt && (\n                    <Button\n                      size=\"lg\"\n                      variant=\"outline\"\n                      onClick={() => {\n                        deleteMutation.mutate(selectedOrder.id);\n                        setSelectedOrderId(null);\n                      }}\n                      className=\"flex flex-col items-center justify-center gap-2 h-auto py-4 rounded-2xl border-none bg-secondary/50 hover:bg-secondary transition-all active:scale-95 group\"\n                      data-testid=\"button-delete-order-quick\"\n                    >\n                      <div className=\"w-10 h-10 rounded-full bg-red-50 dark:bg-red-900/20 flex items-center justify-center text-red-500\">\n                        <Trash2 className=\"h-5 w-5\" />\n                      </div>\n                      <span className=\"text-[11px] font-medium lowercase tracking-tight text-red-600 dark:text-red-400\">remover</span>\n                    </Button>\n                  )}\n\n                  <div className=\"flex flex-col gap-2\">\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      asChild\n                      className=\"w-full justify-start gap-2 h-10 rounded-xl border-none bg-secondary/50 hover:bg-secondary\"\n                      data-testid=\"button-whatsapp-contact\"\n                    >\n                      <a\n                        href={`https://wa.me/55${selectedOrder.customerPhone.replace(/\\D/g, '')}`}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        <SiWhatsapp className=\"h-4 w-4 text-[#25D366]\" />\n                        <span className=\"text-xs lowercase\">whatsapp</span>\n                      </a>\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      asChild\n                      className=\"w-full justify-start gap-2 h-10 rounded-xl border-none bg-secondary/50 hover:bg-secondary\"\n                      data-testid=\"button-email-contact\"\n                    >\n                      <a href={`mailto:${selectedOrder.customerEmail}`}>\n                        <Mail className=\"h-4 w-4 text-primary\" />\n                        <span className=\"text-xs lowercase\">email</span>\n                      </a>\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      asChild\n                      className=\"w-full justify-start gap-2 h-10 rounded-xl border-none bg-secondary/50 hover:bg-secondary\"\n                      data-testid=\"button-maps-location\"\n                    >\n                      <a\n                        href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(`${selectedOrder.street}, ${selectedOrder.number}, ${selectedOrder.neighborhood}, ${selectedOrder.city} - ${selectedOrder.state}, ${selectedOrder.zipCode}`)}`}\n                        target=\"_blank\"\n                        rel=\"noopener noreferrer\"\n                      >\n                        <Navigation className=\"h-4 w-4 text-primary\" />\n                        <span className=\"text-xs lowercase\">maps</span>\n                      </a>\n                    </Button>\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n                <Card className=\"p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                    <Mail className=\"h-4 w-4\" />\n                    informa√ß√µes do cliente\n                  </div>\n                  <Separator />\n                  <div className=\"space-y-2 text-sm\">\n                    <div>\n                      <span className=\"text-muted-foreground lowercase\">nome:</span>\n                      <p className=\"font-medium\">{selectedOrder.customerName}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground lowercase\">email:</span>\n                      <p className=\"font-medium lowercase\">{selectedOrder.customerEmail}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground lowercase\">telefone:</span>\n                      <p className=\"font-medium\">{selectedOrder.customerPhone}</p>\n                    </div>\n                    <div>\n                      <span className=\"text-muted-foreground lowercase\">cpf:</span>\n                      <p className=\"font-medium\">{selectedOrder.customerCpf}</p>\n                    </div>\n                  </div>\n                </Card>\n\n                <Card className=\"p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                    <MapPin className=\"h-4 w-4\" />\n                    endere√ßo de entrega\n                  </div>\n                  <Separator />\n                  <div className=\"text-sm space-y-1\">\n                    <p className=\"font-medium\">{selectedOrder.street}, {selectedOrder.number}</p>\n                    {selectedOrder.complement && <p>{selectedOrder.complement}</p>}\n                    <p>{selectedOrder.neighborhood}</p>\n                    <p>{selectedOrder.city} - {selectedOrder.state}</p>\n                    <p className=\"text-muted-foreground lowercase\">cep: {selectedOrder.zipCode}</p>\n                  </div>\n                </Card>\n              </div>\n\n              <Card className=\"p-4 space-y-3\">\n                <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                  <Package className=\"h-4 w-4\" />\n                  itens do pedido\n                </div>\n                <Separator />\n                <div className=\"space-y-4\">\n                  {selectedOrder.items.map((item) => {\n                    const colorData = JSON.parse(item.color);\n                    return (\n                      <div key={item.id} className=\"flex gap-4\">\n                        <div className=\"w-20 h-20 bg-muted rounded-lg overflow-hidden flex-shrink-0\">\n                          {item.productImage && (\n                            <img\n                              src={item.productImage}\n                              alt={item.productName}\n                              className=\"w-full h-full object-cover\"\n                              loading=\"lazy\"\n                              decoding=\"async\"\n                            />\n                          )}\n                        </div>\n                        <div className=\"flex-1\">\n                          <h4 className=\"font-medium lowercase\">{item.productName}</h4>\n                          <div className=\"text-sm text-muted-foreground space-y-0.5 mt-1\">\n                            <p className=\"lowercase\">tamanho: {item.size}</p>\n                            <p className=\"lowercase\">cor: {colorData.name}</p>\n                            {item.printPosition && (\n                              <p className=\"lowercase\">estampa: {item.printPosition}</p>\n                            )}\n                            <p className=\"lowercase\">quantidade: {item.quantity}</p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <p className=\"text-sm text-muted-foreground lowercase\">\n                            {item.quantity}x {formatPrice(item.unitPrice)}\n                          </p>\n                          <p className=\"font-medium\">{formatPrice(item.subtotal)}</p>\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              </Card>\n\n              <Card className=\"p-4 space-y-3\">\n                <div className=\"space-y-2\">\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground lowercase\">subtotal:</span>\n                    <span className=\"font-medium\">{formatPrice(selectedOrder.subtotal)}</span>\n                  </div>\n                  <div className=\"flex justify-between text-sm\">\n                    <span className=\"text-muted-foreground lowercase\">frete:</span>\n                    <span className=\"font-medium text-primary lowercase\">\n                      {parseFloat(selectedOrder.shippingCost) === 0 ? 'gr√°tis' : formatPrice(selectedOrder.shippingCost)}\n                    </span>\n                  </div>\n                  <Separator />\n                  <div className=\"flex justify-between text-base font-semibold\">\n                    <span className=\"lowercase\">total:</span>\n                    <span>{formatPrice(selectedOrder.totalAmount)}</span>\n                  </div>\n                </div>\n              </Card>\n\n              {(selectedOrder.paymentId || selectedOrder.paymentStatus) && (\n                <Card className=\"p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                    <Package className=\"h-4 w-4\" />\n                    informa√ß√µes de pagamento\n                  </div>\n                  <Separator />\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                    {selectedOrder.paymentId && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">id do pagamento:</span>\n                        <p className=\"font-medium\">{selectedOrder.paymentId}</p>\n                      </div>\n                    )}\n                    {selectedOrder.paymentStatus && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">status:</span>\n                        <p className=\"font-medium lowercase\">{selectedOrder.paymentStatus}</p>\n                      </div>\n                    )}\n                    {selectedOrder.paymentTypeId && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">tipo:</span>\n                        <p className=\"font-medium lowercase\">{selectedOrder.paymentTypeId === 'credit_card' ? 'cart√£o de cr√©dito' : selectedOrder.paymentTypeId === 'debit_card' ? 'cart√£o de d√©bito' : selectedOrder.paymentTypeId === 'account_money' ? 'saldo em conta' : selectedOrder.paymentTypeId}</p>\n                      </div>\n                    )}\n                    {selectedOrder.paymentMethod && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">m√©todo:</span>\n                        <p className=\"font-medium lowercase\">{selectedOrder.paymentMethod}</p>\n                      </div>\n                    )}\n                    {selectedOrder.paymentInstallments && selectedOrder.paymentInstallments > 1 && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">parcelas:</span>\n                        <p className=\"font-medium\">{selectedOrder.paymentInstallments}x</p>\n                      </div>\n                    )}\n                    {selectedOrder.paidAt && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">pago em:</span>\n                        <p className=\"font-medium\">{formatDate(selectedOrder.paidAt)}</p>\n                      </div>\n                    )}\n                    {selectedOrder.paymentPreferenceId && (\n                      <div className=\"md:col-span-2\">\n                        <span className=\"text-muted-foreground lowercase\">preference id:</span>\n                        <p className=\"font-medium text-xs break-all\">{selectedOrder.paymentPreferenceId}</p>\n                      </div>\n                    )}\n                  </div>\n                </Card>\n              )}\n\n              {(selectedOrder.customerIp || selectedOrder.deviceType || selectedOrder.browserName || selectedOrder.osName || selectedOrder.screenResolution) && (\n                <Card className=\"p-4 space-y-3\">\n                  <div className=\"flex items-center gap-2 text-sm font-medium lowercase\">\n                    <Package className=\"h-4 w-4\" />\n                    informa√ß√µes do dispositivo\n                  </div>\n                  <Separator />\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n                    {selectedOrder.customerIp && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">ip:</span>\n                        <p className=\"font-medium\">{selectedOrder.customerIp}</p>\n                      </div>\n                    )}\n                    {selectedOrder.deviceType && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">dispositivo:</span>\n                        <p className=\"font-medium lowercase\">{selectedOrder.deviceType}</p>\n                      </div>\n                    )}\n                    {selectedOrder.browserName && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">navegador:</span>\n                        <p className=\"font-medium\">{selectedOrder.browserName} {selectedOrder.browserVersion}</p>\n                      </div>\n                    )}\n                    {selectedOrder.osName && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">sistema:</span>\n                        <p className=\"font-medium\">{selectedOrder.osName} {selectedOrder.osVersion}</p>\n                      </div>\n                    )}\n                    {selectedOrder.screenResolution && (\n                      <div>\n                        <span className=\"text-muted-foreground lowercase\">resolu√ß√£o:</span>\n                        <p className=\"font-medium\">{selectedOrder.screenResolution}</p>\n                      </div>\n                    )}\n                    {selectedOrder.userAgent && (\n                      <div className=\"md:col-span-2\">\n                        <span className=\"text-muted-foreground lowercase\">user agent:</span>\n                        <p className=\"font-medium text-xs break-all\">{selectedOrder.userAgent}</p>\n                      </div>\n                    )}\n                  </div>\n                </Card>\n              )}\n            </div>\n          ) : null}\n        </DialogContent>\n      </Dialog>\n\n      <Dialog open={isStatusDialogOpen} onOpenChange={setIsStatusDialogOpen}>\n        <DialogContent className=\"sm:max-w-[425px]\">\n          <DialogHeader>\n            <DialogTitle className=\"lowercase\">\n              {pendingStatusChange?.status === 'shipped' ? 'informar rastreio' : 'motivo do estorno'}\n            </DialogTitle>\n            <DialogDescription className=\"lowercase\">\n              {pendingStatusChange?.status === 'shipped' \n                ? 'insira o c√≥digo de rastreio para o envio do pedido.' \n                : 'explique o motivo do estorno (m√≠nimo 20 caracteres).'}\n            </DialogDescription>\n          </DialogHeader>\n          <div className=\"grid gap-4 py-4\">\n            {pendingStatusChange?.status === 'shipped' ? (\n              <Input\n                placeholder=\"ex: BR123456789BR\"\n                value={statusMetadata.trackingCode}\n                onChange={(e) => setStatusMetadata(prev => ({ ...prev, trackingCode: e.target.value }))}\n                className=\"lowercase\"\n              />\n            ) : (\n              <Textarea\n                placeholder=\"descreva o motivo do estorno detalhadamente...\"\n                value={statusMetadata.refundReason}\n                onChange={(e) => setStatusMetadata(prev => ({ ...prev, refundReason: e.target.value }))}\n                className=\"min-h-[100px] resize-none lowercase\"\n              />\n            )}\n          </div>\n          <DialogFooter>\n            <Button\n              variant=\"outline\"\n              onClick={() => {\n                setIsStatusDialogOpen(false);\n                setPendingStatusChange(null);\n                setStatusMetadata({ trackingCode: \"\", refundReason: \"\" });\n              }}\n              className=\"lowercase\"\n            >\n              cancelar\n            </Button>\n            <Button\n              onClick={() => {\n                if (pendingStatusChange) {\n                  updateStatus(pendingStatusChange.id, pendingStatusChange.status, statusMetadata);\n                }\n              }}\n              disabled={\n                pendingStatusChange?.status === 'shipped' \n                  ? !statusMetadata.trackingCode.trim()\n                  : statusMetadata.refundReason.trim().length < 20\n              }\n              className=\"lowercase\"\n            >\n              confirmar\n            </Button>\n          </DialogFooter>\n        </DialogContent>\n      </Dialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":85607,"size_tokens":null},"client/src/pages/Checkout.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\n// Importa o hook do Facebook Pixel para rastreamento de eventos\nimport { usePixel } from \"@/hooks/usePixel\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { ArrowLeft, ArrowRight, Check, Lock, Truck, Mail, MapPin, User, Zap } from \"lucide-react\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport logoSvg from \"@/assets/logo.svg\";\nimport mpColorLogo from \"@/assets/mp-color.svg\";\nimport mpPlumaLogo from \"@/assets/mp-pluma.svg\";\n\nfunction getDeviceInfo() {\n  const ua = navigator.userAgent;\n  \n  let deviceType = \"desktop\";\n  if (/mobile|android|iphone|ipad|tablet/i.test(ua)) {\n    if (/ipad|tablet/i.test(ua)) {\n      deviceType = \"tablet\";\n    } else {\n      deviceType = \"mobile\";\n    }\n  }\n  \n  let browserName = \"Unknown\";\n  let browserVersion = \"\";\n  if (ua.indexOf(\"Firefox\") > -1) {\n    browserName = \"Firefox\";\n    browserVersion = ua.match(/Firefox\\/(\\d+\\.\\d+)/)?.[1] || \"\";\n  } else if (ua.indexOf(\"Chrome\") > -1 && ua.indexOf(\"Edg\") === -1) {\n    browserName = \"Chrome\";\n    browserVersion = ua.match(/Chrome\\/(\\d+\\.\\d+)/)?.[1] || \"\";\n  } else if (ua.indexOf(\"Safari\") > -1 && ua.indexOf(\"Chrome\") === -1) {\n    browserName = \"Safari\";\n    browserVersion = ua.match(/Version\\/(\\d+\\.\\d+)/)?.[1] || \"\";\n  } else if (ua.indexOf(\"Edg\") > -1) {\n    browserName = \"Edge\";\n    browserVersion = ua.match(/Edg\\/(\\d+\\.\\d+)/)?.[1] || \"\";\n  }\n  \n  let osName = \"Unknown\";\n  let osVersion = \"\";\n  if (ua.indexOf(\"Win\") > -1) {\n    osName = \"Windows\";\n    osVersion = ua.match(/Windows NT (\\d+\\.\\d+)/)?.[1] || \"\";\n  } else if (ua.indexOf(\"Mac\") > -1) {\n    osName = \"macOS\";\n    osVersion = ua.match(/Mac OS X (\\d+[._]\\d+)/)?.[1].replace(\"_\", \".\") || \"\";\n  } else if (ua.indexOf(\"Linux\") > -1) {\n    osName = \"Linux\";\n  } else if (ua.indexOf(\"Android\") > -1) {\n    osName = \"Android\";\n    osVersion = ua.match(/Android (\\d+\\.\\d+)/)?.[1] || \"\";\n  } else if (ua.indexOf(\"iOS\") > -1 || ua.indexOf(\"iPhone\") > -1 || ua.indexOf(\"iPad\") > -1) {\n    osName = \"iOS\";\n    osVersion = ua.match(/OS (\\d+[._]\\d+)/)?.[1].replace(\"_\", \".\") || \"\";\n  }\n  \n  const screenResolution = `${window.screen.width}x${window.screen.height}`;\n  \n  return {\n    userAgent: ua,\n    deviceType,\n    browserName,\n    browserVersion,\n    osName,\n    osVersion,\n    screenResolution,\n  };\n}\n\n// Fun√ß√£o para validar CPF\nfunction isValidCPF(cpf: string): boolean {\n  const numbers = cpf.replace(/\\D/g, '');\n  \n  if (numbers.length !== 11) return false;\n  \n  // Verifica se todos os d√≠gitos s√£o iguais (ex: 111.111.111-11)\n  if (/^(\\d)\\1+$/.test(numbers)) return false;\n  \n  // Valida√ß√£o do primeiro d√≠gito verificador\n  let sum = 0;\n  for (let i = 0; i < 9; i++) {\n    sum += parseInt(numbers[i]) * (10 - i);\n  }\n  let remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(numbers[9])) return false;\n  \n  // Valida√ß√£o do segundo d√≠gito verificador\n  sum = 0;\n  for (let i = 0; i < 10; i++) {\n    sum += parseInt(numbers[i]) * (11 - i);\n  }\n  remainder = (sum * 10) % 11;\n  if (remainder === 10 || remainder === 11) remainder = 0;\n  if (remainder !== parseInt(numbers[10])) return false;\n  \n  return true;\n}\n\nconst contactSchema = z.object({\n  customerName: z.string().min(3, \"Nome muito curto\"),\n  customerEmail: z.string().email(\"Email inv√°lido\"),\n  customerPhone: z.string().refine((val) => {\n    const numbers = val.replace(/\\D/g, '');\n    return numbers.length === 10 || numbers.length === 11;\n  }, \"Telefone deve ter 10 ou 11 d√≠gitos\"),\n  customerCpf: z.string().refine((val) => isValidCPF(val), \"CPF inv√°lido\"),\n});\n\nconst addressSchema = z.object({\n  zipCode: z.string().refine((val) => {\n    const numbers = val.replace(/\\D/g, '');\n    return numbers.length === 8;\n  }, \"CEP deve ter 8 d√≠gitos\"),\n  street: z.string().min(3, \"Endere√ßo muito curto\"),\n  number: z.string().min(1, \"N√∫mero obrigat√≥rio\"),\n  complement: z.string().optional(),\n  neighborhood: z.string().min(2, \"Bairro muito curto\"),\n  city: z.string().min(2, \"Cidade muito curta\"),\n  state: z.string().length(2, \"Estado inv√°lido\"),\n});\n\ntype ContactForm = z.infer<typeof contactSchema>;\ntype AddressForm = z.infer<typeof addressSchema>;\n\nfunction formatCPF(value: string): string {\n  const numbers = value.replace(/\\D/g, '');\n  if (numbers.length <= 3) return numbers;\n  if (numbers.length <= 6) return `${numbers.slice(0, 3)}.${numbers.slice(3)}`;\n  if (numbers.length <= 9) return `${numbers.slice(0, 3)}.${numbers.slice(3, 6)}.${numbers.slice(6)}`;\n  return `${numbers.slice(0, 3)}.${numbers.slice(3, 6)}.${numbers.slice(6, 9)}-${numbers.slice(9, 11)}`;\n}\n\nfunction formatPhone(value: string): string {\n  const numbers = value.replace(/\\D/g, '');\n  if (numbers.length <= 2) return numbers;\n  if (numbers.length <= 6) return `(${numbers.slice(0, 2)}) ${numbers.slice(2)}`;\n  if (numbers.length <= 10) return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 6)}-${numbers.slice(6)}`;\n  return `(${numbers.slice(0, 2)}) ${numbers.slice(2, 7)}-${numbers.slice(7, 11)}`;\n}\n\nfunction formatCEP(value: string): string {\n  const numbers = value.replace(/\\D/g, '');\n  if (numbers.length <= 5) return numbers;\n  return `${numbers.slice(0, 5)}-${numbers.slice(5, 8)}`;\n}\n\nconst steps = [\n  { id: 1, name: \"contato\", icon: User, title: \"informa√ß√µes de contato\" },\n  { id: 2, name: \"entrega\", icon: Truck, title: \"finalizar compra\" },\n];\n\nexport default function Checkout() {\n  const [, setLocation] = useLocation();\n  const { items, getTotalPrice, isFreeShippingActive, appliedCoupon, appliedDiscount, zipCode, setZipCode, shippingPrice } = useMochila();\n  const { toast } = useToast();\n  const [currentStep, setCurrentStep] = useState(1);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n  const [isLoadingCep, setIsLoadingCep] = useState(false);\n  const numberInputRef = useRef<HTMLInputElement>(null);\n  \n  // Inicializa o hook do Facebook Pixel para rastreamento de eventos\n  const { trackInitiateCheckout } = usePixel();\n  \n  // Dispara o evento InitiateCheckout do Facebook Pixel quando a p√°gina carrega\n  // Este evento rastreia quando o usu√°rio inicia o processo de checkout\n  useEffect(() => {\n    if (items.length > 0) {\n      // Calcula o valor total e n√∫mero de itens para o evento\n      const totalValue = items.reduce((sum, item) => sum + item.price * item.quantity, 0);\n      const numItems = items.reduce((sum, item) => sum + item.quantity, 0);\n      \n      // Dispara o evento com valor total e n√∫mero de itens\n      trackInitiateCheckout(totalValue, \"BRL\", numItems);\n    }\n  }, [items.length, trackInitiateCheckout]);\n\n  const [contactData, setContactData] = useState<ContactForm | null>(null);\n  const [addressData, setAddressData] = useState<AddressForm | null>(null);\n\n  // Buscar configura√ß√µes de frete do admin\n  const { data: shippingSettings } = useQuery<{ system: string; threshold: string; shippingValue: string }>({\n    queryKey: [\"/api/settings/free_shipping\"],\n  });\n  \n  const isFreeShippingForAll = shippingSettings?.system === \"all\";\n  const freeShippingThreshold = shippingSettings?.threshold ? parseFloat(shippingSettings.threshold) : 200;\n  const configuredShippingPrice = shippingSettings?.shippingValue ? parseFloat(shippingSettings.shippingValue) : 23;\n\n  const contactForm = useForm<ContactForm>({\n    resolver: zodResolver(contactSchema),\n    defaultValues: {\n      customerName: \"\",\n      customerEmail: \"\",\n      customerPhone: \"\",\n      customerCpf: \"\",\n    },\n  });\n\n  const addressForm = useForm<AddressForm>({\n    resolver: zodResolver(addressSchema),\n    defaultValues: {\n      zipCode: zipCode || \"\",\n      street: \"\",\n      number: \"\",\n      complement: \"\",\n      neighborhood: \"\",\n      city: \"\",\n      state: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (zipCode && zipCode.length === 9 && !addressForm.getValues(\"street\")) {\n      handleCepBlur();\n    }\n  }, [zipCode]);\n\n  useEffect(() => {\n    if (items.length === 0) {\n      const pendingOrder = localStorage.getItem(\"oudla_pending_order\");\n      if (pendingOrder) return;\n      setLocation(\"/produtos\");\n    }\n  }, [items, setLocation]);\n\n  useEffect(() => {\n    const checkPendingOrder = async () => {\n      const pendingOrder = localStorage.getItem(\"oudla_pending_order\");\n      if (!pendingOrder) return;\n\n      try {\n        const res = await fetch(`/api/checkout/payment-status/${pendingOrder}`);\n        const data = await res.json();\n        if (data.success) {\n          if (data.paymentStatus === \"approved\" || data.orderStatus === \"paid\") {\n            localStorage.removeItem(\"oudla_pending_order\");\n            setLocation(`/pagamento/sucesso?order=${pendingOrder}`);\n          } else if (data.paymentStatus === \"rejected\" || data.orderStatus === \"failed\") {\n            localStorage.removeItem(\"oudla_pending_order\");\n            setLocation(`/pagamento/falha?order=${pendingOrder}`);\n          } else if ((data.paymentStatus === \"pending\" || data.paymentStatus === \"in_process\") && data.paymentMethod) {\n            localStorage.removeItem(\"oudla_pending_order\");\n            setLocation(`/pagamento/pendente?order=${pendingOrder}`);\n          }\n        }\n      } catch (err) {\n        console.error(\"Erro ao verificar pedido pendente:\", err);\n      }\n    };\n\n    const handleVisibility = () => {\n      if (document.visibilityState === \"visible\") {\n        checkPendingOrder();\n      }\n    };\n\n    const handleFocus = () => {\n      checkPendingOrder();\n    };\n\n    document.addEventListener(\"visibilitychange\", handleVisibility);\n    window.addEventListener(\"focus\", handleFocus);\n\n    return () => {\n      document.removeEventListener(\"visibilitychange\", handleVisibility);\n      window.removeEventListener(\"focus\", handleFocus);\n    };\n  }, [setLocation]);\n\n  const handleCepBlur = async () => {\n    const cep = addressForm.getValues(\"zipCode\").replace(/\\D/g, '');\n    \n    if (cep.length !== 8) return;\n\n    setIsLoadingCep(true);\n    try {\n      const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);\n      const data = await response.json();\n\n      if (data.erro) {\n        toast({\n          variant: \"destructive\",\n          title: \"CEP n√£o encontrado\",\n          description: \"Verifique o CEP digitado e tente novamente.\",\n        });\n        return;\n      }\n\n      addressForm.setValue(\"street\", data.logradouro || \"\");\n      addressForm.setValue(\"neighborhood\", data.bairro || \"\");\n      addressForm.setValue(\"city\", data.localidade || \"\");\n      addressForm.setValue(\"state\", data.uf || \"\");\n\n      setZipCode(formatCEP(cep));\n\n      setTimeout(() => {\n        numberInputRef.current?.focus();\n        numberInputRef.current?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n      }, 150);\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Erro ao buscar CEP\",\n        description: \"N√£o foi poss√≠vel buscar o endere√ßo.\",\n      });\n    } finally {\n      setIsLoadingCep(false);\n    }\n  };\n\n  const onContactSubmit = (data: ContactForm) => {\n    // Formata os dados antes de salvar\n    const formattedData = {\n      ...data,\n      customerPhone: formatPhone(data.customerPhone),\n      customerCpf: formatCPF(data.customerCpf),\n    };\n    setContactData(formattedData);\n    setCurrentStep(2);\n    window.scrollTo({ top: 0, behavior: 'smooth' });\n  };\n\n  const onAddressSubmit = async (data: AddressForm) => {\n    // Formata o CEP antes de salvar\n    const formattedData = {\n      ...data,\n      zipCode: formatCEP(data.zipCode),\n    };\n    setAddressData(formattedData);\n    \n    // Processar pagamento diretamente\n    if (!contactData) return;\n\n    setIsSubmitting(true);\n    try {\n      const checkoutItems = items.map((item) => {\n        const price = typeof item.price === 'string' ? parseFloat(item.price) : item.price;\n\n        return {\n          productId: item.productId,\n          productName: item.name,\n          productImage: item.image,\n          size: item.size || null,\n          color: item.color || null,\n          fabric: item.fabric || null,\n          printPosition: item.printPosition || null,\n          unitPrice: price.toString(),\n          quantity: item.quantity,\n          subtotal: (price * item.quantity).toString(),\n        };\n      });\n\n      const subtotalValue = getTotalPrice();\n      const discountValue = appliedDiscount ? (subtotalValue * appliedDiscount) / 100 : 0;\n      const isFreeShippingByValue = subtotalValue >= freeShippingThreshold;\n      \n      const shippingCostValue = (isFreeShippingForAll || isFreeShippingActive || isFreeShippingByValue) ? 0 : (shippingPrice || configuredShippingPrice);\n      \n      const totalAmountValue = subtotalValue - discountValue + shippingCostValue;\n\n      const deviceInfo = getDeviceInfo();\n      \n      const response = await apiRequest(\"POST\", \"/api/checkout/create-order\", {\n        ...contactData,\n        ...formattedData,\n        items: checkoutItems,\n        subtotal: subtotalValue.toFixed(2),\n        discountAmount: discountValue.toFixed(2),\n        shippingCost: shippingCostValue.toFixed(2),\n        totalAmount: totalAmountValue.toFixed(2),\n        appliedCoupon,\n        ...deviceInfo,\n      });\n\n      if (!response.ok) {\n        const errorData = await response.json();\n        console.error(\"Erro na resposta:\", errorData);\n        throw new Error(errorData.error || \"Erro ao criar pedido\");\n      }\n\n      const result = await response.json();\n      \n      if (result.success) {\n        localStorage.setItem(\"oudla_pending_order\", result.orderNumber || \"\");\n\n        toast({\n          title: \"Pedido criado!\",\n          description: \"Redirecionando para pagamento...\",\n        });\n\n        const preferenceResponse = await apiRequest(\"POST\", \"/api/checkout/create-preference\", {\n          orderId: result.orderId,\n        });\n\n        if (!preferenceResponse.ok) {\n          const prefError = await preferenceResponse.json();\n          console.error(\"Erro ao criar prefer√™ncia MP:\", prefError);\n          throw new Error(prefError.error || \"Erro ao iniciar pagamento\");\n        }\n\n        const preferenceData = await preferenceResponse.json();\n\n        if (preferenceData.success) {\n          const paymentUrl = preferenceData.isProduction\n            ? preferenceData.initPoint\n            : preferenceData.sandboxInitPoint;\n          \n          if (paymentUrl) {\n            const opened = window.open(paymentUrl, \"_blank\");\n            if (!opened) {\n              window.location.href = paymentUrl;\n            }\n            setIsSubmitting(false);\n          } else {\n            throw new Error(\"Falha ao obter link de pagamento\");\n          }\n        } else {\n          throw new Error(\"Falha ao obter link de pagamento\");\n        }\n      } else {\n        throw new Error(result.error || \"Erro ao criar pedido\");\n      }\n    } catch (error) {\n      console.error(\"Erro ao processar checkout:\", error);\n      const errorMessage = error instanceof Error ? error.message : \"Por favor, tente novamente mais tarde.\";\n      toast({\n        variant: \"destructive\",\n        title: \"Erro ao processar pedido\",\n        description: errorMessage,\n      });\n      setIsSubmitting(false);\n    }\n  };\n\n  if (items.length === 0) {\n    return null;\n  }\n\n  const subtotalValue = getTotalPrice();\n  const isFreeShippingByValue = subtotalValue >= freeShippingThreshold;\n  \n  const shippingValue = (isFreeShippingForAll || isFreeShippingActive || isFreeShippingByValue) ? 0 : (shippingPrice || configuredShippingPrice);\n  \n  const discountValue = appliedDiscount ? (subtotalValue * (Number(appliedDiscount) / 100)) : 0;\n  const subtotalAfterDiscount = subtotalValue - discountValue;\n  const totalValue = subtotalAfterDiscount + shippingValue;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Simplified Checkout Header */}\n      <header className=\"sticky top-0 z-50 w-full bg-background/80 backdrop-blur-xl border-b border-border/50\">\n        <div className=\"flex h-14 items-center justify-between px-6 max-w-4xl mx-auto\">\n          <button \n            className=\"flex items-center\"\n            data-testid=\"button-logo-checkout\"\n            onClick={() => setLocation(\"/\")}\n          >\n            <img src={logoSvg} alt=\"Oudla Logo\" className=\"h-7 w-7 object-contain dark:invert\" />\n          </button>\n          \n          <div className=\"flex items-center gap-2\">\n            <img src={mpColorLogo} alt=\"Mercado Pago\" className=\"h-6 w-auto block dark:hidden\" />\n            <img src={mpPlumaLogo} alt=\"Mercado Pago\" className=\"h-6 w-auto hidden dark:block\" />\n          </div>\n        </div>\n      </header>\n\n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <Button\n          variant=\"ghost\"\n          onClick={() => currentStep === 1 ? setLocation(\"/\") : setCurrentStep(currentStep - 1)}\n          className=\"mb-6 -ml-2 text-muted-foreground\"\n          data-testid=\"button-back\"\n        >\n          <ArrowLeft className=\"h-4 w-4 mr-1\" />\n          voltar\n        </Button>\n\n        {/* Progress Indicator */}\n        <div className=\"mb-10\">\n          <div className=\"flex items-center justify-center gap-6 max-w-xs mx-auto\">\n            {steps.map((step, index) => (\n              <div key={`step-${step.id}`} className=\"flex items-center gap-6\">\n                <div className=\"flex flex-col items-center gap-1.5\">\n                  <div\n                    className={`w-10 h-10 rounded-full flex items-center justify-center transition-all duration-500 ${\n                      currentStep > step.id\n                        ? \"bg-foreground text-background\"\n                        : currentStep === step.id\n                        ? \"bg-foreground text-background ring-4 ring-foreground/10\"\n                        : \"bg-muted/50 text-muted-foreground\"\n                    }`}\n                  >\n                    {currentStep > step.id ? (\n                      <Check className=\"h-4 w-4\" />\n                    ) : (\n                      <step.icon className=\"h-4 w-4\" />\n                    )}\n                  </div>\n                  <span className={`text-[11px] font-medium lowercase tracking-wide ${currentStep >= step.id ? \"text-foreground\" : \"text-muted-foreground/60\"}`}>\n                    {step.name}\n                  </span>\n                </div>\n                {index < steps.length - 1 && (\n                  <div className=\"w-20 h-px -mt-5\">\n                    <div className={`h-full transition-all duration-500 ${currentStep > step.id ? \"bg-foreground\" : \"bg-muted/50\"}`} />\n                  </div>\n                )}\n              </div>\n            ))}\n          </div>\n        </div>\n\n        <AnimatePresence mode=\"wait\">\n          {/* Step 1: Contact Information */}\n          {currentStep === 1 && (\n            <motion.div\n              key=\"step1\"\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.3 }}\n            >\n              <div className=\"max-w-xl mx-auto\">\n                <div className=\"text-center mb-10\">\n                  <h1 className=\"text-2xl font-semibold lowercase tracking-tight mb-2\">seus dados</h1>\n                  <p className=\"text-sm text-muted-foreground/70 lowercase\">\n                    pra te enviar atualiza√ß√µes do pedido\n                  </p>\n                </div>\n\n                <form onSubmit={contactForm.handleSubmit(onContactSubmit)} className=\"space-y-6\">\n                  <div className=\"space-y-6\">\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"customerName\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">nome completo</label>\n                      <Input\n                        id=\"customerName\"\n                        {...contactForm.register(\"customerName\")}\n                        placeholder=\"jo√£o silva\"\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-name\"\n                      />\n                      {contactForm.formState.errors.customerName && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {contactForm.formState.errors.customerName.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"customerEmail\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">email</label>\n                      <Input\n                        id=\"customerEmail\"\n                        type=\"email\"\n                        {...contactForm.register(\"customerEmail\")}\n                        placeholder=\"joao@email.com\"\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-email\"\n                      />\n                      {contactForm.formState.errors.customerEmail && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {contactForm.formState.errors.customerEmail.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"customerPhone\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">telefone</label>\n                      <Input\n                        id=\"customerPhone\"\n                        {...contactForm.register(\"customerPhone\")}\n                        placeholder=\"(11) 98765-4321\"\n                        maxLength={15}\n                        onChange={(e) => {\n                          const formatted = formatPhone(e.target.value);\n                          contactForm.setValue(\"customerPhone\", formatted);\n                        }}\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-phone\"\n                      />\n                      {contactForm.formState.errors.customerPhone && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {contactForm.formState.errors.customerPhone.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"customerCpf\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">cpf</label>\n                      <Input\n                        id=\"customerCpf\"\n                        {...contactForm.register(\"customerCpf\")}\n                        placeholder=\"123.456.789-00\"\n                        maxLength={14}\n                        onChange={(e) => {\n                          const formatted = formatCPF(e.target.value);\n                          contactForm.setValue(\"customerCpf\", formatted);\n                        }}\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-cpf\"\n                      />\n                      {contactForm.formState.errors.customerCpf && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {contactForm.formState.errors.customerCpf.message}\n                        </p>\n                      )}\n                    </div>\n                  </div>\n\n                  <Button\n                    type=\"submit\"\n                    className=\"w-full h-14 text-[15px] font-semibold rounded-2xl mt-10\"\n                    data-testid=\"button-continue-to-address\"\n                  >\n                    continuar\n                    <ArrowRight className=\"h-4 w-4 ml-2\" />\n                  </Button>\n                </form>\n              </div>\n            </motion.div>\n          )}\n\n          {/* Step 2: Address & Payment */}\n          {currentStep === 2 && (\n            <motion.div\n              key=\"step2\"\n              initial={{ opacity: 0, x: 20 }}\n              animate={{ opacity: 1, x: 0 }}\n              exit={{ opacity: 0, x: -20 }}\n              transition={{ duration: 0.3 }}\n            >\n              <div className=\"max-w-6xl mx-auto\">\n                <div className=\"text-center mb-10\">\n                  <h1 className=\"text-2xl font-semibold lowercase tracking-tight mb-2\">finalizar compra</h1>\n                  <p className=\"text-sm text-muted-foreground/70 lowercase\">\n                    endere√ßo de entrega e resumo do pedido\n                  </p>\n                </div>\n\n                <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                  {/* Left Column: Address Form */}\n                  <div>\n                    <div className=\"flex items-center gap-3 mb-6\">\n                      <div className=\"h-9 w-9 rounded-full bg-muted/50 flex items-center justify-center\">\n                        <MapPin className=\"h-4 w-4 opacity-50\" />\n                      </div>\n                      <h2 className=\"text-lg font-medium lowercase\">endere√ßo de entrega</h2>\n                    </div>\n                    <form onSubmit={addressForm.handleSubmit(onAddressSubmit)} className=\"space-y-6\" id=\"address-form\">\n                  <div className=\"space-y-6\">\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"zipCode\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">cep</label>\n                      <Input\n                        id=\"zipCode\"\n                        {...addressForm.register(\"zipCode\")}\n                        placeholder=\"12345-678\"\n                        maxLength={9}\n                        onChange={(e) => {\n                          const formatted = formatCEP(e.target.value);\n                          addressForm.setValue(\"zipCode\", formatted);\n                        }}\n                        onBlur={handleCepBlur}\n                        disabled={isLoadingCep}\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-zipcode\"\n                      />\n                      {addressForm.formState.errors.zipCode && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {addressForm.formState.errors.zipCode.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"grid grid-cols-3 gap-4\">\n                      <div className=\"col-span-2 space-y-1.5\">\n                        <label htmlFor=\"street\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">rua</label>\n                        <Input\n                          id=\"street\"\n                          {...addressForm.register(\"street\")}\n                          placeholder=\"rua das flores\"\n                          disabled={isLoadingCep}\n                          className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                          data-testid=\"input-street\"\n                        />\n                        {addressForm.formState.errors.street && (\n                          <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                            {addressForm.formState.errors.street.message}\n                          </p>\n                        )}\n                      </div>\n\n                      <div className=\"space-y-1.5\">\n                        <label htmlFor=\"number\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">n√∫mero</label>\n                        <Input\n                          id=\"number\"\n                          {...(() => {\n                            const { ref: formRef, ...rest } = addressForm.register(\"number\");\n                            return {\n                              ...rest,\n                              ref: (el: HTMLInputElement | null) => {\n                                formRef(el);\n                                (numberInputRef as React.MutableRefObject<HTMLInputElement | null>).current = el;\n                              }\n                            };\n                          })()}\n                          placeholder=\"123\"\n                          className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                          data-testid=\"input-number\"\n                        />\n                        {addressForm.formState.errors.number && (\n                          <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                            {addressForm.formState.errors.number.message}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"complement\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">complemento (opcional)</label>\n                      <Input\n                        id=\"complement\"\n                        {...addressForm.register(\"complement\")}\n                        placeholder=\"apto 45\"\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-complement\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label htmlFor=\"neighborhood\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">bairro</label>\n                      <Input\n                        id=\"neighborhood\"\n                        {...addressForm.register(\"neighborhood\")}\n                        placeholder=\"centro\"\n                        disabled={isLoadingCep}\n                        className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                        data-testid=\"input-neighborhood\"\n                      />\n                      {addressForm.formState.errors.neighborhood && (\n                        <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                          {addressForm.formState.errors.neighborhood.message}\n                        </p>\n                      )}\n                    </div>\n\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div className=\"space-y-1.5\">\n                        <label htmlFor=\"city\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">cidade</label>\n                        <Input\n                          id=\"city\"\n                          {...addressForm.register(\"city\")}\n                          placeholder=\"s√£o paulo\"\n                          disabled={isLoadingCep}\n                          className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                          data-testid=\"input-city\"\n                        />\n                        {addressForm.formState.errors.city && (\n                          <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                            {addressForm.formState.errors.city.message}\n                          </p>\n                        )}\n                      </div>\n\n                      <div className=\"space-y-1.5\">\n                        <label htmlFor=\"state\" className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-medium pl-1\">estado</label>\n                        <Input\n                          id=\"state\"\n                          {...addressForm.register(\"state\")}\n                          placeholder=\"SP\"\n                          maxLength={2}\n                          onChange={(e) => {\n                            addressForm.setValue(\"state\", e.target.value.toUpperCase());\n                          }}\n                          disabled={isLoadingCep}\n                          className=\"h-14 text-base bg-muted/40 border-0 rounded-2xl px-5 placeholder:text-muted-foreground/40 focus-visible:ring-1 focus-visible:ring-foreground/20 focus-visible:bg-muted/60 transition-colors\"\n                          data-testid=\"input-state\"\n                        />\n                        {addressForm.formState.errors.state && (\n                          <p className=\"text-[11px] text-destructive pl-1 lowercase\">\n                            {addressForm.formState.errors.state.message}\n                          </p>\n                        )}\n                      </div>\n                    </div>\n                  </div>\n                </form>\n              </div>\n\n              {/* Right Column: Order Summary & Mercado Pago Info */}\n              <div className=\"space-y-6\">\n                    {/* Order Summary Card */}\n                    <Card className=\"p-6 rounded-3xl border-0 bg-muted/20\">\n                      <div className=\"flex items-center gap-2 mb-5\">\n                        <h3 className=\"text-[11px] uppercase tracking-widest text-muted-foreground font-bold\">resumo do pedido</h3>\n                      </div>\n                      \n                      <div className=\"space-y-4 mb-6\">\n                        {items.map((item) => {\n                          const colorData = item.color;\n                          return (\n                            <div key={`${item.productId}-${item.size}-${item.color?.hex || 'default'}`} className=\"flex gap-4\">\n                              <div className=\"relative w-[72px] h-[72px] bg-muted/30 rounded-2xl overflow-hidden flex-shrink-0\">\n                                {item.image && (\n                                  <img\n                                    src={item.image}\n                                    alt={item.name}\n                                    className=\"w-full h-full object-cover\"\n                                    loading=\"lazy\"\n                                    decoding=\"async\"\n                                  />\n                                )}\n                                <div className=\"absolute -top-1.5 -right-1.5 bg-foreground text-background rounded-full w-5 h-5 flex items-center justify-center text-[10px] font-bold\">\n                                  {item.quantity}\n                                </div>\n                              </div>\n                              <div className=\"flex-1 min-w-0\">\n                                <h4 className=\"text-sm font-medium lowercase truncate\">\n                                  {item.name}\n                                </h4>\n                                <p className=\"text-xs text-muted-foreground lowercase\">\n                                  {[\n                                    item.size,\n                                    colorData?.name,\n                                    item.fabric?.name,\n                                    item.printPosition ? `estampa ${item.printPosition}` : null\n                                  ].filter(Boolean).join(' ¬∑ ')}\n                                </p>\n                              </div>\n                              <div className=\"text-sm font-medium\">\n                                R$ {(item.price * item.quantity).toFixed(2)}\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n\n                      <Separator className=\"my-4\" />\n\n                      <div className=\"space-y-2\">\n                        <div className=\"flex justify-between text-sm\">\n                          <span className=\"text-muted-foreground lowercase\">subtotal</span>\n                          <span>R$ {subtotalValue.toFixed(2)}</span>\n                        </div>\n                        {discountValue > 0 && (\n                          <div className=\"flex justify-between text-sm text-green-600\">\n                            <span className=\"lowercase\">desconto</span>\n                            <span>-R$ {discountValue.toFixed(2)}</span>\n                          </div>\n                        )}\n                        <div className=\"flex justify-between text-sm items-center\">\n                          <span className=\"text-muted-foreground lowercase\">frete</span>\n                          <span className={isFreeShippingForAll || isFreeShippingActive || isFreeShippingByValue ? \"text-primary lowercase\" : \"lowercase\"}>\n                            {isFreeShippingForAll || isFreeShippingActive || isFreeShippingByValue ? \"gr√°tis\" : <span className=\"normal-case\">R$ {shippingValue.toFixed(2).replace('.', ',')}</span>}\n                          </span>\n                        </div>\n                        <Separator />\n                        <div className=\"flex justify-between text-lg font-medium pt-2\">\n                          <span className=\"lowercase\">total</span>\n                          <span>R$ {totalValue.toFixed(2)}</span>\n                        </div>\n                      </div>\n                    </Card>\n\n                    <Button\n                      type=\"submit\"\n                      form=\"address-form\"\n                      className=\"w-full h-14 text-[15px] font-semibold rounded-2xl\"\n                      disabled={isSubmitting}\n                      data-testid=\"button-proceed-payment\"\n                    >\n                      {isSubmitting ? (\n                        <div className=\"flex items-center gap-3\">\n                          <div className=\"h-5 w-5 border-2 border-primary-foreground/20 border-t-primary-foreground rounded-full animate-spin\" />\n                          processando...\n                        </div>\n                      ) : (\n                        <>\n                          <Lock className=\"h-4 w-4 mr-2\" />\n                          finalizar e pagar\n                        </>\n                      )}\n                    </Button>\n\n\n                <p className=\"text-[11px] text-center text-muted-foreground/50 lowercase px-4 mt-4\">\n                  ao finalizar, seu pedido ser√° confirmado e voc√™ receber√° um email com os detalhes\n                </p>\n              </div>\n            </div>\n          </div>\n        </motion.div>\n      )}\n        </AnimatePresence>\n      </div>\n    </div>\n  );\n}","path":null,"size_bytes":40401,"size_tokens":null},"client/src/pages/CheckoutFailure.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { XCircle } from \"lucide-react\";\n\nexport default function CheckoutFailure() {\n  const [, setLocation] = useLocation();\n  const [orderNumber, setOrderNumber] = useState<string>(\"\");\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const externalReference = params.get(\"external_reference\");\n    if (externalReference) {\n      setOrderNumber(externalReference);\n    }\n  }, []);\n\n  return (\n    <div className=\"min-h-screen flex items-center justify-center px-4 py-12 bg-background\">\n      <Card className=\"max-w-md w-full p-8 text-center space-y-6\">\n        <div className=\"flex justify-center\">\n          <div className=\"bg-destructive/10 p-4 rounded-full\">\n            <XCircle className=\"h-16 w-16 text-destructive\" />\n          </div>\n        </div>\n        \n        <div className=\"space-y-2\">\n          <h1 className=\"text-3xl font-light lowercase\">pagamento n√£o aprovado</h1>\n          <p className=\"text-muted-foreground lowercase\">\n            n√£o foi poss√≠vel processar seu pagamento\n          </p>\n        </div>\n\n        {orderNumber && (\n          <div className=\"bg-muted/30 rounded-lg p-4\">\n            <p className=\"text-sm text-muted-foreground lowercase mb-1\">\n              n√∫mero do pedido\n            </p>\n            <p className=\"text-xl font-medium\" data-testid=\"text-order-number\">\n              {orderNumber}\n            </p>\n          </div>\n        )}\n\n        <div className=\"space-y-3 pt-4\">\n          <p className=\"text-sm text-muted-foreground lowercase\">\n            verifique os dados do cart√£o ou tente outro m√©todo de pagamento\n          </p>\n          \n          <div className=\"flex flex-col gap-2\">\n            <Button\n              className=\"w-full\"\n              onClick={() => setLocation(\"/checkout\")}\n              data-testid=\"button-try-again\"\n            >\n              tentar novamente\n            </Button>\n            <Button\n              variant=\"outline\"\n              className=\"w-full\"\n              onClick={() => setLocation(\"/\")}\n              data-testid=\"button-go-home\"\n            >\n              voltar para a home\n            </Button>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":2394,"size_tokens":null},"client/src/pages/OrderTracking.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { queryClient } from \"@/lib/queryClient\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Search, Package, Truck, MapPin, Calendar, ExternalLink, CheckCircle2, Clock, XCircle, PackageCheck, ArrowRight } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport Footer from \"@/components/Footer\";\n\ntype Order = {\n  id: string;\n  orderNumber: string;\n  customerName: string;\n  customerEmail: string;\n  customerPhone: string;\n  street: string;\n  number: string;\n  complement?: string;\n  neighborhood: string;\n  city: string;\n  state: string;\n  zipCode: string;\n  subtotal: string;\n  shippingCost: string;\n  totalAmount: string;\n  orderStatus: string;\n  trackingCode?: string;\n  shippingMethod?: string;\n  estimatedDeliveryDate?: string;\n  actualDeliveryDate?: string;\n  createdAt: string;\n  paidAt?: string;\n  items: Array<{\n    id: string;\n    productName: string;\n    productImage: string;\n    size: string;\n    color: string;\n    quantity: number;\n    unitPrice: string;\n    subtotal: string;\n  }>;\n};\n\nconst orderStatusMap: Record<string, { label: string; icon: any; color: string }> = {\n  pending: { label: \"aguardando pagamento\", icon: Clock, color: \"bg-yellow-500/90\" },\n  paid: { label: \"pagamento aprovado\", icon: CheckCircle2, color: \"bg-green-500/90\" },\n  processing: { label: \"em processamento\", icon: Package, color: \"bg-blue-500/90\" },\n  shipped: { label: \"em transporte\", icon: Truck, color: \"bg-purple-500/90\" },\n  delivered: { label: \"entregue\", icon: PackageCheck, color: \"bg-green-600/90\" },\n  cancelled: { label: \"cancelado\", icon: XCircle, color: \"bg-red-500/90\" },\n  failed: { label: \"pagamento reprovado\", icon: XCircle, color: \"bg-red-500/90\" },\n};\n\nfunction detectCarrier(trackingCode: string): { name: string; url: string } | null {\n  if (!trackingCode) return null;\n  const code = trackingCode.toUpperCase().trim().replace(/\\s/g, '');\n  if (code.length < 5) return null;\n\n  if (/^[A-Z]{2}\\d{9}[A-Z]{2}$/.test(code)) return { name: \"Correios\", url: `https://rastreamento.correios.com.br/app/index.php?codigo=${code}` };\n  if (/^1Z[A-Z0-9]{16}$/.test(code)) return { name: \"UPS\", url: `https://www.ups.com/track?tracknum=${code}` };\n  if (/^\\d{3}-\\d{8}$/.test(code)) return { name: \"LATAM Cargo\", url: `https://www.latamcargo.com/en/trackshipment?docNumber=${code}` };\n  if (/^ME\\d{8,}$/.test(code)) return { name: \"Melhor Envio\", url: `https://melhorrastreio.com.br/rastreio/${code}` };\n  if (/^MND[A-Z0-9]+$/.test(code)) return { name: \"Mandae\", url: `https://rastreae.com.br/resultado/${code}` };\n  if (/^JT\\d{10,}$/.test(code)) return { name: \"J&T Express\", url: `https://www.jtexpress.com.br/trajectoryQuery?waybillNo=${code}` };\n  if (/^KG[A-Z0-9]+$/.test(code)) return { name: \"Kangu\", url: `https://www.kangu.com.br/rastreio/${code}` };\n  if (/^AZ[A-Z0-9]+$/.test(code)) return { name: \"Azul Cargo\", url: `https://www.azulcargoexpress.com.br/rastreamento?tracking=${code}` };\n  if (/^JD\\d{10,}$/.test(code)) return { name: \"DHL\", url: `https://www.dhl.com/br-pt/home/rastreamento.html?tracking-id=${code}` };\n  if (/^LOG[A-Z0-9]{6,}$/.test(code)) return { name: \"Loggi\", url: `https://www.loggi.com/rastreamento/${code}` };\n  if (/^DT[A-Z0-9]{10,}$/.test(code)) return { name: \"FedEx\", url: `https://www.fedex.com/fedextrack/?trknbr=${code}` };\n  if (/^SEQ[A-Z0-9]+$/.test(code)) return { name: \"Sequoia\", url: `https://sequoialog.com.br/rastreamento/?code=${code}` };\n  if (/^BUS[A-Z0-9]+$/.test(code)) return { name: \"Buslog\", url: `https://buslog.com.br/rastreamento?codigo=${code}` };\n  if (/^82\\d{8,13}$/.test(code)) return { name: \"J&T Express\", url: `https://www.jtexpress.com.br/trajectoryQuery?waybillNo=${code}` };\n  if (/^6\\d{11,21}$/.test(code)) return { name: \"FedEx\", url: `https://www.fedex.com/fedextrack/?trknbr=${code}` };\n  if (/^\\d{15,}$/.test(code)) return { name: \"Aramex\", url: `https://www.aramex.com/track/results?ShipmentNumber=${code}` };\n  if (/^\\d{10,14}$/.test(code)) return { name: \"Jadlog\", url: `https://www.jadlog.com.br/tracking?cte=${code}` };\n  if (/^\\d{8,9}$/.test(code)) return { name: \"TNT\", url: `https://www.fedex.com/fedextrack/?trknbr=${code}` };\n  if (/^\\d{5,7}$/.test(code)) return { name: \"Total Express\", url: `https://status.totalexpress.com.br/tracking/${code}` };\n\n  return null;\n}\n\nfunction TimelineStep({ icon: Icon, label, date, color, isLast }: { icon: any; label: string; date?: string; color: string; isLast?: boolean }) {\n  return (\n    <div className=\"flex gap-4\">\n      <div className=\"flex flex-col items-center\">\n        <div className={`w-8 h-8 rounded-full ${color} flex items-center justify-center shrink-0`}>\n          <Icon className=\"h-3.5 w-3.5 text-white\" />\n        </div>\n        {!isLast && <div className=\"w-px flex-1 bg-border mt-1\" />}\n      </div>\n      <div className={`${isLast ? '' : 'pb-6'}`}>\n        <p className=\"text-sm font-medium lowercase\">{label}</p>\n        {date && (\n          <p className=\"text-xs text-muted-foreground mt-0.5\">\n            {format(new Date(date), \"dd/MM/yyyy 'as' HH:mm\", { locale: ptBR })}\n          </p>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default function OrderTracking() {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [currentSearch, setCurrentSearch] = useState(\"\");\n\n  useEffect(() => {\n    const params = new URLSearchParams(window.location.search);\n    const codigo = params.get(\"codigo\");\n    if (codigo) {\n      setSearchTerm(codigo);\n      setCurrentSearch(codigo);\n    }\n  }, []);\n\n  const { data, isLoading, error } = useQuery<{ order: Order }>({\n    queryKey: ['/api/tracking', currentSearch],\n    queryFn: async () => {\n      const res = await fetch(`/api/tracking/${encodeURIComponent(currentSearch)}`);\n      if (!res.ok) {\n        const errorData = await res.json();\n        throw new Error(errorData.error || 'Erro ao buscar pedido');\n      }\n      return res.json();\n    },\n    enabled: !!currentSearch && currentSearch.trim().length > 0,\n    retry: false,\n  });\n\n  const order = data?.order;\n  const carrier = order?.trackingCode ? detectCarrier(order.trackingCode) : null;\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    const trimmedSearch = searchTerm.trim();\n    if (!trimmedSearch) return;\n    queryClient.removeQueries({ queryKey: ['/api/tracking'] });\n    setCurrentSearch(trimmedSearch);\n  };\n\n  const statusInfo = order ? orderStatusMap[order.orderStatus] || orderStatusMap.pending : null;\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      {/* Hero */}\n      <div className=\"pt-16 pb-8 md:pt-24 md:pb-12\">\n        <div className=\"text-center max-w-lg mx-auto px-4\">\n          <div className=\"inline-flex items-center justify-center w-14 h-14 rounded-full bg-muted/50 mb-6\">\n            <Package className=\"h-6 w-6 text-muted-foreground\" />\n          </div>\n          <h1 className=\"text-4xl md:text-5xl font-light tracking-tight mb-3 lowercase\" data-testid=\"text-tracking-title\">\n            rastrear pedido\n          </h1>\n          <p className=\"text-muted-foreground text-sm lowercase\">\n            insira o numero do pedido ou codigo de rastreamento\n          </p>\n        </div>\n      </div>\n\n      {/* Search */}\n      <div className=\"max-w-lg mx-auto px-4 mb-12\">\n        <form onSubmit={handleSearch} className=\"flex gap-2\">\n          <div className=\"relative flex-1\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n            <Input\n              data-testid=\"input-tracking-search\"\n              placeholder=\"codigo de rastreio ou numero do pedido\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"pl-10 h-11 bg-muted/50 border-0 focus-visible:ring-1 focus-visible:ring-primary/20\"\n            />\n          </div>\n          <Button\n            data-testid=\"button-search-tracking\"\n            type=\"submit\"\n            disabled={isLoading || !searchTerm.trim()}\n            className=\"h-11 px-6 lowercase\"\n          >\n            {isLoading ? \"...\" : \"rastrear\"}\n          </Button>\n        </form>\n      </div>\n\n      {/* Error */}\n      {error && currentSearch && !order && (\n        <div className=\"max-w-lg mx-auto px-4 mb-8\">\n          <div className=\"flex items-center gap-3 p-4 rounded-md bg-destructive/5 text-destructive text-sm\">\n            <XCircle className=\"h-4 w-4 shrink-0\" />\n            <p data-testid=\"text-error-message\" className=\"lowercase\">\n              {(error as any)?.message || \"pedido nao encontrado. verifique o numero e tente novamente.\"}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Order Result */}\n      {order && (\n        <div className=\"max-w-2xl mx-auto px-4 space-y-6 pb-16\">\n          {/* Status Header */}\n          <div className=\"text-center space-y-3\">\n            <Badge\n              data-testid={`badge-status-${order.orderStatus}`}\n              className=\"text-white text-xs lowercase\"\n              style={{ backgroundColor: statusInfo?.color?.replace('/90', '') }}\n            >\n              {statusInfo?.label}\n            </Badge>\n            <h2 className=\"text-2xl font-light tracking-tight lowercase\">\n              pedido {order.orderNumber}\n            </h2>\n            <p className=\"text-xs text-muted-foreground lowercase\">\n              {format(new Date(order.createdAt), \"dd 'de' MMMM 'de' yyyy\", { locale: ptBR })}\n            </p>\n          </div>\n\n          {/* Tracking Card */}\n          {order.trackingCode && (\n            <Card className=\"overflow-hidden\">\n              <CardContent className=\"p-5 space-y-4\">\n                <div className=\"flex items-center justify-between gap-3\">\n                  <div>\n                    <p className=\"text-xs text-muted-foreground lowercase mb-1\">codigo de rastreio</p>\n                    <p data-testid=\"text-tracking-code\" className=\"font-mono text-sm font-medium\">\n                      {order.trackingCode}\n                    </p>\n                  </div>\n                  {carrier && (\n                    <Badge variant=\"secondary\" className=\"text-xs lowercase\">{carrier.name}</Badge>\n                  )}\n                </div>\n\n                {carrier && (\n                  <Button\n                    data-testid=\"button-track-carrier\"\n                    className=\"w-full h-11 lowercase gap-2\"\n                    asChild\n                  >\n                    <a href={carrier.url} target=\"_blank\" rel=\"noopener noreferrer\">\n                      rastrear na {carrier.name.toLowerCase()}\n                      <ExternalLink className=\"h-3.5 w-3.5\" />\n                    </a>\n                  </Button>\n                )}\n\n                {order.estimatedDeliveryDate && (\n                  <div className=\"flex items-center gap-2 text-xs text-muted-foreground pt-1\">\n                    <Calendar className=\"h-3.5 w-3.5\" />\n                    <span className=\"lowercase\">\n                      previsao: {format(new Date(order.estimatedDeliveryDate), \"dd 'de' MMMM\", { locale: ptBR })}\n                    </span>\n                  </div>\n                )}\n\n                {order.actualDeliveryDate && (\n                  <div className=\"flex items-center gap-2 text-xs text-green-600 pt-1\">\n                    <CheckCircle2 className=\"h-3.5 w-3.5\" />\n                    <span className=\"lowercase\" data-testid=\"text-actual-delivery\">\n                      entregue em {format(new Date(order.actualDeliveryDate), \"dd 'de' MMMM\", { locale: ptBR })}\n                    </span>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          )}\n\n          {/* Timeline */}\n          <Card>\n            <CardContent className=\"p-5\">\n              <p className=\"text-xs text-muted-foreground uppercase tracking-wider mb-4\">timeline</p>\n              <div>\n                {order.actualDeliveryDate && (\n                  <TimelineStep\n                    icon={PackageCheck}\n                    label=\"entregue\"\n                    date={order.actualDeliveryDate}\n                    color=\"bg-green-600\"\n                  />\n                )}\n                {order.trackingCode && (order.orderStatus === 'shipped' || order.orderStatus === 'delivered') && (\n                  <TimelineStep\n                    icon={Truck}\n                    label=\"em transporte\"\n                    color=\"bg-purple-500\"\n                  />\n                )}\n                {order.paidAt && (\n                  <TimelineStep\n                    icon={CheckCircle2}\n                    label=\"pagamento confirmado\"\n                    date={order.paidAt}\n                    color=\"bg-green-500\"\n                  />\n                )}\n                <TimelineStep\n                  icon={Package}\n                  label=\"pedido realizado\"\n                  date={order.createdAt}\n                  color=\"bg-blue-500\"\n                  isLast\n                />\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Delivery Address */}\n          <Card>\n            <CardContent className=\"p-5\">\n              <div className=\"flex items-center gap-2 mb-3\">\n                <MapPin className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                <p className=\"text-xs text-muted-foreground uppercase tracking-wider\">entrega</p>\n              </div>\n              <div className=\"text-sm space-y-0.5 lowercase\">\n                <p data-testid=\"text-delivery-address\" className=\"font-medium\">{order.customerName}</p>\n                <p className=\"text-muted-foreground\">\n                  {order.street}, {order.number}\n                  {order.complement && ` - ${order.complement}`}\n                </p>\n                <p className=\"text-muted-foreground\">\n                  {order.neighborhood} - {order.city}/{order.state}\n                </p>\n                <p className=\"text-muted-foreground\">cep {order.zipCode}</p>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Items */}\n          <Card>\n            <CardContent className=\"p-5\">\n              <p className=\"text-xs text-muted-foreground uppercase tracking-wider mb-4\">itens</p>\n              <div className=\"space-y-3\">\n                {order.items.map((item) => {\n                  let color: any;\n                  try {\n                    color = typeof item.color === 'string' ? JSON.parse(item.color) : item.color;\n                  } catch {\n                    color = { name: item.color, hex: '#000000' };\n                  }\n\n                  return (\n                    <div\n                      key={item.id}\n                      data-testid={`order-item-${item.id}`}\n                      className=\"flex gap-3\"\n                    >\n                      <img\n                        src={item.productImage}\n                        alt={item.productName}\n                        className=\"h-14 w-14 rounded-md object-cover bg-muted\"\n                        loading=\"lazy\"\n                        decoding=\"async\"\n                      />\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate lowercase\">{item.productName}</p>\n                        <div className=\"flex gap-2 mt-0.5 text-xs text-muted-foreground lowercase\">\n                          <span>{item.size}</span>\n                          <span className=\"flex items-center gap-1\">\n                            <span\n                              className=\"inline-block w-2.5 h-2.5 rounded-full border border-border\"\n                              style={{ backgroundColor: color.hex }}\n                            />\n                            {color.name}\n                          </span>\n                          <span>x{item.quantity}</span>\n                        </div>\n                      </div>\n                      <p className=\"text-sm font-medium shrink-0 normal-case\">\n                        R$ {parseFloat(item.subtotal).toFixed(2)}\n                      </p>\n                    </div>\n                  );\n                })}\n              </div>\n\n              <div className=\"mt-4 pt-4 border-t space-y-1.5\">\n                <div className=\"flex justify-between text-xs text-muted-foreground lowercase\">\n                  <span>subtotal</span>\n                  <span data-testid=\"text-subtotal\" className=\"normal-case\">R$ {parseFloat(order.subtotal).toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-xs text-muted-foreground lowercase\">\n                  <span>frete</span>\n                  <span data-testid=\"text-shipping-cost\" className=\"normal-case\">R$ {parseFloat(order.shippingCost).toFixed(2)}</span>\n                </div>\n                <div className=\"flex justify-between text-sm font-semibold pt-1 lowercase\">\n                  <span>total</span>\n                  <span data-testid=\"text-total-amount\" className=\"normal-case\">R$ {parseFloat(order.totalAmount).toFixed(2)}</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Empty state when no search */}\n      {!order && !error && !currentSearch && (\n        <div className=\"max-w-sm mx-auto px-4 pb-24 text-center\">\n          <div className=\"space-y-6 text-muted-foreground/50\">\n            <Truck className=\"h-12 w-12 mx-auto\" />\n            <p className=\"text-sm lowercase\">\n              seus detalhes de envio aparecerao aqui\n            </p>\n          </div>\n        </div>\n      )}\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":17906,"size_tokens":null},"client/src/components/SizeChartModal.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { Ruler } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { motion } from \"framer-motion\";\nimport type { ProductMeasurementField, ProductSizeMeasurement } from \"@shared/schema\";\n\ninterface SizeChartModalProps {\n  productId: string;\n  productName: string;\n  sizeChartImage?: string | null;\n  sizeChartEnabled?: boolean;\n  activeSizes?: Array<{ name: string; available: boolean }>;\n  trigger?: React.ReactNode;\n}\n\ninterface MeasurementsResponse {\n  fields: ProductMeasurementField[];\n  measurements: ProductSizeMeasurement[];\n}\n\nconst MAX_SELECTED = 3;\n\nexport default function SizeChartModal({ \n  productId, \n  productName, \n  sizeChartImage,\n  sizeChartEnabled,\n  activeSizes = [],\n  trigger\n}: SizeChartModalProps) {\n  const [open, setOpen] = useState(false);\n  const [selectedSizes, setSelectedSizes] = useState<string[]>([]);\n\n  const { data, isLoading } = useQuery<MeasurementsResponse>({\n    queryKey: ['/api/products', productId, 'measurements'],\n    enabled: !!sizeChartEnabled,\n  });\n\n  const fields = data?.fields || [];\n  const measurements = data?.measurements || [];\n\n  const activeSizeNames = activeSizes.map(s => s.name);\n  const availableSizes = Array.from(new Set(measurements.map(m => m.sizeName))).filter(\n    size => activeSizeNames.length === 0 || activeSizeNames.includes(size)\n  );\n\n  const toggleSize = (size: string) => {\n    setSelectedSizes(prev => {\n      if (prev.includes(size)) {\n        return prev.filter(s => s !== size);\n      }\n      if (prev.length >= MAX_SELECTED) {\n        return [...prev.slice(1), size];\n      }\n      return [...prev, size];\n    });\n  };\n\n  const getMeasurementValue = (sizeName: string, fieldId: string) => {\n    const measurement = measurements.find(m => m.sizeName === sizeName && m.fieldId === fieldId);\n    return measurement?.value || \"‚Äî\";\n  };\n\n  const hasCustomFields = fields.length > 0 && measurements.length > 0;\n  const hasImage = sizeChartImage;\n  const showButton = sizeChartEnabled && (hasCustomFields || hasImage);\n\n  if (!showButton) return null;\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        {trigger || (\n          <Button\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"lowercase gap-2\"\n            data-testid=\"button-open-size-chart\"\n          >\n            <Ruler className=\"h-4 w-4\" />\n            tabela de medidas\n          </Button>\n        )}\n      </DialogTrigger>\n      <DialogContent className=\"[&>button]:hidden max-w-2xl w-[95vw] sm:w-full p-0 gap-0 overflow-hidden max-h-[90vh] overflow-y-auto\">\n        <DialogHeader className=\"p-5 sm:p-8 pb-0\">\n          <DialogTitle className=\"text-xl sm:text-2xl font-light tracking-tight lowercase\">\n            guia de tamanhos\n          </DialogTitle>\n          <p className=\"text-xs sm:text-sm text-muted-foreground lowercase mt-1\">\n            {productName}\n          </p>\n        </DialogHeader>\n\n        {isLoading ? (\n          <div className=\"p-8 flex items-center justify-center\">\n            <div className=\"w-6 h-6 border-2 border-foreground/20 border-t-foreground rounded-full animate-spin\" />\n          </div>\n        ) : (\n          <div className=\"p-5 sm:p-8 pt-4 sm:pt-6 space-y-6 sm:space-y-8\">\n            {hasCustomFields && (\n              <div className=\"space-y-5 sm:space-y-6\">\n                <div>\n                  <p className=\"text-xs text-muted-foreground lowercase mb-3\">\n                    selecione at√© {MAX_SELECTED} tamanhos para comparar\n                  </p>\n                  <div className=\"grid grid-cols-3 sm:grid-cols-6 gap-2 sm:gap-3\">\n                    {availableSizes.map((size, index) => {\n                      const isSelected = selectedSizes.includes(size);\n                      const selectionIndex = selectedSizes.indexOf(size);\n                      return (\n                        <motion.button\n                          key={size}\n                          onClick={() => toggleSize(size)}\n                          className={`relative aspect-square rounded-2xl border-2 transition-all duration-300 flex items-center justify-center ${\n                            isSelected \n                              ? 'border-foreground bg-foreground text-background shadow-lg' \n                              : 'border-border hover-elevate hover:border-foreground/50'\n                          }`}\n                          whileHover={{ scale: 1.02 }}\n                          whileTap={{ scale: 0.98 }}\n                          initial={{ opacity: 0, y: 10 }}\n                          animate={{ opacity: 1, y: 0 }}\n                          transition={{ duration: 0.3, delay: index * 0.05 }}\n                          data-testid={`button-size-chart-${size}`}\n                        >\n                          <span className=\"text-base font-medium lowercase\">{size}</span>\n                          {isSelected && (\n                            <span className=\"absolute -top-1 -right-1 w-5 h-5 bg-background text-foreground rounded-full text-xs font-bold flex items-center justify-center border-2 border-foreground\">\n                              {selectionIndex + 1}\n                            </span>\n                          )}\n                        </motion.button>\n                      );\n                    })}\n                  </div>\n                </div>\n\n                {selectedSizes.length > 0 && (\n                  <motion.div\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    transition={{ duration: 0.2 }}\n                  >\n                      <div className=\"bg-muted/30 rounded-xl sm:rounded-2xl p-4 sm:p-6 space-y-3 sm:space-y-4\">\n                        <div className=\"overflow-x-auto\">\n                          <table className=\"w-full\">\n                            <thead>\n                              <tr className=\"border-b border-border/50\">\n                                <th className=\"text-left py-2 sm:py-3 pr-4 text-xs sm:text-sm font-medium text-muted-foreground lowercase\">\n                                  medida\n                                </th>\n                                {selectedSizes.map((size, idx) => (\n                                  <th \n                                    key={size} \n                                    className=\"text-center py-2 sm:py-3 px-2 sm:px-4 min-w-[70px] sm:min-w-[90px]\"\n                                  >\n                                    <motion.div\n                                      initial={{ opacity: 0, scale: 0.8 }}\n                                      animate={{ opacity: 1, scale: 1 }}\n                                      transition={{ duration: 0.2, delay: idx * 0.05 }}\n                                      className=\"inline-flex items-center gap-1 sm:gap-2 bg-foreground text-background px-2 sm:px-3 py-1 rounded-full\"\n                                    >\n                                      <span className=\"text-xs sm:text-sm font-medium lowercase\">{size}</span>\n                                    </motion.div>\n                                  </th>\n                                ))}\n                              </tr>\n                            </thead>\n                            <tbody>\n                              {fields.map((field, fieldIndex) => (\n                                <motion.tr\n                                  key={field.id}\n                                  initial={{ opacity: 0, x: -10 }}\n                                  animate={{ opacity: 1, x: 0 }}\n                                  transition={{ duration: 0.2, delay: fieldIndex * 0.03 }}\n                                  className=\"border-b border-border/30 last:border-0\"\n                                >\n                                  <td className=\"py-2 sm:py-3 pr-4 text-xs sm:text-sm text-muted-foreground lowercase\">\n                                    {field.fieldName}\n                                  </td>\n                                  {selectedSizes.map((size) => (\n                                    <td \n                                      key={size} \n                                      className=\"text-center py-2 sm:py-3 px-2 sm:px-4 text-sm sm:text-base font-medium\"\n                                    >\n                                      {getMeasurementValue(size, field.id)}\n                                    </td>\n                                  ))}\n                                </motion.tr>\n                              ))}\n                            </tbody>\n                          </table>\n                        </div>\n                      </div>\n                  </motion.div>\n                )}\n\n                {selectedSizes.length === 0 && (\n                  <motion.p \n                    className=\"text-center text-xs sm:text-sm text-muted-foreground lowercase py-2\"\n                    initial={{ opacity: 0 }}\n                    animate={{ opacity: 1 }}\n                    transition={{ delay: 0.3 }}\n                  >\n                    toque nos tamanhos acima para comparar\n                  </motion.p>\n                )}\n              </div>\n            )}\n\n            {hasImage && (\n              <motion.div \n                className=\"space-y-3 sm:space-y-4\"\n                initial={{ opacity: 0, y: 20 }}\n                animate={{ opacity: 1, y: 0 }}\n                transition={{ duration: 0.4, delay: hasCustomFields ? 0.2 : 0 }}\n              >\n                {hasCustomFields && (\n                  <div className=\"pt-3 sm:pt-4 border-t\">\n                    <p className=\"text-xs sm:text-sm font-medium lowercase text-muted-foreground\">\n                      refer√™ncia visual\n                    </p>\n                  </div>\n                )}\n                <div className=\"rounded-xl sm:rounded-2xl overflow-hidden\">\n                  <img\n                    src={sizeChartImage}\n                    alt={`Tabela de medidas - ${productName}`}\n                    className=\"w-full h-auto\"\n                    data-testid=\"img-size-chart\"\n                    loading=\"lazy\"\n                    decoding=\"async\"\n                  />\n                </div>\n              </motion.div>\n            )}\n\n            <div className=\"pt-8 sm:pt-12 pb-4\">\n              <Button \n                onClick={() => setOpen(false)}\n                className=\"w-full h-14 rounded-2xl bg-foreground text-background hover:bg-foreground/90 text-base font-medium lowercase transition-all duration-300 active:scale-[0.98]\"\n              >\n                fechar guia\n              </Button>\n            </div>\n          </div>\n        )}\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":10950,"size_tokens":null},"client/src/components/admin/SizeChartEditor.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Plus, Trash2, X, Ruler } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { ProductMeasurementField, ProductSizeMeasurement } from \"@shared/schema\";\n\ninterface SizeChartEditorProps {\n  productId: string;\n  selectedSizes: string[];\n}\n\ninterface MeasurementData {\n  [sizeName: string]: {\n    [fieldId: string]: string;\n  };\n}\n\nexport default function SizeChartEditor({ productId, selectedSizes }: SizeChartEditorProps) {\n  const { toast } = useToast();\n  const [newFieldName, setNewFieldName] = useState(\"\");\n  const [measurementData, setMeasurementData] = useState<MeasurementData>({});\n\n  const { data: fieldsData, isLoading: loadingFields } = useQuery<{ fields: ProductMeasurementField[] }>({\n    queryKey: ['/api/admin/products', productId, 'measurement-fields'],\n  });\n\n  const { data: measurementsData, isLoading: loadingMeasurements } = useQuery<{ measurements: ProductSizeMeasurement[] }>({\n    queryKey: ['/api/admin/products', productId, 'size-measurements'],\n  });\n\n  const fields = fieldsData?.fields || [];\n  const measurements = measurementsData?.measurements || [];\n\n  useEffect(() => {\n    if (!fields.length || !selectedSizes.length) return;\n    \n    const data: MeasurementData = {};\n    selectedSizes.forEach(size => {\n      data[size] = {};\n      fields.forEach(field => {\n        const measurement = measurements.find(m => m.sizeName === size && m.fieldId === field.id);\n        data[size][field.id] = measurement?.value || \"\";\n      });\n    });\n    setMeasurementData(data);\n  }, [selectedSizes, fields.length, measurements.length]);\n\n  const createFieldMutation = useMutation({\n    mutationFn: async (fieldName: string) => {\n      const response = await apiRequest(\"POST\", `/api/admin/products/${productId}/measurement-fields`, {\n        fieldName,\n        sortOrder: fields.length,\n      });\n      if (!response.ok) throw new Error(\"erro ao criar campo\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'measurement-fields'] });\n      setNewFieldName(\"\");\n      toast({ title: \"campo criado\", description: \"o campo de medida foi adicionado.\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"erro\", description: \"n√£o foi poss√≠vel criar o campo.\" });\n    },\n  });\n\n  const deleteFieldMutation = useMutation({\n    mutationFn: async (fieldId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/measurement-fields/${fieldId}`);\n      if (!response.ok) throw new Error(\"erro ao deletar campo\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'measurement-fields'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'size-measurements'] });\n      toast({ title: \"campo removido\", description: \"o campo foi deletado com sucesso.\" });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"erro\", description: \"n√£o foi poss√≠vel deletar o campo.\" });\n    },\n  });\n\n  const saveMeasurementMutation = useMutation({\n    mutationFn: async ({ sizeName, fieldId, value }: { sizeName: string; fieldId: string; value: string }) => {\n      const response = await apiRequest(\"POST\", `/api/admin/products/${productId}/size-measurements`, {\n        sizeName,\n        fieldId,\n        value,\n      });\n      if (!response.ok) throw new Error(\"erro ao salvar medida\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'size-measurements'] });\n    },\n    onError: () => {\n      toast({ variant: \"destructive\", title: \"erro\", description: \"n√£o foi poss√≠vel salvar a medida.\" });\n    },\n  });\n\n  const handleAddField = () => {\n    if (!newFieldName.trim()) return;\n    createFieldMutation.mutate(newFieldName.trim());\n  };\n\n  const handleMeasurementChange = (sizeName: string, fieldId: string, value: string) => {\n    setMeasurementData(prev => ({\n      ...prev,\n      [sizeName]: {\n        ...prev[sizeName],\n        [fieldId]: value,\n      },\n    }));\n  };\n\n  const handleMeasurementBlur = (sizeName: string, fieldId: string) => {\n    const value = measurementData[sizeName]?.[fieldId];\n    if (value !== undefined) {\n      saveMeasurementMutation.mutate({ sizeName, fieldId, value });\n    }\n  };\n\n  if (loadingFields || loadingMeasurements) {\n    return (\n      <div className=\"flex items-center justify-center py-8\">\n        <p className=\"text-xs text-muted-foreground/60 lowercase\">carregando medidas...</p>\n      </div>\n    );\n  }\n\n  if (selectedSizes.length === 0) {\n    return (\n      <div className=\"flex flex-col items-center justify-center py-10 gap-3\">\n        <div className=\"w-12 h-12 rounded-2xl bg-muted/50 flex items-center justify-center\">\n          <Ruler className=\"h-5 w-5 text-muted-foreground/40\" />\n        </div>\n        <p className=\"text-xs text-muted-foreground/60 lowercase text-center\">\n          ative e adicione tamanhos para configurar a tabela de medidas\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-5\">\n      <div className=\"flex items-center gap-3\">\n        <Input\n          placeholder=\"ex: largura, altura, manga...\"\n          value={newFieldName}\n          onChange={(e) => setNewFieldName(e.target.value)}\n          onKeyDown={(e) => e.key === \"Enter\" && (e.preventDefault(), handleAddField())}\n          className=\"flex-1 border-0 bg-muted/50 rounded-xl h-11 px-4 text-sm focus-visible:ring-1 lowercase\"\n          data-testid=\"input-new-measurement-field\"\n        />\n        <Button\n          type=\"button\"\n          onClick={handleAddField}\n          disabled={!newFieldName.trim() || createFieldMutation.isPending}\n          className=\"flex-shrink-0 rounded-xl h-11 px-5 lowercase gap-2\"\n          data-testid=\"button-add-measurement-field\"\n        >\n          <Plus className=\"h-4 w-4\" />\n          adicionar\n        </Button>\n      </div>\n\n      {fields.length > 0 && (\n        <div className=\"flex flex-wrap gap-2\">\n          {fields.map((field) => (\n            <div\n              key={field.id}\n              className=\"flex items-center gap-2 px-3.5 py-2 rounded-xl bg-muted/50 group\"\n              data-testid={`badge-field-${field.id}`}\n            >\n              <span className=\"text-sm lowercase\">{field.fieldName}</span>\n              <button\n                type=\"button\"\n                onClick={() => deleteFieldMutation.mutate(field.id)}\n                className=\"text-muted-foreground/40 hover:text-destructive transition-colors p-0.5 rounded-full invisible group-hover:visible\"\n                data-testid={`button-delete-field-${field.id}`}\n              >\n                <X className=\"h-3 w-3\" />\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {fields.length > 0 && selectedSizes.length > 0 && (\n        <div className=\"space-y-4\">\n          <div className=\"hidden sm:block rounded-2xl bg-muted/30 overflow-hidden\">\n            <div className=\"overflow-x-auto\">\n              <table className=\"w-full\">\n                <thead>\n                  <tr>\n                    <th className=\"text-left px-4 py-3 text-xs font-medium lowercase text-muted-foreground/70 bg-muted/50\">\n                      tamanho\n                    </th>\n                    {fields.map((field) => (\n                      <th\n                        key={field.id}\n                        className=\"text-left px-4 py-3 text-xs font-medium lowercase text-muted-foreground/70 bg-muted/50\"\n                      >\n                        {field.fieldName}\n                      </th>\n                    ))}\n                  </tr>\n                </thead>\n                <tbody>\n                  {selectedSizes.map((size, sizeIdx) => (\n                    <tr\n                      key={size}\n                      className={sizeIdx < selectedSizes.length - 1 ? \"border-b border-border/20\" : \"\"}\n                    >\n                      <td className=\"px-4 py-2.5\">\n                        <span className=\"text-sm font-medium uppercase tracking-wider\" data-testid={`badge-size-${size}`}>\n                          {size}\n                        </span>\n                      </td>\n                      {fields.map((field) => (\n                        <td key={field.id} className=\"px-3 py-2\">\n                          <Input\n                            value={measurementData[size]?.[field.id] || \"\"}\n                            onChange={(e) => handleMeasurementChange(size, field.id, e.target.value)}\n                            onBlur={() => handleMeasurementBlur(size, field.id)}\n                            placeholder=\"--\"\n                            className=\"h-9 border-0 bg-background/60 rounded-lg px-3 text-sm text-center focus-visible:ring-1 w-20\"\n                            data-testid={`input-measurement-${size}-${field.id}`}\n                          />\n                        </td>\n                      ))}\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </div>\n\n          <div className=\"sm:hidden space-y-2\">\n            {selectedSizes.map((size) => (\n              <div key={size} className=\"rounded-xl bg-muted/30 overflow-hidden\">\n                <div className=\"px-4 py-3 bg-muted/50\">\n                  <span className=\"text-sm font-medium uppercase tracking-wider\" data-testid={`badge-size-${size}`}>\n                    {size}\n                  </span>\n                </div>\n                <div className=\"p-3 space-y-2\">\n                  {fields.map((field) => (\n                    <div key={field.id} className=\"flex items-center gap-3\">\n                      <span className=\"text-xs lowercase text-muted-foreground min-w-[80px] flex-shrink-0\">\n                        {field.fieldName}\n                      </span>\n                      <Input\n                        value={measurementData[size]?.[field.id] || \"\"}\n                        onChange={(e) => handleMeasurementChange(size, field.id, e.target.value)}\n                        onBlur={() => handleMeasurementBlur(size, field.id)}\n                        placeholder=\"--\"\n                        className=\"h-9 border-0 bg-background/60 rounded-lg px-3 text-sm flex-1 focus-visible:ring-1\"\n                        data-testid={`input-measurement-${size}-${field.id}`}\n                      />\n                    </div>\n                  ))}\n                </div>\n              </div>\n            ))}\n          </div>\n\n          <p className=\"text-[11px] text-muted-foreground/50 lowercase text-center\">\n            valores salvos automaticamente ao sair do campo. use cm.\n          </p>\n        </div>\n      )}\n\n      {fields.length === 0 && (\n        <div className=\"flex flex-col items-center justify-center py-6 gap-2\">\n          <p className=\"text-xs text-muted-foreground/50 lowercase\">\n            ex: largura, altura, manga, comprimento\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":11400,"size_tokens":null},"client/src/pages/About.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport Footer from \"@/components/Footer\";\n\nexport default function About() {\n  const { data: pageData, isLoading } = useQuery<{\n    id: string;\n    slug: string;\n    title: string;\n    content: string;\n  }>({\n    queryKey: ['/api/footer-page', 'about'],\n  });\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <div className=\"container mx-auto px-4 py-16\">\n        <div className=\"max-w-4xl mx-auto space-y-12\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              <div className=\"h-12 bg-muted animate-pulse rounded\" />\n              <div className=\"h-64 bg-muted animate-pulse rounded\" />\n            </div>\n          ) : pageData ? (\n            <>\n              <div className=\"text-center space-y-4\">\n                <h1 className=\"text-4xl md:text-5xl font-light lowercase text-foreground tracking-tight\">\n                  {pageData.title}\n                </h1>\n              </div>\n\n              <Card className=\"p-8\">\n                <div \n                  className=\"prose prose-invert dark:prose max-w-none lowercase\"\n                  dangerouslySetInnerHTML={{ __html: pageData.content }}\n                />\n              </Card>\n            </>\n          ) : (\n            <div className=\"text-center py-16\">\n              <p className=\"text-muted-foreground\">p√°gina n√£o encontrada</p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      <Footer />\n    </div>\n  );\n}\n","path":null,"size_bytes":1538,"size_tokens":null},"client/src/components/admin/AdminFooter.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport AdminFAQ from \"./AdminFAQ\";\nimport AdminCompanyInfo from \"./AdminCompanyInfo\";\n\nconst footerPages = [\n  { slug: \"company\", title: \"Informa√ß√µes da Empresa\" },\n  { slug: \"faq\", title: \"FAQ\" },\n  { slug: \"about\", title: \"Sobre N√≥s\" },\n  { slug: \"policies\", title: \"Pol√≠ticas\" },\n  { slug: \"returns\", title: \"Trocas e Devolu√ß√µes\" },\n  { slug: \"shipping\", title: \"Frete e Entrega\" },\n  { slug: \"privacy\", title: \"Privacidade\" },\n];\n\nexport default function AdminFooter() {\n  const { toast } = useToast();\n  const [selectedPage, setSelectedPage] = useState(\"company\");\n  const [formData, setFormData] = useState({ title: \"\", content: \"\", description: \"\" });\n  const [isSaving, setIsSaving] = useState(false);\n\n  const { data: pageData, isLoading } = useQuery<{\n    id: string;\n    slug: string;\n    title: string;\n    content: string;\n    description: string;\n  }>({\n    queryKey: ['/api/footer-page', selectedPage],\n    enabled: selectedPage !== \"company\" && selectedPage !== \"faq\",\n  });\n\n  useEffect(() => {\n    if (pageData) {\n      setFormData({\n        title: pageData.title,\n        content: pageData.content,\n        description: pageData.description || \"\",\n      });\n    }\n  }, [pageData]);\n\n  const handleSave = async () => {\n    if (selectedPage === \"company\" || selectedPage === \"faq\") {\n      return;\n    }\n    try {\n      setIsSaving(true);\n      await apiRequest(\"POST\", `/api/footer-page/${selectedPage}`, {\n        ...formData,\n      });\n      \n      toast({\n        title: \"salvo com sucesso\",\n        description: `p√°gina \"${formData.title}\" atualizada`,\n      });\n\n      queryClient.invalidateQueries({ queryKey: ['/api/footer-page', selectedPage] });\n    } catch (error) {\n      console.error(\"Save error:\", error);\n      toast({\n        title: \"erro ao salvar\",\n        description: \"tente novamente\",\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsSaving(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"space-y-4\">\n        <label className=\"text-sm font-medium lowercase\">selecione uma p√°gina</label>\n        <Select value={selectedPage} onValueChange={setSelectedPage}>\n          <SelectTrigger className=\"w-full lowercase\" data-testid=\"select-footer-page\">\n            <SelectValue className=\"lowercase\" />\n          </SelectTrigger>\n          <SelectContent className=\"z-50\">\n            {footerPages.map((page) => (\n              <SelectItem key={page.slug} value={page.slug} className=\"lowercase\">\n                {page.title}\n              </SelectItem>\n            ))}\n          </SelectContent>\n        </Select>\n      </div>\n\n      {selectedPage === \"faq\" ? (\n        <AdminFAQ />\n      ) : selectedPage === \"company\" ? (\n        <AdminCompanyInfo />\n      ) : (\n        <Card className=\"p-6 space-y-6\">\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              <div className=\"h-10 bg-muted animate-pulse rounded\" />\n              <div className=\"h-64 bg-muted animate-pulse rounded\" />\n            </div>\n          ) : (\n            <>\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium lowercase\">t√≠tulo</label>\n                <Input\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  placeholder=\"t√≠tulo da p√°gina\"\n                  data-testid=\"input-footer-title\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium lowercase\">meta descri√ß√£o (opcional)</label>\n                <Input\n                  value={formData.description}\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\n                  placeholder=\"descri√ß√£o para SEO\"\n                  data-testid=\"input-footer-description\"\n                />\n              </div>\n\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium lowercase\">conte√∫do (HTML permitido)</label>\n                <Textarea\n                  value={formData.content}\n                  onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n                  placeholder=\"Digite o conte√∫do da p√°gina... HTML permitido\"\n                  className=\"min-h-96 font-mono text-sm\"\n                  data-testid=\"textarea-footer-content\"\n                />\n                <p className=\"text-xs text-muted-foreground lowercase\">\n                  Voc√™ pode usar HTML b√°sico: &lt;p&gt;, &lt;strong&gt;, &lt;em&gt;, &lt;h2&gt;, &lt;h3&gt;, &lt;ul&gt;, &lt;li&gt;, &lt;a&gt;, etc.\n                </p>\n              </div>\n\n              <Button\n                onClick={handleSave}\n                disabled={isSaving}\n                className=\"w-full sm:w-auto lowercase\"\n                data-testid=\"button-save-footer\"\n              >\n                {isSaving ? \"salvando...\" : \"salvar altera√ß√µes\"}\n              </Button>\n            </>\n          )}\n        </Card>\n      )}\n    </div>\n  );\n}\n","path":null,"size_bytes":5592,"size_tokens":null},"client/src/pages/PaymentSuccess.tsx":{"content":"/**\n * P√°gina de Sucesso do Pagamento\n * \n * Exibida quando o pagamento √© aprovado pelo Mercado Pago.\n * Mostra os detalhes do pedido e permite download do comprovante em PDF.\n */\n\nimport { useEffect, useState, useRef } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { usePixel } from \"@/hooks/usePixel\";\nimport { useMochila } from \"@/contexts/MochilaContext\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { CheckCircle, Download, Home, Package } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\ninterface OrderData {\n  orderNumber: string;\n  customerName: string;\n  customerEmail: string;\n  totalAmount: string;\n  paymentMethod: string;\n  paymentInstallments: number;\n  orderStatus: string;\n  paymentStatus: string;\n  paidAt: string;\n  items: Array<{\n    productName: string;\n    quantity: number;\n    unitPrice: string;\n    subtotal: string;\n  }>;\n}\n\nexport default function PaymentSuccess() {\n  const [location] = useLocation();\n  const [orderNumber, setOrderNumber] = useState<string | null>(null);\n  const { items, clearAll } = useMochila();\n  const { trackPurchase } = usePixel();\n  const purchaseTrackedRef = useRef(false);\n  const clearedRef = useRef(false);\n\n  useEffect(() => {\n    localStorage.removeItem(\"oudla_pending_order\");\n    const params = new URLSearchParams(window.location.search);\n    const order = params.get(\"order\");\n    if (order) {\n      setOrderNumber(order);\n    }\n    if (items.length > 0 && !clearedRef.current) {\n      clearedRef.current = true;\n      clearAll();\n    }\n  }, [location, items, clearAll]);\n\n  // Busca os dados do pedido\n  const { data: orderData, isLoading } = useQuery<{ success: boolean; order: OrderData }>({\n    queryKey: [\"/api/checkout/order\", orderNumber],\n    enabled: !!orderNumber,\n  });\n\n  // Dispara o evento Purchase do Facebook Pixel quando os dados do pedido carregam\n  // Este evento rastreia compras finalizadas com sucesso\n  useEffect(() => {\n    const order = orderData?.order;\n    \n    // Verifica se o pedido existe e se o evento ainda n√£o foi disparado\n    if (order && !purchaseTrackedRef.current) {\n      // Marca como disparado para evitar duplica√ß√£o\n      purchaseTrackedRef.current = true;\n      \n      // Prepara a lista de itens comprados para o evento\n      const purchaseItems = order.items?.map((item) => ({\n        id: item.productName, // Usa o nome do produto como ID\n        name: item.productName,\n        quantity: item.quantity,\n        price: parseFloat(item.unitPrice),\n      })) || [];\n      \n      // Dispara o evento Purchase com orderId, valor total e itens\n      trackPurchase(\n        order.orderNumber,\n        parseFloat(order.totalAmount),\n        \"BRL\",\n        purchaseItems\n      );\n    }\n  }, [orderData?.order, trackPurchase]);\n\n  // Fun√ß√£o para baixar o comprovante em PDF\n  const handleDownloadPDF = () => {\n    if (orderNumber) {\n      window.open(`/api/checkout/receipt/${orderNumber}`, \"_blank\");\n    }\n  };\n\n  // Formata pre√ßo em Real brasileiro\n  const formatPrice = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(num);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"h-8 w-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground lowercase\">carregando pedido...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const order = orderData?.order;\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* √çcone de sucesso animado */}\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ type: \"spring\", duration: 0.5 }}\n          className=\"flex justify-center mb-8\"\n        >\n          <div className=\"w-24 h-24 bg-green-500/10 rounded-full flex items-center justify-center\">\n            <CheckCircle className=\"w-12 h-12 text-green-500\" />\n          </div>\n        </motion.div>\n\n        {/* T√≠tulo */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"text-center mb-8\"\n        >\n          <h1 className=\"text-3xl font-bold lowercase mb-2\">pagamento aprovado!</h1>\n          <p className=\"text-muted-foreground lowercase\">\n            obrigado pela sua compra. seu pedido foi confirmado.\n          </p>\n        </motion.div>\n\n        {order && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n          >\n            <Card className=\"mb-6\">\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground lowercase\">n√∫mero do pedido</p>\n                    <p className=\"text-xl font-bold\">{order.orderNumber}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground lowercase\">total</p>\n                    <p className=\"text-xl font-bold text-primary\">\n                      {formatPrice(order.totalAmount)}\n                    </p>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Detalhes do cliente */}\n                <div className=\"p-4 bg-muted/30 rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground lowercase mb-1\">enviamos a confirma√ß√£o para</p>\n                  <p className=\"font-medium\">{order.customerEmail}</p>\n                </div>\n\n                {/* M√©todo de pagamento */}\n                {order.paymentMethod && (\n                  <div className=\"flex justify-between items-center py-2 border-b\">\n                    <span className=\"text-muted-foreground lowercase\">m√©todo de pagamento</span>\n                    <span className=\"font-medium\">\n                      {order.paymentMethod}\n                      {order.paymentInstallments > 1 && ` (${order.paymentInstallments}x)`}\n                    </span>\n                  </div>\n                )}\n\n                {/* Itens do pedido */}\n                <div className=\"space-y-2\">\n                  <p className=\"text-sm font-medium lowercase\">itens do pedido</p>\n                  {order.items?.map((item, index) => (\n                    <div key={index} className=\"flex justify-between text-sm py-1\">\n                      <span>\n                        {item.productName} x{item.quantity}\n                      </span>\n                      <span>{formatPrice(item.subtotal)}</span>\n                    </div>\n                  ))}\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Bot√µes de a√ß√£o */}\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                onClick={handleDownloadPDF}\n                variant=\"outline\"\n                className=\"flex-1 h-12 rounded-full\"\n                data-testid=\"button-download-pdf\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                <span className=\"lowercase\">baixar comprovante</span>\n              </Button>\n              <Link href=\"/\" className=\"flex-1\">\n                <Button className=\"w-full h-12 rounded-full\" data-testid=\"button-back-home\">\n                  <Home className=\"w-4 h-4 mr-2\" />\n                  <span className=\"lowercase\">voltar √† loja</span>\n                </Button>\n              </Link>\n            </div>\n\n            {/* Informa√ß√£o sobre acompanhamento */}\n            <div className=\"mt-8 p-4 bg-muted/20 rounded-xl text-center\">\n              <Package className=\"w-6 h-6 mx-auto mb-2 text-muted-foreground\" />\n              <p className=\"text-sm text-muted-foreground lowercase\">\n                voc√™ receber√° atualiza√ß√µes sobre o envio no seu e-mail.\n              </p>\n            </div>\n          </motion.div>\n        )}\n\n        {!order && !isLoading && (\n          <Card className=\"text-center py-8\">\n            <CardContent>\n              <p className=\"text-muted-foreground lowercase mb-4\">\n                pedido n√£o encontrado\n              </p>\n              <Link href=\"/\">\n                <Button className=\"rounded-full\">\n                  <Home className=\"w-4 h-4 mr-2\" />\n                  <span className=\"lowercase\">voltar √† loja</span>\n                </Button>\n              </Link>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":9022,"size_tokens":null},"client/src/components/admin/AdminEmails.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, Mail, Send, Eye, Code, ChevronDown, Save, CheckCircle, Bold, Italic, Underline, Link, Type, AlignLeft, AlignCenter, AlignRight, List, ListOrdered, Image, Minus, Palette, ImageIcon } from \"lucide-react\";\nimport { Popover, PopoverContent, PopoverTrigger } from \"@/components/ui/popover\";\n\ninterface EmailTemplate {\n  id: string;\n  templateKey: string;\n  name: string;\n  subject: string;\n  htmlContent: string;\n  enabled: boolean;\n  createdAt: string;\n  updatedAt: string;\n}\n\nconst TEMPLATE_VARIABLES = [\n  { key: \"logo_url\", label: \"url da logo\", example: \"https://example.com/logo.png\" },\n  { key: \"nome\", label: \"nome do cliente\", example: \"Jo√£o da Silva\" },\n  { key: \"email\", label: \"email\", example: \"joao@exemplo.com\" },\n  { key: \"cpf\", label: \"CPF\", example: \"123.456.789-00\" },\n  { key: \"telefone\", label: \"telefone\", example: \"(11) 99999-9999\" },\n  { key: \"endereco\", label: \"endere√ßo completo\", example: \"Rua Exemplo, 123...\" },\n  { key: \"numero_pedido\", label: \"n¬∞ do pedido\", example: \"OUDLA-20250212-0001\" },\n  { key: \"itens\", label: \"lista de itens\", example: \"(tabela HTML)\" },\n  { key: \"subtotal\", label: \"subtotal\", example: \"R$ 199,90\" },\n  { key: \"frete\", label: \"frete\", example: \"R$ 19,90\" },\n  { key: \"total\", label: \"total\", example: \"R$ 219,80\" },\n  { key: \"metodo_pagamento\", label: \"m√©todo de pagamento\", example: \"Cart√£o de Cr√©dito\" },\n  { key: \"codigo_rastreio\", label: \"c√≥digo de rastreio\", example: \"BR123456789BR\" },\n  { key: \"link_rastreio\", label: \"link da p√°gina de rastreio\", example: \"https://seusite.com/rastreio\" },\n  { key: \"data_pedido\", label: \"data do pedido\", example: \"12/02/2025\" },\n];\n\nconst EMAIL_HEADER_HTML = `<table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" style=\"background-color:#1a1a1a;padding:24px 32px;\">\n  <tr>\n    <td style=\"text-align:left;vertical-align:middle;width:50%;\">\n      <img src=\"{{logo_url}}\" alt=\"OUDLA\" style=\"height:32px;width:auto;\" />\n    </td>\n    <td style=\"text-align:right;vertical-align:middle;width:50%;font-family:Arial,sans-serif;font-size:20px;font-weight:bold;color:#ffffff;letter-spacing:4px;\">\n      OUDLA\n    </td>\n  </tr>\n</table>\n`;\n\nconst TEMPLATE_LABELS: Record<string, { title: string; description: string }> = {\n  order_confirmation: {\n    title: \"confirma√ß√£o de pedido\",\n    description: \"enviado automaticamente quando o pagamento √© aprovado\",\n  },\n  tracking_code: {\n    title: \"c√≥digo de rastreio\",\n    description: \"enviado quando o admin adiciona o c√≥digo de rastreio\",\n  },\n  newsletter_welcome: {\n    title: \"boas-vindas newsletter\",\n    description: \"enviado automaticamente quando algu√©m se cadastra na newsletter\",\n  },\n};\n\nexport default function AdminEmails() {\n  const { toast } = useToast();\n  const [activeTemplate, setActiveTemplate] = useState<string>(\"order_confirmation\");\n  const [editMode, setEditMode] = useState<\"visual\" | \"code\">(\"code\");\n  const [subject, setSubject] = useState(\"\");\n  const [htmlContent, setHtmlContent] = useState(\"\");\n  const [enabled, setEnabled] = useState(true);\n  const [testEmail, setTestEmail] = useState(\"\");\n  const [showPreview, setShowPreview] = useState(false);\n  const [showVariables, setShowVariables] = useState(false);\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const [linkUrl, setLinkUrl] = useState(\"\");\n  const [linkText, setLinkText] = useState(\"\");\n  const [imageUrl, setImageUrl] = useState(\"\");\n  const [fontSize, setFontSize] = useState(\"14px\");\n  const [fontColor, setFontColor] = useState(\"#000000\");\n  const [logoUrl, setLogoUrl] = useState(\"\");\n\n  const { data: logoSetting } = useQuery<{ value: string }>({\n    queryKey: [\"/api/admin/settings\", \"email_logo_url\"],\n    queryFn: async () => {\n      const res = await fetch(\"/api/admin/settings/email_logo_url\", { credentials: \"include\" });\n      return res.json();\n    },\n  });\n\n  useEffect(() => {\n    if (logoSetting?.value) {\n      setLogoUrl(logoSetting.value);\n    }\n  }, [logoSetting?.value]);\n\n  const saveLogoMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"email_logo_url\",\n        value: logoUrl,\n        type: \"text\",\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/settings\", \"email_logo_url\"] });\n      toast({ title: \"logo salva\", description: \"a url da logo foi salva com sucesso.\" });\n    },\n    onError: () => {\n      toast({ title: \"erro\", description: \"n√£o foi poss√≠vel salvar a url da logo.\", variant: \"destructive\" });\n    },\n  });\n\n  const wrapSelection = (before: string, after: string) => {\n    if (!textareaRef.current) return;\n    const ta = textareaRef.current;\n    const start = ta.selectionStart;\n    const end = ta.selectionEnd;\n    const selected = htmlContent.substring(start, end);\n    const replacement = `${before}${selected}${after}`;\n    const newContent = htmlContent.substring(0, start) + replacement + htmlContent.substring(end);\n    setHtmlContent(newContent);\n    setTimeout(() => {\n      ta.focus();\n      ta.setSelectionRange(start + before.length, start + before.length + selected.length);\n    }, 0);\n  };\n\n  const insertAtCursor = (text: string) => {\n    if (!textareaRef.current) return;\n    const ta = textareaRef.current;\n    const start = ta.selectionStart;\n    const newContent = htmlContent.substring(0, start) + text + htmlContent.substring(start);\n    setHtmlContent(newContent);\n    setTimeout(() => {\n      ta.focus();\n      ta.setSelectionRange(start + text.length, start + text.length);\n    }, 0);\n  };\n\n  const { data: templatesData, isLoading } = useQuery<{ templates: EmailTemplate[] }>({\n    queryKey: [\"/api/admin/email-templates\"],\n  });\n\n  const templates = templatesData?.templates || [];\n\n  const currentTemplate = templates.find((t) => t.templateKey === activeTemplate);\n\n  useEffect(() => {\n    if (currentTemplate) {\n      setSubject(currentTemplate.subject);\n      setHtmlContent(currentTemplate.htmlContent);\n      setEnabled(currentTemplate.enabled);\n    }\n  }, [currentTemplate?.id, activeTemplate]);\n\n  const saveMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"PUT\", `/api/admin/email-templates/${activeTemplate}`, {\n        name: TEMPLATE_LABELS[activeTemplate]?.title || activeTemplate,\n        subject,\n        htmlContent,\n        enabled,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/email-templates\"] });\n      toast({ title: \"template salvo\", description: \"as altera√ß√µes foram salvas com sucesso.\" });\n    },\n    onError: () => {\n      toast({ title: \"erro\", description: \"n√£o foi poss√≠vel salvar o template.\", variant: \"destructive\" });\n    },\n  });\n\n  const testMutation = useMutation({\n    mutationFn: async () => {\n      const res = await apiRequest(\"POST\", `/api/admin/email-templates/${activeTemplate}/test`, {\n        to: testEmail,\n      });\n      return res.json();\n    },\n    onSuccess: () => {\n      toast({ title: \"email enviado\", description: `email de teste enviado para ${testEmail}` });\n    },\n    onError: () => {\n      toast({ title: \"erro\", description: \"falha ao enviar email de teste.\", variant: \"destructive\" });\n    },\n  });\n\n\n  const getPreviewHtml = () => {\n    let preview = htmlContent;\n    TEMPLATE_VARIABLES.forEach((v) => {\n      const regex = new RegExp(`\\\\{\\\\{${v.key}\\\\}\\\\}`, \"g\");\n      preview = preview.replace(regex, v.example);\n    });\n    return preview;\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-20\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-3\">\n        <div>\n          <h2 className=\"text-lg font-medium lowercase\" data-testid=\"text-email-title\">emails transacionais</h2>\n          <p className=\"text-sm text-muted-foreground lowercase\">configure os emails enviados automaticamente aos clientes</p>\n        </div>\n        <Button\n          onClick={() => saveMutation.mutate()}\n          disabled={saveMutation.isPending}\n          data-testid=\"button-save-template\"\n        >\n          {saveMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : <Save className=\"h-4 w-4 mr-2\" />}\n          salvar\n        </Button>\n      </div>\n\n      <div>\n        <DropdownMenu>\n          <DropdownMenuTrigger asChild>\n            <Button variant=\"outline\" className=\"w-full justify-between lowercase\" data-testid=\"dropdown-template-selector\">\n              <span className=\"flex items-center gap-2\">\n                <Mail className=\"h-3.5 w-3.5\" />\n                {TEMPLATE_LABELS[activeTemplate as keyof typeof TEMPLATE_LABELS]?.title || \"selecionar template\"}\n              </span>\n              <ChevronDown className=\"h-4 w-4 opacity-50\" />\n            </Button>\n          </DropdownMenuTrigger>\n          <DropdownMenuContent className=\"w-[var(--radix-dropdown-menu-trigger-width)]\" align=\"start\">\n            {Object.entries(TEMPLATE_LABELS).map(([key, info]) => (\n              <DropdownMenuItem\n                key={key}\n                onClick={() => setActiveTemplate(key)}\n                className=\"lowercase gap-2 cursor-pointer\"\n                data-testid={`dropdown-item-${key}`}\n              >\n                <Mail className=\"h-3.5 w-3.5\" />\n                {info.title}\n                {key === activeTemplate && <CheckCircle className=\"h-3.5 w-3.5 ml-auto\" />}\n              </DropdownMenuItem>\n            ))}\n          </DropdownMenuContent>\n        </DropdownMenu>\n\n        <Card className=\"mt-4\">\n          <CardContent className=\"pt-4 px-4 sm:px-6\">\n            <div className=\"flex items-center gap-2 mb-3\">\n              <ImageIcon className=\"h-4 w-4 text-muted-foreground\" />\n              <Label className=\"lowercase text-sm font-medium\">logo do cabe√ßalho dos emails</Label>\n            </div>\n            <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2\">\n              <Input\n                value={logoUrl}\n                onChange={(e) => setLogoUrl(e.target.value)}\n                placeholder=\"https://exemplo.com/logo.png\"\n                className=\"flex-1 text-sm\"\n                data-testid=\"input-email-logo-url\"\n              />\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => saveLogoMutation.mutate()}\n                  disabled={saveLogoMutation.isPending}\n                  className=\"lowercase\"\n                  data-testid=\"button-save-logo-url\"\n                >\n                  {saveLogoMutation.isPending ? <Loader2 className=\"h-3.5 w-3.5 animate-spin mr-1.5\" /> : <Save className=\"h-3.5 w-3.5 mr-1.5\" />}\n                  salvar logo\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => insertAtCursor(EMAIL_HEADER_HTML)}\n                  className=\"lowercase\"\n                  data-testid=\"button-insert-header\"\n                >\n                  <Code className=\"h-3.5 w-3.5 mr-1.5\" />\n                  inserir cabe√ßalho\n                </Button>\n              </div>\n            </div>\n            <p className=\"text-xs text-muted-foreground lowercase mt-2\">\n              cole a url da imagem da logo. use o bot√£o \"inserir cabe√ßalho\" para adicionar o header com logo √† esquerda e OUDLA √† direita no template.\n            </p>\n            {logoUrl && (\n              <div className=\"mt-3 p-3 bg-[#1a1a1a] rounded-lg flex items-center justify-between\" data-testid=\"preview-email-header\">\n                <img src={logoUrl} alt=\"logo preview\" className=\"h-8 w-auto\" style={{ filter: \"invert(1)\" }} data-testid=\"img-email-logo-preview\" />\n                <span className=\"text-white font-bold tracking-[4px] text-lg\" data-testid=\"text-email-brand-name\">OUDLA</span>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {(() => {\n          const key = activeTemplate;\n          const info = TEMPLATE_LABELS[key as keyof typeof TEMPLATE_LABELS];\n          if (!info) return null;\n          return (\n          <div className=\"space-y-4 mt-4\">\n            <Card>\n              <CardHeader className=\"pb-3 px-4 sm:px-6\">\n                <div className=\"flex items-center justify-between flex-wrap gap-2\">\n                  <div className=\"flex items-center gap-2 sm:gap-3 flex-wrap\">\n                    <CardTitle className=\"text-sm sm:text-base lowercase\">{info.title}</CardTitle>\n                    <Badge variant={enabled ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid={`badge-status-${key}`}>\n                      {enabled ? \"ativo\" : \"inativo\"}\n                    </Badge>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Label htmlFor={`toggle-${key}`} className=\"text-sm text-muted-foreground lowercase\">\n                      ativo\n                    </Label>\n                    <Switch\n                      id={`toggle-${key}`}\n                      checked={enabled}\n                      onCheckedChange={setEnabled}\n                      data-testid={`switch-enabled-${key}`}\n                    />\n                  </div>\n                </div>\n                <p className=\"text-xs sm:text-sm text-muted-foreground lowercase\">{info.description}</p>\n              </CardHeader>\n              <CardContent className=\"space-y-5 px-4 sm:px-6\">\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">assunto do email</Label>\n                  <Input\n                    value={subject}\n                    onChange={(e) => setSubject(e.target.value)}\n                    placeholder=\"ex: OUDLA - Pedido {{numero_pedido}} confirmado!\"\n                    className=\"lowercase text-sm\"\n                    data-testid={`input-subject-${key}`}\n                  />\n                  <p className=\"text-xs text-muted-foreground lowercase\">\n                    use vari√°veis como {\"{{numero_pedido}}\"} no assunto\n                  </p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-2\">\n                    <Label className=\"lowercase text-sm\">conte√∫do HTML</Label>\n                    <div className=\"flex items-center gap-1.5 sm:gap-2\">\n                      <Button\n                        variant={editMode === \"code\" ? \"default\" : \"outline\"}\n                        size=\"sm\"\n                        onClick={() => setEditMode(\"code\")}\n                        data-testid={`button-code-mode-${key}`}\n                      >\n                        <Code className=\"h-3.5 w-3.5\" />\n                      </Button>\n                      <Button\n                        variant={showPreview ? \"default\" : \"outline\"}\n                        size=\"sm\"\n                        onClick={() => setShowPreview(!showPreview)}\n                        data-testid={`button-preview-${key}`}\n                      >\n                        <Eye className=\"h-3.5 w-3.5\" />\n                      </Button>\n                    </div>\n                  </div>\n\n                  {showPreview ? (\n                    <div className=\"border rounded-md overflow-hidden\">\n                      <div className=\"bg-muted px-3 sm:px-4 py-2 border-b\">\n                        <p className=\"text-xs text-muted-foreground lowercase\">pr√©-visualiza√ß√£o (dados de exemplo)</p>\n                      </div>\n                      <div className=\"bg-white p-2 sm:p-4 min-h-[300px] sm:min-h-[400px]\">\n                        <iframe\n                          srcDoc={getPreviewHtml()}\n                          className=\"w-full min-h-[300px] sm:min-h-[400px] border-0\"\n                          title=\"Email Preview\"\n                          data-testid={`iframe-preview-${key}`}\n                        />\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"border rounded-md overflow-hidden\">\n                      <div className=\"hidden sm:flex items-center gap-0.5 flex-wrap bg-muted/50 border-b px-2 py-1.5\">\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection(\"<strong>\", \"</strong>\")} title=\"negrito\" data-testid=\"toolbar-bold\">\n                          <Bold className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection(\"<em>\", \"</em>\")} title=\"it√°lico\" data-testid=\"toolbar-italic\">\n                          <Italic className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection(\"<u>\", \"</u>\")} title=\"sublinhado\" data-testid=\"toolbar-underline\">\n                          <Underline className=\"h-3.5 w-3.5\" />\n                        </Button>\n\n                        <div className=\"w-px h-5 bg-border mx-1\" />\n\n                        <Popover>\n                          <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" title=\"link\" data-testid=\"toolbar-link\">\n                              <Link className=\"h-3.5 w-3.5\" />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-72 space-y-2\" align=\"start\">\n                            <Label className=\"text-xs lowercase\">url</Label>\n                            <Input value={linkUrl} onChange={(e) => setLinkUrl(e.target.value)} placeholder=\"https://...\" className=\"h-8 text-xs\" data-testid=\"toolbar-link-url\" />\n                            <Label className=\"text-xs lowercase\">texto (opcional)</Label>\n                            <Input value={linkText} onChange={(e) => setLinkText(e.target.value)} placeholder=\"clique aqui\" className=\"h-8 text-xs\" data-testid=\"toolbar-link-text\" />\n                            <Button size=\"sm\" className=\"w-full lowercase\" onClick={() => {\n                              if (linkUrl) {\n                                const text = linkText || linkUrl;\n                                insertAtCursor(`<a href=\"${linkUrl}\" style=\"color:#1a73e8;text-decoration:underline\">${text}</a>`);\n                                setLinkUrl(\"\");\n                                setLinkText(\"\");\n                              }\n                            }} data-testid=\"toolbar-link-insert\">inserir link</Button>\n                          </PopoverContent>\n                        </Popover>\n\n                        <Popover>\n                          <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" title=\"imagem\" data-testid=\"toolbar-image\">\n                              <Image className=\"h-3.5 w-3.5\" />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-72 space-y-2\" align=\"start\">\n                            <Label className=\"text-xs lowercase\">url da imagem</Label>\n                            <Input value={imageUrl} onChange={(e) => setImageUrl(e.target.value)} placeholder=\"https://...\" className=\"h-8 text-xs\" data-testid=\"toolbar-image-url\" />\n                            <Button size=\"sm\" className=\"w-full lowercase\" onClick={() => {\n                              if (imageUrl) {\n                                insertAtCursor(`<img src=\"${imageUrl}\" alt=\"\" style=\"max-width:100%;height:auto\" />`);\n                                setImageUrl(\"\");\n                              }\n                            }} data-testid=\"toolbar-image-insert\">inserir imagem</Button>\n                          </PopoverContent>\n                        </Popover>\n\n                        <div className=\"w-px h-5 bg-border mx-1\" />\n\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection('<p style=\"text-align:left\">', \"</p>\")} title=\"alinhar esquerda\" data-testid=\"toolbar-align-left\">\n                          <AlignLeft className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection('<p style=\"text-align:center\">', \"</p>\")} title=\"centralizar\" data-testid=\"toolbar-align-center\">\n                          <AlignCenter className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => wrapSelection('<p style=\"text-align:right\">', \"</p>\")} title=\"alinhar direita\" data-testid=\"toolbar-align-right\">\n                          <AlignRight className=\"h-3.5 w-3.5\" />\n                        </Button>\n\n                        <div className=\"w-px h-5 bg-border mx-1\" />\n\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => insertAtCursor(\"<ul>\\n  <li></li>\\n</ul>\")} title=\"lista\" data-testid=\"toolbar-list\">\n                          <List className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => insertAtCursor(\"<ol>\\n  <li></li>\\n</ol>\")} title=\"lista numerada\" data-testid=\"toolbar-list-ordered\">\n                          <ListOrdered className=\"h-3.5 w-3.5\" />\n                        </Button>\n                        <Button variant=\"ghost\" size=\"icon\" className=\"h-7 w-7\" onClick={() => insertAtCursor(\"<hr />\")} title=\"linha divis√≥ria\" data-testid=\"toolbar-hr\">\n                          <Minus className=\"h-3.5 w-3.5\" />\n                        </Button>\n\n                        <div className=\"w-px h-5 bg-border mx-1\" />\n\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\" title=\"tamanho da fonte\" data-testid=\"toolbar-font-size\">\n                              <Type className=\"h-3.5 w-3.5\" />\n                              <span className=\"text-[10px]\">{fontSize}</span>\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"start\">\n                            {[\"10px\", \"12px\", \"14px\", \"16px\", \"18px\", \"20px\", \"24px\", \"28px\", \"32px\"].map((size) => (\n                              <DropdownMenuItem key={size} onClick={() => { setFontSize(size); wrapSelection(`<span style=\"font-size:${size}\">`, \"</span>\"); }} data-testid={`toolbar-font-size-${size}`}>\n                                <span className=\"text-xs\">{size}</span>\n                              </DropdownMenuItem>\n                            ))}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n\n                        <Popover>\n                          <PopoverTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2 gap-1\" title=\"cor do texto\" data-testid=\"toolbar-color\">\n                              <Palette className=\"h-3.5 w-3.5\" />\n                              <div className=\"h-3 w-3 rounded-sm border\" style={{ backgroundColor: fontColor }} />\n                            </Button>\n                          </PopoverTrigger>\n                          <PopoverContent className=\"w-56 space-y-2\" align=\"start\">\n                            <Label className=\"text-xs lowercase\">cor do texto</Label>\n                            <div className=\"flex items-center gap-2\">\n                              <input type=\"color\" value={fontColor} onChange={(e) => setFontColor(e.target.value)} className=\"h-8 w-8 rounded cursor-pointer border-0 p-0\" data-testid=\"toolbar-color-picker\" />\n                              <Input value={fontColor} onChange={(e) => setFontColor(e.target.value)} className=\"h-8 text-xs font-mono flex-1\" data-testid=\"toolbar-color-hex\" />\n                            </div>\n                            <div className=\"flex flex-wrap gap-1\">\n                              {[\"#000000\", \"#333333\", \"#666666\", \"#999999\", \"#ffffff\", \"#1a73e8\", \"#e53935\", \"#43a047\", \"#fb8c00\", \"#8e24aa\"].map((c) => (\n                                <button key={c} onClick={() => setFontColor(c)} className=\"h-6 w-6 rounded-sm border\" style={{ backgroundColor: c }} data-testid={`toolbar-color-${c}`} />\n                              ))}\n                            </div>\n                            <Button size=\"sm\" className=\"w-full lowercase\" onClick={() => wrapSelection(`<span style=\"color:${fontColor}\">`, \"</span>\")} data-testid=\"toolbar-color-apply\">aplicar cor</Button>\n                          </PopoverContent>\n                        </Popover>\n\n                        <DropdownMenu>\n                          <DropdownMenuTrigger asChild>\n                            <Button variant=\"ghost\" size=\"sm\" className=\"h-7 px-2\" title=\"cabe√ßalho\" data-testid=\"toolbar-heading\">\n                              <span className=\"text-xs font-bold\">H</span>\n                            </Button>\n                          </DropdownMenuTrigger>\n                          <DropdownMenuContent align=\"start\">\n                            {[1, 2, 3, 4].map((level) => (\n                              <DropdownMenuItem key={level} onClick={() => wrapSelection(`<h${level}>`, `</h${level}>`)} data-testid={`toolbar-heading-${level}`}>\n                                <span className=\"text-xs\">h{level}</span>\n                              </DropdownMenuItem>\n                            ))}\n                          </DropdownMenuContent>\n                        </DropdownMenu>\n                      </div>\n\n                      <textarea\n                        ref={textareaRef}\n                        value={htmlContent}\n                        onChange={(e) => setHtmlContent(e.target.value)}\n                        className=\"w-full min-h-[250px] sm:min-h-[400px] font-mono text-xs sm:text-sm p-3 sm:p-4 bg-background resize-y focus:outline-none focus:ring-2 focus:ring-ring\"\n                        spellCheck={false}\n                        data-testid={`textarea-html-${key}`}\n                      />\n                    </div>\n                  )}\n                </div>\n\n                <Card>\n                  <CardContent className=\"pt-4 px-4 sm:px-6\">\n                    <div>\n                      <Label className=\"lowercase text-sm\">enviar email de teste</Label>\n                      <p className=\"text-xs text-muted-foreground lowercase mt-0.5\">\n                        envie um email de teste com dados fict√≠cios para verificar o template\n                      </p>\n                    </div>\n                    <div className=\"flex flex-col sm:flex-row items-stretch sm:items-center gap-2 mt-3\">\n                      <Input\n                        type=\"email\"\n                        value={testEmail}\n                        onChange={(e) => setTestEmail(e.target.value)}\n                        placeholder=\"email@exemplo.com\"\n                        className=\"flex-1\"\n                        data-testid={`input-test-email-${key}`}\n                      />\n                      <Button\n                        variant=\"outline\"\n                        onClick={() => testMutation.mutate()}\n                        disabled={!testEmail || testMutation.isPending}\n                        className=\"w-full sm:w-auto\"\n                        data-testid={`button-send-test-${key}`}\n                      >\n                        {testMutation.isPending ? (\n                          <Loader2 className=\"h-4 w-4 animate-spin mr-2\" />\n                        ) : (\n                          <Send className=\"h-4 w-4 mr-2\" />\n                        )}\n                        enviar teste\n                      </Button>\n                    </div>\n                  </CardContent>\n                </Card>\n              </CardContent>\n            </Card>\n          </div>\n          );\n        })()}\n      </div>\n\n      <Card className=\"hover-elevate cursor-pointer\" onClick={() => setShowVariables(!showVariables)} data-testid=\"button-toggle-variables\">\n        <CardContent className=\"pt-4 px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between w-full\">\n            <h3 className=\"text-sm font-medium lowercase\">vari√°veis dispon√≠veis</h3>\n            <ChevronDown className={`h-4 w-4 text-muted-foreground transition-transform ${showVariables ? \"rotate-180\" : \"\"}`} />\n          </div>\n          {showVariables && (\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 mt-3\" onClick={(e) => e.stopPropagation()}>\n              {TEMPLATE_VARIABLES.map((v) => (\n                <button\n                  key={v.key}\n                  onClick={() => insertAtCursor(`{{${v.key}}}`)}\n                  className=\"flex items-center gap-2 text-sm p-2 rounded-md bg-muted/50 hover-elevate text-left\"\n                  data-testid={`button-var-${v.key}`}\n                >\n                  <code className=\"font-mono text-xs bg-background px-1.5 py-0.5 rounded border shrink-0\">{`{{${v.key}}}`}</code>\n                  <span className=\"text-muted-foreground text-xs lowercase truncate\">{v.label}</span>\n                </button>\n              ))}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":30384,"size_tokens":null},"SYSTEM_REVIEWS_READY.md":{"content":"# Sistema de Avalia√ß√µes Pronto! ‚úÖ\n\n## O Que Foi Criado:\n\n### 1. **Schema (Database)**\n- Nova tabela `admin_product_reviews` com campos:\n  - `id`, `productId`, `userName`, `userImage`, `rating` (1-5), `comment`, `reviewImage`\n  - Calcula automaticamente m√©dia de estrelas e count\n\n### 2. **Backend (Routes)**\n- `GET /api/admin/products/:productId/reviews` - lista avalia√ß√µes\n- `POST /api/admin/products/:productId/reviews` - criar avalia√ß√£o\n- `PATCH /api/admin/products/:productId/reviews/:reviewId` - editar\n- `DELETE /api/admin/products/:productId/reviews/:reviewId` - deletar\n- Auto-atualiza `product.rating` e `product.reviewsCount`\n\n### 3. **Componente Admin**\n- `AdminProductReviews.tsx` - interface completa de CRUD\n- Upload de nome, foto, estrelas, coment√°rio e imagem opcional\n- Mostra m√©dia de avalia√ß√µes em tempo real\n\n### 4. **SQL para Supabase**\nEst√° em `ADMIN_REVIEWS_SQL.sql` - execute no console:\n```sql\nCREATE TABLE admin_product_reviews (\n  id VARCHAR PRIMARY KEY DEFAULT gen_random_uuid(),\n  product_id VARCHAR NOT NULL,\n  user_name TEXT NOT NULL,\n  user_image TEXT,\n  rating INTEGER NOT NULL,\n  comment TEXT NOT NULL,\n  review_image TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n  FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE,\n  CHECK (rating >= 1 AND rating <= 5)\n);\n```\n\n## Para Completar:\n\n1. **Execute o SQL no Supabase Console**\n2. **Abra um produto no admin** - ver√° aba de \"avalia√ß√µes do produto\"\n3. **Clique em \"nova avalia√ß√£o\"** - formul√°rio aparece\n4. **Preencha dados do usu√°rio** - nome, foto (opcional), estrelas, coment√°rio, imagem (opcional)\n5. **As avalia√ß√µes aparecem na p√°gina do produto** - com m√©dia calculada automaticamente\n\n## Recursos:\n- ‚úÖ CRUD completo de avalia√ß√µes  \n- ‚úÖ C√°lculo autom√°tico de m√©dia\n- ‚úÖ Upload de fotos de usu√°rio\n- ‚úÖ Upload de imagem da avalia√ß√£o\n- ‚úÖ Interface mobile-responsive\n- ‚úÖ Integra√ß√£o com ProductPage (em progresso)\n","path":null,"size_bytes":2018,"size_tokens":null},"client/src/pages/PaymentFailure.tsx":{"content":"/**\n * P√°gina de Falha no Pagamento\n * \n * Exibida quando o pagamento √© rejeitado ou ocorre algum erro.\n * Oferece op√ß√µes para tentar novamente ou entrar em contato.\n */\n\nimport { useEffect, useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { XCircle, Home, RefreshCw, MessageCircle } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\ninterface OrderData {\n  orderNumber: string;\n  customerEmail: string;\n  totalAmount: string;\n  paymentStatus: string;\n  orderStatus: string;\n}\n\nexport default function PaymentFailure() {\n  const [location] = useLocation();\n  const [orderNumber, setOrderNumber] = useState<string | null>(null);\n\n  // Extrai o n√∫mero do pedido da URL\n  useEffect(() => {\n    localStorage.removeItem(\"oudla_pending_order\");\n    const params = new URLSearchParams(window.location.search);\n    const order = params.get(\"order\");\n    if (order) {\n      setOrderNumber(order);\n    }\n  }, [location]);\n\n  // Busca os dados do pedido\n  const { data: orderData, isLoading } = useQuery<{ success: boolean; order: OrderData }>({\n    queryKey: [\"/api/checkout/order\", orderNumber],\n    enabled: !!orderNumber,\n  });\n\n  // Formata pre√ßo em Real brasileiro\n  const formatPrice = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(num);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"h-8 w-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground lowercase\">carregando...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const order = orderData?.order;\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* √çcone de erro animado */}\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ type: \"spring\", duration: 0.5 }}\n          className=\"flex justify-center mb-8\"\n        >\n          <div className=\"w-24 h-24 bg-red-500/10 rounded-full flex items-center justify-center\">\n            <XCircle className=\"w-12 h-12 text-red-500\" />\n          </div>\n        </motion.div>\n\n        {/* T√≠tulo */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"text-center mb-8\"\n        >\n          <h1 className=\"text-3xl font-bold lowercase mb-2\">pagamento n√£o aprovado</h1>\n          <p className=\"text-muted-foreground lowercase\">\n            infelizmente n√£o foi poss√≠vel processar seu pagamento.\n          </p>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.3 }}\n        >\n          <Card className=\"mb-6\">\n            <CardHeader className=\"pb-4\">\n              {order && (\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground lowercase\">pedido</p>\n                    <p className=\"text-xl font-bold\">{order.orderNumber}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground lowercase\">valor</p>\n                    <p className=\"text-xl font-bold\">{formatPrice(order.totalAmount)}</p>\n                  </div>\n                </div>\n              )}\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              {/* Poss√≠veis motivos */}\n              <div className=\"p-4 bg-red-500/5 rounded-lg border border-red-500/10\">\n                <p className=\"text-sm font-medium lowercase mb-2\">poss√≠veis motivos:</p>\n                <ul className=\"text-sm text-muted-foreground space-y-1 lowercase\">\n                  <li>‚Ä¢ cart√£o sem limite dispon√≠vel</li>\n                  <li>‚Ä¢ dados do cart√£o incorretos</li>\n                  <li>‚Ä¢ transa√ß√£o bloqueada pelo banco</li>\n                  <li>‚Ä¢ cart√£o vencido</li>\n                </ul>\n              </div>\n\n              {/* Sugest√µes */}\n              <div className=\"p-4 bg-muted/30 rounded-lg\">\n                <p className=\"text-sm font-medium lowercase mb-2\">o que voc√™ pode fazer:</p>\n                <ul className=\"text-sm text-muted-foreground space-y-1 lowercase\">\n                  <li>‚Ä¢ tente usar outro cart√£o ou forma de pagamento</li>\n                  <li>‚Ä¢ verifique se os dados est√£o corretos</li>\n                  <li>‚Ä¢ entre em contato com seu banco</li>\n                </ul>\n              </div>\n            </CardContent>\n          </Card>\n\n          {/* Bot√µes de a√ß√£o */}\n          <div className=\"flex flex-col gap-3\">\n            <Link href=\"/checkout\">\n              <Button className=\"w-full h-12 rounded-full\" data-testid=\"button-try-again\">\n                <RefreshCw className=\"w-4 h-4 mr-2\" />\n                <span className=\"lowercase\">tentar novamente</span>\n              </Button>\n            </Link>\n            \n            <Link href=\"/\">\n              <Button variant=\"outline\" className=\"w-full h-12 rounded-full\" data-testid=\"button-back-home\">\n                <Home className=\"w-4 h-4 mr-2\" />\n                <span className=\"lowercase\">voltar √† loja</span>\n              </Button>\n            </Link>\n          </div>\n\n          {/* Contato para ajuda */}\n          <div className=\"mt-8 p-4 bg-muted/20 rounded-xl text-center\">\n            <MessageCircle className=\"w-6 h-6 mx-auto mb-2 text-muted-foreground\" />\n            <p className=\"text-sm text-muted-foreground lowercase\">\n              precisa de ajuda? entre em contato conosco pelo whatsapp\n            </p>\n          </div>\n        </motion.div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6220,"size_tokens":null},"client/src/components/admin/AdminShipping.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Truck, Save, Calendar, MessageSquare } from \"lucide-react\";\n\nexport default function AdminShipping() {\n  const { toast } = useToast();\n  const [shippingValue, setShippingValue] = useState(\"\");\n  const [thresholdValue, setThresholdValue] = useState(\"200\");\n  const [minDays, setMinDays] = useState(\"9\");\n  const [maxDays, setMaxDays] = useState(\"15\");\n  const [ctaShippingFreeText, setCtaShippingFreeText] = useState(\"chegar√° gr√°tis\");\n  const [ctaShippingPaidText, setCtaShippingPaidText] = useState(\"chegar√° por\");\n  const [mochilaShippingFreeText, setMochilaShippingFreeText] = useState(\"entrega gr√°tis\");\n  const [mochilaShippingPaidText, setMochilaShippingPaidText] = useState(\"entrega por\");\n\n  const { data: shippingConfig, isLoading } = useQuery<{ system: string; threshold: string; shippingValue: string; shippingMinDays: string; shippingMaxDays: string }>({\n    queryKey: ['/api/settings/free_shipping'],\n  });\n\n  const { data: ctaConfig } = useQuery<{ ctaShippingFreeText: string; ctaShippingPaidText: string; mochilaShippingFreeText: string; mochilaShippingPaidText: string }>({\n    queryKey: ['/api/settings/cta'],\n  });\n\n  const { data: freeShippingSetting } = useQuery<{ value: string }>({\n    queryKey: ['/api/admin/settings/free_shipping_enabled'],\n  });\n\n  const freeShippingEnabled = freeShippingSetting?.value === \"true\";\n  const shippingSystem = shippingConfig?.system || \"threshold\";\n  const isThresholdSystem = shippingSystem === \"threshold\";\n\n  useEffect(() => {\n    if (shippingConfig?.shippingValue) {\n      setShippingValue(shippingConfig.shippingValue);\n    }\n    if (shippingConfig?.threshold) {\n      setThresholdValue(shippingConfig.threshold);\n    }\n    if (shippingConfig?.shippingMinDays) setMinDays(shippingConfig.shippingMinDays);\n    if (shippingConfig?.shippingMaxDays) setMaxDays(shippingConfig.shippingMaxDays);\n  }, [shippingConfig]);\n\n  useEffect(() => {\n    if (ctaConfig) {\n      if (ctaConfig.ctaShippingFreeText) setCtaShippingFreeText(ctaConfig.ctaShippingFreeText);\n      if (ctaConfig.ctaShippingPaidText) setCtaShippingPaidText(ctaConfig.ctaShippingPaidText);\n      if (ctaConfig.mochilaShippingFreeText) setMochilaShippingFreeText(ctaConfig.mochilaShippingFreeText);\n      if (ctaConfig.mochilaShippingPaidText) setMochilaShippingPaidText(ctaConfig.mochilaShippingPaidText);\n    }\n  }, [ctaConfig]);\n\n  const updateShippingMutation = useMutation({\n    mutationFn: async (value: string) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"default_shipping_value\",\n        value: value,\n        type: \"number\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"valor do frete atualizado\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/free_shipping'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao atualizar frete\", variant: \"destructive\" });\n    }\n  });\n\n  const updateThresholdMutation = useMutation({\n    mutationFn: async (value: string) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"free_shipping_threshold\",\n        value: value,\n        type: \"number\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"valor m√≠nimo atualizado\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/free_shipping'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao atualizar valor m√≠nimo\", variant: \"destructive\" });\n    }\n  });\n\n  const toggleFreeShippingMutation = useMutation({\n    mutationFn: async (enabled: boolean) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"free_shipping_enabled\",\n        value: enabled ? \"true\" : \"false\",\n        type: \"boolean\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"configura√ß√£o atualizada\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/settings/free_shipping_enabled'] });\n    }\n  });\n\n  const toggleShippingSystemMutation = useMutation({\n    mutationFn: async (system: \"threshold\" | \"all\") => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"free_shipping_system\",\n        value: system,\n        type: \"text\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"sistema de frete atualizado\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/free_shipping'] });\n    }\n  });\n\n  const updateMinDaysMutation = useMutation({\n    mutationFn: async (value: string) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"shipping_min_days\",\n        value: value,\n        type: \"number\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"prazo m√≠nimo atualizado\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/free_shipping'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao atualizar prazo\", variant: \"destructive\" });\n    }\n  });\n\n  const updateMaxDaysMutation = useMutation({\n    mutationFn: async (value: string) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key: \"shipping_max_days\",\n        value: value,\n        type: \"number\"\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"prazo m√°ximo atualizado\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/free_shipping'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao atualizar prazo\", variant: \"destructive\" });\n    }\n  });\n\n  const handleSaveDeadline = () => {\n    const min = parseInt(minDays);\n    const max = parseInt(maxDays);\n    if (isNaN(min) || isNaN(max) || min < 1 || max < 1 || min > max) {\n      toast({ title: \"prazos inv√°lidos. m√≠nimo deve ser menor que m√°ximo\", variant: \"destructive\" });\n      return;\n    }\n    updateMinDaysMutation.mutate(minDays);\n    updateMaxDaysMutation.mutate(maxDays);\n  };\n\n  const handleSaveShippingTexts = async () => {\n    try {\n      await Promise.all([\n        apiRequest(\"POST\", \"/api/admin/settings\", { key: \"cta_shipping_free_text\", value: ctaShippingFreeText, type: \"text\" }),\n        apiRequest(\"POST\", \"/api/admin/settings\", { key: \"cta_shipping_paid_text\", value: ctaShippingPaidText, type: \"text\" }),\n        apiRequest(\"POST\", \"/api/admin/settings\", { key: \"mochila_shipping_free_text\", value: mochilaShippingFreeText, type: \"text\" }),\n        apiRequest(\"POST\", \"/api/admin/settings\", { key: \"mochila_shipping_paid_text\", value: mochilaShippingPaidText, type: \"text\" }),\n      ]);\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/cta'] });\n      toast({ title: \"textos de frete atualizados\" });\n    } catch {\n      toast({ title: \"erro ao salvar textos\", variant: \"destructive\" });\n    }\n  };\n\n  const handleSaveShipping = () => {\n    if (!shippingValue || isNaN(parseFloat(shippingValue))) {\n      toast({ title: \"digite um valor v√°lido\", variant: \"destructive\" });\n      return;\n    }\n    updateShippingMutation.mutate(shippingValue);\n  };\n\n  const handleSaveThreshold = () => {\n    if (!thresholdValue || isNaN(parseFloat(thresholdValue))) {\n      toast({ title: \"digite um valor v√°lido\", variant: \"destructive\" });\n      return;\n    }\n    updateThresholdMutation.mutate(thresholdValue);\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-primary border-r-transparent\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <div className=\"flex items-center gap-3\">\n        <Truck className=\"h-6 w-6 opacity-60\" />\n        <div>\n          <h2 className=\"text-2xl font-light lowercase tracking-tight\">configura√ß√£o de frete</h2>\n          <p className=\"text-sm text-muted-foreground lowercase\">gerencie o frete do site</p>\n        </div>\n      </div>\n\n      <Card className=\"p-6\">\n        <div className=\"flex flex-col gap-6\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n                <Truck className=\"h-5 w-5 opacity-60\" />\n              </div>\n              <div>\n                <h3 className=\"text-lg font-medium lowercase\">sistema de frete gr√°tis</h3>\n                <p className=\"text-sm text-muted-foreground lowercase\">escolha como o frete gr√°tis √© concedido</p>\n              </div>\n            </div>\n            <div className=\"flex bg-muted/30 p-1 rounded-xl border border-border/30 shrink-0 w-full sm:w-auto\">\n              <Button\n                variant={isThresholdSystem ? \"default\" : \"ghost\"}\n                size=\"sm\"\n                className=\"rounded-lg lowercase h-8 text-xs px-3 flex-1 sm:flex-initial whitespace-nowrap\"\n                onClick={() => toggleShippingSystemMutation.mutate(\"threshold\")}\n                disabled={toggleShippingSystemMutation.isPending}\n              >\n                a partir de valor\n              </Button>\n              <Button\n                variant={!isThresholdSystem ? \"default\" : \"ghost\"}\n                size=\"sm\"\n                className=\"rounded-lg lowercase h-8 text-xs px-3 flex-1 sm:flex-initial whitespace-nowrap\"\n                onClick={() => toggleShippingSystemMutation.mutate(\"all\")}\n                disabled={toggleShippingSystemMutation.isPending}\n              >\n                gr√°tis para todos\n              </Button>\n            </div>\n          </div>\n\n          <div className=\"h-px bg-border/50 w-full\" />\n\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-sm font-medium lowercase\">exibir aviso na mochila</h3>\n              <p className=\"text-xs text-muted-foreground lowercase\">mostrar mensagem de frete gr√°tis/falta para atingir</p>\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <Label htmlFor=\"free-shipping-toggle\" className=\"text-xs uppercase tracking-tighter text-muted-foreground\">\n                {freeShippingEnabled ? \"ativo\" : \"inativo\"}\n              </Label>\n              <Switch\n                id=\"free-shipping-toggle\"\n                checked={freeShippingEnabled}\n                onCheckedChange={(checked) => toggleFreeShippingMutation.mutate(checked)}\n                disabled={toggleFreeShippingMutation.isPending}\n              />\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <h3 className=\"text-lg font-medium lowercase\">valor do frete</h3>\n        \n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium lowercase\">valor padr√£o do frete (R$)</Label>\n            <div className=\"flex gap-3\">\n              <div className=\"relative flex-1\">\n                <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">R$</span>\n                <Input\n                  type=\"number\"\n                  step=\"0.01\"\n                  min=\"0\"\n                  value={shippingValue}\n                  onChange={(e) => setShippingValue(e.target.value)}\n                  placeholder=\"19.99\"\n                  className=\"pl-10 h-12 text-lg\"\n                />\n              </div>\n              <Button \n                onClick={handleSaveShipping} \n                disabled={updateShippingMutation.isPending}\n                className=\"h-12 px-6\"\n              >\n                <Save className=\"h-4 w-4 mr-2\" />\n                {updateShippingMutation.isPending ? \"...\" : \"salvar\"}\n              </Button>\n            </div>\n            <p className=\"text-xs text-muted-foreground lowercase\">\n              este valor ser√° aplicado para todos os pedidos\n            </p>\n          </div>\n\n          {isThresholdSystem && (\n            <div className=\"space-y-2 pt-4 border-t border-border/50\">\n              <Label className=\"text-sm font-medium lowercase\">valor m√≠nimo para frete gr√°tis (R$)</Label>\n              <div className=\"flex gap-3\">\n                <div className=\"relative flex-1\">\n                  <span className=\"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground\">R$</span>\n                  <Input\n                    type=\"number\"\n                    step=\"1\"\n                    min=\"0\"\n                    value={thresholdValue}\n                    onChange={(e) => setThresholdValue(e.target.value)}\n                    placeholder=\"200\"\n                    className=\"pl-10 h-12 text-lg\"\n                  />\n                </div>\n                <Button \n                  onClick={handleSaveThreshold} \n                  disabled={updateThresholdMutation.isPending}\n                  className=\"h-12 px-6\"\n                >\n                  <Save className=\"h-4 w-4 mr-2\" />\n                  {updateThresholdMutation.isPending ? \"...\" : \"salvar\"}\n                </Button>\n              </div>\n              <p className=\"text-xs text-muted-foreground lowercase\">\n                compras acima deste valor ter√£o frete gr√°tis\n              </p>\n            </div>\n          )}\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <div className=\"bg-muted/30 rounded-xl p-4\">\n            <div className=\"flex justify-between text-sm\">\n              <span className=\"text-muted-foreground\">valor do frete:</span>\n              <span className=\"font-medium\">R$ {parseFloat(shippingValue || \"0\").toFixed(2)}</span>\n            </div>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <Calendar className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">prazo de entrega</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">configure o prazo em dias √∫teis</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"flex gap-4\">\n            <div className=\"space-y-2 flex-1\">\n              <Label className=\"text-sm font-medium lowercase\">m√≠nimo (dias √∫teis)</Label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                value={minDays}\n                onChange={(e) => setMinDays(e.target.value)}\n                placeholder=\"9\"\n                className=\"h-12 text-lg\"\n              />\n            </div>\n            <div className=\"space-y-2 flex-1\">\n              <Label className=\"text-sm font-medium lowercase\">m√°ximo (dias √∫teis)</Label>\n              <Input\n                type=\"number\"\n                min=\"1\"\n                value={maxDays}\n                onChange={(e) => setMaxDays(e.target.value)}\n                placeholder=\"15\"\n                className=\"h-12 text-lg\"\n              />\n            </div>\n          </div>\n          \n          <Button\n            onClick={handleSaveDeadline}\n            disabled={updateMinDaysMutation.isPending || updateMaxDaysMutation.isPending}\n            className=\"w-full h-12\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            {(updateMinDaysMutation.isPending || updateMaxDaysMutation.isPending) ? \"...\" : \"salvar prazo\"}\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <div className=\"bg-muted/30 rounded-xl p-4 space-y-1\">\n            <p className=\"text-xs text-muted-foreground lowercase\">pr√©via do prazo</p>\n            <p className=\"text-sm lowercase\">\n              {(() => {\n                const min = parseInt(minDays) || 9;\n                const max = parseInt(maxDays) || 15;\n                const addBizDays = (d: Date, n: number) => {\n                  const r = new Date(d);\n                  let a = 0;\n                  while (a < n) { r.setDate(r.getDate() + 1); if (r.getDay() !== 0 && r.getDay() !== 6) a++; }\n                  return r;\n                };\n                const today = new Date();\n                const dMin = addBizDays(today, min);\n                const dMax = addBizDays(today, max);\n                const fmt = (d: Date) => `${d.getDate().toString().padStart(2,'0')}/${(d.getMonth()+1).toString().padStart(2,'0')}`;\n                return `entrega entre ${fmt(dMin)} a ${fmt(dMax)}`;\n              })()}\n            </p>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <MessageSquare className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">textos de frete</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">personalize as mensagens exibidas no produto e na mochila</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-5\">\n          <div className=\"space-y-3\">\n            <p className=\"text-xs uppercase tracking-widest text-muted-foreground font-bold\">p√°gina do produto</p>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium lowercase\">frete gr√°tis</Label>\n                <Input\n                  value={ctaShippingFreeText}\n                  onChange={(e) => setCtaShippingFreeText(e.target.value)}\n                  placeholder=\"chegar√° gr√°tis\"\n                  className=\"h-12 text-base lowercase\"\n                  data-testid=\"input-cta-shipping-free\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium lowercase\">frete pago</Label>\n                <Input\n                  value={ctaShippingPaidText}\n                  onChange={(e) => setCtaShippingPaidText(e.target.value)}\n                  placeholder=\"chegar√° por\"\n                  className=\"h-12 text-base lowercase\"\n                  data-testid=\"input-cta-shipping-paid\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"space-y-3\">\n            <p className=\"text-xs uppercase tracking-widest text-muted-foreground font-bold\">mochila (carrinho)</p>\n            <div className=\"grid grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium lowercase\">frete gr√°tis</Label>\n                <Input\n                  value={mochilaShippingFreeText}\n                  onChange={(e) => setMochilaShippingFreeText(e.target.value)}\n                  placeholder=\"entrega gr√°tis\"\n                  className=\"h-12 text-base lowercase\"\n                  data-testid=\"input-mochila-shipping-free\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label className=\"text-sm font-medium lowercase\">frete pago</Label>\n                <Input\n                  value={mochilaShippingPaidText}\n                  onChange={(e) => setMochilaShippingPaidText(e.target.value)}\n                  placeholder=\"entrega por\"\n                  className=\"h-12 text-base lowercase\"\n                  data-testid=\"input-mochila-shipping-paid\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <Button\n            onClick={handleSaveShippingTexts}\n            className=\"w-full h-12\"\n            data-testid=\"button-save-shipping-texts\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            salvar textos\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50 space-y-3\">\n          <p className=\"text-xs text-muted-foreground lowercase\">pr√©via</p>\n          <div className=\"bg-[#1d1d1f] rounded-2xl p-4 space-y-2\">\n            <p className=\"text-[10px] uppercase tracking-widest text-white/40 font-bold\">produto</p>\n            <p className=\"text-[13px] text-white/80 font-light\">{ctaShippingFreeText} entre 26/02 a 06/03</p>\n            <p className=\"text-[13px] text-white/80 font-light\">{ctaShippingPaidText} R$ 19,90 entre 26/02 a 06/03</p>\n          </div>\n          <div className=\"bg-muted/30 rounded-xl p-4 space-y-2\">\n            <p className=\"text-[10px] uppercase tracking-widest text-muted-foreground font-bold\">mochila</p>\n            <p className=\"text-sm lowercase\">{mochilaShippingFreeText} entre 26/02 a 06/03</p>\n            <p className=\"text-sm lowercase\">{mochilaShippingPaidText} R$ 19,90 entre 26/02 a 06/03</p>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":21146,"size_tokens":null},"client/src/components/AppleMenu.tsx":{"content":"import { Heart, Trash2, MapPin, ChevronRight, Search, X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useFavoritos } from \"@/contexts/FavoritosContext\";\nimport { motion, AnimatePresence } from \"framer-motion\";\nimport { useLocation } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Product } from \"@shared/schema\";\nimport ThemeToggle from \"./ThemeToggle\";\nimport { useState } from \"react\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface ProductWithImages extends Product {\n  images?: string[];\n}\n\ninterface AppleMenuProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport default function AppleMenu({ isOpen, onClose }: AppleMenuProps) {\n  const { favoritos, toggleFavorito } = useFavoritos();\n  const [, setLocation] = useLocation();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n\n  const { data: productsData } = useQuery<{ products: ProductWithImages[] }>({\n    queryKey: ['/api/products'],\n    enabled: isOpen && favoritos.length > 0,\n  });\n\n  const favoritoProducts = productsData?.products?.filter((p) => favoritos.includes(p.id)) || [];\n\n  const handleSearch = (e: React.FormEvent) => {\n    e.preventDefault();\n    if (searchQuery.trim()) {\n      onClose();\n      // Use window.location.href or similar to ensure the search param is updated if already on the products page\n      const searchUrl = `/produtos?q=${encodeURIComponent(searchQuery.trim())}`;\n      setLocation(searchUrl);\n    }\n  };\n\n  const formatPrice = (value: string | number) => {\n    const numValue = typeof value === 'string' ? parseFloat(value) : value;\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(numValue);\n  };\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <>\n          {/* Backdrop */}\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            onClick={onClose}\n            className=\"fixed inset-0 bg-black/20 backdrop-blur-sm z-[60]\"\n            data-testid=\"backdrop-apple-menu\"\n          />\n\n          {/* Menu Panel - Popup Style */}\n          <motion.div\n            initial={{ x: \"-100%\", opacity: 0 }}\n            animate={{ x: 0, opacity: 1 }}\n            exit={{ x: \"-100%\", opacity: 0 }}\n            drag=\"x\"\n            dragConstraints={{ left: 0, right: 0 }}\n            dragElastic={{ left: 0.8, right: 0.1 }}\n            onDragEnd={(_, info) => {\n              if (info.offset.x < -100) {\n                onClose();\n              }\n            }}\n            transition={{ type: \"spring\", damping: 30, stiffness: 300 }}\n            className=\"fixed left-4 top-4 bottom-4 w-[calc(100%-2rem)] max-w-md bg-background/95 backdrop-blur-xl z-[61] shadow-2xl rounded-[2.5rem] overflow-hidden flex flex-col border border-white/10 touch-none\"\n            data-testid=\"apple-menu-panel\"\n          >\n            {/* Header / Close handle */}\n            <div className=\"flex items-center justify-center pt-4 pb-2 shrink-0\">\n              <div className=\"w-12 h-1.5 bg-muted rounded-full\" />\n            </div>\n\n            <div className=\"flex-1 overflow-y-auto px-6 py-4 custom-scrollbar\">\n              <div className=\"space-y-10 pb-20\">\n                {/* Favoritos Section */}\n                <div className=\"space-y-6\">\n                  <div className=\"flex items-center justify-between px-2\">\n                    <h2 className=\"text-2xl font-semibold tracking-tight lowercase\">lista de desejos</h2>\n                    <Button \n                      variant=\"ghost\" \n                      size=\"icon\" \n                      className=\"h-10 w-10 rounded-full bg-muted/20 hover:bg-muted/40 transition-colors\"\n                      onClick={onClose}\n                    >\n                      <X className=\"h-5 w-5\" />\n                    </Button>\n                  </div>\n\n                  <div className=\"space-y-3\">\n                    {favoritoProducts.length === 0 ? (\n                      <div className=\"py-10 flex flex-col items-center justify-center rounded-[2rem] bg-muted/20 border border-dashed border-muted\">\n                        <Heart className=\"h-6 w-6 text-muted-foreground/30 mb-2\" />\n                        <p className=\"text-xs text-muted-foreground lowercase\">lista de desejos vazia</p>\n                      </div>\n                    ) : (\n                      <div className=\"grid grid-cols-1 gap-3\">\n                        {favoritoProducts.map((product) => {\n                          const firstImage = product.images?.[0] || '/placeholder.jpg';\n                          return (\n                            <div\n                              key={product.id}\n                              className=\"group relative flex items-center gap-4 p-4 rounded-[2rem] bg-card hover:bg-muted/30 transition-all cursor-pointer border border-white/5 shadow-sm active:scale-[0.99]\"\n                              onClick={() => {\n                                onClose();\n                                setLocation(`/produto/${product.id}`);\n                              }}\n                            >\n                              <div className=\"relative shrink-0\">\n                                <img\n                                  src={firstImage}\n                                  alt={product.name}\n                                  className=\"w-20 h-20 object-cover rounded-2xl shadow-sm border border-white/5\"\n                                  loading=\"lazy\"\n                                  decoding=\"async\"\n                                />\n                              </div>\n                              <div className=\"flex-1 min-w-0 flex flex-col justify-center h-20\">\n                                <div className=\"space-y-1\">\n                                  <h3 className=\"font-semibold text-sm tracking-tight lowercase truncate opacity-90\">{product.name}</h3>\n                                  <p className=\"text-xs text-muted-foreground/80 font-medium\">{formatPrice(product.price)}</p>\n                                </div>\n                                <div className=\"flex justify-end mt-auto\">\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    onClick={(e) => {\n                                      e.stopPropagation();\n                                      toggleFavorito(product.id);\n                                    }}\n                                    className=\"h-8 w-8 rounded-full bg-muted/20 hover:bg-destructive hover:text-white transition-all shadow-sm group/trash\"\n                                  >\n                                    <Trash2 className=\"h-4 w-4 text-muted-foreground group-hover/trash:text-white\" />\n                                  </Button>\n                                </div>\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* Search Section */}\n                <div className=\"space-y-4\">\n                  <h2 className=\"text-2xl font-semibold tracking-tight lowercase px-2\">pesquisar</h2>\n                  <form onSubmit={handleSearch} className=\"px-2\">\n                    <div className=\"relative\">\n                      <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground\" />\n                      <Input\n                        type=\"text\"\n                        placeholder=\"o que voc√™ procura?\"\n                        value={searchQuery}\n                        onChange={(e) => setSearchQuery(e.target.value)}\n                        className=\"h-14 pl-12 pr-4 rounded-2xl bg-muted/20 border-transparent focus-visible:ring-1 focus-visible:ring-primary/20 placeholder:text-muted-foreground/50 lowercase\"\n                      />\n                    </div>\n                  </form>\n                </div>\n\n                {/* Services Section */}\n                <div className=\"space-y-6\">\n                  <h2 className=\"text-2xl font-semibold tracking-tight lowercase px-2\">servi√ßos</h2>\n                  <div className=\"grid grid-cols-1 gap-3\">\n                    <Button\n                      variant=\"ghost\"\n                      className=\"h-auto py-5 px-6 rounded-[2rem] bg-muted/20 hover:bg-muted/40 justify-start gap-4 text-base font-medium lowercase transition-all active:scale-[0.98]\"\n                      onClick={() => {\n                        onClose();\n                        setLocation('/rastreio');\n                      }}\n                    >\n                      <div className=\"p-2.5 rounded-2xl bg-primary/10 text-primary\">\n                        <MapPin className=\"h-5 w-5\" />\n                      </div>\n                      rastrear pedido\n                    </Button>\n\n                    <div \n                      className=\"flex items-center justify-between py-4 px-6 rounded-[2rem] bg-muted/20 border border-transparent cursor-pointer hover:bg-muted/30 transition-colors active:scale-[0.98]\"\n                      onClick={() => {\n                        const event = new CustomEvent('toggle-theme');\n                        window.dispatchEvent(event);\n                      }}\n                    >\n                      <span className=\"text-base font-medium lowercase\">apar√™ncia</span>\n                      <ThemeToggle />\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            {/* Bottom Section */}\n            <div className=\"p-6 pb-8 shrink-0 bg-gradient-to-t from-background to-transparent\" />\n          </motion.div>\n        </>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":9922,"size_tokens":null},"client/src/components/admin/AdminProductReviews.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useMutation, useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Upload, Trash2, Star, Plus, X, Pencil, ChevronUp, ChevronDown } from \"lucide-react\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\n\ninterface AdminProductReviewsProps {\n  productId: string;\n  onRatingUpdate?: (newRating: number) => void;\n}\n\ninterface Review {\n  id: string;\n  productId: string;\n  userName: string;\n  userCity?: string;\n  userImage?: string;\n  rating: number;\n  comment: string;\n  reviewImage?: string;\n  sortOrder?: number;\n  createdAt: string;\n}\n\nexport default function AdminProductReviews({ product, onRatingUpdate }: { product: any, onRatingUpdate?: (newRating: number) => void }) {\n  const productId = product.id;\n  const { toast } = useToast();\n  const [showForm, setShowForm] = useState(false);\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [formData, setFormData] = useState({\n    userName: \"\",\n    userCity: \"\",\n    userImage: \"\",\n    rating: \"5\",\n    comment: \"\",\n    reviewImage: \"\",\n  });\n  const userImageInputRef = useRef<HTMLInputElement>(null);\n  const reviewImageInputRef = useRef<HTMLInputElement>(null);\n  const [userImagePreview, setUserImagePreview] = useState<string>(\"\");\n  const [reviewImagePreview, setReviewImagePreview] = useState<string>(\"\");\n  const [uploadingUserImage, setUploadingUserImage] = useState(false);\n  const [uploadingReviewImage, setUploadingReviewImage] = useState(false);\n\n  const { data: reviewsData } = useQuery<{ reviews: Review[] }>({\n    queryKey: ['/api/admin/products', productId, 'reviews'],\n    enabled: !!productId,\n  });\n\n  const reviews = reviewsData?.reviews || [];\n  const averageRating = reviews.length > 0\n    ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)\n    : \"0.0\";\n\n  const createMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", `/api/admin/products/${productId}/reviews`, formData);\n      if (!response.ok) throw new Error(\"erro ao criar avalia√ß√£o\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'reviews'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/products', productId] });\n      resetForm();\n      toast({\n        title: \"avalia√ß√£o criada\",\n        description: \"a avalia√ß√£o foi adicionada com sucesso.\",\n      });\n      if (onRatingUpdate) {\n        onRatingUpdate(parseFloat(averageRating));\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel criar a avalia√ß√£o.\",\n      });\n    },\n  });\n\n  const updateMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/products/${productId}/reviews/${editingId}`, formData);\n      if (!response.ok) throw new Error(\"erro ao atualizar avalia√ß√£o\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'reviews'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/products', productId] });\n      resetForm();\n      toast({\n        title: \"avalia√ß√£o atualizada\",\n        description: \"a avalia√ß√£o foi modificada com sucesso.\",\n      });\n      if (onRatingUpdate) {\n        onRatingUpdate(parseFloat(averageRating));\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel atualizar a avalia√ß√£o.\",\n      });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/admin/products/${productId}/reviews/${id}`);\n      if (!response.ok) throw new Error(\"erro ao deletar avalia√ß√£o\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'reviews'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/products', productId] });\n      toast({\n        title: \"avalia√ß√£o removida\",\n        description: \"a avalia√ß√£o foi deletada com sucesso.\",\n      });\n      if (onRatingUpdate) {\n        onRatingUpdate(parseFloat(averageRating));\n      }\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"n√£o foi poss√≠vel deletar a avalia√ß√£o.\",\n      });\n    },\n  });\n\n  const reorderMutation = useMutation({\n    mutationFn: async ({ reviewId, sortOrder }: { reviewId: string; sortOrder: number }) => {\n      const response = await apiRequest(\"PATCH\", `/api/admin/products/${productId}/reviews/${reviewId}/reorder`, { sortOrder });\n      if (!response.ok) throw new Error(\"erro ao reordenar\");\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/products', productId, 'reviews'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/products', productId] });\n    },\n  });\n\n  const handleMoveUp = (index: number) => {\n    if (index === 0) return;\n    const current = reviews[index];\n    const above = reviews[index - 1];\n    const currentOrder = current.sortOrder ?? index;\n    const aboveOrder = above.sortOrder ?? (index - 1);\n    reorderMutation.mutate({ reviewId: current.id, sortOrder: aboveOrder });\n    reorderMutation.mutate({ reviewId: above.id, sortOrder: currentOrder });\n  };\n\n  const handleMoveDown = (index: number) => {\n    if (index >= reviews.length - 1) return;\n    const current = reviews[index];\n    const below = reviews[index + 1];\n    const currentOrder = current.sortOrder ?? index;\n    const belowOrder = below.sortOrder ?? (index + 1);\n    reorderMutation.mutate({ reviewId: current.id, sortOrder: belowOrder });\n    reorderMutation.mutate({ reviewId: below.id, sortOrder: currentOrder });\n  };\n\n  const resetForm = () => {\n    setFormData({\n      userName: \"\",\n      userCity: \"\",\n      userImage: \"\",\n      rating: \"5\",\n      comment: \"\",\n      reviewImage: \"\",\n    });\n    setEditingId(null);\n    setShowForm(false);\n  };\n\n  const handleEdit = (review: Review) => {\n    setFormData({\n      userName: review.userName,\n      userCity: review.userCity || \"\",\n      userImage: review.userImage || \"\",\n      rating: review.rating.toString(),\n      comment: review.comment,\n      reviewImage: review.reviewImage || \"\",\n    });\n    setUserImagePreview(review.userImage || \"\");\n    setReviewImagePreview(review.reviewImage || \"\");\n    setEditingId(review.id);\n    setShowForm(true);\n  };\n\n  const handleUserImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    setUploadingUserImage(true);\n    try {\n      const formData = new FormData();\n      formData.append('image', file);\n      \n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      if (sessionId) headers['x-session-id'] = sessionId;\n      \n      const response = await fetch('/api/admin/reviews/upload-user-image', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include',\n        headers,\n      });\n      \n      if (!response.ok) throw new Error(\"erro ao fazer upload\");\n      const data = await response.json();\n      setFormData(prev => ({ ...prev, userImage: data.userImage }));\n      setUserImagePreview(data.userImage);\n      toast({ title: \"sucesso\", description: \"imagem de perfil enviada\" });\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"erro\", description: \"n√£o foi poss√≠vel enviar a imagem\" });\n    } finally {\n      setUploadingUserImage(false);\n    }\n  };\n\n  const handleReviewImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    \n    setUploadingReviewImage(true);\n    try {\n      const formData = new FormData();\n      formData.append('image', file);\n      \n      const sessionId = localStorage.getItem('admin_session');\n      const headers: Record<string, string> = {};\n      if (sessionId) headers['x-session-id'] = sessionId;\n      \n      const response = await fetch('/api/admin/reviews/upload-review-image', {\n        method: 'POST',\n        body: formData,\n        credentials: 'include',\n        headers,\n      });\n      \n      if (!response.ok) throw new Error(\"erro ao fazer upload\");\n      const data = await response.json();\n      setFormData(prev => ({ ...prev, reviewImage: data.reviewImage }));\n      setReviewImagePreview(data.reviewImage);\n      toast({ title: \"sucesso\", description: \"imagem da avalia√ß√£o enviada\" });\n    } catch (error) {\n      toast({ variant: \"destructive\", title: \"erro\", description: \"n√£o foi poss√≠vel enviar a imagem\" });\n    } finally {\n      setUploadingReviewImage(false);\n    }\n  };\n\n  const handleSubmit = async () => {\n    if (!formData.userName || !formData.comment) {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: \"preencha nome e coment√°rio.\",\n      });\n      return;\n    }\n\n    if (editingId) {\n      updateMutation.mutate();\n    } else {\n      createMutation.mutate();\n    }\n  };\n\n  return (\n    <div className=\"space-y-4\">\n      <div className=\"flex flex-col sm:flex-row sm:items-center justify-between bg-muted/20 p-4 rounded-2xl border border-border/40 gap-4\">\n        <div className=\"flex items-center gap-6\">\n          <div className=\"flex flex-col shrink-0\">\n            <span className=\"text-[11px] font-medium lowercase text-muted-foreground ml-0.5\">m√©dia</span>\n            <div className=\"flex items-center gap-1.5\">\n              <span className=\"text-2xl font-semibold tracking-tight leading-none\">{averageRating}</span>\n              <div className=\"flex items-center -space-x-0.5\">\n                {[...Array(5)].map((_, i) => (\n                  <Star\n                    key={i}\n                    className={`h-3 w-3 ${\n                      i < Math.round(parseFloat(averageRating))\n                        ? \"fill-current text-amber-400\"\n                        : \"text-muted-foreground/30\"\n                    }`}\n                  />\n                ))}\n              </div>\n            </div>\n          </div>\n          \n          <div className=\"h-8 w-px bg-border/40 shrink-0\" />\n          \n          <div className=\"flex flex-col shrink-0\">\n            <span className=\"text-[11px] font-medium lowercase text-muted-foreground ml-0.5\">total</span>\n            <span className=\"text-lg font-medium leading-none mt-1\">{reviews.length} <span className=\"text-[10px] text-muted-foreground font-normal\">avalia√ß√µes</span></span>\n          </div>\n        </div>\n\n        <Button\n          type=\"button\"\n          onClick={() => {\n            resetForm();\n            setShowForm(true);\n          }}\n          size=\"sm\"\n          variant=\"secondary\"\n          className=\"h-9 px-4 rounded-xl hover-elevate lowercase text-[11px] font-medium gap-2 w-full sm:w-auto\"\n          data-testid=\"button-add-review\"\n        >\n          <Plus className=\"h-3.5 w-3.5\" />\n          nova avalia√ß√£o\n        </Button>\n      </div>\n\n      {showForm && !editingId && (\n        <div className=\"rounded-2xl bg-muted/30 dark:bg-muted/15 overflow-hidden\">\n          <div className=\"px-5 pt-5 pb-3 flex items-center justify-between\">\n            <p className=\"text-[13px] font-semibold lowercase tracking-tight\">nova avalia√ß√£o</p>\n            <Button type=\"button\" variant=\"ghost\" size=\"icon\" onClick={resetForm} className=\"h-7 w-7 rounded-full\">\n              <X className=\"h-3.5 w-3.5\" />\n            </Button>\n          </div>\n\n          <div className=\"px-5 pb-2\">\n            <div className=\"flex items-center gap-4\">\n              <div\n                onClick={() => userImageInputRef.current?.click()}\n                className=\"relative cursor-pointer group\"\n              >\n                <Avatar className=\"h-14 w-14 ring-2 ring-border/20 group-hover:ring-primary/40 transition-all\">\n                  {userImagePreview ? (\n                    <AvatarImage src={userImagePreview} />\n                  ) : null}\n                  <AvatarFallback className=\"bg-muted/50 text-muted-foreground/40\">\n                    <Upload className=\"h-4 w-4\" />\n                  </AvatarFallback>\n                </Avatar>\n                {userImagePreview && (\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.stopPropagation();\n                      setFormData(prev => ({ ...prev, userImage: \"\" }));\n                      setUserImagePreview(\"\");\n                    }}\n                    className=\"absolute -top-1 -right-1 bg-destructive text-white rounded-full p-0.5 shadow-sm\"\n                  >\n                    <X className=\"h-2.5 w-2.5\" />\n                  </button>\n                )}\n                {uploadingUserImage && (\n                  <div className=\"absolute inset-0 flex items-center justify-center bg-black/30 rounded-full\">\n                    <div className=\"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin\" />\n                  </div>\n                )}\n              </div>\n              <input ref={userImageInputRef} type=\"file\" accept=\"image/*\" onChange={handleUserImageUpload} className=\"hidden\" data-testid=\"input-user-image-upload\" />\n              <div className=\"flex-1 space-y-1\">\n                <Input\n                  value={formData.userName}\n                  onChange={(e) => setFormData({ ...formData, userName: e.target.value })}\n                  placeholder=\"nome do cliente\"\n                  className=\"border-0 bg-transparent shadow-none px-0 text-[15px] font-medium lowercase focus-visible:ring-0 placeholder:text-muted-foreground/30 h-8\"\n                  data-testid=\"input-review-name\"\n                />\n                <Input\n                  value={formData.userCity}\n                  onChange={(e) => setFormData({ ...formData, userCity: e.target.value })}\n                  placeholder=\"cidade, estado\"\n                  className=\"border-0 bg-transparent shadow-none px-0 text-[12px] text-muted-foreground lowercase focus-visible:ring-0 placeholder:text-muted-foreground/25 h-6\"\n                  data-testid=\"input-review-city\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <div className=\"px-5 py-3\">\n            <div className=\"flex items-center gap-1\" data-testid=\"select-review-rating\">\n              {[1, 2, 3, 4, 5].map((num) => (\n                <button\n                  key={num}\n                  type=\"button\"\n                  onClick={() => setFormData({ ...formData, rating: num.toString() })}\n                  className=\"p-0.5 transition-transform hover:scale-110 active:scale-95\"\n                >\n                  <Star\n                    className={`h-5 w-5 transition-colors ${\n                      num <= parseInt(formData.rating)\n                        ? \"fill-current text-amber-400\"\n                        : \"text-muted-foreground/20 hover:text-amber-400/40\"\n                    }`}\n                  />\n                </button>\n              ))}\n            </div>\n          </div>\n\n          <div className=\"h-px bg-border/20 mx-5\" />\n\n          <div className=\"p-5\">\n            <Textarea\n              value={formData.comment}\n              onChange={(e) => setFormData({ ...formData, comment: e.target.value })}\n              placeholder=\"escreva o coment√°rio da avalia√ß√£o...\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase resize-none min-h-[80px] focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"textarea-review-comment\"\n            />\n          </div>\n\n          <div className=\"h-px bg-border/20 mx-5\" />\n\n          <div className=\"p-5\">\n            {reviewImagePreview ? (\n              <div className=\"relative inline-block\">\n                <img src={reviewImagePreview} alt=\"preview\" className=\"h-24 w-auto rounded-xl object-cover ring-1 ring-border/20\" loading=\"lazy\" decoding=\"async\" />\n                <button\n                  type=\"button\"\n                  onClick={() => {\n                    setFormData(prev => ({ ...prev, reviewImage: \"\" }));\n                    setReviewImagePreview(\"\");\n                  }}\n                  className=\"absolute -top-1.5 -right-1.5 bg-destructive text-white rounded-full p-0.5 shadow-sm\"\n                >\n                  <X className=\"h-3 w-3\" />\n                </button>\n              </div>\n            ) : (\n              <button\n                type=\"button\"\n                onClick={() => reviewImageInputRef.current?.click()}\n                className=\"flex items-center gap-2 text-[12px] text-muted-foreground/50 hover:text-muted-foreground transition-colors lowercase\"\n              >\n                <Upload className=\"h-3.5 w-3.5\" />\n                adicionar foto da avalia√ß√£o\n              </button>\n            )}\n            <input ref={reviewImageInputRef} type=\"file\" accept=\"image/*\" onChange={handleReviewImageUpload} className=\"hidden\" data-testid=\"input-review-image-upload\" />\n            {uploadingReviewImage && (\n              <p className=\"text-[11px] text-muted-foreground/40 mt-1 lowercase\">enviando...</p>\n            )}\n          </div>\n\n          <div className=\"px-5 pb-5 flex gap-2\">\n            <Button\n              type=\"button\"\n              onClick={handleSubmit}\n              disabled={createMutation.isPending}\n              className=\"flex-1 rounded-xl lowercase\"\n              data-testid=\"button-save-review\"\n            >\n              {createMutation.isPending ? \"salvando...\" : \"publicar avalia√ß√£o\"}\n            </Button>\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={resetForm}\n              className=\"rounded-xl lowercase\"\n              data-testid=\"button-cancel-review\"\n            >\n              cancelar\n            </Button>\n          </div>\n        </div>\n      )}\n\n      <div className=\"space-y-2\">\n        {reviews.map((review, index) => (\n          <div key={review.id}>\n            {editingId === review.id ? (\n              <Card className=\"border-primary/20 bg-primary/[0.02]\">\n                <CardHeader className=\"pb-3\">\n                  <CardTitle className=\"text-sm font-medium lowercase\">editar avalia√ß√£o</CardTitle>\n                </CardHeader>\n                <CardContent className=\"space-y-4\">\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <div className=\"space-y-1.5\">\n                      <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">nome do usu√°rio</label>\n                      <Input\n                        value={formData.userName}\n                        onChange={(e) => setFormData({ ...formData, userName: e.target.value })}\n                        placeholder=\"ex: Jo√£o Silva\"\n                        className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary h-10 px-4 rounded-xl text-sm\"\n                        data-testid=\"input-review-name\"\n                      />\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">cidade/estado</label>\n                      <Input\n                        value={formData.userCity}\n                        onChange={(e) => setFormData({ ...formData, userCity: e.target.value })}\n                        placeholder=\"ex: Maring√°/PR\"\n                        className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary h-10 px-4 rounded-xl text-sm\"\n                        data-testid=\"input-review-city\"\n                      />\n                    </div>\n                  </div>\n\n                  <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4\">\n                    <div className=\"space-y-1.5\">\n                      <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">estrelas</label>\n                      <Select value={formData.rating} onValueChange={(val) => setFormData({ ...formData, rating: val })}>\n                        <SelectTrigger className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary h-10 px-4 rounded-xl text-sm\" data-testid=\"select-review-rating\">\n                          <SelectValue />\n                        </SelectTrigger>\n                        <SelectContent>\n                          {[1, 2, 3, 4, 5].map((num) => (\n                            <SelectItem key={num} value={num.toString()}>\n                              {num} estrela{num > 1 ? \"s\" : \"\"}\n                            </SelectItem>\n                          ))}\n                        </SelectContent>\n                      </Select>\n                    </div>\n\n                    <div className=\"space-y-1.5\">\n                      <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">foto do usu√°rio</label>\n                      <div className=\"flex gap-2\">\n                        <Input\n                          type=\"file\"\n                          accept=\"image/*\"\n                          onChange={handleUserImageUpload}\n                          disabled={uploadingUserImage}\n                          ref={userImageInputRef}\n                          className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary h-10 px-4 rounded-xl text-sm file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer\"\n                          data-testid=\"input-user-image-upload\"\n                        />\n                      </div>\n                      {userImagePreview && (\n                        <div className=\"mt-2 relative inline-block\">\n                          <img src={userImagePreview} alt=\"preview\" className=\"h-12 w-12 rounded-lg object-cover ring-1 ring-border\" loading=\"lazy\" decoding=\"async\" />\n                          <button\n                            type=\"button\"\n                            onClick={() => {\n                              setFormData(prev => ({ ...prev, userImage: \"\" }));\n                              setUserImagePreview(\"\");\n                            }}\n                            className=\"absolute -top-2 -right-2 bg-destructive text-white rounded-full p-1 shadow-sm\"\n                          >\n                            <X className=\"h-3 w-3\" />\n                          </button>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"space-y-1.5\">\n                    <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">coment√°rio</label>\n                    <Textarea\n                      value={formData.comment}\n                      onChange={(e) => setFormData({ ...formData, comment: e.target.value })}\n                      placeholder=\"O que voc√™ achou do produto?\"\n                      className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary min-h-[100px] px-4 py-3 rounded-xl text-sm resize-none\"\n                      data-testid=\"textarea-review-comment\"\n                    />\n                  </div>\n\n                  <div className=\"space-y-1.5\">\n                    <label className=\"text-[11px] font-medium lowercase text-muted-foreground ml-1\">imagem da avalia√ß√£o (opcional)</label>\n                    <div className=\"flex gap-2\">\n                      <Input\n                        type=\"file\"\n                        accept=\"image/*\"\n                        onChange={handleReviewImageUpload}\n                        disabled={uploadingReviewImage}\n                        ref={reviewImageInputRef}\n                        className=\"bg-background border-none ring-1 ring-border focus-visible:ring-2 focus-visible:ring-primary h-10 px-4 rounded-xl text-sm file:mr-4 file:py-1 file:px-4 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer\"\n                        data-testid=\"input-review-image-upload\"\n                      />\n                    </div>\n                    {reviewImagePreview && (\n                      <div className=\"mt-2 relative inline-block\">\n                        <img src={reviewImagePreview} alt=\"preview\" className=\"h-16 w-24 rounded-lg object-cover ring-1 ring-border\" loading=\"lazy\" decoding=\"async\" />\n                        <button\n                          type=\"button\"\n                          onClick={() => {\n                            setFormData(prev => ({ ...prev, reviewImage: \"\" }));\n                            setReviewImagePreview(\"\");\n                          }}\n                          className=\"absolute -top-2 -right-2 bg-destructive text-white rounded-full p-1 shadow-sm\"\n                        >\n                          <X className=\"h-3 w-3\" />\n                        </button>\n                      </div>\n                    )}\n                  </div>\n\n                  <div className=\"flex gap-2 pt-2\">\n                    <Button \n                      type=\"button\" \n                      onClick={handleSubmit} \n                      disabled={updateMutation.isPending} \n                      className=\"h-10 px-6 rounded-xl hover-elevate lowercase text-[11px] font-medium\"\n                      data-testid=\"button-save-review\"\n                    >\n                      {updateMutation.isPending ? \"salvando...\" : \"salvar altera√ß√µes\"}\n                    </Button>\n                    <Button \n                      type=\"button\" \n                      variant=\"outline\" \n                      onClick={resetForm} \n                      className=\"h-10 px-6 rounded-xl hover-elevate lowercase text-[11px] font-medium\"\n                      data-testid=\"button-cancel-review\"\n                    >\n                      cancelar\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              <Card data-testid={`card-review-${review.id}`} className=\"hover:bg-muted/5 transition-colors border-border/40\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex gap-4\">\n                    <Avatar className=\"h-10 w-10 flex-shrink-0 ring-1 ring-border/20\">\n                      {review.userImage && <AvatarImage src={review.userImage} />}\n                      <AvatarFallback className=\"bg-muted text-xs font-medium\">{review.userName[0]?.toUpperCase()}</AvatarFallback>\n                    </Avatar>\n\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1\">\n                          <p className=\"font-medium text-sm lowercase\" data-testid={`text-review-name-${review.id}`}>\n                            {review.userName}\n                          </p>\n                          {review.userCity && (\n                            <p className=\"text-[10px] text-muted-foreground lowercase\">\n                              {review.userCity}\n                            </p>\n                          )}\n                          <div className=\"flex items-center gap-1 mt-1\">\n                            {[...Array(5)].map((_, i) => (\n                              <Star\n                                key={i}\n                                className={`h-3 w-3 ${\n                                  i < review.rating ? \"fill-current text-amber-400\" : \"text-muted-foreground/30\"\n                                }`}\n                              />\n                            ))}\n                          </div>\n                        </div>\n                        <div className=\"flex gap-1\">\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleMoveUp(index)}\n                            disabled={index === 0 || reorderMutation.isPending}\n                            className=\"opacity-50 hover:opacity-100 disabled:opacity-20\"\n                            data-testid={`button-move-up-review-${review.id}`}\n                          >\n                            <ChevronUp className=\"h-3.5 w-3.5\" />\n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleMoveDown(index)}\n                            disabled={index >= reviews.length - 1 || reorderMutation.isPending}\n                            className=\"opacity-50 hover:opacity-100 disabled:opacity-20\"\n                            data-testid={`button-move-down-review-${review.id}`}\n                          >\n                            <ChevronDown className=\"h-3.5 w-3.5\" />\n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => handleEdit(review)}\n                            data-testid={`button-edit-review-${review.id}`}\n                          >\n                            <Pencil className=\"h-3.5 w-3.5\" />\n                          </Button>\n                          <Button\n                            type=\"button\"\n                            variant=\"ghost\"\n                            size=\"icon\"\n                            onClick={() => deleteMutation.mutate(review.id)}\n                            disabled={deleteMutation.isPending}\n                            data-testid={`button-delete-review-${review.id}`}\n                          >\n                            <Trash2 className=\"h-3.5 w-3.5\" />\n                          </Button>\n                        </div>\n                      </div>\n\n                      <p className=\"text-sm text-muted-foreground mt-2 leading-relaxed\" data-testid={`text-review-comment-${review.id}`}>\n                        {review.comment}\n                      </p>\n\n                      {review.reviewImage && (\n                        <div className=\"mt-3 overflow-hidden rounded-xl border border-border/20\">\n                          <img\n                            src={review.reviewImage}\n                            alt=\"avalia√ß√£o\"\n                            className=\"max-h-48 w-auto object-cover\"\n                            data-testid={`img-review-photo-${review.id}`}\n                            loading=\"lazy\"\n                            decoding=\"async\"\n                          />\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":32109,"size_tokens":null},"client/src/pages/PaymentPending.tsx":{"content":"/**\n * P√°gina de Pagamento Pendente\n * \n * Exibida quando o pagamento ainda est√° sendo processado (PIX, Boleto, etc).\n * Orienta o cliente sobre como finalizar o pagamento.\n */\n\nimport { useEffect, useState } from \"react\";\nimport { useLocation, Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader } from \"@/components/ui/card\";\nimport { Clock, Home, RefreshCw, Download } from \"lucide-react\";\nimport { motion } from \"framer-motion\";\n\ninterface OrderData {\n  orderNumber: string;\n  customerEmail: string;\n  totalAmount: string;\n  paymentStatus: string;\n  orderStatus: string;\n}\n\nexport default function PaymentPending() {\n  const [location] = useLocation();\n  const [orderNumber, setOrderNumber] = useState<string | null>(null);\n\n  // Extrai o n√∫mero do pedido da URL\n  useEffect(() => {\n    localStorage.removeItem(\"oudla_pending_order\");\n    const params = new URLSearchParams(window.location.search);\n    const order = params.get(\"order\");\n    if (order) {\n      setOrderNumber(order);\n    }\n  }, [location]);\n\n  // Busca os dados do pedido\n  const { data: orderData, isLoading, refetch } = useQuery<{ success: boolean; order: OrderData }>({\n    queryKey: [\"/api/checkout/order\", orderNumber],\n    enabled: !!orderNumber,\n    refetchInterval: 10000, // Atualiza a cada 10 segundos\n  });\n\n  // Formata pre√ßo em Real brasileiro\n  const formatPrice = (value: string | number) => {\n    const num = typeof value === \"string\" ? parseFloat(value) : value;\n    return new Intl.NumberFormat(\"pt-BR\", {\n      style: \"currency\",\n      currency: \"BRL\",\n    }).format(num);\n  };\n\n  // Fun√ß√£o para baixar o comprovante em PDF\n  const handleDownloadPDF = () => {\n    if (orderNumber) {\n      window.open(`/api/checkout/receipt/${orderNumber}`, \"_blank\");\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center bg-background\">\n        <div className=\"text-center\">\n          <div className=\"h-8 w-8 border-2 border-primary border-t-transparent rounded-full animate-spin mx-auto mb-4\" />\n          <p className=\"text-muted-foreground lowercase\">carregando pedido...</p>\n        </div>\n      </div>\n    );\n  }\n\n  const order = orderData?.order;\n\n  // Se o pagamento foi aprovado, redireciona para sucesso\n  if (order?.paymentStatus === \"approved\" || order?.orderStatus === \"paid\") {\n    window.location.href = `/pagamento/sucesso?order=${orderNumber}`;\n    return null;\n  }\n\n  return (\n    <div className=\"min-h-screen bg-background py-12 px-4\">\n      <div className=\"max-w-2xl mx-auto\">\n        {/* √çcone de pendente animado */}\n        <motion.div\n          initial={{ scale: 0 }}\n          animate={{ scale: 1 }}\n          transition={{ type: \"spring\", duration: 0.5 }}\n          className=\"flex justify-center mb-8\"\n        >\n          <div className=\"w-24 h-24 bg-yellow-500/10 rounded-full flex items-center justify-center\">\n            <Clock className=\"w-12 h-12 text-yellow-500\" />\n          </div>\n        </motion.div>\n\n        {/* T√≠tulo */}\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          transition={{ delay: 0.2 }}\n          className=\"text-center mb-8\"\n        >\n          <h1 className=\"text-3xl font-bold lowercase mb-2\">pagamento pendente</h1>\n          <p className=\"text-muted-foreground lowercase\">\n            estamos aguardando a confirma√ß√£o do seu pagamento.\n          </p>\n        </motion.div>\n\n        {order && (\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ delay: 0.3 }}\n          >\n            <Card className=\"mb-6\">\n              <CardHeader className=\"pb-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-muted-foreground lowercase\">n√∫mero do pedido</p>\n                    <p className=\"text-xl font-bold\">{order.orderNumber}</p>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-muted-foreground lowercase\">valor</p>\n                    <p className=\"text-xl font-bold text-primary\">\n                      {formatPrice(order.totalAmount)}\n                    </p>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Instru√ß√µes */}\n                <div className=\"p-4 bg-yellow-500/10 rounded-lg border border-yellow-500/20\">\n                  <p className=\"text-sm lowercase\">\n                    <strong>importante:</strong> se voc√™ escolheu pagar com pix ou boleto, \n                    siga as instru√ß√µes enviadas para seu e-mail para completar o pagamento.\n                  </p>\n                </div>\n\n                {/* Email de confirma√ß√£o */}\n                <div className=\"p-4 bg-muted/30 rounded-lg\">\n                  <p className=\"text-sm text-muted-foreground lowercase mb-1\">\n                    enviamos as instru√ß√µes para\n                  </p>\n                  <p className=\"font-medium\">{order.customerEmail}</p>\n                </div>\n\n                {/* Status atual */}\n                <div className=\"flex justify-between items-center py-2 border-b\">\n                  <span className=\"text-muted-foreground lowercase\">status</span>\n                  <span className=\"text-yellow-600 font-medium lowercase\">aguardando pagamento</span>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Bot√µes de a√ß√£o */}\n            <div className=\"flex flex-col sm:flex-row gap-3\">\n              <Button\n                onClick={() => refetch()}\n                variant=\"outline\"\n                className=\"flex-1 h-12 rounded-full\"\n                data-testid=\"button-refresh-status\"\n              >\n                <RefreshCw className=\"w-4 h-4 mr-2\" />\n                <span className=\"lowercase\">atualizar status</span>\n              </Button>\n              <Button\n                onClick={handleDownloadPDF}\n                variant=\"outline\"\n                className=\"flex-1 h-12 rounded-full\"\n                data-testid=\"button-download-pdf\"\n              >\n                <Download className=\"w-4 h-4 mr-2\" />\n                <span className=\"lowercase\">baixar pedido</span>\n              </Button>\n            </div>\n\n            <div className=\"mt-4\">\n              <Link href=\"/\">\n                <Button variant=\"ghost\" className=\"w-full h-12 rounded-full\" data-testid=\"button-back-home\">\n                  <Home className=\"w-4 h-4 mr-2\" />\n                  <span className=\"lowercase\">voltar √† loja</span>\n                </Button>\n              </Link>\n            </div>\n\n            {/* Info de atualiza√ß√£o autom√°tica */}\n            <div className=\"mt-8 text-center\">\n              <p className=\"text-xs text-muted-foreground lowercase\">\n                esta p√°gina atualiza automaticamente a cada 10 segundos\n              </p>\n            </div>\n          </motion.div>\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":7209,"size_tokens":null},"SECURITY_CHECKLIST.md":{"content":"# Checklist de Seguran√ßa - Auditoria e Corre√ß√µes\n\n## ‚úÖ Vulnerabilidades Corrigidas\n\n### 1. Session Security\n- ‚úÖ **SESSION_SECRET**: Agora exigido e validado (m√≠nimo 32 caracteres)\n- ‚úÖ **Cookie Secure**: Configurado dinamicamente baseado em NODE_ENV\n- ‚úÖ **sameSite**: Mudado de 'lax' para 'strict'\n- ‚úÖ **resave/saveUninitialized**: Mudado para false (melhor pr√°tica)\n- ‚úÖ **Remo√ß√£o de session hijacking**: Middleware x-session-id removido (risco de seguran√ßa)\n\n### 2. Checkout Security\n- ‚úÖ **Rate Limiting**: Adicionado ao `/create-order` (10 requisi√ß√µes/15 min)\n- ‚úÖ **CPF Validation**: Implementado valida√ß√£o completa de CPF (check digit + rejeita n√∫meros repetidos)\n- ‚úÖ **Order Number Validation**: Valida√ß√£o de formato para evitar injection (OUDLA-YYYYMMDD-XXXX)\n- ‚úÖ **MERCADOPAGO_ACCESS_TOKEN**: Agora validado antes de qualquer transa√ß√£o\n- ‚úÖ **Webhook Rate Limiting**: Adicionado (100 req/min)\n- ‚úÖ **Webhook Signature Validation**: J√° implementado com HMAC-SHA256\n\n### 3. Admin Security\n- ‚úÖ **Brute Force Protection**: Implementado rate limiting (m√°x 5 tentativas/15 min)\n- ‚úÖ **Input Sanitization**: Username validado (3-50 caracteres, lowercase)\n- ‚úÖ **Timing Attack Prevention**: Incrementa tentativas mesmo com usu√°rio n√£o-existente\n- ‚úÖ **Secure Password Hashing**: bcrypt j√° utilizado\n- ‚úÖ **Removed Weak Default Admin**: Usu√°rio 'a/a' tempor√°rio removido\n- ‚úÖ **Admin Middleware Hardened**: Logging seguro sem expor dados sens√≠veis\n\n### 4. Request Security\n- ‚úÖ **Body Size Limit**: Adicionado limite de 1MB para JSON/URL-encoded\n- ‚úÖ **Debug Logging**: Removido ou limitado a desenvolvimento apenas\n- ‚úÖ **Error Messages**: Gen√©ricos ao usu√°rio (n√£o exp√µem detalhes internos)\n\n### 5. Code Quality\n- ‚úÖ **Zod Validation**: J√° implementado para todas as entradas\n- ‚úÖ **Type Safety**: Adicionados tipos √†s fun√ß√µes de rate limiting\n- ‚úÖ **Sensitive Data**: N√£o logado em produ√ß√£o (senhas, CPF, etc)\n\n## üîê Vari√°veis de Ambiente Obrigat√≥rias\n\n```bash\n# ‚ùå CR√çTICO - Defina antes de publicar:\nSESSION_SECRET=seu-string-aleatoria-com-no-minimo-32-caracteres-muito-forte\nMERCADOPAGO_ACCESS_TOKEN=seu-token-de-producao\nMERCADOPAGO_WEBHOOK_SECRET=seu-webhook-secret\nNODE_ENV=production\n\n# Database\nSUPABASE_DATABASE_URL=sua-url-de-producao\n```\n\n## üìã Deploy Checklist\n\n- [ ] SESSION_SECRET configurado (m√≠n 32 caracteres, aleat√≥rio)\n- [ ] NODE_ENV=production\n- [ ] HTTPS/TLS configurado (obrigat√≥rio para cookies secure)\n- [ ] MERCADOPAGO_ACCESS_TOKEN de produ√ß√£o\n- [ ] MERCADOPAGO_WEBHOOK_SECRET configurado\n- [ ] Database URL de produ√ß√£o\n- [ ] Verificar logs: n√£o h√° exposi√ß√£o de dados sens√≠veis\n- [ ] Testar: checkout com dados v√°lidos\n- [ ] Testar: rejei√ß√£o de CPF inv√°lido\n- [ ] Testar: rate limiting (m√∫ltiplas requisi√ß√µes)\n\n## üö® Prote√ß√µes Implementadas Contra\n\n| Amea√ßa | Prote√ß√£o | Status |\n|--------|----------|--------|\n| Brute Force (Admin) | Rate limiting + valida√ß√£o | ‚úÖ |\n| SQL Injection | Zod validation + ORM (Drizzle) | ‚úÖ |\n| CSRF | sameSite strict + origem validation | ‚úÖ |\n| XSS | JSON responses + no inline scripts | ‚úÖ |\n| Session Hijacking | Removed dangerous session restoration | ‚úÖ |\n| Fraud (Checkout) | Recalculate totals server-side | ‚úÖ |\n| DDoS (Checkout) | Rate limiting + webhook throttling | ‚úÖ |\n| CPF Forging | Full CPF validation algorithm | ‚úÖ |\n| Timing Attacks | Consistent auth responses | ‚úÖ |\n| Sensitive Data Exposure | Removed debug logging, secure cookies | ‚úÖ |\n\n## üîÑ Pr√≥ximas A√ß√µes (Recomendadas)\n\n1. **Adicionar logging de auditoria**: Registre tentativas de login falhadas\n2. **Implementar 2FA**: Para acesso admin\n3. **WAF (Web Application Firewall)**: Considere usar no Replit ou CloudFlare\n4. **CORS configurado**: Se necess√°rio\n5. **Helmet.js**: Para headers de seguran√ßa adicionais\n6. **Monitoramento**: Configure alertas para taxa de erro ou atividade suspeita\n\n## üìù Arquivos Modificados\n\n- `server/index.ts` - Session security, environment validation\n- `server/checkout-routes.ts` - CPF validation, rate limiting, order validation\n- `server/admin-middleware.ts` - Brute force protection, input sanitization\n- `server/routes.ts` - Removed weak default admin user\n\n## ‚ú® Resultado\n\n**Seguran√ßa aumentada significativamente.** O checkout agora est√° protegido contra:\n- Fraude de pre√ßo\n- Ataque de for√ßa bruta\n- CPF forjado\n- Exploitation de sess√£o\n- DDoS direcionado\n\nTudo mant√©m as funcionalidades originais intactas.\n","path":null,"size_bytes":4515,"size_tokens":null},"CSS_ANIMATION_OPTIMIZATIONS.md":{"content":"# CSS Animation Optimizations - Performance Report\n\n## Overview\nSuccessfully optimized CSS animations for GPU acceleration and improved overall application fluidity. All optimizations have been added to `client/src/index.css`.\n\n## Optimizations Implemented\n\n### 1. **GPU Acceleration Utility Classes**\n\n#### `.gpu-accelerate`\n```css\n.gpu-accelerate {\n  transform: translateZ(0);\n  backface-visibility: hidden;\n  perspective: 1000px;\n}\n```\n- **Purpose**: Forces GPU acceleration for 3D transforms\n- **Use case**: Apply to elements with frequent animations or transforms\n- **Benefits**: Offloads rendering to GPU, smoother animations, reduced CPU usage\n\n#### `.gpu-animate`\n```css\n.gpu-animate {\n  transform: translateZ(0);\n  backface-visibility: hidden;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n```\n- **Purpose**: Enhanced GPU acceleration with font rendering optimization\n- **Use case**: Animated text elements, complex layouts\n- **Benefits**: Smoother text rendering during animations, better performance on macOS\n\n#### `.animate-gpu`\n```css\n.animate-gpu {\n  will-change: transform;\n  backface-visibility: hidden;\n}\n```\n- **Purpose**: Prepares browser for transform animations\n- **Use case**: Elements that will be transformed via JavaScript/Framer Motion\n- **Benefits**: Browser optimization hints, faster animation performance\n\n### 2. **Smooth Scrolling**\n```css\nhtml {\n  scroll-behavior: smooth;\n}\n```\n- **Purpose**: Enables smooth scrolling across the entire application\n- **Benefits**: Better UX, smooth scroll-to behavior for anchor links\n- **Browser Support**: All modern browsers\n\n### 3. **Animation Optimization with Will-Change**\n\n#### `.animate-smooth` (Respects Accessibility Preferences)\n```css\n@media (prefers-reduced-motion: no-preference) {\n  .animate-smooth {\n    will-change: transform, opacity;\n  }\n}\n```\n- **Purpose**: Declares properties that will be animated\n- **Use case**: Elements with fade-in, slide, or opacity animations\n- **Benefits**: Browser pre-optimization, better performance\n- **Accessibility**: Respects user's motion preferences (prefers-reduced-motion)\n\n#### `.hover-optimize`\n```css\n.hover-optimize {\n  will-change: transform;\n}\n```\n- **Purpose**: Optimizes hover-triggered animations\n- **Use case**: Buttons, cards, interactive elements on hover\n- **Benefits**: Faster hover response, smoother interactions\n- **Important**: Remove `will-change` after animation completes to prevent memory bloat\n\n## Current Animation Analysis\n\n### Analyzed Components\n\n#### ‚úÖ **ProductCard.tsx** - Excellent (Framer Motion)\n- Uses Framer Motion with GPU-accelerated transforms\n- Implements `useScroll`, `useTransform`, and `useSpring`\n- Already optimized with transform-based animations\n- Scale animations on images properly handled\n\n#### ‚úÖ **BannerCarousel.tsx** - Good\n- Uses `transition-all duration-700 ease-in-out` for background images\n- Properly uses `transform` for positioning (e.g., `-translate-x-1/2`)\n- Carousel dots use `transition-colors` which is efficient\n\n#### ‚úÖ **FeatureBanner.tsx** - Good\n- Uses `transition-opacity duration-1000` for image fading\n- Opacity changes don't cause reflow - perfect for image transitions\n- Efficient fade-in/fade-out effects\n\n#### ‚úÖ **NewsletterSection.tsx** - Excellent\n- Uses Framer Motion for all animations\n- Implements proper fade-in and scale animations\n- Respects motion preferences via Framer Motion\n\n#### ‚ö†Ô∏è **ReviewsModal.tsx** - Potential Optimization\n- Rating stars use `width: ${fillPercentage}%` animation\n- **Current**: Width property changes (causes reflow)\n- **Recommendation**: Use `scaleX()` or `clip-path` instead\n\n## Recommended Optimization for ReviewsModal\n\n### Current Implementation (Causes Reflow)\n```jsx\nstyle={{ width: `${fillPercentage}%` }}\n```\n\n### Recommended Alternative 1: ScaleX Transform\n```jsx\nstyle={{ \n  transform: `scaleX(${fillPercentage / 100})`,\n  transformOrigin: 'left'\n}}\n```\n- No reflow\n- GPU-accelerated\n- Smooth performance\n\n### Recommended Alternative 2: Clip-Path\n```jsx\nstyle={{ \n  clipPath: `inset(0 ${100 - fillPercentage}% 0 0)`\n}}\n```\n- No reflow\n- Works well with modern browsers\n- Smooth clipping animation\n\n### Recommended Alternative 3: Mask-Image\n```jsx\nstyle={{ \n  maskImage: `linear-gradient(90deg, black ${fillPercentage}%, transparent ${fillPercentage}%)`\n}}\n```\n- Best browser support\n- No reflow\n- Smooth masking effect\n\n## How to Use the Optimization Classes\n\n### Example 1: Animated Component\n```jsx\n// For elements using Framer Motion animations\n<motion.div className=\"animate-smooth\">\n  Your animated content\n</motion.div>\n```\n\n### Example 2: Transform Animations\n```jsx\n// For elements with transform animations\n<div className=\"gpu-accelerate\">\n  Transform animated content\n</div>\n```\n\n### Example 3: Hover Animations\n```jsx\n// For hover-triggered effects\n<button className=\"hover-optimize\">\n  Hover me\n</button>\n```\n\n### Example 4: Complex Animated Text\n```jsx\n// For animated text elements\n<h2 className=\"gpu-animate\">\n  Animated heading\n</h2>\n```\n\n## Performance Benefits\n\n### CPU & GPU Optimization\n- **GPU Acceleration**: `translateZ(0)` and `transform3d` force GPU rendering\n- **Reduced Repaints**: `will-change` and `backface-visibility` hints to browser\n- **Better Memory**: Only applied to animated elements\n- **Smooth Scrolling**: Native scroll behavior optimization\n\n### Browser Performance\n- **Frame Rate**: 60 FPS animations (or 120 FPS on high refresh displays)\n- **Reduced Jank**: GPU offloading prevents main thread blocking\n- **Battery Life**: Mobile devices benefit from GPU acceleration\n- **Accessibility**: Respects user motion preferences\n\n## Accessibility Considerations\n\nAll animation optimizations respect the `prefers-reduced-motion` media query:\n```css\n@media (prefers-reduced-motion: no-preference) {\n  /* Animations only applied when user hasn't disabled motion */\n}\n```\n\nThis ensures:\n- Users with vestibular disorders aren't affected\n- Animations respect user preferences\n- Better accessibility compliance\n- Smoother experience for all users\n\n## Testing Recommendations\n\n1. **Performance Audit**: Use Chrome DevTools Performance tab\n2. **Animation Smoothness**: Test on various devices\n3. **Accessibility**: Test with `prefers-reduced-motion` enabled\n4. **Browser Compatibility**: Test on Edge, Firefox, Safari\n5. **Mobile Testing**: Test on iOS and Android devices\n\n## Summary\n\n‚úÖ All required GPU acceleration optimizations implemented\n‚úÖ Performance utility classes added to index.css\n‚úÖ Smooth scrolling enabled\n‚úÖ Will-change properties properly declared\n‚úÖ Accessibility considerations included\n‚úÖ Existing animations analyzed and verified\n‚ö†Ô∏è ReviewsModal.tsx identified for optional optimization\n\nThe application now has improved animation performance with GPU acceleration and respects user accessibility preferences.\n","path":null,"size_bytes":6861,"size_tokens":null},"client/src/components/PixelProvider.tsx":{"content":"/**\n * PixelProvider - Provider de contexto para gerenciar o Facebook Pixel\n * \n * Este componente √© respons√°vel por:\n * - Carregar as configura√ß√µes de tracking pixels do backend\n * - Injetar o script do Facebook Pixel no head da p√°gina\n * - Injetar scripts customizados (headerScripts e bodyScripts)\n * - Expor fun√ß√µes para disparar eventos do Facebook Pixel\n * \n * O provider deve envolver toda a aplica√ß√£o no App.tsx\n */\n\nimport { createContext, useContext, useEffect, useState, useCallback, type ReactNode } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\n\n// ===== TIPOS =====\n\n/**\n * Interface para os dados de configura√ß√£o dos pixels de rastreamento\n * Vem do endpoint /api/tracking-pixels\n */\ninterface TrackingPixelsConfig {\n  facebookPixelId: string | null;\n  facebookPixelEnabled: boolean;\n  facebookTestEventCode: string | null;\n  headerScripts: string | null;\n  bodyScripts: string | null;\n}\n\n/**\n * Interface para itens de compra (usado no evento Purchase)\n */\ninterface PurchaseItem {\n  id: string;\n  name: string;\n  quantity: number;\n  price: number;\n}\n\n/**\n * Interface do contexto do Pixel\n * Exp√µe as fun√ß√µes de tracking e estado de carregamento\n */\ninterface PixelContextType {\n  // Estado\n  isLoaded: boolean;\n  isEnabled: boolean;\n  \n  // Fun√ß√µes de tracking\n  trackPageView: () => void;\n  trackViewContent: (productId: string, productName: string, value: number, currency?: string, category?: string) => void;\n  trackAddToCart: (productId: string, productName: string, value: number, currency?: string, quantity?: number) => void;\n  trackRemoveFromCart: (productId: string, productName: string, value: number) => void;\n  trackInitiateCheckout: (value: number, currency?: string, numItems?: number) => void;\n  trackAddPaymentInfo: (value: number, currency?: string) => void;\n  trackPurchase: (orderId: string, value: number, currency?: string, items?: PurchaseItem[]) => void;\n  trackLead: (email?: string) => void;\n  trackSearch: (searchQuery: string) => void;\n  trackAddToWishlist: (productId: string, productName: string, value: number) => void;\n  trackCompleteRegistration: () => void;\n}\n\n// ===== CONTEXTO =====\n\n// Cria o contexto com valores padr√£o (fun√ß√µes vazias)\nconst PixelContext = createContext<PixelContextType>({\n  isLoaded: false,\n  isEnabled: false,\n  trackPageView: () => {},\n  trackViewContent: () => {},\n  trackAddToCart: () => {},\n  trackRemoveFromCart: () => {},\n  trackInitiateCheckout: () => {},\n  trackAddPaymentInfo: () => {},\n  trackPurchase: () => {},\n  trackLead: () => {},\n  trackSearch: () => {},\n  trackAddToWishlist: () => {},\n  trackCompleteRegistration: () => {},\n});\n\n// ===== DECLARA√á√ÉO GLOBAL DO FBQ =====\n\n// Tipo para a fun√ß√£o fbq do Facebook Pixel\ntype FBQFunction = (\n  action: string,\n  eventName: string,\n  params?: Record<string, unknown>\n) => void;\n\n// Declara a interface do Facebook Pixel no objeto window\ndeclare global {\n  interface Window {\n    fbq?: FBQFunction;\n    _fbq?: FBQFunction;\n  }\n}\n\n// ===== PROVIDER =====\n\ninterface PixelProviderProps {\n  children: ReactNode;\n}\n\nexport function PixelProvider({ children }: PixelProviderProps) {\n  // Estado para controlar se o pixel foi carregado\n  const [isLoaded, setIsLoaded] = useState(false);\n  \n  // Busca as configura√ß√µes de tracking pixels do backend\n  const { data: config } = useQuery<TrackingPixelsConfig>({\n    queryKey: [\"/api/tracking-pixels\"],\n    staleTime: 5 * 60 * 1000, // Cache por 5 minutos\n  });\n\n  // Verifica se o Facebook Pixel est√° habilitado\n  const isEnabled = Boolean(config?.facebookPixelEnabled && config?.facebookPixelId);\n\n  /**\n   * Efeito para injetar o script do Facebook Pixel\n   * Executado quando as configura√ß√µes s√£o carregadas e o pixel est√° habilitado\n   */\n  useEffect(() => {\n    // Verifica se o pixel est√° habilitado e tem ID v√°lido\n    if (!config?.facebookPixelEnabled || !config?.facebookPixelId) {\n      return;\n    }\n\n    // Evita injetar o script mais de uma vez\n    if (window.fbq) {\n      setIsLoaded(true);\n      return;\n    }\n\n    // C√≥digo base do Facebook Pixel (minificado)\n    const pixelScript = `\n      !function(f,b,e,v,n,t,s)\n      {if(f.fbq)return;n=f.fbq=function(){n.callMethod?\n      n.callMethod.apply(n,arguments):n.queue.push(arguments)};\n      if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';\n      n.queue=[];t=b.createElement(e);t.async=!0;\n      t.src=v;s=b.getElementsByTagName(e)[0];\n      s.parentNode.insertBefore(t,s)}(window, document,'script',\n      'https://connect.facebook.net/en_US/fbevents.js');\n      fbq('init', '${config.facebookPixelId}');\n      fbq('track', 'PageView');\n    `;\n\n    // Cria e injeta o script no head\n    const script = document.createElement(\"script\");\n    script.id = \"facebook-pixel-script\";\n    script.innerHTML = pixelScript;\n    document.head.appendChild(script);\n\n    // Marca como carregado\n    setIsLoaded(true);\n\n    console.log(\"‚úÖ [Facebook Pixel] Inicializado com ID:\", config.facebookPixelId);\n\n    // Cleanup: remove o script quando o componente desmonta\n    return () => {\n      const existingScript = document.getElementById(\"facebook-pixel-script\");\n      if (existingScript) {\n        existingScript.remove();\n      }\n    };\n  }, [config?.facebookPixelEnabled, config?.facebookPixelId]);\n\n  /**\n   * Efeito para injetar scripts customizados do header\n   * Scripts s√£o adicionados ao <head> da p√°gina\n   */\n  useEffect(() => {\n    if (!config?.headerScripts) {\n      return;\n    }\n\n    // Cria um container para os scripts do header\n    const container = document.createElement(\"div\");\n    container.id = \"custom-header-scripts\";\n    container.innerHTML = config.headerScripts;\n    document.head.appendChild(container);\n\n    console.log(\"‚úÖ [Pixel] Scripts de header injetados\");\n\n    // Cleanup\n    return () => {\n      const existingContainer = document.getElementById(\"custom-header-scripts\");\n      if (existingContainer) {\n        existingContainer.remove();\n      }\n    };\n  }, [config?.headerScripts]);\n\n  /**\n   * Efeito para injetar scripts customizados do body\n   * Scripts s√£o adicionados antes do fechamento do </body>\n   */\n  useEffect(() => {\n    if (!config?.bodyScripts) {\n      return;\n    }\n\n    // Cria um container para os scripts do body\n    const container = document.createElement(\"div\");\n    container.id = \"custom-body-scripts\";\n    container.innerHTML = config.bodyScripts;\n    document.body.appendChild(container);\n\n    console.log(\"‚úÖ [Pixel] Scripts de body injetados\");\n\n    // Cleanup\n    return () => {\n      const existingContainer = document.getElementById(\"custom-body-scripts\");\n      if (existingContainer) {\n        existingContainer.remove();\n      }\n    };\n  }, [config?.bodyScripts]);\n\n  // ===== FUN√á√ïES DE TRACKING =====\n\n  /**\n   * Dispara o evento PageView\n   * Usado para rastrear visualiza√ß√£o de p√°ginas\n   */\n  const trackPageView = useCallback(() => {\n    if (!isEnabled || !window.fbq) return;\n    \n    window.fbq(\"track\", \"PageView\");\n    console.log(\"üìä [Pixel] PageView disparado\");\n  }, [isEnabled]);\n\n  /**\n   * Dispara o evento ViewContent\n   * Usado quando o usu√°rio visualiza um produto\n   */\n  const trackViewContent = useCallback(\n    (productId: string, productName: string, value: number, currency = \"BRL\", category?: string) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"ViewContent\", {\n        content_ids: [productId],\n        content_name: productName,\n        content_type: \"product\",\n        content_category: category,\n        value: value,\n        currency: currency,\n      });\n      \n      console.log(\"üìä [Pixel] ViewContent disparado:\", { productId, productName, value });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento AddToCart\n   * Usado quando o usu√°rio adiciona um produto ao carrinho\n   */\n  const trackAddToCart = useCallback(\n    (productId: string, productName: string, value: number, currency = \"BRL\", quantity = 1) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"AddToCart\", {\n        content_ids: [productId],\n        content_name: productName,\n        content_type: \"product\",\n        value: value,\n        currency: currency,\n        num_items: quantity,\n      });\n      \n      console.log(\"üìä [Pixel] AddToCart disparado:\", { productId, productName, value, quantity });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara evento customizado RemoveFromCart\n   * Usado quando o usu√°rio remove um produto do carrinho\n   * Nota: Este √© um evento customizado, n√£o padr√£o do Facebook\n   */\n  const trackRemoveFromCart = useCallback(\n    (productId: string, productName: string, value: number) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"trackCustom\", \"RemoveFromCart\", {\n        content_ids: [productId],\n        content_name: productName,\n        value: value,\n        currency: \"BRL\",\n      });\n      \n      console.log(\"üìä [Pixel] RemoveFromCart disparado:\", { productId, productName, value });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento InitiateCheckout\n   * Usado quando o usu√°rio inicia o processo de checkout\n   */\n  const trackInitiateCheckout = useCallback(\n    (value: number, currency = \"BRL\", numItems?: number) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"InitiateCheckout\", {\n        value: value,\n        currency: currency,\n        num_items: numItems,\n      });\n      \n      console.log(\"üìä [Pixel] InitiateCheckout disparado:\", { value, numItems });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento AddPaymentInfo\n   * Usado quando o usu√°rio adiciona informa√ß√µes de pagamento\n   */\n  const trackAddPaymentInfo = useCallback(\n    (value: number, currency = \"BRL\") => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"AddPaymentInfo\", {\n        value: value,\n        currency: currency,\n      });\n      \n      console.log(\"üìä [Pixel] AddPaymentInfo disparado:\", { value });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento Purchase\n   * Usado quando uma compra √© finalizada com sucesso\n   */\n  const trackPurchase = useCallback(\n    (orderId: string, value: number, currency = \"BRL\", items?: PurchaseItem[]) => {\n      if (!isEnabled || !window.fbq) return;\n\n      // Formata os IDs dos produtos para o Facebook\n      const contentIds = items?.map((item) => item.id) || [];\n      \n      // Formata os conte√∫dos para o Facebook\n      const contents = items?.map((item) => ({\n        id: item.id,\n        quantity: item.quantity,\n        item_price: item.price,\n      })) || [];\n\n      window.fbq(\"track\", \"Purchase\", {\n        value: value,\n        currency: currency,\n        content_ids: contentIds,\n        contents: contents,\n        content_type: \"product\",\n        order_id: orderId,\n        num_items: items?.reduce((acc, item) => acc + item.quantity, 0) || 0,\n      });\n      \n      console.log(\"üìä [Pixel] Purchase disparado:\", { orderId, value, items: items?.length });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento Lead\n   * Usado quando o usu√°rio se cadastra na newsletter\n   */\n  const trackLead = useCallback(\n    (email?: string) => {\n      if (!isEnabled || !window.fbq) return;\n\n      // N√£o envia o email diretamente para preservar privacidade\n      // O Facebook usa o email hashado internamente\n      window.fbq(\"track\", \"Lead\", {\n        content_name: \"Newsletter\",\n      });\n      \n      console.log(\"üìä [Pixel] Lead disparado:\", { email: email ? \"***\" : \"n√£o informado\" });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento Search\n   * Usado quando o usu√°rio realiza uma busca\n   */\n  const trackSearch = useCallback(\n    (searchQuery: string) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"Search\", {\n        search_string: searchQuery,\n      });\n      \n      console.log(\"üìä [Pixel] Search disparado:\", { searchQuery });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento AddToWishlist\n   * Usado quando o usu√°rio adiciona um produto aos favoritos\n   */\n  const trackAddToWishlist = useCallback(\n    (productId: string, productName: string, value: number) => {\n      if (!isEnabled || !window.fbq) return;\n\n      window.fbq(\"track\", \"AddToWishlist\", {\n        content_ids: [productId],\n        content_name: productName,\n        content_type: \"product\",\n        value: value,\n        currency: \"BRL\",\n      });\n      \n      console.log(\"üìä [Pixel] AddToWishlist disparado:\", { productId, productName, value });\n    },\n    [isEnabled]\n  );\n\n  /**\n   * Dispara o evento CompleteRegistration\n   * Usado quando o usu√°rio completa o registro/cadastro\n   */\n  const trackCompleteRegistration = useCallback(() => {\n    if (!isEnabled || !window.fbq) return;\n\n    window.fbq(\"track\", \"CompleteRegistration\");\n    \n    console.log(\"üìä [Pixel] CompleteRegistration disparado\");\n  }, [isEnabled]);\n\n  // ===== VALOR DO CONTEXTO =====\n\n  const contextValue: PixelContextType = {\n    isLoaded,\n    isEnabled,\n    trackPageView,\n    trackViewContent,\n    trackAddToCart,\n    trackRemoveFromCart,\n    trackInitiateCheckout,\n    trackAddPaymentInfo,\n    trackPurchase,\n    trackLead,\n    trackSearch,\n    trackAddToWishlist,\n    trackCompleteRegistration,\n  };\n\n  return (\n    <PixelContext.Provider value={contextValue}>\n      {children}\n    </PixelContext.Provider>\n  );\n}\n\n// ===== HOOK DE ACESSO AO CONTEXTO =====\n\n/**\n * Hook para acessar o contexto do Pixel diretamente\n * Prefira usar o hook usePixel para uma API mais limpa\n */\nexport function usePixelContext() {\n  const context = useContext(PixelContext);\n  \n  if (!context) {\n    throw new Error(\"usePixelContext deve ser usado dentro de um PixelProvider\");\n  }\n  \n  return context;\n}\n\nexport default PixelProvider;\n","path":null,"size_bytes":13775,"size_tokens":null},"server/mercadopago.ts":{"content":"/**\n * M√≥dulo de integra√ß√£o com Mercado Pago\n * \n * Este arquivo gerencia toda a comunica√ß√£o com a API do Mercado Pago,\n * incluindo detec√ß√£o autom√°tica de ambiente (produ√ß√£o vs sandbox),\n * cria√ß√£o de clientes e valida√ß√£o de webhooks.\n * \n * O sistema detecta automaticamente se est√° em produ√ß√£o ou desenvolvimento\n * e usa as credenciais apropriadas.\n */\n\nimport { MercadoPagoConfig, Preference, Payment } from \"mercadopago\";\nimport crypto from \"crypto\";\n\n/**\n * Detecta se a aplica√ß√£o est√° rodando em ambiente de produ√ß√£o.\n * \n * Crit√©rios para produ√ß√£o:\n * 1. Dom√≠nio Replit termina em .replit.app (sem dom√≠nio de dev)\n * 2. NODE_ENV est√° definido como \"production\"\n * \n * @returns true se estiver em produ√ß√£o, false para desenvolvimento/sandbox\n */\nfunction isProduction(): boolean {\n  if (process.env.APP_ENV === \"production\" || process.env.NODE_ENV === \"production\") {\n    return true;\n  }\n\n  const replitDomain = process.env.REPLIT_DOMAINS || \"\";\n  const devDomain = process.env.REPLIT_DEV_DOMAIN || \"\";\n  if (replitDomain.includes(\".replit.app\") && !devDomain) {\n    return true;\n  }\n  \n  return false;\n}\n\n/**\n * Obt√©m o Access Token apropriado para o ambiente atual.\n * \n * Em produ√ß√£o: usa MERCADOPAGO_ACCESS_TOKEN\n * Em desenvolvimento: usa MERCADOPAGO_ACCESS_TOKEN_SANDBOX\n * \n * Se a credencial de sandbox n√£o existir, usa a de produ√ß√£o como fallback.\n * \n * @returns Access Token do Mercado Pago\n * @throws Error se nenhum token estiver configurado\n */\nfunction getAccessToken(): string {\n  const isProd = isProduction();\n  \n  if (isProd) {\n    // Ambiente de PRODU√á√ÉO - usa credenciais reais\n    const token = process.env.MERCADOPAGO_ACCESS_TOKEN;\n    if (!token) {\n      throw new Error(\"MERCADOPAGO_ACCESS_TOKEN n√£o configurado para produ√ß√£o\");\n    }\n    console.log(\"üîë [MP] Usando credenciais de PRODU√á√ÉO\");\n    return token;\n  } else {\n    // Ambiente de DESENVOLVIMENTO/SANDBOX - usa credenciais de teste\n    const token = process.env.MERCADOPAGO_ACCESS_TOKEN_SANDBOX;\n    if (!token) {\n      console.warn(\"‚ö†Ô∏è [MP] MERCADOPAGO_ACCESS_TOKEN_SANDBOX n√£o configurado, usando produ√ß√£o\");\n      const prodToken = process.env.MERCADOPAGO_ACCESS_TOKEN;\n      if (!prodToken) {\n        throw new Error(\"Nenhum token do Mercado Pago configurado\");\n      }\n      return prodToken;\n    }\n    console.log(\"üß™ [MP] Usando credenciais de SANDBOX/TESTE\");\n    return token;\n  }\n}\n\n/**\n * Obt√©m a Public Key apropriada para o ambiente atual.\n * Usada no frontend para inicializar o SDK do Mercado Pago.\n * \n * @returns Public Key do Mercado Pago\n */\nexport function getPublicKey(): string {\n  const isProd = isProduction();\n  \n  if (isProd) {\n    return process.env.MERCADOPAGO_PUBLIC_KEY || \"\";\n  } else {\n    // Em sandbox, tenta usar a key de sandbox primeiro, depois a de produ√ß√£o\n    return process.env.MERCADOPAGO_PUBLIC_KEY_SANDBOX || process.env.MERCADOPAGO_PUBLIC_KEY || \"\";\n  }\n}\n\n/**\n * Obt√©m o segredo do webhook para valida√ß√£o de assinaturas.\n * Usado para garantir que as notifica√ß√µes vieram realmente do Mercado Pago.\n * \n * @returns Segredo do webhook\n */\nexport function getWebhookSecret(): string {\n  return process.env.MERCADOPAGO_WEBHOOK_SECRET || \"\";\n}\n\n/**\n * Cria e retorna um cliente configurado do Mercado Pago.\n * Este cliente √© a base para todas as opera√ß√µes com a API.\n * \n * @returns Inst√¢ncia configurada do MercadoPagoConfig\n */\nexport function getMercadoPagoClient(): MercadoPagoConfig {\n  const accessToken = getAccessToken();\n  return new MercadoPagoConfig({ accessToken });\n}\n\n/**\n * Cria um cliente para gerenciar prefer√™ncias de pagamento.\n * Prefer√™ncias s√£o usadas no Checkout Pro para definir itens, valores e URLs de retorno.\n * \n * @returns Cliente de Prefer√™ncia do Mercado Pago\n */\nexport function createPreferenceClient(): Preference {\n  const client = getMercadoPagoClient();\n  return new Preference(client);\n}\n\n/**\n * Cria um cliente para consultar informa√ß√µes de pagamentos.\n * Usado principalmente para processar webhooks e verificar status.\n * \n * @returns Cliente de Pagamento do Mercado Pago\n */\nexport function createPaymentClient(): Payment {\n  const client = getMercadoPagoClient();\n  return new Payment(client);\n}\n\n/**\n * Valida a assinatura de um webhook do Mercado Pago.\n * \n * O Mercado Pago envia um header x-signature com cada notifica√ß√£o.\n * Este header cont√©m um timestamp (ts) e um hash (v1) que devemos verificar\n * para garantir que a notifica√ß√£o √© aut√™ntica.\n * \n * Algoritmo de valida√ß√£o:\n * 1. Extrai ts e v1 do header x-signature\n * 2. Monta o template: \"id:{dataId};request-id:{xRequestId};ts:{ts};\"\n * 3. Calcula HMAC-SHA256 do template usando o webhook secret\n * 4. Compara o hash calculado com o v1 recebido\n * \n * @param xSignature - Header x-signature da requisi√ß√£o\n * @param xRequestId - Header x-request-id da requisi√ß√£o\n * @param dataId - ID do recurso (payment, merchant_order, etc.)\n * @returns true se a assinatura for v√°lida\n */\nexport function validateWebhookSignature(\n  xSignature: string,\n  xRequestId: string,\n  dataId: string\n): boolean {\n  const secret = getWebhookSecret();\n  if (!secret) {\n    console.warn(\"‚ö†Ô∏è [MP] Webhook secret n√£o configurado, pulando valida√ß√£o\");\n    return true; // Se n√£o tem secret, aceita (n√£o recomendado em produ√ß√£o)\n  }\n\n  try {\n    // Extrai timestamp (ts) e hash (v1) do header\n    const parts = xSignature.split(\",\");\n    let ts: string | null = null;\n    let hash: string | null = null;\n\n    for (const part of parts) {\n      const [key, value] = part.split(\"=\").map(s => s.trim());\n      if (key === \"ts\") ts = value;\n      if (key === \"v1\") hash = value;\n    }\n\n    if (!ts || !hash) {\n      console.error(\"‚ùå [MP] Assinatura do webhook inv√°lida - ts ou hash ausente\");\n      return false;\n    }\n\n    // Monta o template para calcular o hash\n    const manifest = `id:${dataId};request-id:${xRequestId};ts:${ts};`;\n    \n    // Calcula o HMAC-SHA256 usando o webhook secret\n    const computedHash = crypto\n      .createHmac(\"sha256\", secret)\n      .update(manifest)\n      .digest(\"hex\");\n\n    // Compara os hashes\n    const isValid = computedHash === hash;\n    \n    if (!isValid) {\n      console.error(\"‚ùå [MP] Assinatura do webhook n√£o confere\");\n      console.error(\"   Esperado:\", computedHash);\n      console.error(\"   Recebido:\", hash);\n    }\n\n    return isValid;\n  } catch (error) {\n    console.error(\"‚ùå [MP] Erro ao validar assinatura:\", error);\n    return false;\n  }\n}\n\n/**\n * Retorna informa√ß√µes sobre o ambiente atual.\n * Usado pelo frontend para saber qual public key usar.\n * \n * @returns Objeto com isProduction e publicKey\n */\nexport function getEnvironmentInfo(): { isProduction: boolean; publicKey: string } {\n  return {\n    isProduction: isProduction(),\n    publicKey: getPublicKey()\n  };\n}\n","path":null,"size_bytes":6844,"size_tokens":null},"client/src/components/CookieBanner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Cookie, X } from \"lucide-react\";\nimport { motion, AnimatePresence } from \"framer-motion\";\n\ninterface CookieSettingsData {\n  enabled: boolean;\n  title: string;\n  description: string;\n  buttonAcceptText: string;\n  buttonRejectText: string;\n  buttonCustomizeText: string;\n  showCustomizeButton: boolean;\n  privacyPolicyUrl: string;\n}\n\nexport default function CookieBanner() {\n  const [visible, setVisible] = useState(false);\n  const [dismissed, setDismissed] = useState(false);\n\n  const { data: settings } = useQuery<CookieSettingsData>({\n    queryKey: [\"/api/cookie-settings\"],\n    staleTime: 1000 * 60 * 5,\n  });\n\n  useEffect(() => {\n    const consent = localStorage.getItem(\"oudla_cookie_consent\");\n    if (!consent && settings?.enabled) {\n      const timer = setTimeout(() => setVisible(true), 1500);\n      return () => clearTimeout(timer);\n    }\n  }, [settings]);\n\n  const handleAccept = () => {\n    localStorage.setItem(\"oudla_cookie_consent\", \"accepted\");\n    setDismissed(true);\n    setTimeout(() => setVisible(false), 400);\n  };\n\n  const handleReject = () => {\n    localStorage.setItem(\"oudla_cookie_consent\", \"rejected\");\n    setDismissed(true);\n    setTimeout(() => setVisible(false), 400);\n  };\n\n  const handleCustomize = () => {\n    localStorage.setItem(\"oudla_cookie_consent\", \"custom\");\n    setDismissed(true);\n    setTimeout(() => setVisible(false), 400);\n  };\n\n  if (!settings?.enabled || !visible) return null;\n\n  return (\n    <AnimatePresence>\n      {!dismissed && (\n        <motion.div\n          initial={{ y: 100, opacity: 0 }}\n          animate={{ y: 0, opacity: 1 }}\n          exit={{ y: 100, opacity: 0 }}\n          transition={{ type: \"spring\", damping: 25, stiffness: 200 }}\n          className=\"fixed bottom-0 left-0 right-0 z-[9999] p-3 sm:p-4 md:p-6\"\n          data-testid=\"cookie-banner\"\n        >\n          <div className=\"max-w-lg mx-auto sm:mx-4 md:mx-auto\">\n            <div className=\"bg-background/95 backdrop-blur-xl border border-border/50 rounded-2xl p-4 sm:p-5 shadow-2xl\">\n              <div className=\"flex items-start gap-3\">\n                <div className=\"p-2 rounded-xl bg-muted shrink-0 mt-0.5\">\n                  <Cookie className=\"h-4 w-4 text-muted-foreground\" />\n                </div>\n                <div className=\"flex-1 min-w-0 space-y-2.5\">\n                  <div className=\"flex items-center justify-between gap-2\">\n                    <p className=\"font-medium text-sm lowercase\">{settings.title}</p>\n                    <button\n                      onClick={handleReject}\n                      className=\"p-1 rounded-lg hover-elevate shrink-0\"\n                      data-testid=\"button-cookie-close\"\n                    >\n                      <X className=\"h-3.5 w-3.5 text-muted-foreground\" />\n                    </button>\n                  </div>\n                  <p className=\"text-xs text-muted-foreground lowercase leading-relaxed\">\n                    {settings.description}\n                  </p>\n                  <a\n                    href={settings.privacyPolicyUrl || \"/privacidade\"}\n                    className=\"text-xs text-primary lowercase underline inline-block\"\n                    data-testid=\"link-cookie-privacy\"\n                  >\n                    pol√≠tica de privacidade\n                  </a>\n                  <div className=\"flex flex-col sm:flex-row gap-2 pt-1\">\n                    <Button\n                      size=\"sm\"\n                      className=\"flex-1 rounded-full lowercase text-xs\"\n                      onClick={handleAccept}\n                      data-testid=\"button-cookie-accept\"\n                    >\n                      {settings.buttonAcceptText}\n                    </Button>\n                    <Button\n                      variant=\"outline\"\n                      size=\"sm\"\n                      className=\"flex-1 rounded-full lowercase text-xs\"\n                      onClick={handleReject}\n                      data-testid=\"button-cookie-reject\"\n                    >\n                      {settings.buttonRejectText}\n                    </Button>\n                    {settings.showCustomizeButton && (\n                      <Button\n                        variant=\"ghost\"\n                        size=\"sm\"\n                        className=\"flex-1 rounded-full lowercase text-xs\"\n                        onClick={handleCustomize}\n                        data-testid=\"button-cookie-customize\"\n                      >\n                        {settings.buttonCustomizeText}\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":4868,"size_tokens":null},"fly.toml":{"content":"app = \"oudla\"\nprimary_region = \"gru\"\n\n[checks.alive]\ngrace_period = \"30s\"\ninterval = \"15s\"\nmethod = \"GET\"\npath = \"/\"\nport = 3_000\ntimeout = \"10s\"\ntype = \"http\"\n\n[env]\nNODE_ENV = \"production\"\nNODE_OPTIONS = \"--max-old-space-size=512\"\nPORT = \"3000\"\n\n[http_service]\nauto_start_machines = true\nauto_stop_machines = false\nforce_https = true\ninternal_port = 3_000\nmin_machines_running = 2\nprocesses = [ \"app\" ]\n\n[processes]\napp = \"npm start\"\n\n[[vm]]\ncpu_kind = \"shared\"\ncpus = 1\nmemory = \"256mb\"\n","path":null,"size_bytes":490,"size_tokens":null},"client/src/pages/LeleliPage.tsx":{"content":"import { motion } from \"framer-motion\";\n\nexport default function LeleliPage() {\n  return (\n    <div className=\"min-h-screen bg-white dark:bg-black flex flex-col items-center justify-center relative overflow-hidden font-sans selection:bg-primary/10\">\n      <main className=\"z-10 flex flex-col items-center justify-center\">\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ duration: 2, ease: [0.22, 1, 0.36, 1] }}\n          className=\"relative\"\n        >\n          <span className=\"text-[120px] sm:text-[180px] font-extralight leading-none tracking-tighter text-black dark:text-white select-none\">\n            ‚àû\n          </span>\n        </motion.div>\n      </main>\n    </div>\n  );\n}\n","path":null,"size_bytes":749,"size_tokens":null},"server/email.ts":{"content":"import FormData from \"form-data\";\nimport Mailgun from \"mailgun.js\";\nimport { storage } from \"./storage\";\nimport { db } from \"./db\";\nimport { emailTemplates, siteSettings } from \"@shared/schema\";\nimport { eq } from \"drizzle-orm\";\n\nconst MAILGUN_API_KEY = process.env.MAILGUN_API_KEY || \"\";\nconst MAILGUN_DOMAIN = (process.env.MAILGUN_DOMAIN || \"\").toLowerCase();\n\nlet mgClient: any = null;\n\nfunction getMailgunClient() {\n  if (!mgClient) {\n    const mailgun = new Mailgun(FormData);\n    mgClient = mailgun.client({\n      username: \"api\",\n      key: MAILGUN_API_KEY,\n      url: \"https://api.eu.mailgun.net\",\n    });\n  }\n  return mgClient;\n}\n\nexport async function sendEmail(to: string, subject: string, html: string): Promise<boolean> {\n  try {\n    if (!MAILGUN_API_KEY || !MAILGUN_DOMAIN) {\n      console.error(\"‚ùå [EMAIL] Mailgun n√£o configurado: API_KEY ou DOMAIN ausente\");\n      return false;\n    }\n\n    const mg = getMailgunClient();\n    const result = await mg.messages.create(MAILGUN_DOMAIN, {\n      from: `OUDLA <postmaster@${MAILGUN_DOMAIN}>`,\n      to: [to],\n      subject,\n      html,\n    });\n\n    console.log(\"‚úÖ [EMAIL] Email enviado:\", { to, subject, id: result.id });\n    return true;\n  } catch (error) {\n    console.error(\"‚ùå [EMAIL] Erro ao enviar email:\", error);\n    return false;\n  }\n}\n\nexport function replaceTemplateVariables(template: string, variables: Record<string, string>): string {\n  let result = template;\n  for (const [key, value] of Object.entries(variables)) {\n    const regex = new RegExp(`\\\\{\\\\{${key}\\\\}\\\\}`, \"g\");\n    result = result.replace(regex, value || \"\");\n  }\n  return result;\n}\n\nasync function getTemplate(templateKey: string) {\n  try {\n    const results = await db.select().from(emailTemplates).where(eq(emailTemplates.templateKey, templateKey)).limit(1);\n    return results[0] || null;\n  } catch (error) {\n    console.error(`‚ùå [EMAIL] Erro ao buscar template ${templateKey}:`, error);\n    return null;\n  }\n}\n\nfunction buildItemsHtml(items: any[]): string {\n  return items.map(item => {\n    const color = item.color ? (() => { try { return JSON.parse(item.color); } catch { return null; } })() : null;\n    return `<tr style=\"border-bottom: 1px solid #eee;\">\n      <td style=\"padding: 12px 0;\">\n        <strong>${item.productName}</strong><br/>\n        <span style=\"color: #666; font-size: 13px;\">\n          Tam: ${item.size}${color?.name ? ` | Cor: ${color.name}` : \"\"}${item.printPosition ? ` | Estampa: ${item.printPosition}` : \"\"}\n        </span>\n      </td>\n      <td style=\"padding: 12px 0; text-align: center;\">${item.quantity}</td>\n      <td style=\"padding: 12px 0; text-align: right;\">R$ ${item.unitPrice}</td>\n      <td style=\"padding: 12px 0; text-align: right; font-weight: bold;\">R$ ${item.subtotal}</td>\n    </tr>`;\n  }).join(\"\");\n}\n\nasync function getEmailLogoUrl(): Promise<string> {\n  try {\n    const results = await db.select().from(siteSettings).where(eq(siteSettings.key, \"email_logo_url\")).limit(1);\n    return results[0]?.value || \"\";\n  } catch {\n    return \"\";\n  }\n}\n\nasync function buildOrderVariables(order: any, items?: any[]): Promise<Record<string, string>> {\n  const address = [\n    order.street,\n    order.number,\n    order.complement ? `- ${order.complement}` : \"\",\n    `\\n${order.neighborhood}`,\n    `\\n${order.city} - ${order.state}`,\n    `\\nCEP: ${order.zipCode}`\n  ].filter(Boolean).join(\", \").replace(\", \\n\", \"\\n\");\n\n  const logoUrl = await getEmailLogoUrl();\n\n  const variables: Record<string, string> = {\n    logo_url: logoUrl,\n    nome: order.customerName || \"\",\n    email: order.customerEmail || \"\",\n    cpf: order.customerCpf || \"\",\n    telefone: order.customerPhone || \"\",\n    endereco: address,\n    numero_pedido: order.orderNumber || \"\",\n    subtotal: `R$ ${order.subtotal}`,\n    frete: `R$ ${order.shippingCost}`,\n    total: `R$ ${order.totalAmount}`,\n    metodo_pagamento: order.paymentMethod || \"N√£o informado\",\n    codigo_rastreio: order.trackingCode || \"\",\n    data_pedido: order.createdAt ? new Date(order.createdAt).toLocaleDateString(\"pt-BR\") : new Date().toLocaleDateString(\"pt-BR\"),\n    link_rastreio: (() => {\n      let baseUrl = process.env.APP_URL \n        || (process.env.REPL_SLUG && process.env.REPL_OWNER \n          ? `https://${process.env.REPL_SLUG}.${process.env.REPL_OWNER}.repl.co` \n          : (process.env.REPLIT_DEV_DOMAIN \n            ? `https://${process.env.REPLIT_DEV_DOMAIN}` \n            : \"http://localhost:5000\"));\n      baseUrl = baseUrl.replace(/\\/+$/, '');\n      const code = order.trackingCode || order.orderNumber || \"\";\n      return code ? `${baseUrl}/rastreio?codigo=${encodeURIComponent(code)}` : `${baseUrl}/rastreio`;\n    })(),\n  };\n\n  if (items && items.length > 0) {\n    variables.itens = `<table style=\"width: 100%; border-collapse: collapse;\">\n      <thead>\n        <tr style=\"border-bottom: 2px solid #ddd;\">\n          <th style=\"padding: 8px 0; text-align: left;\">Produto</th>\n          <th style=\"padding: 8px 0; text-align: center;\">Qtd</th>\n          <th style=\"padding: 8px 0; text-align: right;\">Pre√ßo</th>\n          <th style=\"padding: 8px 0; text-align: right;\">Subtotal</th>\n        </tr>\n      </thead>\n      <tbody>${buildItemsHtml(items)}</tbody>\n    </table>`;\n  }\n\n  return variables;\n}\n\nexport async function sendOrderConfirmationEmail(order: any, items: any[]): Promise<boolean> {\n  try {\n    const template = await getTemplate(\"order_confirmation\");\n    if (!template || !template.enabled) {\n      console.log(\"‚ö†Ô∏è [EMAIL] Template de confirma√ß√£o desabilitado ou n√£o encontrado\");\n      return false;\n    }\n\n    const variables = await buildOrderVariables(order, items);\n    const subject = replaceTemplateVariables(template.subject, variables);\n    const html = replaceTemplateVariables(template.htmlContent, variables);\n\n    const result = await sendEmail(order.customerEmail, subject, html);\n    if (result) {\n      await storage.updateOrder(order.id, { confirmationEmailSentAt: new Date() });\n    }\n    return result;\n  } catch (error) {\n    console.error(\"‚ùå [EMAIL] Erro ao enviar confirma√ß√£o de pedido:\", error);\n    return false;\n  }\n}\n\nexport async function sendTrackingCodeEmail(order: any): Promise<boolean> {\n  try {\n    const template = await getTemplate(\"tracking_code\");\n    if (!template || !template.enabled) {\n      console.log(\"‚ö†Ô∏è [EMAIL] Template de rastreio desabilitado ou n√£o encontrado\");\n      return false;\n    }\n\n    const variables = await buildOrderVariables(order);\n    const subject = replaceTemplateVariables(template.subject, variables);\n    const html = replaceTemplateVariables(template.htmlContent, variables);\n\n    const result = await sendEmail(order.customerEmail, subject, html);\n    if (result) {\n      await storage.updateOrder(order.id, { trackingEmailSentAt: new Date() });\n    }\n    return result;\n  } catch (error) {\n    console.error(\"‚ùå [EMAIL] Erro ao enviar c√≥digo de rastreio:\", error);\n    return false;\n  }\n}\n\nexport async function sendNewsletterWelcomeEmail(subscriberEmail: string): Promise<boolean> {\n  try {\n    const template = await getTemplate(\"newsletter_welcome\");\n    if (!template || !template.enabled) {\n      console.log(\"‚ö†Ô∏è [EMAIL] Template de boas-vindas newsletter desabilitado ou n√£o encontrado\");\n      return false;\n    }\n\n    const logoUrl = await getEmailLogoUrl();\n    const variables: Record<string, string> = {\n      logo_url: logoUrl,\n      email: subscriberEmail,\n    };\n\n    const subject = replaceTemplateVariables(template.subject, variables);\n    const html = replaceTemplateVariables(template.htmlContent, variables);\n\n    return await sendEmail(subscriberEmail, subject, html);\n  } catch (error) {\n    console.error(\"‚ùå [EMAIL] Erro ao enviar email de boas-vindas newsletter:\", error);\n    return false;\n  }\n}\n","path":null,"size_bytes":7778,"size_tokens":null},"server/cache.ts":{"content":"interface CacheEntry<T> {\n  data: T;\n  expiry: number;\n}\n\nclass SimpleCache {\n  private cache = new Map<string, CacheEntry<any>>();\n\n  get<T>(key: string): T | null {\n    const entry = this.cache.get(key);\n    if (!entry) return null;\n    if (Date.now() > entry.expiry) {\n      this.cache.delete(key);\n      return null;\n    }\n    return entry.data;\n  }\n\n  set<T>(key: string, data: T, ttlSeconds: number): void {\n    this.cache.set(key, {\n      data,\n      expiry: Date.now() + ttlSeconds * 1000\n    });\n  }\n\n  invalidate(key: string): void {\n    this.cache.delete(key);\n  }\n\n  invalidatePattern(pattern: string): void {\n    const keys = Array.from(this.cache.keys());\n    for (const key of keys) {\n      if (key.includes(pattern)) {\n        this.cache.delete(key);\n      }\n    }\n  }\n}\n\nexport const cache = new SimpleCache();\n\nexport const CACHE_TTL = {\n  PRODUCTS: 60,\n  BANNERS: 300,\n  VERSE: 3600,\n  COMPANY_INFO: 600,\n  FREE_SHIPPING: 300\n} as const;\n","path":null,"size_bytes":957,"size_tokens":null},"client/src/components/admin/AdminCompanyInfo.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card } from \"@/components/ui/card\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\n\ninterface CompanyInfo {\n  id: string;\n  companyName: string;\n  cnpj: string;\n  street: string;\n  number: string;\n  complement?: string;\n  neighborhood: string;\n  city: string;\n  state: string;\n  zipCode: string;\n  phone?: string;\n  email?: string;\n  copyrightYear: number;\n}\n\nexport default function AdminCompanyInfo() {\n  const { toast } = useToast();\n  const [formData, setFormData] = useState({\n    companyName: \"\",\n    cnpj: \"\",\n    street: \"\",\n    number: \"\",\n    complement: \"\",\n    neighborhood: \"\",\n    city: \"\",\n    state: \"\",\n    zipCode: \"\",\n    phone: \"\",\n    email: \"\",\n    copyrightYear: new Date().getFullYear(),\n  });\n\n  const { data: companyData, isLoading } = useQuery<{ company: CompanyInfo | null }>({\n    queryKey: ['/api/admin/company-info'],\n  });\n\n  useEffect(() => {\n    if (companyData?.company) {\n      setFormData({\n        companyName: companyData.company.companyName,\n        cnpj: companyData.company.cnpj,\n        street: companyData.company.street,\n        number: companyData.company.number,\n        complement: companyData.company.complement || \"\",\n        neighborhood: companyData.company.neighborhood,\n        city: companyData.company.city,\n        state: companyData.company.state,\n        zipCode: companyData.company.zipCode,\n        phone: companyData.company.phone || \"\",\n        email: companyData.company.email || \"\",\n        copyrightYear: companyData.company.copyrightYear,\n      });\n    }\n  }, [companyData]);\n\n  const updateMutation = useMutation({\n    mutationFn: async (data: typeof formData) => {\n      const response = await apiRequest(\"POST\", \"/api/admin/company-info\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/company-info'] });\n      queryClient.invalidateQueries({ queryKey: ['/api/company-info'] });\n      toast({\n        title: \"salvo com sucesso\",\n        description: \"informa√ß√µes da empresa atualizadas\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Update error:\", error);\n      toast({\n        title: \"erro ao salvar\",\n        description: error?.message || \"tente novamente\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateMutation.mutate(formData);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div>\n        <h1 className=\"text-2xl sm:text-3xl font-light lowercase mb-2\">informa√ß√µes da empresa</h1>\n        <p className=\"text-sm sm:text-base text-muted-foreground lowercase\">gerencie dados da empresa para o rodap√©</p>\n      </div>\n\n      <Card className=\"p-6\">\n        <form onSubmit={handleSubmit} className=\"space-y-6\">\n          <div className=\"grid gap-4\">\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"companyName\" className=\"lowercase\">nome da empresa (opcional)</Label>\n                <Input\n                  id=\"companyName\"\n                  value={formData.companyName}\n                  onChange={(e) => setFormData({ ...formData, companyName: e.target.value })}\n                  placeholder=\"ex: Oudla Ltda\"\n                  data-testid=\"input-company-name\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"cnpj\" className=\"lowercase\">cnpj (opcional)</Label>\n                <Input\n                  id=\"cnpj\"\n                  value={formData.cnpj}\n                  onChange={(e) => setFormData({ ...formData, cnpj: e.target.value })}\n                  placeholder=\"ex: 12.345.678/0001-90\"\n                  data-testid=\"input-cnpj\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"street\" className=\"lowercase\">rua (opcional)</Label>\n              <Input\n                id=\"street\"\n                value={formData.street}\n                onChange={(e) => setFormData({ ...formData, street: e.target.value })}\n                placeholder=\"ex: Rua das Flores\"\n                data-testid=\"input-street\"\n              />\n            </div>\n\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"number\" className=\"lowercase\">n√∫mero (opcional)</Label>\n                <Input\n                  id=\"number\"\n                  value={formData.number}\n                  onChange={(e) => setFormData({ ...formData, number: e.target.value })}\n                  placeholder=\"ex: 123\"\n                  data-testid=\"input-number\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"complement\" className=\"lowercase\">complemento (opcional)</Label>\n                <Input\n                  id=\"complement\"\n                  value={formData.complement}\n                  onChange={(e) => setFormData({ ...formData, complement: e.target.value })}\n                  placeholder=\"ex: Apto 10\"\n                  data-testid=\"input-complement\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"neighborhood\" className=\"lowercase\">bairro (opcional)</Label>\n              <Input\n                id=\"neighborhood\"\n                value={formData.neighborhood}\n                onChange={(e) => setFormData({ ...formData, neighborhood: e.target.value })}\n                placeholder=\"ex: Centro\"\n                data-testid=\"input-neighborhood\"\n              />\n            </div>\n\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"city\" className=\"lowercase\">cidade (opcional)</Label>\n                <Input\n                  id=\"city\"\n                  value={formData.city}\n                  onChange={(e) => setFormData({ ...formData, city: e.target.value })}\n                  placeholder=\"ex: S√£o Paulo\"\n                  data-testid=\"input-city\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"state\" className=\"lowercase\">estado (opcional)</Label>\n                <Input\n                  id=\"state\"\n                  value={formData.state}\n                  onChange={(e) => setFormData({ ...formData, state: e.target.value })}\n                  placeholder=\"ex: SP\"\n                  maxLength={2}\n                  data-testid=\"input-state\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"zipCode\" className=\"lowercase\">cep (opcional)</Label>\n              <Input\n                id=\"zipCode\"\n                value={formData.zipCode}\n                onChange={(e) => setFormData({ ...formData, zipCode: e.target.value })}\n                placeholder=\"ex: 01310-100\"\n                data-testid=\"input-zipcode\"\n              />\n            </div>\n\n            <div className=\"grid sm:grid-cols-2 gap-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"phone\" className=\"lowercase\">telefone (opcional)</Label>\n                <Input\n                  id=\"phone\"\n                  value={formData.phone}\n                  onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\n                  placeholder=\"ex: (11) 3000-0000\"\n                  data-testid=\"input-phone\"\n                />\n              </div>\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"email\" className=\"lowercase\">email de suporte / sac (exibido no rodap√©)</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  value={formData.email}\n                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}\n                  placeholder=\"ex: sac@oudla.com\"\n                  data-testid=\"input-email\"\n                />\n              </div>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label htmlFor=\"copyrightYear\" className=\"lowercase\">ano de copyright</Label>\n              <Input\n                id=\"copyrightYear\"\n                type=\"number\"\n                value={formData.copyrightYear}\n                onChange={(e) => setFormData({ ...formData, copyrightYear: parseInt(e.target.value) })}\n                data-testid=\"input-copyright-year\"\n              />\n            </div>\n          </div>\n\n          <Button\n            type=\"submit\"\n            disabled={updateMutation.isPending || isLoading}\n            className=\"w-full sm:w-auto lowercase\"\n            data-testid=\"button-save-company\"\n          >\n            {updateMutation.isPending ? \"salvando...\" : \"salvar informa√ß√µes\"}\n          </Button>\n        </form>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":9279,"size_tokens":null},"client/src/components/ReviewsModal.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogHeader,\n  DialogTitle,\n} from \"@/components/ui/dialog\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { Star } from \"lucide-react\";\n\ninterface Review {\n  id: string;\n  productId: string;\n  userName: string;\n  userCity?: string;\n  userImage?: string;\n  rating: number;\n  comment: string;\n  reviewImage?: string;\n  createdAt: string;\n}\n\ninterface ReviewsModalProps {\n  productId: string;\n  isOpen: boolean;\n  onOpenChange: (open: boolean) => void;\n  productName: string;\n}\n\nexport default function ReviewsModal({\n  productId,\n  isOpen,\n  onOpenChange,\n  productName,\n}: ReviewsModalProps) {\n  const { data: reviewsData, isLoading } = useQuery<{ reviews: Review[] }>({\n    queryKey: ['/api/products', productId, 'admin-reviews'],\n    enabled: isOpen && !!productId,\n  });\n\n  const reviews = reviewsData?.reviews || [];\n  const averageRating =\n    reviews.length > 0\n      ? (reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length).toFixed(1)\n      : \"0.0\";\n\n  return (\n    <Dialog open={isOpen} onOpenChange={onOpenChange}>\n      <DialogContent className=\"max-h-[80vh] overflow-y-auto max-w-2xl\">\n        <DialogHeader>\n          <DialogTitle className=\"text-lg lowercase\">\n            avalia√ß√µes de {productName}\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-8\">\n          {/* Rating Summary - Apple Style Simplified */}\n          <div className=\"bg-muted/30 rounded-3xl p-8 flex flex-col items-center justify-center gap-4 border\">\n            <div className=\"flex flex-col items-center gap-1\">\n              <div className=\"text-7xl font-bold tracking-tighter\">\n                {averageRating}\n              </div>\n              <div className=\"text-sm text-muted-foreground font-medium lowercase\">\n                m√©dia de {reviews.length} {reviews.length === 1 ? \"avalia√ß√£o\" : \"avalia√ß√µes\"}\n              </div>\n              <div className=\"flex items-center gap-1.5 mt-2 relative\">\n                {[...Array(5)].map((_, i) => {\n                  const rating = parseFloat(averageRating);\n                  const fillPercentage = Math.max(0, Math.min(1, rating - i)) * 100;\n                  \n                  return (\n                    <div key={i} className=\"relative h-6 w-6\">\n                      {/* Background Star (Empty) */}\n                      <Star className=\"h-6 w-6 text-muted-foreground/20 absolute inset-0\" />\n                      \n                      {/* Foreground Star (Proportional Fill) */}\n                      {fillPercentage > 0 && (\n                        <div \n                          className=\"absolute inset-0 overflow-hidden\"\n                          style={{ width: `${fillPercentage}%` }}\n                        >\n                          <Star className=\"h-6 w-6 fill-amber-400 text-amber-400 flex-shrink-0\" />\n                        </div>\n                      )}\n                    </div>\n                  );\n                })}\n              </div>\n            </div>\n          </div>\n\n          {/* Reviews List */}\n          {isLoading ? (\n            <div className=\"space-y-4\">\n              {[...Array(3)].map((_, i) => (\n                <div key={i} className=\"h-32 bg-muted animate-pulse rounded\" />\n              ))}\n            </div>\n          ) : reviews.length > 0 ? (\n            <div className=\"space-y-4\">\n              {reviews.map((review) => (\n                <div\n                  key={review.id}\n                  className=\"border rounded-lg p-4 space-y-3\"\n                  data-testid={`review-item-${review.id}`}\n                >\n                  {/* Reviewer Info */}\n                  <div className=\"flex items-start gap-3\">\n                    <Avatar className=\"h-10 w-10 flex-shrink-0\">\n                      {review.userImage && (\n                        <AvatarImage src={review.userImage} />\n                      )}\n                      <AvatarFallback>\n                        {review.userName[0]?.toUpperCase()}\n                      </AvatarFallback>\n                    </Avatar>\n\n                    <div className=\"flex-1 min-w-0\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div>\n                          <p className=\"font-medium text-sm\">\n                            {review.userName}\n                          </p>\n                          {review.userCity && (\n                            <p className=\"text-[10px] text-muted-foreground lowercase\">\n                              {review.userCity}\n                            </p>\n                          )}\n                        </div>\n                        <div className=\"flex items-center gap-1\">\n                          {[...Array(5)].map((_, i) => (\n                            <Star\n                              key={i}\n                              className={`h-3 w-3 ${\n                                i < review.rating\n                                  ? \"fill-current text-amber-400\"\n                                  : \"text-muted-foreground\"\n                              }`}\n                            />\n                          ))}\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Comment */}\n                  <p className=\"text-sm text-muted-foreground leading-relaxed\">\n                    {review.comment}\n                  </p>\n\n                  {/* Review Image */}\n                  {review.reviewImage && (\n                    <img\n                      src={review.reviewImage}\n                      alt=\"avalia√ß√£o\"\n                      className=\"max-h-48 rounded-lg object-cover w-full\"\n                      data-testid={`review-image-${review.id}`}\n                      loading=\"lazy\"\n                      decoding=\"async\"\n                    />\n                  )}\n                </div>\n              ))}\n            </div>\n          ) : (\n            <div className=\"text-center py-12\">\n              <p className=\"text-muted-foreground lowercase\">\n                nenhuma avalia√ß√£o cadastrada ainda\n              </p>\n            </div>\n          )}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","path":null,"size_bytes":6350,"size_tokens":null},"client/src/components/admin/AdminGlobalCoupon.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { motion } from \"framer-motion\";\nimport { Trash2, Plus } from \"lucide-react\";\n\nexport default function AdminGlobalCoupon() {\n  const { toast } = useToast();\n  const [newCode, setNewCode] = useState(\"\");\n  const [newDescription, setNewDescription] = useState(\"desconto especial\");\n  const [newDiscountValue, setNewDiscountValue] = useState(\"10\");\n\n  const { data: couponsData, isLoading } = useQuery<{ coupons: any[] }>({\n    queryKey: ['/api/admin/global-coupons'],\n  });\n\n  const coupons = couponsData?.coupons || [];\n\n  const createMutation = useMutation({\n    mutationFn: async () => {\n      return await apiRequest(\"POST\", \"/api/admin/global-coupons\", {\n        code: newCode,\n        description: newDescription,\n        discountValue: newDiscountValue,\n        discountType: \"percentage\",\n        isActive: true,\n      });\n    },\n    onSuccess: () => {\n      toast({ title: \"cupom criado com sucesso\" });\n      setNewCode(\"\");\n      setNewDescription(\"frete gr√°tis\");\n      setNewDiscountValue(\"0\");\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/global-coupons'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao criar cupom\", variant: \"destructive\" });\n    }\n  });\n\n  const toggleMutation = useMutation({\n    mutationFn: async (couponId: string) => {\n      const coupon = coupons.find((c: any) => c.id === couponId);\n      return await apiRequest(\"PATCH\", `/api/admin/global-coupons/${couponId}`, {\n        isActive: !coupon.isActive,\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/global-coupons'] });\n    },\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (couponId: string) => {\n      return await apiRequest(\"DELETE\", `/api/admin/global-coupons/${couponId}`);\n    },\n    onSuccess: () => {\n      toast({ title: \"cupom removido\" });\n      queryClient.invalidateQueries({ queryKey: ['/api/admin/global-coupons'] });\n    },\n  });\n\n  if (isLoading) {\n    return <div className=\"p-6 text-center text-muted-foreground lowercase\">carregando...</div>;\n  }\n\n  return (\n    <div className=\"p-6 space-y-6\">\n      <Card className=\"p-6\">\n        <h3 className=\"text-lg font-medium lowercase mb-4\">criar novo cupom</h3>\n        <div className=\"space-y-4\">\n          <div>\n            <label className=\"block text-sm font-medium lowercase mb-2\">c√≥digo do cupom</label>\n            <Input\n              placeholder=\"ex: fretegratis2025\"\n              value={newCode}\n              onChange={(e) => setNewCode(e.target.value.toUpperCase())}\n              className=\"lowercase\"\n              data-testid=\"input-coupon-code\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium lowercase mb-2\">descri√ß√£o</label>\n            <Input\n              placeholder=\"ex: frete gr√°tis\"\n              value={newDescription}\n              onChange={(e) => setNewDescription(e.target.value)}\n              className=\"lowercase\"\n              data-testid=\"input-coupon-desc\"\n            />\n          </div>\n          <div>\n            <label className=\"block text-sm font-medium lowercase mb-2\">desconto (%)</label>\n            <Input\n              type=\"number\"\n              placeholder=\"0\"\n              value={newDiscountValue}\n              onChange={(e) => setNewDiscountValue(e.target.value)}\n              data-testid=\"input-coupon-value\"\n            />\n          </div>\n          <Button\n            onClick={() => createMutation.mutate()}\n            disabled={!newCode || createMutation.isPending}\n            className=\"w-full lowercase\"\n            data-testid=\"button-create-coupon\"\n          >\n            <Plus className=\"w-4 h-4 mr-2\" />\n            {createMutation.isPending ? \"criando...\" : \"criar cupom\"}\n          </Button>\n        </div>\n      </Card>\n\n      <div className=\"space-y-3\">\n        <h3 className=\"text-lg font-medium lowercase\">cupons ativos</h3>\n        {coupons.length === 0 ? (\n          <p className=\"text-sm text-muted-foreground lowercase\">nenhum cupom criado</p>\n        ) : (\n          coupons.map((coupon: any) => (\n            <motion.div\n              key={coupon.id}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n            >\n              <Card className={`p-4 ${coupon.isActive ? \"\" : \"opacity-50\"}`}>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                    <p className=\"font-medium lowercase\" data-testid={`text-code-${coupon.id}`}>\n                      {coupon.code}\n                    </p>\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      {coupon.description} ¬∑ <span className=\"font-medium\">{coupon.discountValue}% off</span>\n                    </p>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    <Button\n                      variant={coupon.isActive ? \"default\" : \"outline\"}\n                      size=\"sm\"\n                      onClick={() => toggleMutation.mutate(coupon.id)}\n                      disabled={toggleMutation.isPending}\n                      className=\"lowercase text-xs\"\n                      data-testid={`button-toggle-${coupon.id}`}\n                    >\n                      {coupon.isActive ? \"ativo\" : \"inativo\"}\n                    </Button>\n                    <Button\n                      variant=\"ghost\"\n                      size=\"icon\"\n                      onClick={() => deleteMutation.mutate(coupon.id)}\n                      disabled={deleteMutation.isPending}\n                      data-testid={`button-delete-${coupon.id}`}\n                      className=\"text-destructive hover:text-destructive\"\n                    >\n                      <Trash2 className=\"w-4 h-4\" />\n                    </Button>\n                  </div>\n                </div>\n              </Card>\n            </motion.div>\n          ))\n        )}\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":6462,"size_tokens":null},"DEPLOY.md":{"content":"# OUDLA - Guia de Deploy\n\n## Pr√©-requisitos\n\n- Node.js 20+\n- PostgreSQL (Supabase, Neon, ou qualquer inst√¢ncia)\n- Dom√≠nio configurado (para SSL e webhooks do Mercado Pago)\n\n## Vari√°veis de Ambiente\n\nCopie `.env.example` para `.env` e preencha:\n\n```bash\ncp .env.example .env\n```\n\n### Obrigat√≥rias\n\n| Vari√°vel | Descri√ß√£o |\n|----------|-----------|\n| `DATABASE_URL` | URL do PostgreSQL (Supabase) |\n| `SESSION_SECRET` | M√≠nimo 32 caracteres. Gere com: `openssl rand -hex 32` |\n| `APP_URL` | URL p√∫blica do app (ex: `https://oudla.com.br`) |\n| `NODE_ENV` | `production` |\n| `PORT` | Porta do servidor (padr√£o: 3000) |\n| `TRUST_PROXY` | `true` se atr√°s de nginx/load balancer |\n\n### Mercado Pago\n\n| Vari√°vel | Descri√ß√£o |\n|----------|-----------|\n| `MERCADOPAGO_ACCESS_TOKEN` | Token de produ√ß√£o |\n| `MERCADOPAGO_PUBLIC_KEY` | Chave p√∫blica de produ√ß√£o |\n| `MERCADOPAGO_WEBHOOK_SECRET` | Secret do webhook |\n\n### Mailgun (regi√£o EU)\n\n| Vari√°vel | Descri√ß√£o |\n|----------|-----------|\n| `MAILGUN_API_KEY` | API key do Mailgun |\n| `MAILGUN_DOMAIN` | Dom√≠nio configurado no Mailgun |\n| `MAILGUN_WEBHOOK_SIGNING_KEY` | Chave de assinatura dos webhooks |\n\n---\n\n## Op√ß√£o 1: Oracle Free Tier (Ubuntu ARM)\n\n### Setup autom√°tico\n\n```bash\nsudo bash deploy/setup-oracle.sh\n```\n\n### Setup manual\n\n```bash\n# 1. Clone o projeto\ngit clone <repo> /home/ubuntu/oudla\ncd /home/ubuntu/oudla\n\n# 2. Configure o ambiente\ncp .env.example .env\nnano .env\n\n# 3. Instale depend√™ncias e fa√ßa build\nnpm ci\nnpm run build\n\n# 4. Teste se funciona\nnode dist/index.js\n# Ctrl+C para parar\n\n# 5. Configure nginx\nsudo cp deploy/nginx.conf /etc/nginx/sites-available/oudla\nsudo nano /etc/nginx/sites-available/oudla  # edite \"seu-dominio.com\"\nsudo ln -s /etc/nginx/sites-available/oudla /etc/nginx/sites-enabled/\nsudo rm -f /etc/nginx/sites-enabled/default\nsudo nginx -t && sudo systemctl reload nginx\n\n# 6. SSL com Certbot\nsudo certbot --nginx -d seu-dominio.com -d www.seu-dominio.com\n\n# 7. Inicie com PM2\npm2 start ecosystem.config.cjs\npm2 startup\npm2 save\n```\n\n### Atualizar o app (Oracle)\n\n```bash\ncd /home/ubuntu/oudla\ngit pull\nnpm ci\nnpm run build\npm2 restart oudla\n```\n\n---\n\n## Op√ß√£o 2: Docker (qualquer plataforma)\n\n### Build e execu√ß√£o\n\n```bash\n# Build da imagem\ndocker build -t oudla .\n\n# Executar\ndocker run -d \\\n  --name oudla \\\n  --restart unless-stopped \\\n  -p 3000:3000 \\\n  --env-file .env \\\n  oudla\n```\n\n### Com Docker Compose\n\n```bash\n# Copie e configure o .env\ncp .env.example .env\nnano .env\n\n# Suba o container\ndocker compose up -d\n\n# Ver logs\ndocker compose logs -f\n\n# Atualizar\ndocker compose down\ndocker compose build --no-cache\ndocker compose up -d\n```\n\nA imagem Docker funciona em AMD64 e ARM64 (Oracle Ampere, Apple Silicon).\n\n---\n\n## Op√ß√£o 3: Fly.io\n\n### Primeiro deploy\n\n```bash\n# Instale o flyctl\ncurl -L https://fly.io/install.sh | sh\n\n# Login\nfly auth login\n\n# Crie o app (regi√£o S√£o Paulo)\nfly launch --no-deploy\n\n# Configure os secrets\nfly secrets set DATABASE_URL=\"postgresql://...\"\nfly secrets set SESSION_SECRET=\"$(openssl rand -hex 32)\"\nfly secrets set APP_URL=\"https://oudla.fly.dev\"\nfly secrets set MERCADOPAGO_ACCESS_TOKEN=\"...\"\nfly secrets set MERCADOPAGO_PUBLIC_KEY=\"...\"\nfly secrets set MERCADOPAGO_WEBHOOK_SECRET=\"...\"\nfly secrets set MAILGUN_API_KEY=\"...\"\nfly secrets set MAILGUN_DOMAIN=\"...\"\nfly secrets set MAILGUN_WEBHOOK_SIGNING_KEY=\"...\"\n\n# Deploy\nfly deploy\n\n# Dom√≠nio customizado (opcional)\nfly certs create seu-dominio.com\n```\n\n### Atualizar (Fly.io)\n\n```bash\nfly deploy\n```\n\n---\n\n## Op√ß√£o 4: VPS gen√©rica (DigitalOcean, Hetzner, Contabo, etc.)\n\nSiga os mesmos passos da Oracle Free Tier. Os scripts funcionam em qualquer Ubuntu 22.04+.\n\nPara outras distribui√ß√µes Linux:\n1. Instale Node.js 20, nginx e certbot pelo gerenciador de pacotes da distro\n2. O restante dos passos √© id√™ntico\n\n---\n\n## Op√ß√£o 5: Replit\n\nO app j√° est√° configurado para funcionar no Replit sem altera√ß√µes. Basta clicar em \"Deploy\" no painel do Replit.\n\n---\n\n## Verifica√ß√£o p√≥s-deploy\n\nAp√≥s o deploy, verifique:\n\n1. **App rodando:** acesse `https://seu-dominio.com` e veja a homepage\n2. **API funcionando:** acesse `https://seu-dominio.com/api/products`\n3. **Banco conectado:** verifique no log se aparece `Database connection successful`\n4. **Mercado Pago:** teste um checkout sandbox\n5. **Webhooks:** configure no painel do Mercado Pago: `https://seu-dominio.com/api/checkout/webhook`\n6. **Mailgun webhooks:** configure no painel do Mailgun: `https://seu-dominio.com/api/email/webhook/mailgun`\n7. **SSL:** verifique se o cadeado aparece no navegador\n\n## Webhooks a configurar\n\n| Servi√ßo | URL | Eventos |\n|---------|-----|---------|\n| Mercado Pago | `https://dominio/api/checkout/webhook` | payment |\n| Mailgun | `https://dominio/api/email/webhook/mailgun` | delivered, opened, clicked, failed, bounced, complained, unsubscribed |\n\n## Estrutura de produ√ß√£o\n\n```\ndist/\n‚îú‚îÄ‚îÄ index.js          # Servidor Express compilado\n‚îî‚îÄ‚îÄ public/           # Frontend compilado (HTML, JS, CSS)\nattached_assets/      # Imagens est√°ticas do produto\npublic/\n‚îú‚îÄ‚îÄ uploads/          # Uploads de imagem (banners, etc.)\n‚îî‚îÄ‚îÄ reviews/          # Fotos de reviews\nlogs/                 # Logs do PM2 (Oracle)\n```\n\n## Notas Importantes\n\n### Sess√µes (MemoryStore)\nO app usa MemoryStore para sess√µes. Isso significa que:\n- Sess√µes de login (admin) s√£o perdidas ao reiniciar o servidor\n- Funciona perfeitamente para inst√¢ncia √∫nica (Oracle, VPS, Fly.io com 1 m√°quina)\n- Se precisar de m√∫ltiplas inst√¢ncias, substitua por `connect-pg-simple` no `server/index.ts`\n\n### Uploads e Imagens\n- `attached_assets/` - imagens est√°ticas do produto (inclu√≠das no build/Docker)\n- `public/uploads/` - uploads din√¢micos (banners, etc.) - use volumes persistentes\n- `public/reviews/` - fotos de reviews - use volumes persistentes\n\n---\n\n## Troubleshooting\n\n### Erro: \"DATABASE_URL must be set\"\nConfigure a vari√°vel `DATABASE_URL` no `.env` ou nos secrets da plataforma.\n\n### Erro: \"SESSION_SECRET n√£o configurado\"\nO `SESSION_SECRET` precisa ter pelo menos 32 caracteres.\n\n### Cookies n√£o funcionam (login admin)\nVerifique se `TRUST_PROXY=true` est√° configurado quando atr√°s de nginx/proxy.\n\n### Imagens n√£o carregam\nCertifique-se de que as pastas `attached_assets/`, `public/uploads/` e `public/reviews/` existem e t√™m as permiss√µes corretas.\n\n### Mercado Pago retorna para URL errada\nConfigure `APP_URL` com a URL p√∫blica correta (com https, sem barra no final).\n","path":null,"size_bytes":6505,"size_tokens":null},"client/src/components/NewsletterSection.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertNewsletterSubscriberSchema, type NewsletterSettings } from \"@shared/schema\";\nimport { Form, FormControl, FormField, FormItem, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { motion } from \"framer-motion\";\nimport { ArrowRight, CheckCircle2 } from \"lucide-react\";\n\nexport default function NewsletterSection() {\n  const { toast } = useToast();\n  const [isSubscribed, setIsSubscribed] = useState(false);\n\n  useEffect(() => {\n    const subscribed = localStorage.getItem(\"newsletter_subscribed\") === \"true\";\n    if (subscribed) {\n      setIsSubscribed(true);\n    }\n  }, []);\n\n  const { data: settings } = useQuery<NewsletterSettings>({\n    queryKey: [\"/api/newsletter/settings\"],\n  });\n\n  const form = useForm({\n    resolver: zodResolver(insertNewsletterSubscriberSchema),\n    defaultValues: {\n      email: \"\",\n    },\n  });\n\n  const mutation = useMutation({\n    mutationFn: async (values: { email: string }) => {\n      const res = await apiRequest(\"POST\", \"/api/newsletter/subscribe\", values);\n      return res.json();\n    },\n    onSuccess: () => {\n      setIsSubscribed(true);\n      localStorage.setItem(\"newsletter_subscribed\", \"true\");\n      toast({\n        title: \"sucesso!\",\n        description: \"voc√™ foi cadastrado na nossa newsletter.\",\n      });\n      form.reset();\n    },\n    onError: (error: any) => {\n      toast({\n        variant: \"destructive\",\n        title: \"erro\",\n        description: error.message || \"ocorreu um erro ao tentar se cadastrar.\",\n      });\n    },\n  });\n\n  if (!settings) return null;\n\n  return (\n    <section className=\"relative py-28 md:py-40 px-6 overflow-hidden bg-muted/50 dark:bg-muted/20\">\n      <div className=\"relative max-w-md mx-auto text-center\">\n        <motion.div\n          initial={{ opacity: 0, y: 24 }}\n          whileInView={{ opacity: 1, y: 0 }}\n          viewport={{ once: true, margin: \"-80px\" }}\n          transition={{ duration: 0.7, ease: [0.25, 0.1, 0.25, 1] }}\n        >\n          <h2 className=\"text-4xl md:text-5xl font-extralight tracking-tight lowercase leading-[1.1] text-foreground\">\n            {settings.title}\n          </h2>\n\n          <p className=\"text-muted-foreground text-[15px] lowercase mt-5 leading-relaxed\">\n            {settings.description}\n          </p>\n        </motion.div>\n\n        <motion.div\n          initial={{ opacity: 0, y: 16 }}\n          whileInView={{ opacity: 1, y: 0 }}\n          viewport={{ once: true, margin: \"-80px\" }}\n          transition={{ duration: 0.7, delay: 0.12, ease: [0.25, 0.1, 0.25, 1] }}\n          className=\"mt-10\"\n        >\n          {!isSubscribed ? (\n            <Form {...form}>\n              <form\n                onSubmit={form.handleSubmit((data) => mutation.mutate(data))}\n                className=\"space-y-3\"\n              >\n                <FormField\n                  control={form.control}\n                  name=\"email\"\n                  render={({ field }) => (\n                    <FormItem className=\"space-y-0\">\n                      <FormControl>\n                        <Input\n                          placeholder=\"seu e-mail\"\n                          className=\"h-14 px-6 rounded-full bg-background border border-border/50 text-foreground placeholder:text-muted-foreground/40 text-base focus-visible:ring-1 focus-visible:ring-foreground/10 text-center\"\n                          {...field}\n                          data-testid=\"input-newsletter-email\"\n                        />\n                      </FormControl>\n                      <FormMessage className=\"text-[11px] mt-2.5 text-red-500 dark:text-red-400 pl-6\" />\n                    </FormItem>\n                  )}\n                />\n                <Button\n                  type=\"submit\"\n                  disabled={mutation.isPending}\n                  className=\"w-full h-14 rounded-full bg-foreground text-background text-[15px] font-medium lowercase gap-2 mt-1\"\n                  data-testid=\"button-newsletter-submit\"\n                >\n                  {mutation.isPending ? \"enviando...\" : settings.buttonText}\n                  {!mutation.isPending && <ArrowRight className=\"h-4 w-4\" />}\n                </Button>\n              </form>\n            </Form>\n          ) : (\n            <motion.div\n              initial={{ opacity: 0, scale: 0.96 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.5, ease: [0.25, 0.1, 0.25, 1] }}\n              className=\"inline-flex items-center gap-2.5 h-14 px-8 rounded-full bg-background border border-border/50 text-foreground text-[15px] lowercase\"\n            >\n              <CheckCircle2 className=\"h-4 w-4 text-green-500 dark:text-green-400\" />\n              obrigado por se inscrever!\n            </motion.div>\n          )}\n        </motion.div>\n\n        {settings.disclaimerText && (\n          <motion.p\n            initial={{ opacity: 0 }}\n            whileInView={{ opacity: 1 }}\n            viewport={{ once: true }}\n            transition={{ duration: 0.7, delay: 0.25 }}\n            className=\"mt-8 text-[11px] text-muted-foreground/50 lowercase tracking-wide\"\n          >\n            {settings.disclaimerText}\n          </motion.p>\n        )}\n      </div>\n    </section>\n  );\n}\n","path":null,"size_bytes":5599,"size_tokens":null},"deploy/setup-oracle.sh":{"content":"#!/bin/bash\nset -e\n\necho \"=== [1/6] Atualizando sistema ===\"\nsudo dnf update -y\n\necho \"=== [2/6] Instalando Node.js 20 ===\"\nsudo dnf module enable nodejs:20 -y\nsudo dnf install nodejs -y\n\necho \"=== [3/6] Instalando PM2 ===\"\nsudo npm install -g pm2\n\necho \"=== [4/6] Instalando Nginx ===\"\nsudo dnf install nginx -y\n\necho \"=== [5/6] Abrindo portas no firewall ===\"\nsudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n\necho \"=== [6/6] Criando diretorios do app ===\"\nsudo mkdir -p /opt/oudla/logs\nsudo mkdir -p /opt/oudla/public/uploads\nsudo mkdir -p /opt/oudla/public/reviews\nsudo chown -R opc:opc /opt/oudla\n\necho \"\"\necho \"==========================================\"\necho \"  Setup concluido!\"\necho \"==========================================\"\n","path":null,"size_bytes":814,"size_tokens":null},"client/src/components/admin/AdminPixels.tsx":{"content":"// Componente para gerenciar pixels de rastreamento e scripts customizados\n// Permite configurar Facebook Pixel, Google Ads, Google Analytics, TikTok e scripts customizados\n\nimport { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, AlertTriangle, Code, BarChart3, ChevronDown } from \"lucide-react\";\nimport { SiFacebook, SiGoogleads, SiGoogleanalytics, SiTiktok } from \"react-icons/si\";\n\n// Interface para os dados de tracking pixels do backend\ninterface TrackingPixelsData {\n  facebookPixelId: string | null;\n  facebookPixelEnabled: boolean;\n  facebookTestEventCode: string | null;\n  googleAdsConversionId: string | null;\n  googleAdsConversionLabel: string | null;\n  googleAdsEnabled: boolean;\n  googleAnalyticsId: string | null;\n  googleAnalyticsEnabled: boolean;\n  tiktokPixelId: string | null;\n  tiktokPixelEnabled: boolean;\n  headerScripts: string | null;\n  bodyScripts: string | null;\n  mercadoPagoTrackingEnabled: boolean;\n}\n\nexport default function AdminPixels() {\n  const { toast } = useToast();\n  \n  const [activePixelTab, setActivePixelTab] = useState<\"facebook\" | \"outros\" | \"scripts\">(\"facebook\");\n  \n  // Estado local do formul√°rio\n  const [formData, setFormData] = useState<TrackingPixelsData>({\n    facebookPixelId: \"\",\n    facebookPixelEnabled: false,\n    facebookTestEventCode: \"\",\n    googleAdsConversionId: \"\",\n    googleAdsConversionLabel: \"\",\n    googleAdsEnabled: false,\n    googleAnalyticsId: \"\",\n    googleAnalyticsEnabled: false,\n    tiktokPixelId: \"\",\n    tiktokPixelEnabled: false,\n    headerScripts: \"\",\n    bodyScripts: \"\",\n    mercadoPagoTrackingEnabled: true,\n  });\n\n  // Busca os dados de tracking pixels do backend\n  const { data: pixelsData, isLoading } = useQuery<TrackingPixelsData>({\n    queryKey: ['/api/tracking-pixels'],\n  });\n\n  // Atualiza o formul√°rio quando os dados s√£o carregados\n  useEffect(() => {\n    if (pixelsData) {\n      setFormData({\n        facebookPixelId: pixelsData.facebookPixelId || \"\",\n        facebookPixelEnabled: pixelsData.facebookPixelEnabled || false,\n        facebookTestEventCode: pixelsData.facebookTestEventCode || \"\",\n        googleAdsConversionId: pixelsData.googleAdsConversionId || \"\",\n        googleAdsConversionLabel: pixelsData.googleAdsConversionLabel || \"\",\n        googleAdsEnabled: pixelsData.googleAdsEnabled || false,\n        googleAnalyticsId: pixelsData.googleAnalyticsId || \"\",\n        googleAnalyticsEnabled: pixelsData.googleAnalyticsEnabled || false,\n        tiktokPixelId: pixelsData.tiktokPixelId || \"\",\n        tiktokPixelEnabled: pixelsData.tiktokPixelEnabled || false,\n        headerScripts: pixelsData.headerScripts || \"\",\n        bodyScripts: pixelsData.bodyScripts || \"\",\n        mercadoPagoTrackingEnabled: pixelsData.mercadoPagoTrackingEnabled ?? true,\n      });\n    }\n  }, [pixelsData]);\n\n  // Mutation para salvar as configura√ß√µes\n  const updateMutation = useMutation({\n    mutationFn: async (data: Partial<TrackingPixelsData>) => {\n      const response = await apiRequest(\"PUT\", \"/api/tracking-pixels\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      // Invalida o cache para recarregar os dados atualizados\n      queryClient.invalidateQueries({ queryKey: ['/api/tracking-pixels'] });\n      toast({\n        title: \"salvo com sucesso\",\n        description: \"configura√ß√µes de rastreamento atualizadas\",\n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Erro ao atualizar tracking pixels:\", error);\n      toast({\n        title: \"erro ao salvar\",\n        description: error?.message || \"tente novamente\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  // Handler para submeter o formul√°rio\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    updateMutation.mutate(formData);\n  };\n\n  // Mostra loading enquanto carrega os dados\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-12\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Cabe√ßalho da p√°gina */}\n      <div>\n        <h1 className=\"text-2xl sm:text-3xl font-light lowercase mb-2\">pixels de rastreamento</h1>\n        <p className=\"text-sm sm:text-base text-muted-foreground lowercase\">\n          configure pixels e scripts para rastrear convers√µes e analytics\n        </p>\n      </div>\n\n      {/* Formul√°rio com abas */}\n      <form onSubmit={handleSubmit}>\n        <div className=\"space-y-6\">\n          {/* Mobile Dropdown */}\n          <div className=\"block sm:hidden\">\n            <div className=\"relative\">\n              <select\n                value={activePixelTab}\n                onChange={(e) => setActivePixelTab(e.target.value as \"facebook\" | \"outros\" | \"scripts\")}\n                className=\"w-full appearance-none bg-background border border-border rounded-md px-4 py-2.5 pr-10 text-sm lowercase focus:outline-none focus:ring-2 focus:ring-ring\"\n                data-testid=\"select-pixel-section\"\n              >\n                <option value=\"facebook\">facebook pixel</option>\n                <option value=\"outros\">outros pixels</option>\n                <option value=\"scripts\">scripts</option>\n              </select>\n              <ChevronDown className=\"absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground pointer-events-none\" />\n            </div>\n          </div>\n\n          {/* Desktop Tabs */}\n          <div className=\"hidden sm:grid grid-cols-3 bg-muted p-1 rounded-lg\">\n            <button\n              type=\"button\"\n              onClick={() => setActivePixelTab(\"facebook\")}\n              className={`flex items-center justify-center gap-2 px-3 py-1.5 rounded-md text-sm lowercase transition-all ${activePixelTab === \"facebook\" ? \"bg-background shadow-sm\" : \"text-muted-foreground\"}`}\n              data-testid=\"tab-facebook\"\n            >\n              <SiFacebook className=\"h-4 w-4\" />\n              facebook pixel\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setActivePixelTab(\"outros\")}\n              className={`flex items-center justify-center gap-2 px-3 py-1.5 rounded-md text-sm lowercase transition-all ${activePixelTab === \"outros\" ? \"bg-background shadow-sm\" : \"text-muted-foreground\"}`}\n              data-testid=\"tab-outros\"\n            >\n              <BarChart3 className=\"h-4 w-4\" />\n              outros pixels\n            </button>\n            <button\n              type=\"button\"\n              onClick={() => setActivePixelTab(\"scripts\")}\n              className={`flex items-center justify-center gap-2 px-3 py-1.5 rounded-md text-sm lowercase transition-all ${activePixelTab === \"scripts\" ? \"bg-background shadow-sm\" : \"text-muted-foreground\"}`}\n              data-testid=\"tab-scripts\"\n            >\n              <Code className=\"h-4 w-4\" />\n              scripts\n            </button>\n          </div>\n\n          {/* ===== ABA FACEBOOK PIXEL ===== */}\n          {activePixelTab === \"facebook\" && <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <SiFacebook className=\"h-6 w-6 text-blue-600\" />\n                  <div>\n                    <CardTitle className=\"lowercase\">facebook pixel</CardTitle>\n                    <CardDescription className=\"lowercase\">\n                      configure o pixel do facebook para rastrear convers√µes\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Switch para ativar/desativar */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label className=\"lowercase\">ativar facebook pixel</Label>\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      habilita o rastreamento do facebook em todo o site\n                    </p>\n                  </div>\n                  <Switch\n                    checked={formData.facebookPixelEnabled}\n                    onCheckedChange={(checked) => setFormData({ ...formData, facebookPixelEnabled: checked })}\n                    data-testid=\"switch-facebook-enabled\"\n                  />\n                </div>\n\n                {/* Input para o Pixel ID */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"facebookPixelId\" className=\"lowercase\">pixel id</Label>\n                  <Input\n                    id=\"facebookPixelId\"\n                    value={formData.facebookPixelId || \"\"}\n                    onChange={(e) => setFormData({ ...formData, facebookPixelId: e.target.value })}\n                    placeholder=\"ex: 123456789012345\"\n                    data-testid=\"input-facebook-pixel-id\"\n                  />\n                  <p className=\"text-xs text-muted-foreground lowercase\">\n                    encontre seu pixel id no gerenciador de eventos do facebook\n                  </p>\n                </div>\n\n                {/* Input para Test Event Code (opcional) */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"facebookTestEventCode\" className=\"lowercase\">\n                    test event code (opcional)\n                  </Label>\n                  <Input\n                    id=\"facebookTestEventCode\"\n                    value={formData.facebookTestEventCode || \"\"}\n                    onChange={(e) => setFormData({ ...formData, facebookTestEventCode: e.target.value })}\n                    placeholder=\"ex: TEST12345\"\n                    data-testid=\"input-facebook-test-code\"\n                  />\n                  <p className=\"text-xs text-muted-foreground lowercase\">\n                    use para testar eventos no modo debug do facebook\n                  </p>\n                </div>\n\n                {/* Se√ß√£o informativa sobre eventos rastreados */}\n                <div className=\"rounded-md bg-muted/50 p-4 space-y-2\">\n                  <p className=\"text-sm font-medium lowercase\">eventos rastreados automaticamente:</p>\n                  <ul className=\"text-sm text-muted-foreground space-y-1 lowercase\">\n                    <li>‚Ä¢ <strong>PageView</strong> - visualiza√ß√£o de p√°ginas</li>\n                    <li>‚Ä¢ <strong>ViewContent</strong> - visualiza√ß√£o de produtos</li>\n                    <li>‚Ä¢ <strong>AddToCart</strong> - adi√ß√£o ao carrinho</li>\n                    <li>‚Ä¢ <strong>InitiateCheckout</strong> - in√≠cio do checkout</li>\n                    <li>‚Ä¢ <strong>Purchase</strong> - compra finalizada</li>\n                  </ul>\n                </div>\n              </CardContent>\n            </Card>\n          </div>}\n\n          {/* ===== ABA OUTROS PIXELS ===== */}\n          {activePixelTab === \"outros\" && <div className=\"space-y-4\">\n            {/* Card Google Ads */}\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <SiGoogleads className=\"h-6 w-6 text-yellow-600\" />\n                  <div>\n                    <CardTitle className=\"lowercase\">google ads</CardTitle>\n                    <CardDescription className=\"lowercase\">\n                      configure o rastreamento de convers√µes do google ads\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Switch para ativar/desativar */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label className=\"lowercase\">ativar google ads</Label>\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      habilita o rastreamento de convers√µes\n                    </p>\n                  </div>\n                  <Switch\n                    checked={formData.googleAdsEnabled}\n                    onCheckedChange={(checked) => setFormData({ ...formData, googleAdsEnabled: checked })}\n                    data-testid=\"switch-google-ads-enabled\"\n                  />\n                </div>\n\n                {/* Inputs para Conversion ID e Label */}\n                <div className=\"grid gap-4 sm:grid-cols-2\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"googleAdsConversionId\" className=\"lowercase\">conversion id</Label>\n                    <Input\n                      id=\"googleAdsConversionId\"\n                      value={formData.googleAdsConversionId || \"\"}\n                      onChange={(e) => setFormData({ ...formData, googleAdsConversionId: e.target.value })}\n                      placeholder=\"ex: AW-123456789\"\n                      data-testid=\"input-google-ads-id\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"googleAdsConversionLabel\" className=\"lowercase\">conversion label</Label>\n                    <Input\n                      id=\"googleAdsConversionLabel\"\n                      value={formData.googleAdsConversionLabel || \"\"}\n                      onChange={(e) => setFormData({ ...formData, googleAdsConversionLabel: e.target.value })}\n                      placeholder=\"ex: abcDEF123\"\n                      data-testid=\"input-google-ads-label\"\n                    />\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Card Google Analytics */}\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <SiGoogleanalytics className=\"h-6 w-6 text-orange-500\" />\n                  <div>\n                    <CardTitle className=\"lowercase\">google analytics 4</CardTitle>\n                    <CardDescription className=\"lowercase\">\n                      configure o ga4 para an√°lise de tr√°fego\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Switch para ativar/desativar */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label className=\"lowercase\">ativar google analytics</Label>\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      habilita o rastreamento do ga4\n                    </p>\n                  </div>\n                  <Switch\n                    checked={formData.googleAnalyticsEnabled}\n                    onCheckedChange={(checked) => setFormData({ ...formData, googleAnalyticsEnabled: checked })}\n                    data-testid=\"switch-google-analytics-enabled\"\n                  />\n                </div>\n\n                {/* Input para GA4 ID */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"googleAnalyticsId\" className=\"lowercase\">ga4 measurement id</Label>\n                  <Input\n                    id=\"googleAnalyticsId\"\n                    value={formData.googleAnalyticsId || \"\"}\n                    onChange={(e) => setFormData({ ...formData, googleAnalyticsId: e.target.value })}\n                    placeholder=\"ex: G-XXXXXXXXXX\"\n                    data-testid=\"input-google-analytics-id\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* Card TikTok */}\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <SiTiktok className=\"h-6 w-6\" />\n                  <div>\n                    <CardTitle className=\"lowercase\">tiktok pixel</CardTitle>\n                    <CardDescription className=\"lowercase\">\n                      configure o pixel do tiktok para rastrear convers√µes\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                {/* Switch para ativar/desativar */}\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label className=\"lowercase\">ativar tiktok pixel</Label>\n                    <p className=\"text-sm text-muted-foreground lowercase\">\n                      habilita o rastreamento do tiktok\n                    </p>\n                  </div>\n                  <Switch\n                    checked={formData.tiktokPixelEnabled}\n                    onCheckedChange={(checked) => setFormData({ ...formData, tiktokPixelEnabled: checked })}\n                    data-testid=\"switch-tiktok-enabled\"\n                  />\n                </div>\n\n                {/* Input para TikTok Pixel ID */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"tiktokPixelId\" className=\"lowercase\">pixel id</Label>\n                  <Input\n                    id=\"tiktokPixelId\"\n                    value={formData.tiktokPixelId || \"\"}\n                    onChange={(e) => setFormData({ ...formData, tiktokPixelId: e.target.value })}\n                    placeholder=\"ex: C1234567890\"\n                    data-testid=\"input-tiktok-pixel-id\"\n                  />\n                </div>\n              </CardContent>\n            </Card>\n          </div>}\n\n          {/* ===== ABA SCRIPTS CUSTOMIZADOS ===== */}\n          {activePixelTab === \"scripts\" && <div className=\"space-y-4\">\n            <Card>\n              <CardHeader>\n                <div className=\"flex items-center gap-3\">\n                  <Code className=\"h-6 w-6\" />\n                  <div>\n                    <CardTitle className=\"lowercase\">scripts customizados</CardTitle>\n                    <CardDescription className=\"lowercase\">\n                      adicione scripts personalizados ao site (hotjar, clarity, chat, etc)\n                    </CardDescription>\n                  </div>\n                </div>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                {/* Aviso importante */}\n                <div className=\"flex gap-3 rounded-md border border-yellow-500/50 bg-yellow-500/10 p-4\">\n                  <AlertTriangle className=\"h-5 w-5 text-yellow-600 flex-shrink-0 mt-0.5\" />\n                  <div className=\"text-sm\">\n                    <p className=\"font-medium lowercase text-yellow-700 dark:text-yellow-500\">aten√ß√£o</p>\n                    <p className=\"text-muted-foreground lowercase\">\n                      scripts s√£o executados em todas as p√°ginas do site. \n                      use apenas c√≥digo de fontes confi√°veis.\n                    </p>\n                  </div>\n                </div>\n\n                {/* Textarea para Header Scripts */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"headerScripts\" className=\"lowercase\">\n                    scripts do header (head)\n                  </Label>\n                  <Textarea\n                    id=\"headerScripts\"\n                    value={formData.headerScripts || \"\"}\n                    onChange={(e) => setFormData({ ...formData, headerScripts: e.target.value })}\n                    placeholder=\"<!-- Cole aqui scripts que devem ser carregados no <head> -->\"\n                    className=\"font-mono text-sm min-h-[150px]\"\n                    data-testid=\"textarea-header-scripts\"\n                  />\n                  <p className=\"text-xs text-muted-foreground lowercase\">\n                    scripts injetados dentro da tag &lt;head&gt; - carregam antes do conte√∫do\n                  </p>\n                </div>\n\n                {/* Textarea para Body Scripts */}\n                <div className=\"space-y-2\">\n                  <Label htmlFor=\"bodyScripts\" className=\"lowercase\">\n                    scripts do body (final da p√°gina)\n                  </Label>\n                  <Textarea\n                    id=\"bodyScripts\"\n                    value={formData.bodyScripts || \"\"}\n                    onChange={(e) => setFormData({ ...formData, bodyScripts: e.target.value })}\n                    placeholder=\"<!-- Cole aqui scripts que devem ser carregados no final do <body> -->\"\n                    className=\"font-mono text-sm min-h-[150px]\"\n                    data-testid=\"textarea-body-scripts\"\n                  />\n                  <p className=\"text-xs text-muted-foreground lowercase\">\n                    scripts injetados antes de fechar a tag &lt;/body&gt; - carregam ap√≥s o conte√∫do\n                  </p>\n                </div>\n              </CardContent>\n            </Card>\n          </div>}\n        </div>\n\n        {/* Bot√£o de salvar (fixo no final) */}\n        <div className=\"mt-6\">\n          <Button\n            type=\"submit\"\n            disabled={updateMutation.isPending}\n            className=\"w-full sm:w-auto lowercase\"\n            data-testid=\"button-save-pixels\"\n          >\n            {updateMutation.isPending ? (\n              <>\n                <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                salvando...\n              </>\n            ) : (\n              \"salvar configura√ß√µes\"\n            )}\n          </Button>\n        </div>\n      </form>\n    </div>\n  );\n}\n","path":null,"size_bytes":21906,"size_tokens":null},"client/src/components/admin/AdminCookies.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Loader2, Save, Cookie, Eye, Globe, Shield } from \"lucide-react\";\nimport { Textarea } from \"@/components/ui/textarea\";\n\ninterface CookieSettingsData {\n  id?: string;\n  enabled: boolean;\n  title: string;\n  description: string;\n  buttonAcceptText: string;\n  buttonRejectText: string;\n  buttonCustomizeText: string;\n  showCustomizeButton: boolean;\n  privacyPolicyUrl: string;\n}\n\nexport default function AdminCookies() {\n  const { toast } = useToast();\n  const [settings, setSettings] = useState<CookieSettingsData>({\n    enabled: true,\n    title: \"usamos cookies\",\n    description: \"utilizamos cookies para melhorar sua experi√™ncia de navega√ß√£o, personalizar conte√∫do e analisar nosso tr√°fego.\",\n    buttonAcceptText: \"aceitar todos\",\n    buttonRejectText: \"recusar\",\n    buttonCustomizeText: \"personalizar\",\n    showCustomizeButton: false,\n    privacyPolicyUrl: \"/privacidade\",\n  });\n\n  const { data, isLoading } = useQuery<CookieSettingsData>({\n    queryKey: [\"/api/cookie-settings\"],\n  });\n\n  useEffect(() => {\n    if (data) {\n      setSettings(data);\n    }\n  }, [data]);\n\n  const saveMutation = useMutation({\n    mutationFn: async () => {\n      await apiRequest(\"PUT\", \"/api/admin/cookie-settings\", settings);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/cookie-settings\"] });\n      toast({ title: \"salvo\", description: \"configura√ß√µes de cookies atualizadas.\" });\n    },\n    onError: () => {\n      toast({ title: \"erro\", description: \"n√£o foi poss√≠vel salvar.\", variant: \"destructive\" });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-20\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-3\">\n        <div>\n          <h2 className=\"text-lg font-medium lowercase\" data-testid=\"text-cookies-title\">aviso de cookies</h2>\n          <p className=\"text-sm text-muted-foreground lowercase\">configure o banner de consentimento de cookies do site</p>\n        </div>\n        <Button\n          onClick={() => saveMutation.mutate()}\n          disabled={saveMutation.isPending}\n          data-testid=\"button-save-cookies\"\n        >\n          {saveMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : <Save className=\"h-4 w-4 mr-2\" />}\n          salvar\n        </Button>\n      </div>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 pb-6 border-b\">\n            <div className=\"flex items-center gap-3 sm:gap-4\">\n              <div className={`p-3 rounded-2xl transition-colors ${settings.enabled ? \"bg-primary/10\" : \"bg-muted\"}`}>\n                <Cookie className={`h-6 w-6 transition-colors ${settings.enabled ? \"text-primary\" : \"text-muted-foreground\"}`} />\n              </div>\n              <div>\n                <p className=\"font-medium lowercase text-sm sm:text-base\">banner de cookies</p>\n                <p className=\"text-xs sm:text-sm text-muted-foreground lowercase\">\n                  {settings.enabled ? \"vis√≠vel para os visitantes\" : \"oculto ‚Äî nenhum aviso ser√° exibido\"}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-3\">\n              <Badge variant={settings.enabled ? \"default\" : \"secondary\"} className=\"lowercase hidden sm:inline-flex\">\n                {settings.enabled ? \"ativo\" : \"inativo\"}\n              </Badge>\n              <Switch\n                checked={settings.enabled}\n                onCheckedChange={(v) => setSettings({ ...settings, enabled: v })}\n                data-testid=\"switch-cookies-enabled\"\n              />\n            </div>\n          </div>\n\n          <div className={`space-y-6 pt-6 transition-opacity ${settings.enabled ? \"opacity-100\" : \"opacity-40 pointer-events-none\"}`}>\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Globe className=\"h-4 w-4 text-muted-foreground\" />\n                  <p className=\"text-sm font-medium lowercase\">conte√∫do</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">t√≠tulo</Label>\n                  <Input\n                    value={settings.title}\n                    onChange={(e) => setSettings({ ...settings, title: e.target.value })}\n                    placeholder=\"usamos cookies\"\n                    className=\"lowercase\"\n                    data-testid=\"input-cookie-title\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">descri√ß√£o</Label>\n                  <Textarea\n                    value={settings.description}\n                    onChange={(e) => setSettings({ ...settings, description: e.target.value })}\n                    placeholder=\"utilizamos cookies para melhorar...\"\n                    className=\"lowercase min-h-[100px] resize-none\"\n                    data-testid=\"input-cookie-description\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">link pol√≠tica de privacidade</Label>\n                  <Input\n                    value={settings.privacyPolicyUrl}\n                    onChange={(e) => setSettings({ ...settings, privacyPolicyUrl: e.target.value })}\n                    placeholder=\"/privacidade\"\n                    data-testid=\"input-cookie-privacy-url\"\n                  />\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center gap-2 mb-1\">\n                  <Shield className=\"h-4 w-4 text-muted-foreground\" />\n                  <p className=\"text-sm font-medium lowercase\">bot√µes</p>\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">texto aceitar</Label>\n                  <Input\n                    value={settings.buttonAcceptText}\n                    onChange={(e) => setSettings({ ...settings, buttonAcceptText: e.target.value })}\n                    placeholder=\"aceitar todos\"\n                    className=\"lowercase\"\n                    data-testid=\"input-cookie-accept\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">texto recusar</Label>\n                  <Input\n                    value={settings.buttonRejectText}\n                    onChange={(e) => setSettings({ ...settings, buttonRejectText: e.target.value })}\n                    placeholder=\"recusar\"\n                    className=\"lowercase\"\n                    data-testid=\"input-cookie-reject\"\n                  />\n                </div>\n\n                <div className=\"space-y-2\">\n                  <Label className=\"lowercase text-sm\">texto personalizar</Label>\n                  <Input\n                    value={settings.buttonCustomizeText}\n                    onChange={(e) => setSettings({ ...settings, buttonCustomizeText: e.target.value })}\n                    placeholder=\"personalizar\"\n                    className=\"lowercase\"\n                    data-testid=\"input-cookie-customize\"\n                  />\n                </div>\n\n                <div className=\"flex items-center justify-between pt-2\">\n                  <div>\n                    <p className=\"text-sm lowercase\">mostrar bot√£o personalizar</p>\n                    <p className=\"text-xs text-muted-foreground lowercase\">exibir terceiro bot√£o de op√ß√µes</p>\n                  </div>\n                  <Switch\n                    checked={settings.showCustomizeButton}\n                    onCheckedChange={(v) => setSettings({ ...settings, showCustomizeButton: v })}\n                    data-testid=\"switch-show-customize\"\n                  />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"border-t pt-6\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <Eye className=\"h-4 w-4 text-muted-foreground\" />\n                <p className=\"text-sm font-medium lowercase\">pr√©-visualiza√ß√£o</p>\n              </div>\n              <div className=\"bg-muted/30 rounded-2xl p-4 sm:p-6\">\n                <div className=\"bg-background border rounded-2xl p-4 sm:p-6 shadow-lg max-w-lg mx-auto\">\n                  <div className=\"space-y-3\">\n                    <div className=\"flex items-center gap-2\">\n                      <Cookie className=\"h-4 w-4 text-muted-foreground\" />\n                      <p className=\"font-medium text-sm lowercase\">{settings.title || \"usamos cookies\"}</p>\n                    </div>\n                    <p className=\"text-xs sm:text-sm text-muted-foreground lowercase leading-relaxed\">\n                      {settings.description || \"utilizamos cookies para melhorar sua experi√™ncia...\"}\n                    </p>\n                    <p className=\"text-xs text-primary lowercase underline cursor-pointer\">pol√≠tica de privacidade</p>\n                    <div className=\"flex flex-col sm:flex-row gap-2 pt-2\">\n                      <Button size=\"sm\" className=\"flex-1 rounded-full lowercase text-xs\">\n                        {settings.buttonAcceptText || \"aceitar todos\"}\n                      </Button>\n                      <Button variant=\"outline\" size=\"sm\" className=\"flex-1 rounded-full lowercase text-xs\">\n                        {settings.buttonRejectText || \"recusar\"}\n                      </Button>\n                      {settings.showCustomizeButton && (\n                        <Button variant=\"ghost\" size=\"sm\" className=\"flex-1 rounded-full lowercase text-xs\">\n                          {settings.buttonCustomizeText || \"personalizar\"}\n                        </Button>\n                      )}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":10782,"size_tokens":null},"client/src/hooks/usePixel.ts":{"content":"/**\n * usePixel - Hook para disparar eventos do Facebook Pixel\n * \n * Este hook exp√µe todas as fun√ß√µes de rastreamento do Facebook Pixel\n * de forma simples e tipada. Deve ser usado em componentes que\n * estejam dentro do PixelProvider.\n * \n * Exemplo de uso:\n * ```tsx\n * const { trackAddToCart, trackViewContent } = usePixel();\n * \n * // Quando o usu√°rio visualiza um produto\n * trackViewContent(product.id, product.name, product.price, \"BRL\", \"camisetas\");\n * \n * // Quando o usu√°rio adiciona ao carrinho\n * trackAddToCart(product.id, product.name, product.price, \"BRL\", 1);\n * ```\n */\n\nimport { usePixelContext } from \"@/components/PixelProvider\";\n\n/**\n * Interface para itens de compra (usado no evento Purchase)\n */\nexport interface PurchaseItem {\n  id: string;\n  name: string;\n  quantity: number;\n  price: number;\n}\n\n/**\n * Hook principal para rastreamento de eventos do Facebook Pixel\n * \n * @returns Objeto com todas as fun√ß√µes de tracking e estado\n */\nexport function usePixel() {\n  // Obt√©m o contexto do PixelProvider\n  const {\n    isLoaded,\n    isEnabled,\n    trackPageView,\n    trackViewContent,\n    trackAddToCart,\n    trackRemoveFromCart,\n    trackInitiateCheckout,\n    trackAddPaymentInfo,\n    trackPurchase,\n    trackLead,\n    trackSearch,\n    trackAddToWishlist,\n    trackCompleteRegistration,\n  } = usePixelContext();\n\n  return {\n    // ===== ESTADO =====\n    \n    /**\n     * Indica se o script do Facebook Pixel foi carregado\n     */\n    isLoaded,\n    \n    /**\n     * Indica se o Facebook Pixel est√° habilitado nas configura√ß√µes\n     */\n    isEnabled,\n\n    // ===== EVENTOS DE P√ÅGINA =====\n\n    /**\n     * Dispara o evento PageView\n     * Rastreia visualiza√ß√£o de p√°ginas\n     * \n     * @example\n     * trackPageView();\n     */\n    trackPageView,\n\n    /**\n     * Dispara o evento Search\n     * Rastreia buscas realizadas pelo usu√°rio\n     * \n     * @param searchQuery - Termo de busca digitado\n     * \n     * @example\n     * trackSearch(\"camiseta preta\");\n     */\n    trackSearch,\n\n    // ===== EVENTOS DE PRODUTO =====\n\n    /**\n     * Dispara o evento ViewContent\n     * Rastreia visualiza√ß√£o de produtos\n     * \n     * @param productId - ID √∫nico do produto\n     * @param productName - Nome do produto\n     * @param value - Valor/pre√ßo do produto\n     * @param currency - Moeda (padr√£o: \"BRL\")\n     * @param category - Categoria do produto (opcional)\n     * \n     * @example\n     * trackViewContent(\"123\", \"Camiseta Premium\", 149.90, \"BRL\", \"camisetas\");\n     */\n    trackViewContent,\n\n    /**\n     * Dispara o evento AddToWishlist\n     * Rastreia quando usu√°rio adiciona aos favoritos\n     * \n     * @param productId - ID √∫nico do produto\n     * @param productName - Nome do produto\n     * @param value - Valor/pre√ßo do produto\n     * \n     * @example\n     * trackAddToWishlist(\"123\", \"Camiseta Premium\", 149.90);\n     */\n    trackAddToWishlist,\n\n    // ===== EVENTOS DE CARRINHO =====\n\n    /**\n     * Dispara o evento AddToCart\n     * Rastreia adi√ß√£o de produto ao carrinho\n     * \n     * @param productId - ID √∫nico do produto\n     * @param productName - Nome do produto\n     * @param value - Valor/pre√ßo unit√°rio do produto\n     * @param currency - Moeda (padr√£o: \"BRL\")\n     * @param quantity - Quantidade adicionada (padr√£o: 1)\n     * \n     * @example\n     * trackAddToCart(\"123\", \"Camiseta Premium\", 149.90, \"BRL\", 2);\n     */\n    trackAddToCart,\n\n    /**\n     * Dispara evento customizado RemoveFromCart\n     * Rastreia remo√ß√£o de produto do carrinho\n     * Nota: Este √© um evento customizado, n√£o padr√£o do Facebook\n     * \n     * @param productId - ID √∫nico do produto\n     * @param productName - Nome do produto\n     * @param value - Valor/pre√ßo do produto removido\n     * \n     * @example\n     * trackRemoveFromCart(\"123\", \"Camiseta Premium\", 149.90);\n     */\n    trackRemoveFromCart,\n\n    // ===== EVENTOS DE CHECKOUT =====\n\n    /**\n     * Dispara o evento InitiateCheckout\n     * Rastreia in√≠cio do processo de checkout\n     * \n     * @param value - Valor total do carrinho\n     * @param currency - Moeda (padr√£o: \"BRL\")\n     * @param numItems - N√∫mero de itens no carrinho (opcional)\n     * \n     * @example\n     * trackInitiateCheckout(299.80, \"BRL\", 2);\n     */\n    trackInitiateCheckout,\n\n    /**\n     * Dispara o evento AddPaymentInfo\n     * Rastreia quando usu√°rio adiciona informa√ß√µes de pagamento\n     * \n     * @param value - Valor da compra\n     * @param currency - Moeda (padr√£o: \"BRL\")\n     * \n     * @example\n     * trackAddPaymentInfo(299.80, \"BRL\");\n     */\n    trackAddPaymentInfo,\n\n    /**\n     * Dispara o evento Purchase\n     * Rastreia compra finalizada com sucesso\n     * \n     * @param orderId - ID √∫nico do pedido\n     * @param value - Valor total da compra\n     * @param currency - Moeda (padr√£o: \"BRL\")\n     * @param items - Lista de itens comprados (opcional)\n     * \n     * @example\n     * trackPurchase(\"ORDER-123\", 299.80, \"BRL\", [\n     *   { id: \"prod-1\", name: \"Camiseta\", quantity: 2, price: 149.90 }\n     * ]);\n     */\n    trackPurchase,\n\n    // ===== EVENTOS DE CONVERS√ÉO =====\n\n    /**\n     * Dispara o evento Lead\n     * Rastreia cadastro na newsletter\n     * \n     * @param email - Email do usu√°rio (opcional, n√£o √© enviado ao Facebook)\n     * \n     * @example\n     * trackLead(\"usuario@email.com\");\n     */\n    trackLead,\n\n    /**\n     * Dispara o evento CompleteRegistration\n     * Rastreia conclus√£o de cadastro/registro\n     * \n     * @example\n     * trackCompleteRegistration();\n     */\n    trackCompleteRegistration,\n  };\n}\n\nexport default usePixel;\n","path":null,"size_bytes":5582,"size_tokens":null},"client/src/components/admin/AdminNewsletter.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { insertNewsletterSettingsSchema, type NewsletterSubscriber, type NewsletterSettings } from \"@shared/schema\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n} from \"@/components/ui/alert-dialog\";\nimport { \n  Table, \n  TableBody, \n  TableCell, \n  TableHead, \n  TableHeader, \n  TableRow \n} from \"@/components/ui/table\";\nimport { format } from \"date-fns\";\nimport { ptBR } from \"date-fns/locale\";\nimport { Loader2, Download, Trash2 } from \"lucide-react\";\n\nexport default function AdminNewsletter() {\n  const { toast } = useToast();\n  const [deletingSubscriber, setDeletingSubscriber] = useState<string | null>(null);\n\n  const { data: subscribers, isLoading: loadingSubscribers } = useQuery<{ subscribers: NewsletterSubscriber[] }>({\n    queryKey: [\"/api/admin/newsletter/subscribers\"],\n  });\n\n  const { data: settings, isLoading: loadingSettings } = useQuery<NewsletterSettings>({\n    queryKey: [\"/api/newsletter/settings\"],\n  });\n\n  const deleteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/admin/newsletter/subscribers/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/admin/newsletter/subscribers\"] });\n      toast({ title: \"inscrito removido\" });\n    }\n  });\n\n  const form = useForm({\n    resolver: zodResolver(insertNewsletterSettingsSchema),\n    defaultValues: {\n      title: \"\",\n      description: \"\",\n      buttonText: \"\",\n      disclaimerText: \"\",\n    },\n  });\n\n  const settingsLoaded = useState(false);\n  if (settings && !settingsLoaded[0]) {\n    form.reset(settings);\n    settingsLoaded[1](true);\n  }\n\n  const updateSettingsMutation = useMutation({\n    mutationFn: async (values: Partial<NewsletterSettings>) => {\n      const res = await apiRequest(\"PATCH\", \"/api/admin/newsletter/settings\", values);\n      return res.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"sucesso!\",\n        description: \"configura√ß√µes da newsletter atualizadas.\",\n      });\n      if (data) {\n        form.reset(data);\n      }\n      queryClient.invalidateQueries({ queryKey: [\"/api/newsletter/settings\"] });\n    },\n  });\n\n  const exportEmailsOnly = () => {\n    if (!subscribers?.subscribers.length) return;\n    \n    const emails = subscribers.subscribers.map(s => s.email).join(\"\\n\");\n    const blob = new Blob([emails], { type: \"text/plain;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `emails_newsletter_${format(new Date(), \"yyyy-MM-dd\")}.txt`);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  const exportCSV = () => {\n    if (!subscribers?.subscribers.length) return;\n    \n    const headers = [\"Email\", \"IP\", \"Data\", \"Hora\"];\n    const rows = subscribers.subscribers.map(s => {\n      const date = new Date(s.createdAt!);\n      return [\n        s.email,\n        s.ipAddress,\n        format(date, \"dd/MM/yyyy\"),\n        format(date, \"HH:mm\")\n      ];\n    });\n\n    const csvContent = [headers, ...rows].map(e => e.join(\",\")).join(\"\\n\");\n    const blob = new Blob([csvContent], { type: \"text/csv;charset=utf-8;\" });\n    const link = document.createElement(\"a\");\n    const url = URL.createObjectURL(blob);\n    link.setAttribute(\"href\", url);\n    link.setAttribute(\"download\", `newsletter_subscribers_${format(new Date(), \"yyyy-MM-dd\")}.csv`);\n    link.style.visibility = \"hidden\";\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n  };\n\n  if (loadingSubscribers || loadingSettings) {\n    return (\n      <div className=\"flex items-center justify-center h-64\">\n        <Loader2 className=\"h-8 w-8 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-12\">\n      <section className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <h2 className=\"text-xl font-medium lowercase\">configura√ß√µes do convite</h2>\n        </div>\n        \n        <Form {...form}>\n          <form \n            onSubmit={form.handleSubmit((data) => updateSettingsMutation.mutate(data))}\n            className=\"grid gap-6 max-w-2xl\"\n          >\n            <FormField\n              control={form.control}\n              name=\"title\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"lowercase\">t√≠tulo do cta</FormLabel>\n                  <FormControl>\n                    <Input {...field} className=\"lowercase\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n            \n            <FormField\n              control={form.control}\n              name=\"description\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"lowercase\">descri√ß√£o</FormLabel>\n                  <FormControl>\n                    <Textarea {...field} className=\"lowercase min-h-[100px]\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"buttonText\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"lowercase\">texto do bot√£o</FormLabel>\n                  <FormControl>\n                    <Input {...field} className=\"lowercase\" />\n                  </FormControl>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <FormField\n              control={form.control}\n              name=\"disclaimerText\"\n              render={({ field }) => (\n                <FormItem>\n                  <FormLabel className=\"lowercase\">texto de aviso (spam)</FormLabel>\n                  <FormControl>\n                    <Input {...field} value={field.value || \"\"} className=\"lowercase\" placeholder=\"ex: sem spam. cancele quando quiser.\" />\n                  </FormControl>\n                  <p className=\"text-[11px] text-muted-foreground/50 lowercase\">deixe vazio para n√£o exibir</p>\n                  <FormMessage />\n                </FormItem>\n              )}\n            />\n\n            <Button \n              type=\"submit\" \n              className=\"w-full sm:w-fit lowercase\"\n              disabled={updateSettingsMutation.isPending}\n            >\n              {updateSettingsMutation.isPending ? \"salvando...\" : \"salvar configura√ß√µes\"}\n            </Button>\n          </form>\n        </Form>\n      </section>\n\n      <section className=\"space-y-6\">\n        <div className=\"flex flex-col sm:flex-row sm:items-center justify-between gap-4\">\n          <h2 className=\"text-xl font-medium lowercase\">inscritos ({subscribers?.subscribers.length || 0})</h2>\n          <div className=\"flex flex-col sm:flex-row gap-2 w-full sm:w-auto\">\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={exportEmailsOnly}\n              className=\"lowercase gap-2 w-full sm:w-auto\"\n              disabled={!subscribers?.subscribers.length}\n            >\n              <Download className=\"h-4 w-4\" />\n              apenas e-mails (.txt)\n            </Button>\n            <Button \n              variant=\"outline\" \n              size=\"sm\" \n              onClick={exportCSV}\n              className=\"lowercase gap-2 w-full sm:w-auto\"\n              disabled={!subscribers?.subscribers.length}\n            >\n              <Download className=\"h-4 w-4\" />\n              relat√≥rio completo (.csv)\n            </Button>\n          </div>\n        </div>\n\n        <div className=\"rounded-md border bg-card overflow-hidden\">\n          <div className=\"overflow-x-auto -mx-4 sm:mx-0\">\n            <div className=\"inline-block min-w-full align-middle\">\n              <Table>\n                <TableHeader>\n                  <TableRow>\n                    <TableHead className=\"lowercase whitespace-nowrap px-4\">e-mail</TableHead>\n                    <TableHead className=\"hidden md:table-cell lowercase whitespace-nowrap px-4\">ip</TableHead>\n                    <TableHead className=\"lowercase whitespace-nowrap px-4\">data</TableHead>\n                    <TableHead className=\"lowercase whitespace-nowrap w-[80px] px-4 text-right\">a√ß√µes</TableHead>\n                  </TableRow>\n                </TableHeader>\n                <TableBody>\n                  {subscribers?.subscribers.map((subscriber) => (\n                    <TableRow key={subscriber.id}>\n                      <TableCell className=\"font-medium px-4\">\n                        <div className=\"max-w-[140px] sm:max-w-[200px] truncate\" title={subscriber.email}>\n                          {subscriber.email}\n                        </div>\n                      </TableCell>\n                      <TableCell className=\"hidden md:table-cell text-muted-foreground text-xs whitespace-nowrap px-4\">\n                        {subscriber.ipAddress}\n                      </TableCell>\n                      <TableCell className=\"lowercase whitespace-nowrap px-4 text-xs\">\n                        {format(new Date(subscriber.createdAt!), \"dd/MM/yy\")}\n                      </TableCell>\n                      <TableCell className=\"px-4 text-right\">\n                        <Button\n                          variant=\"ghost\"\n                          size=\"icon\"\n                          className=\"h-8 w-8 text-destructive\"\n                          onClick={() => setDeletingSubscriber(subscriber.id)}\n                          disabled={deleteMutation.isPending}\n                        >\n                          <Trash2 className=\"h-4 w-4\" />\n                        </Button>\n                      </TableCell>\n                    </TableRow>\n                  ))}\n                  {subscribers?.subscribers.length === 0 && (\n                    <TableRow>\n                      <TableCell colSpan={4} className=\"md:table-cell md:col-span-5 text-center py-8 text-muted-foreground lowercase\">\n                        nenhum inscrito ainda\n                      </TableCell>\n                    </TableRow>\n                  )}\n                </TableBody>\n              </Table>\n            </div>\n          </div>\n        </div>\n      </section>\n\n      <AlertDialog open={!!deletingSubscriber} onOpenChange={() => setDeletingSubscriber(null)}>\n        <AlertDialogContent>\n          <AlertDialogHeader>\n            <AlertDialogTitle className=\"lowercase\">deletar inscrito?</AlertDialogTitle>\n            <AlertDialogDescription className=\"lowercase\">\n              essa a√ß√£o n√£o pode ser desfeita. o inscrito ser√° removido permanentemente da lista.\n            </AlertDialogDescription>\n          </AlertDialogHeader>\n          <AlertDialogFooter>\n            <AlertDialogCancel className=\"lowercase\">cancelar</AlertDialogCancel>\n            <AlertDialogAction\n              className=\"bg-destructive text-destructive-foreground lowercase\"\n              onClick={() => {\n                if (deletingSubscriber) {\n                  deleteMutation.mutate(deletingSubscriber);\n                  setDeletingSubscriber(null);\n                }\n              }}\n            >\n              deletar\n            </AlertDialogAction>\n          </AlertDialogFooter>\n        </AlertDialogContent>\n      </AlertDialog>\n    </div>\n  );\n}\n","path":null,"size_bytes":12155,"size_tokens":null},"server/prod.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath, { index: false }));\n\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","path":null,"size_bytes":795,"size_tokens":null},"client/src/components/admin/AdminCTA.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Save, Tag, MousePointer, ShoppingBag, Shield, Lock, CheckCircle, CreditCard, Star, Heart, Zap, Award } from \"lucide-react\";\n\nconst iconOptions = [\n  { value: \"lock\", label: \"cadeado\", Icon: Lock },\n  { value: \"shield\", label: \"escudo\", Icon: Shield },\n  { value: \"check-circle\", label: \"verificado\", Icon: CheckCircle },\n  { value: \"credit-card\", label: \"cart√£o\", Icon: CreditCard },\n  { value: \"star\", label: \"estrela\", Icon: Star },\n  { value: \"heart\", label: \"cora√ß√£o\", Icon: Heart },\n  { value: \"zap\", label: \"raio\", Icon: Zap },\n  { value: \"award\", label: \"medalha\", Icon: Award },\n];\n\ninterface CTAConfig {\n  shippingLabel: string;\n  buyNowText: string;\n  buyNowBg: string;\n  buyNowTextColor: string;\n  addToCartText: string;\n  addToCartBorder: string;\n  addToCartTextColor: string;\n  trustText: string;\n  trustIcon: string;\n}\n\nexport default function AdminCTA() {\n  const { toast } = useToast();\n  \n  const [shippingLabel, setShippingLabel] = useState(\"frete padr√£o\");\n  const [buyNowText, setBuyNowText] = useState(\"comprar agora\");\n  const [buyNowBg, setBuyNowBg] = useState(\"#ffffff\");\n  const [buyNowTextColor, setBuyNowTextColor] = useState(\"#1d1d1f\");\n  const [addToCartText, setAddToCartText] = useState(\"adicionar √† mochila\");\n  const [addToCartBorder, setAddToCartBorder] = useState(\"#ffffff1f\");\n  const [addToCartTextColor, setAddToCartTextColor] = useState(\"#ffffffe6\");\n  const [trustText, setTrustText] = useState(\"pagamento seguro via mercado pago\");\n  const [trustIcon, setTrustIcon] = useState(\"lock\");\n\n  const { data: ctaConfig, isLoading } = useQuery<CTAConfig>({\n    queryKey: ['/api/settings/cta'],\n  });\n\n  useEffect(() => {\n    if (ctaConfig) {\n      setShippingLabel(ctaConfig.shippingLabel);\n      setBuyNowText(ctaConfig.buyNowText);\n      setBuyNowBg(ctaConfig.buyNowBg);\n      setBuyNowTextColor(ctaConfig.buyNowTextColor);\n      setAddToCartText(ctaConfig.addToCartText);\n      setAddToCartBorder(ctaConfig.addToCartBorder);\n      setAddToCartTextColor(ctaConfig.addToCartTextColor);\n      setTrustText(ctaConfig.trustText);\n      setTrustIcon(ctaConfig.trustIcon);\n    }\n  }, [ctaConfig]);\n\n  const saveSetting = useMutation({\n    mutationFn: async ({ key, value }: { key: string; value: string }) => {\n      return await apiRequest(\"POST\", \"/api/admin/settings\", {\n        key,\n        value,\n        type: \"text\"\n      });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/cta'] });\n    },\n    onError: () => {\n      toast({ title: \"erro ao salvar\", variant: \"destructive\" });\n    }\n  });\n\n  const saveMultiple = async (settings: { key: string; value: string }[], successMsg: string) => {\n    try {\n      await Promise.all(settings.map(s => \n        apiRequest(\"POST\", \"/api/admin/settings\", { key: s.key, value: s.value, type: \"text\" })\n      ));\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/cta'] });\n      toast({ title: successMsg });\n    } catch {\n      toast({ title: \"erro ao salvar\", variant: \"destructive\" });\n    }\n  };\n\n  const TrustIconComponent = iconOptions.find(i => i.value === trustIcon)?.Icon || Lock;\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-6\">\n        {[1,2,3,4].map(i => (\n          <Card key={i} className=\"p-6\">\n            <div className=\"animate-pulse space-y-4\">\n              <div className=\"h-10 w-48 bg-muted/50 rounded-lg\" />\n              <div className=\"h-12 bg-muted/30 rounded-xl\" />\n            </div>\n          </Card>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <Tag className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">etiqueta de frete</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">texto exibido acima do resultado do frete</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-3\">\n          <Label className=\"text-sm font-medium lowercase\">texto da etiqueta</Label>\n          <Input\n            value={shippingLabel}\n            onChange={(e) => setShippingLabel(e.target.value)}\n            placeholder=\"frete padr√£o\"\n            className=\"h-12 text-lg lowercase\"\n            data-testid=\"input-shipping-label\"\n          />\n          <Button\n            onClick={() => saveSetting.mutate({ key: \"cta_shipping_label\", value: shippingLabel }, {\n              onSuccess: () => {\n                queryClient.invalidateQueries({ queryKey: ['/api/settings/cta'] });\n                toast({ title: \"etiqueta atualizada\" });\n              }\n            })}\n            disabled={saveSetting.isPending}\n            className=\"w-full h-12\"\n            data-testid=\"button-save-shipping-label\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            {saveSetting.isPending ? \"...\" : \"salvar\"}\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <div className=\"bg-[#1d1d1f] rounded-2xl p-4\">\n            <p className=\"text-[10px] uppercase tracking-widest text-white/40 font-bold\">{shippingLabel}</p>\n            <p className=\"text-[13px] text-white/80 font-light mt-1\">chegar√° gr√°tis entre 26/02 a 06/03</p>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <MousePointer className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">bot√£o comprar</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">personalize o bot√£o principal de compra</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium lowercase\">texto do bot√£o</Label>\n            <Input\n              value={buyNowText}\n              onChange={(e) => setBuyNowText(e.target.value)}\n              placeholder=\"comprar agora\"\n              className=\"h-12 text-lg lowercase\"\n              data-testid=\"input-buy-now-text\"\n            />\n          </div>\n          \n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">cor de fundo</Label>\n              <div className=\"flex items-center gap-3\">\n                <input\n                  type=\"color\"\n                  value={buyNowBg}\n                  onChange={(e) => setBuyNowBg(e.target.value)}\n                  className=\"w-12 h-12 rounded-full border-0 cursor-pointer bg-transparent [&::-webkit-color-swatch-wrapper]:p-0 [&::-webkit-color-swatch]:rounded-full [&::-webkit-color-swatch]:border-2 [&::-webkit-color-swatch]:border-border/20\"\n                  data-testid=\"color-buy-now-bg\"\n                />\n                <Input\n                  value={buyNowBg}\n                  onChange={(e) => setBuyNowBg(e.target.value)}\n                  placeholder=\"#ffffff\"\n                  className=\"h-12 font-mono text-sm\"\n                  data-testid=\"input-buy-now-bg-hex\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">cor do texto</Label>\n              <div className=\"flex items-center gap-3\">\n                <input\n                  type=\"color\"\n                  value={buyNowTextColor}\n                  onChange={(e) => setBuyNowTextColor(e.target.value)}\n                  className=\"w-12 h-12 rounded-full border-0 cursor-pointer bg-transparent [&::-webkit-color-swatch-wrapper]:p-0 [&::-webkit-color-swatch]:rounded-full [&::-webkit-color-swatch]:border-2 [&::-webkit-color-swatch]:border-border/20\"\n                  data-testid=\"color-buy-now-text\"\n                />\n                <Input\n                  value={buyNowTextColor}\n                  onChange={(e) => setBuyNowTextColor(e.target.value)}\n                  placeholder=\"#1d1d1f\"\n                  className=\"h-12 font-mono text-sm\"\n                  data-testid=\"input-buy-now-text-hex\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <Button\n            onClick={() => saveMultiple([\n              { key: \"cta_buy_now_text\", value: buyNowText },\n              { key: \"cta_buy_now_bg\", value: buyNowBg },\n              { key: \"cta_buy_now_text_color\", value: buyNowTextColor },\n            ], \"bot√£o comprar atualizado\")}\n            className=\"w-full h-12\"\n            data-testid=\"button-save-buy-now\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            salvar\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <p className=\"text-xs text-muted-foreground lowercase mb-3\">pr√©via</p>\n          <div className=\"bg-[#1d1d1f] rounded-2xl p-6\">\n            <button\n              className=\"w-full h-[54px] rounded-[14px] text-[15px] font-semibold tracking-[-0.01em] flex items-center justify-center\"\n              style={{ backgroundColor: buyNowBg, color: buyNowTextColor }}\n            >\n              {buyNowText}\n            </button>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <ShoppingBag className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">bot√£o mochila</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">personalize o bot√£o de adicionar √† mochila</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium lowercase\">texto do bot√£o</Label>\n            <Input\n              value={addToCartText}\n              onChange={(e) => setAddToCartText(e.target.value)}\n              placeholder=\"adicionar √† mochila\"\n              className=\"h-12 text-lg lowercase\"\n              data-testid=\"input-add-to-cart-text\"\n            />\n          </div>\n\n          <div className=\"grid grid-cols-2 gap-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">cor da borda</Label>\n              <div className=\"flex items-center gap-3\">\n                <input\n                  type=\"color\"\n                  value={addToCartBorder.startsWith(\"rgba\") ? \"#ffffff\" : addToCartBorder}\n                  onChange={(e) => setAddToCartBorder(e.target.value)}\n                  className=\"w-12 h-12 rounded-full border-0 cursor-pointer bg-transparent [&::-webkit-color-swatch-wrapper]:p-0 [&::-webkit-color-swatch]:rounded-full [&::-webkit-color-swatch]:border-2 [&::-webkit-color-swatch]:border-border/20\"\n                  data-testid=\"color-add-to-cart-border\"\n                />\n                <Input\n                  value={addToCartBorder}\n                  onChange={(e) => setAddToCartBorder(e.target.value)}\n                  placeholder=\"#ffffff1f\"\n                  className=\"h-12 font-mono text-sm\"\n                  data-testid=\"input-add-to-cart-border-hex\"\n                />\n              </div>\n            </div>\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">cor do texto</Label>\n              <div className=\"flex items-center gap-3\">\n                <input\n                  type=\"color\"\n                  value={addToCartTextColor.startsWith(\"rgba\") ? \"#ffffff\" : addToCartTextColor}\n                  onChange={(e) => setAddToCartTextColor(e.target.value)}\n                  className=\"w-12 h-12 rounded-full border-0 cursor-pointer bg-transparent [&::-webkit-color-swatch-wrapper]:p-0 [&::-webkit-color-swatch]:rounded-full [&::-webkit-color-swatch]:border-2 [&::-webkit-color-swatch]:border-border/20\"\n                  data-testid=\"color-add-to-cart-text\"\n                />\n                <Input\n                  value={addToCartTextColor}\n                  onChange={(e) => setAddToCartTextColor(e.target.value)}\n                  placeholder=\"#ffffffe6\"\n                  className=\"h-12 font-mono text-sm\"\n                  data-testid=\"input-add-to-cart-text-hex\"\n                />\n              </div>\n            </div>\n          </div>\n\n          <Button\n            onClick={() => saveMultiple([\n              { key: \"cta_add_to_cart_text\", value: addToCartText },\n              { key: \"cta_add_to_cart_border\", value: addToCartBorder },\n              { key: \"cta_add_to_cart_text_color\", value: addToCartTextColor },\n            ], \"bot√£o mochila atualizado\")}\n            className=\"w-full h-12\"\n            data-testid=\"button-save-add-to-cart\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            salvar\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <p className=\"text-xs text-muted-foreground lowercase mb-3\">pr√©via</p>\n          <div className=\"bg-[#1d1d1f] rounded-2xl p-6\">\n            <button\n              className=\"w-full h-[50px] rounded-[14px] bg-transparent text-[15px] font-medium tracking-[-0.01em] border\"\n              style={{ borderColor: addToCartBorder, color: addToCartTextColor }}\n            >\n              {addToCartText}\n            </button>\n          </div>\n        </div>\n      </Card>\n\n      <Card className=\"p-6 space-y-6\">\n        <div className=\"flex items-center gap-3\">\n          <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n            <Shield className=\"h-5 w-5 opacity-60\" />\n          </div>\n          <div>\n            <h3 className=\"text-lg font-medium lowercase\">selo de confian√ßa</h3>\n            <p className=\"text-sm text-muted-foreground lowercase\">texto e √≠cone exibido abaixo dos bot√µes de compra</p>\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium lowercase\">texto do selo</Label>\n            <Input\n              value={trustText}\n              onChange={(e) => setTrustText(e.target.value)}\n              placeholder=\"pagamento seguro via mercado pago\"\n              className=\"h-12 text-lg lowercase\"\n              data-testid=\"input-trust-text\"\n            />\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label className=\"text-sm font-medium lowercase\">√≠cone</Label>\n            <Select value={trustIcon} onValueChange={setTrustIcon}>\n              <SelectTrigger className=\"h-12 text-base lowercase\" data-testid=\"select-trust-icon\">\n                <SelectValue />\n              </SelectTrigger>\n              <SelectContent>\n                {iconOptions.map((opt) => (\n                  <SelectItem key={opt.value} value={opt.value} className=\"lowercase\">\n                    <div className=\"flex items-center gap-2\">\n                      <opt.Icon className=\"h-4 w-4\" />\n                      <span>{opt.label}</span>\n                    </div>\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          <Button\n            onClick={() => saveMultiple([\n              { key: \"cta_trust_text\", value: trustText },\n              { key: \"cta_trust_icon\", value: trustIcon },\n            ], \"selo de confian√ßa atualizado\")}\n            className=\"w-full h-12\"\n            data-testid=\"button-save-trust\"\n          >\n            <Save className=\"h-4 w-4 mr-2\" />\n            salvar\n          </Button>\n        </div>\n\n        <div className=\"pt-4 border-t border-border/50\">\n          <p className=\"text-xs text-muted-foreground lowercase mb-3\">pr√©via</p>\n          <div className=\"bg-[#1d1d1f] rounded-2xl p-6\">\n            <div className=\"flex items-center justify-center gap-2 text-white/30\">\n              <TrustIconComponent className=\"w-4 h-4\" />\n              <span className=\"text-[11px] font-medium tracking-wide\">{trustText}</span>\n            </div>\n          </div>\n        </div>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":16979,"size_tokens":null},"client/src/components/FavoritoToast.tsx":{"content":"import { motion, AnimatePresence } from \"framer-motion\";\nimport { X } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport interface FavoritoToastItem {\n  id: string;\n  name: string;\n  price: number;\n  image: string;\n}\n\ninterface FavoritoToastProps {\n  item: FavoritoToastItem | null;\n  isVisible: boolean;\n  onClose: () => void;\n  onOpenMenu: () => void;\n}\n\nexport default function FavoritoToast({ item, isVisible, onClose, onOpenMenu }: FavoritoToastProps) {\n  if (!item) return null;\n\n  const formatPrice = (value: number) => {\n    return new Intl.NumberFormat('pt-BR', {\n      style: 'currency',\n      currency: 'BRL'\n    }).format(value);\n  };\n\n  const handleToastClick = () => {\n    onOpenMenu();\n    onClose();\n  };\n\n  return (\n    <AnimatePresence>\n      {isVisible && (\n        <motion.div\n          initial={{ opacity: 0, x: -80 }}\n          animate={{ opacity: 1, x: 0 }}\n          exit={{ opacity: 0, x: -80 }}\n          drag=\"x\"\n          dragConstraints={{ left: 0, right: 0 }}\n          dragElastic={{ left: 0.6, right: 0.6 }}\n          onDragEnd={(_, info) => {\n            if (Math.abs(info.offset.x) > 30) {\n              onClose();\n            }\n          }}\n          transition={{ type: \"spring\", damping: 25, stiffness: 300 }}\n          className=\"fixed top-20 left-4 z-50 w-72 max-w-[calc(100vw-2rem)] touch-none\"\n          data-testid=\"toast-favorito\"\n        >\n          <div\n            className=\"bg-background border rounded-lg shadow-lg p-4 flex gap-3 items-center relative cursor-pointer hover-elevate\"\n            onClick={handleToastClick}\n          >\n            <div className=\"flex-shrink-0\">\n              <img\n                src={item.image}\n                alt={item.name}\n                className=\"w-14 h-14 object-cover rounded-lg\"\n                loading=\"lazy\"\n                decoding=\"async\"\n              />\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium lowercase truncate\">{item.name}</p>\n              <span className=\"text-sm text-muted-foreground\">{formatPrice(item.price)}</span>\n            </div>\n            <Button\n              variant=\"ghost\"\n              size=\"icon\"\n              onClick={(e) => {\n                e.stopPropagation();\n                onClose();\n              }}\n              className=\"h-6 w-6 absolute -top-1 -right-1\"\n              data-testid=\"button-close-toast-favorito\"\n            >\n              <X className=\"h-3 w-3\" />\n            </Button>\n          </div>\n        </motion.div>\n      )}\n    </AnimatePresence>\n  );\n}\n","path":null,"size_bytes":2600,"size_tokens":null},"server/seo-inject.ts":{"content":"import { storage } from \"./storage\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nfunction escapeHtml(str: string): string {\n  return str.replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n}\n\nfunction buildSEOHead(seo: Record<string, string>, baseUrl: string): string {\n  const ogImageUrl = `${baseUrl}/og-icon.png`;\n\n  let tags = '';\n  tags += `    <title>${escapeHtml(seo.title)}</title>\\n`;\n  tags += `    <meta name=\"description\" content=\"${escapeHtml(seo.description)}\" />\\n`;\n  if (seo.keywords) {\n    tags += `    <meta name=\"keywords\" content=\"${escapeHtml(seo.keywords)}\" />\\n`;\n  }\n  tags += `    <meta property=\"og:title\" content=\"${escapeHtml(seo.ogTitle)}\" />\\n`;\n  tags += `    <meta property=\"og:description\" content=\"${escapeHtml(seo.ogDescription)}\" />\\n`;\n  tags += `    <meta property=\"og:type\" content=\"${escapeHtml(seo.ogType)}\" />\\n`;\n  if (seo.ogSiteName) {\n    tags += `    <meta property=\"og:site_name\" content=\"${escapeHtml(seo.ogSiteName)}\" />\\n`;\n  }\n  tags += `    <meta property=\"og:image\" content=\"${escapeHtml(ogImageUrl)}\" />\\n`;\n  tags += `    <meta property=\"og:image:type\" content=\"image/png\" />\\n`;\n  tags += `    <meta property=\"og:image:width\" content=\"1200\" />\\n`;\n  tags += `    <meta property=\"og:image:height\" content=\"630\" />\\n`;\n  tags += `    <meta name=\"twitter:card\" content=\"summary_large_image\" />\\n`;\n  tags += `    <meta name=\"twitter:image\" content=\"${escapeHtml(ogImageUrl)}\" />\\n`;\n  tags += `    <meta property=\"og:url\" content=\"${escapeHtml(baseUrl)}\" />`;\n  return tags;\n}\n\nfunction buildProductOGHead(product: { name: string; description?: string | null; price?: string | null }, imageUrl: string, productUrl: string, siteName: string): string {\n  const title = `${product.name} | ${siteName}`;\n  const desc = product.description || product.name;\n  const priceText = product.price ? ` - R$ ${parseFloat(product.price).toFixed(2).replace('.', ',')}` : '';\n  const fullDesc = `${desc}${priceText}`;\n\n  let tags = '';\n  tags += `    <title>${escapeHtml(title)}</title>\\n`;\n  tags += `    <meta name=\"description\" content=\"${escapeHtml(fullDesc)}\" />\\n`;\n  tags += `    <meta property=\"og:title\" content=\"${escapeHtml(product.name)}\" />\\n`;\n  tags += `    <meta property=\"og:description\" content=\"${escapeHtml(fullDesc)}\" />\\n`;\n  tags += `    <meta property=\"og:type\" content=\"product\" />\\n`;\n  tags += `    <meta property=\"og:site_name\" content=\"${escapeHtml(siteName)}\" />\\n`;\n  tags += `    <meta property=\"og:image\" content=\"${escapeHtml(imageUrl)}\" />\\n`;\n  tags += `    <meta property=\"og:image:width\" content=\"1200\" />\\n`;\n  tags += `    <meta property=\"og:image:height\" content=\"630\" />\\n`;\n  tags += `    <meta name=\"twitter:card\" content=\"summary_large_image\" />\\n`;\n  tags += `    <meta name=\"twitter:image\" content=\"${escapeHtml(imageUrl)}\" />\\n`;\n  tags += `    <meta property=\"og:url\" content=\"${escapeHtml(productUrl)}\" />`;\n  if (product.price) {\n    tags += `\\n    <meta property=\"product:price:amount\" content=\"${escapeHtml(product.price)}\" />\\n`;\n    tags += `    <meta property=\"product:price:currency\" content=\"BRL\" />`;\n  }\n  return tags;\n}\n\nexport async function injectProductOG(html: string, productIdentifier: string): Promise<string | null> {\n  try {\n    const baseUrl = (process.env.SITE_URL || \"https://oudla.com.br\").replace(/\\/$/, '');\n    const ogSiteNameSetting = await storage.getSiteSettingByKey(\"seo_og_site_name\");\n    const siteName = ogSiteNameSetting?.value || \"oudla\";\n\n    const allProducts = await storage.getProducts();\n    const id = productIdentifier.trim().toLowerCase();\n\n    let product = allProducts.find(p => p.slug?.trim().toLowerCase() === id);\n    if (!product) {\n      product = allProducts.find(p => p.sku?.trim().toLowerCase() === id);\n    }\n    if (!product) {\n      const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;\n      if (uuidRegex.test(productIdentifier)) {\n        product = allProducts.find(p => p.id === productIdentifier);\n      }\n    }\n\n    if (!product) return null;\n\n    const images = await storage.getProductImages(product.id);\n    const mainImage = images.length > 0 ? images[0].imageUrl : `${baseUrl}/og-icon.png`;\n    const ogImage = mainImage.startsWith(\"http\") ? mainImage : `${baseUrl}${mainImage}`;\n    const productUrl = `${baseUrl}/produto/${product.slug || product.id}`;\n\n    const ogBlock = buildProductOGHead(product, ogImage, productUrl, siteName);\n    return replaceMetaBlock(html, ogBlock);\n  } catch (err) {\n    console.error(\"Error injecting product OG:\", err);\n    return null;\n  }\n}\n\nfunction replaceMetaBlock(html: string, newBlock: string): string {\n  const seoStart = '<!-- SEO_START -->';\n  const seoEnd = '<!-- SEO_END -->';\n\n  if (html.includes(seoStart) && html.includes(seoEnd)) {\n    const regex = new RegExp(`${seoStart}[\\\\s\\\\S]*?${seoEnd}`);\n    return html.replace(regex, `${seoStart}\\n${newBlock}\\n    ${seoEnd}`);\n  }\n\n  const oldTags = [\n    /<title>.*?<\\/title>\\n?/,\n    /<meta name=\"description\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta name=\"keywords\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:title\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:description\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:type\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:site_name\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:image\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:image:width\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:image:height\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta name=\"twitter:card\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta name=\"twitter:image\" content=\"[^\"]*\" \\/>\\n?/,\n    /<meta property=\"og:url\" content=\"[^\"]*\" \\/>\\n?/,\n  ];\n\n  for (const regex of oldTags) {\n    html = html.replace(regex, '');\n  }\n\n  html = html.replace(\n    /(<link rel=\"icon\")/,\n    `${seoStart}\\n${newBlock}\\n    ${seoEnd}\\n    $1`\n  );\n\n  return html;\n}\n\n\nexport async function writeHardcodedSEO(): Promise<void> {\n  try {\n    const [title, description, keywords, ogTitle, ogDesc, ogType, ogSiteName] = await Promise.all([\n      storage.getSiteSettingByKey(\"seo_title\"),\n      storage.getSiteSettingByKey(\"seo_description\"),\n      storage.getSiteSettingByKey(\"seo_keywords\"),\n      storage.getSiteSettingByKey(\"seo_og_title\"),\n      storage.getSiteSettingByKey(\"seo_og_description\"),\n      storage.getSiteSettingByKey(\"seo_og_type\"),\n      storage.getSiteSettingByKey(\"seo_og_site_name\"),\n    ]);\n\n    const seo: Record<string, string> = {\n      title: title?.value || \"oudla\",\n      description: description?.value || \"oudla √© uma marca focada no p√∫blico jovem e descolado. camisetas premium com design minimalista e est√©tica sofisticada.\",\n      keywords: keywords?.value || \"oudla, camisetas, moda crist√£, roupas premium, moda jovem\",\n      ogTitle: ogTitle?.value || \"oudla\",\n      ogDescription: ogDesc?.value || \"camisetas de luxo para jovens descolados. design minimalista, qualidade premium.\",\n      ogType: ogType?.value || \"website\",\n      ogSiteName: ogSiteName?.value || \"oudla\",\n    };\n\n    const baseUrl = (process.env.SITE_URL || \"https://oudla.com.br\").replace(/\\/$/, '');\n    const newBlock = buildSEOHead(seo, baseUrl);\n\n    const clientHtml = path.resolve(import.meta.dirname, \"..\", \"client\", \"index.html\");\n    const distHtml = path.resolve(import.meta.dirname, \"public\", \"index.html\");\n\n    const isDev = process.env.NODE_ENV !== \"production\" && !process.env.APP_ENV;\n\n    for (const filePath of [clientHtml, distHtml]) {\n      if (filePath === clientHtml && isDev) {\n        console.log(`‚è≠Ô∏è Skipping client/index.html in dev (Vite watches it)`);\n        continue;\n      }\n      if (fs.existsSync(filePath)) {\n        let html = fs.readFileSync(filePath, \"utf-8\");\n        html = replaceMetaBlock(html, newBlock);\n        fs.writeFileSync(filePath, html, \"utf-8\");\n        console.log(`‚úÖ SEO tags written to ${filePath}`);\n      }\n    }\n  } catch (err) {\n    console.error(\"‚ùå Error writing SEO tags to HTML:\", err);\n  }\n}\n\nexport async function initSEO(): Promise<void> {\n  await writeHardcodedSEO();\n}\n\nexport function invalidateSEOCache() {\n}\n","path":null,"size_bytes":8126,"size_tokens":null},"client/src/components/admin/AdminSEO.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { Check, Loader2 } from \"lucide-react\";\n\ninterface SEOConfig {\n  seoTitle: string;\n  seoDescription: string;\n  seoKeywords: string;\n  ogTitle: string;\n  ogDescription: string;\n  ogType: string;\n  ogSiteName: string;\n}\n\nexport default function AdminSEO() {\n  const { toast } = useToast();\n\n  const [seoTitle, setSeoTitle] = useState(\"oudla\");\n  const [seoDescription, setSeoDescription] = useState(\"oudla √© uma marca de moda crist√£ premium para jovens modernos. f√©, estilo e qualidade em cada pe√ßa.\");\n  const [seoKeywords, setSeoKeywords] = useState(\"oudla, camisetas, moda crist√£, roupas premium, moda jovem, camisetas premium\");\n  const [ogTitle, setOgTitle] = useState(\"oudla\");\n  const [ogDescription, setOgDescription] = useState(\"camisetas de luxo para jovens descolados. design minimalista, qualidade premium.\");\n  const [ogType, setOgType] = useState(\"website\");\n  const [ogSiteName, setOgSiteName] = useState(\"oudla\");\n  const [savingSeo, setSavingSeo] = useState(false);\n  const [savingOg, setSavingOg] = useState(false);\n  const [savedSeo, setSavedSeo] = useState(false);\n  const [savedOg, setSavedOg] = useState(false);\n\n  const { data: seoConfig, isLoading } = useQuery<SEOConfig>({\n    queryKey: ['/api/settings/seo'],\n  });\n\n  useEffect(() => {\n    if (seoConfig) {\n      setSeoTitle(seoConfig.seoTitle);\n      setSeoDescription(seoConfig.seoDescription);\n      setSeoKeywords(seoConfig.seoKeywords);\n      setOgTitle(seoConfig.ogTitle);\n      setOgDescription(seoConfig.ogDescription);\n      setOgType(seoConfig.ogType);\n      setOgSiteName(seoConfig.ogSiteName);\n    }\n  }, [seoConfig]);\n\n  const saveMultiple = async (settings: { key: string; value: string }[], successMsg: string, setLoading: (v: boolean) => void, setSaved: (v: boolean) => void) => {\n    setLoading(true);\n    try {\n      await Promise.all(settings.map(s =>\n        apiRequest(\"POST\", \"/api/admin/settings\", { key: s.key, value: s.value, type: \"text\" })\n      ));\n      queryClient.invalidateQueries({ queryKey: ['/api/settings/seo'] });\n      setSaved(true);\n      setTimeout(() => setSaved(false), 2000);\n      toast({ title: successMsg });\n    } catch {\n      toast({ title: \"erro ao salvar\", variant: \"destructive\" });\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const descriptionLength = seoDescription.length;\n  const descriptionColor = descriptionLength > 160 ? \"text-red-500\" : descriptionLength > 130 ? \"text-amber-500\" : \"text-muted-foreground/50\";\n\n  if (isLoading) {\n    return (\n      <div className=\"space-y-8 max-w-2xl mx-auto\">\n        {[1, 2, 3].map(i => (\n          <div key={i} className=\"space-y-4\">\n            <div className=\"animate-pulse h-5 w-32 bg-muted/40 rounded-md\" />\n            <div className=\"animate-pulse rounded-2xl bg-muted/20 p-5 space-y-4\">\n              <div className=\"h-11 bg-muted/30 rounded-xl\" />\n              <div className=\"h-11 bg-muted/30 rounded-xl\" />\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-2xl mx-auto space-y-10 pb-8\">\n\n      <div className=\"space-y-5\">\n        <div className=\"px-1\">\n          <h3 className=\"text-[15px] font-semibold lowercase tracking-tight\">mecanismos de busca</h3>\n          <p className=\"text-[12px] text-muted-foreground/60 lowercase leading-tight\">como seu site aparece no google</p>\n        </div>\n\n        <div className=\"rounded-2xl bg-muted/30 dark:bg-muted/15 overflow-hidden\">\n          <div className=\"p-5 space-y-1.5\">\n            <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">t√≠tulo</label>\n            <Input\n              value={seoTitle}\n              onChange={(e) => setSeoTitle(e.target.value)}\n              placeholder=\"oudla\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[15px] font-medium lowercase focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"input-seo-title\"\n            />\n          </div>\n          <div className=\"h-px bg-border/30 mx-5\" />\n          <div className=\"p-5 space-y-1.5\">\n            <div className=\"flex items-center justify-between\">\n              <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">descri√ß√£o</label>\n              <span className={`text-[11px] tabular-nums ${descriptionColor}`}>{descriptionLength}/160</span>\n            </div>\n            <Textarea\n              value={seoDescription}\n              onChange={(e) => setSeoDescription(e.target.value)}\n              placeholder=\"descri√ß√£o do seu site para o google...\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase resize-none min-h-[72px] focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"input-seo-description\"\n            />\n          </div>\n          <div className=\"h-px bg-border/30 mx-5\" />\n          <div className=\"p-5 space-y-1.5\">\n            <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">palavras-chave</label>\n            <Textarea\n              value={seoKeywords}\n              onChange={(e) => setSeoKeywords(e.target.value)}\n              placeholder=\"oudla, camisetas, moda crist√£...\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase resize-none min-h-[56px] focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"input-seo-keywords\"\n            />\n            <p className=\"text-[11px] text-muted-foreground/40 lowercase\">separe por v√≠rgula</p>\n          </div>\n        </div>\n\n        <Button\n          onClick={() => saveMultiple([\n            { key: \"seo_title\", value: seoTitle },\n            { key: \"seo_description\", value: seoDescription },\n            { key: \"seo_keywords\", value: seoKeywords },\n          ], \"seo atualizado\", setSavingSeo, setSavedSeo)}\n          disabled={savingSeo}\n          className=\"w-full rounded-xl\"\n          size=\"lg\"\n          data-testid=\"button-save-seo\"\n        >\n          {savingSeo ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : savedSeo ? <Check className=\"h-4 w-4\" /> : null}\n          {savingSeo ? \"salvando...\" : savedSeo ? \"salvo\" : \"salvar seo\"}\n        </Button>\n\n        <div className=\"px-1\">\n          <p className=\"text-[11px] font-medium text-muted-foreground/40 uppercase tracking-widest mb-3\">pr√©via</p>\n          <div className=\"rounded-xl bg-background border border-border/30 p-4 space-y-0.5 shadow-sm\">\n            <p className=\"text-[#1a0dab] dark:text-blue-400 text-[15px] font-medium truncate leading-snug\">{seoTitle || \"oudla\"}</p>\n            <p className=\"text-[#006621] dark:text-green-400 text-[12px] leading-snug\">oudla.com.br</p>\n            <p className=\"text-[13px] text-muted-foreground/70 line-clamp-2 leading-relaxed\">{seoDescription || \"descri√ß√£o do site...\"}</p>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"h-px bg-border/20\" />\n\n      <div className=\"space-y-5\">\n        <div className=\"px-1\">\n          <h3 className=\"text-[15px] font-semibold lowercase tracking-tight\">open graph</h3>\n          <p className=\"text-[12px] text-muted-foreground/60 lowercase leading-tight\">pr√©via ao compartilhar no whatsapp, instagram e facebook</p>\n        </div>\n\n        <div className=\"rounded-2xl bg-muted/30 dark:bg-muted/15 overflow-hidden\">\n          <div className=\"p-5 space-y-1.5\">\n            <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">t√≠tulo</label>\n            <Input\n              value={ogTitle}\n              onChange={(e) => setOgTitle(e.target.value)}\n              placeholder=\"oudla\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[15px] font-medium lowercase focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"input-og-title\"\n            />\n          </div>\n          <div className=\"h-px bg-border/30 mx-5\" />\n          <div className=\"p-5 space-y-1.5\">\n            <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">descri√ß√£o</label>\n            <Textarea\n              value={ogDescription}\n              onChange={(e) => setOgDescription(e.target.value)}\n              placeholder=\"descri√ß√£o para redes sociais...\"\n              className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase resize-none min-h-[72px] focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n              data-testid=\"input-og-description\"\n            />\n          </div>\n          <div className=\"h-px bg-border/30 mx-5\" />\n          <div className=\"p-5\">\n            <div className=\"grid grid-cols-2 gap-6\">\n              <div className=\"space-y-1.5\">\n                <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">tipo</label>\n                <Input\n                  value={ogType}\n                  onChange={(e) => setOgType(e.target.value)}\n                  placeholder=\"website\"\n                  className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n                  data-testid=\"input-og-type\"\n                />\n              </div>\n              <div className=\"space-y-1.5\">\n                <label className=\"text-[11px] font-medium text-muted-foreground/50 uppercase tracking-widest\">nome do site</label>\n                <Input\n                  value={ogSiteName}\n                  onChange={(e) => setOgSiteName(e.target.value)}\n                  placeholder=\"oudla\"\n                  className=\"border-0 bg-transparent shadow-none px-0 text-[14px] lowercase focus-visible:ring-0 placeholder:text-muted-foreground/25\"\n                  data-testid=\"input-og-site-name\"\n                />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <Button\n          onClick={() => saveMultiple([\n            { key: \"seo_og_title\", value: ogTitle },\n            { key: \"seo_og_description\", value: ogDescription },\n            { key: \"seo_og_type\", value: ogType },\n            { key: \"seo_og_site_name\", value: ogSiteName },\n          ], \"open graph atualizado\", setSavingOg, setSavedOg)}\n          disabled={savingOg}\n          className=\"w-full rounded-xl\"\n          size=\"lg\"\n          data-testid=\"button-save-og\"\n        >\n          {savingOg ? <Loader2 className=\"h-4 w-4 animate-spin\" /> : savedOg ? <Check className=\"h-4 w-4\" /> : null}\n          {savingOg ? \"salvando...\" : savedOg ? \"salvo\" : \"salvar open graph\"}\n        </Button>\n\n        <div className=\"px-1\">\n          <p className=\"text-[11px] font-medium text-muted-foreground/40 uppercase tracking-widest mb-3\">pr√©via do link</p>\n          <div className=\"rounded-2xl bg-background border border-border/20 overflow-hidden shadow-sm max-w-sm\">\n            <div className=\"w-full aspect-[1200/630] bg-white flex items-center justify-center\">\n              <img src=\"/favicon.svg\" alt=\"oudla\" className=\"h-24 w-24 opacity-80\" />\n            </div>\n            <div className=\"p-3.5 space-y-0.5\">\n              <p className=\"text-[10px] text-muted-foreground/40 uppercase tracking-wider font-medium\">{ogSiteName || \"oudla\"}</p>\n              <p className=\"text-[14px] font-semibold truncate leading-snug\">{ogTitle || \"oudla\"}</p>\n              <p className=\"text-[12px] text-muted-foreground/60 line-clamp-2 leading-relaxed\">{ogDescription || \"descri√ß√£o...\"}</p>\n            </div>\n          </div>\n          <p className=\"text-[11px] text-muted-foreground/40 lowercase mt-2\">a imagem de compartilhamento usa automaticamente o √≠cone do site</p>\n        </div>\n      </div>\n    </div>\n  );\n}\n","path":null,"size_bytes":12097,"size_tokens":null},"client/src/components/admin/AdminGateway.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation } from \"@tanstack/react-query\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport { CreditCard, Save, Loader2, Shield, Banknote, Clock, FileText, Ban } from \"lucide-react\";\n\ninterface GatewaySettings {\n  gateway_pix_enabled: string;\n  gateway_credit_card_enabled: string;\n  gateway_debit_card_enabled: string;\n  gateway_boleto_enabled: string;\n  gateway_max_installments: string;\n  gateway_free_installments: string;\n  gateway_auto_return: string;\n  gateway_expiration_hours: string;\n  gateway_statement_descriptor: string;\n  gateway_binary_mode: string;\n  gateway_excluded_methods: string;\n  gateway_excluded_types: string;\n}\n\nconst GATEWAY_KEYS = [\n  \"gateway_pix_enabled\",\n  \"gateway_credit_card_enabled\",\n  \"gateway_debit_card_enabled\",\n  \"gateway_boleto_enabled\",\n  \"gateway_max_installments\",\n  \"gateway_free_installments\",\n  \"gateway_auto_return\",\n  \"gateway_expiration_hours\",\n  \"gateway_statement_descriptor\",\n  \"gateway_binary_mode\",\n  \"gateway_excluded_methods\",\n  \"gateway_excluded_types\",\n] as const;\n\nconst DEFAULTS: GatewaySettings = {\n  gateway_pix_enabled: \"true\",\n  gateway_credit_card_enabled: \"true\",\n  gateway_debit_card_enabled: \"true\",\n  gateway_boleto_enabled: \"true\",\n  gateway_max_installments: \"12\",\n  gateway_free_installments: \"1\",\n  gateway_auto_return: \"approved\",\n  gateway_expiration_hours: \"24\",\n  gateway_statement_descriptor: \"OUDLA\",\n  gateway_binary_mode: \"false\",\n  gateway_excluded_methods: \"\",\n  gateway_excluded_types: \"\",\n};\n\nexport default function AdminGateway() {\n  const { toast } = useToast();\n  const [settings, setSettings] = useState<GatewaySettings>({ ...DEFAULTS });\n\n  const { data: mpConfig } = useQuery<{ success: boolean; publicKey: string; isProduction: boolean }>({\n    queryKey: [\"/api/checkout/mp-config\"],\n  });\n\n  const { data: fetchedSettings, isLoading } = useQuery<GatewaySettings>({\n    queryKey: [\"gateway-settings\"],\n    queryFn: async () => {\n      const results: Record<string, string> = {};\n      const responses = await Promise.all(\n        GATEWAY_KEYS.map((key) =>\n          fetch(`/api/admin/settings/${key}`, { credentials: \"include\" })\n            .then((r) => r.json())\n            .then((data) => ({ key, value: data.value || \"\" }))\n            .catch(() => ({ key, value: \"\" }))\n        )\n      );\n      for (const { key, value } of responses) {\n        results[key] = value;\n      }\n      return results as unknown as GatewaySettings;\n    },\n  });\n\n  useEffect(() => {\n    if (fetchedSettings) {\n      setSettings({\n        gateway_pix_enabled: fetchedSettings.gateway_pix_enabled || DEFAULTS.gateway_pix_enabled,\n        gateway_credit_card_enabled: fetchedSettings.gateway_credit_card_enabled || DEFAULTS.gateway_credit_card_enabled,\n        gateway_debit_card_enabled: fetchedSettings.gateway_debit_card_enabled || DEFAULTS.gateway_debit_card_enabled,\n        gateway_boleto_enabled: fetchedSettings.gateway_boleto_enabled || DEFAULTS.gateway_boleto_enabled,\n        gateway_max_installments: fetchedSettings.gateway_max_installments || DEFAULTS.gateway_max_installments,\n        gateway_free_installments: fetchedSettings.gateway_free_installments || DEFAULTS.gateway_free_installments,\n        gateway_auto_return: fetchedSettings.gateway_auto_return || DEFAULTS.gateway_auto_return,\n        gateway_expiration_hours: fetchedSettings.gateway_expiration_hours || DEFAULTS.gateway_expiration_hours,\n        gateway_statement_descriptor: fetchedSettings.gateway_statement_descriptor || DEFAULTS.gateway_statement_descriptor,\n        gateway_binary_mode: fetchedSettings.gateway_binary_mode || DEFAULTS.gateway_binary_mode,\n        gateway_excluded_methods: fetchedSettings.gateway_excluded_methods || DEFAULTS.gateway_excluded_methods,\n        gateway_excluded_types: fetchedSettings.gateway_excluded_types || DEFAULTS.gateway_excluded_types,\n      });\n    }\n  }, [fetchedSettings]);\n\n  const saveMutation = useMutation({\n    mutationFn: async () => {\n      const settingsToSave: Array<{ key: string; value: string; type: string }> = [\n        { key: \"gateway_pix_enabled\", value: settings.gateway_pix_enabled, type: \"boolean\" },\n        { key: \"gateway_credit_card_enabled\", value: settings.gateway_credit_card_enabled, type: \"boolean\" },\n        { key: \"gateway_debit_card_enabled\", value: settings.gateway_debit_card_enabled, type: \"boolean\" },\n        { key: \"gateway_boleto_enabled\", value: settings.gateway_boleto_enabled, type: \"boolean\" },\n        { key: \"gateway_max_installments\", value: settings.gateway_max_installments, type: \"number\" },\n        { key: \"gateway_free_installments\", value: settings.gateway_free_installments, type: \"number\" },\n        { key: \"gateway_auto_return\", value: settings.gateway_auto_return, type: \"text\" },\n        { key: \"gateway_expiration_hours\", value: settings.gateway_expiration_hours, type: \"number\" },\n        { key: \"gateway_statement_descriptor\", value: settings.gateway_statement_descriptor, type: \"text\" },\n        { key: \"gateway_binary_mode\", value: settings.gateway_binary_mode, type: \"boolean\" },\n        { key: \"gateway_excluded_methods\", value: settings.gateway_excluded_methods, type: \"text\" },\n        { key: \"gateway_excluded_types\", value: settings.gateway_excluded_types, type: \"text\" },\n      ];\n      await Promise.all(\n        settingsToSave.map((s) => apiRequest(\"POST\", \"/api/admin/settings\", s))\n      );\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"gateway-settings\"] });\n      toast({ title: \"configura√ß√µes salvas\", description: \"as configura√ß√µes do gateway foram atualizadas.\" });\n    },\n    onError: () => {\n      toast({ title: \"erro ao salvar\", description: \"n√£o foi poss√≠vel salvar as configura√ß√µes.\", variant: \"destructive\" });\n    },\n  });\n\n  const updateSetting = (key: keyof GatewaySettings, value: string) => {\n    setSettings((prev) => ({ ...prev, [key]: value }));\n  };\n\n  const toggleBool = (key: keyof GatewaySettings, checked: boolean) => {\n    updateSetting(key, checked ? \"true\" : \"false\");\n  };\n\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center py-20\">\n        <Loader2 className=\"h-6 w-6 animate-spin text-muted-foreground\" />\n      </div>\n    );\n  }\n\n  const hasPublicKey = !!(mpConfig?.publicKey);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex items-center justify-between flex-wrap gap-3\">\n        <div>\n          <h2 className=\"text-lg font-medium lowercase\" data-testid=\"text-gateway-title\">gateway de pagamento</h2>\n          <p className=\"text-sm text-muted-foreground lowercase\">configure o mercado pago checkout pro</p>\n        </div>\n        <Button\n          onClick={() => saveMutation.mutate()}\n          disabled={saveMutation.isPending}\n          data-testid=\"button-save-gateway\"\n        >\n          {saveMutation.isPending ? <Loader2 className=\"h-4 w-4 animate-spin mr-2\" /> : <Save className=\"h-4 w-4 mr-2\" />}\n          salvar configura√ß√µes\n        </Button>\n      </div>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6\">\n          <div className=\"flex items-center justify-between gap-4 flex-wrap\">\n            <div className=\"flex items-center gap-3 sm:gap-4\">\n              <div className={`p-3 rounded-2xl transition-colors ${hasPublicKey ? \"bg-primary/10\" : \"bg-muted\"}`}>\n                <Shield className={`h-6 w-6 transition-colors ${hasPublicKey ? \"text-primary\" : \"text-muted-foreground\"}`} />\n              </div>\n              <div>\n                <p className=\"font-medium lowercase text-sm sm:text-base\" data-testid=\"text-mp-status-label\">status da integra√ß√£o</p>\n                <p className=\"text-xs sm:text-sm text-muted-foreground lowercase\">\n                  {hasPublicKey ? \"chaves configuradas\" : \"chaves n√£o configuradas\"}\n                </p>\n              </div>\n            </div>\n            <div className=\"flex items-center gap-2 flex-wrap\">\n              <Badge variant={hasPublicKey ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-mp-public-key\">\n                {hasPublicKey ? \"public key configurada\" : \"public key ausente\"}\n              </Badge>\n              {mpConfig && (\n                <Badge variant={mpConfig.isProduction ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-mp-environment\">\n                  {mpConfig.isProduction ? \"produ√ß√£o\" : \"sandbox\"}\n                </Badge>\n              )}\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6 space-y-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n              <CreditCard className=\"h-5 w-5 opacity-60\" />\n            </div>\n            <div>\n              <h3 className=\"text-lg font-medium lowercase\" data-testid=\"text-payment-methods-title\">m√©todos de pagamento</h3>\n              <p className=\"text-sm text-muted-foreground lowercase\">ative ou desative formas de pagamento no checkout</p>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium lowercase\">pix</p>\n                <p className=\"text-xs text-muted-foreground lowercase\">pagamento instant√¢neo via pix</p>\n              </div>\n              <Switch\n                checked={settings.gateway_pix_enabled === \"true\"}\n                onCheckedChange={(c) => toggleBool(\"gateway_pix_enabled\", c)}\n                data-testid=\"switch-gateway-pix\"\n              />\n            </div>\n\n            <div className=\"h-px bg-border/50\" />\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium lowercase\">cart√£o de cr√©dito</p>\n                <p className=\"text-xs text-muted-foreground lowercase\">visa, mastercard, amex, elo, hipercard</p>\n              </div>\n              <Switch\n                checked={settings.gateway_credit_card_enabled === \"true\"}\n                onCheckedChange={(c) => toggleBool(\"gateway_credit_card_enabled\", c)}\n                data-testid=\"switch-gateway-credit-card\"\n              />\n            </div>\n\n            <div className=\"h-px bg-border/50\" />\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium lowercase\">cart√£o de d√©bito</p>\n                <p className=\"text-xs text-muted-foreground lowercase\">d√©bito visa, mastercard e elo</p>\n              </div>\n              <Switch\n                checked={settings.gateway_debit_card_enabled === \"true\"}\n                onCheckedChange={(c) => toggleBool(\"gateway_debit_card_enabled\", c)}\n                data-testid=\"switch-gateway-debit-card\"\n              />\n            </div>\n\n            <div className=\"h-px bg-border/50\" />\n\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <p className=\"text-sm font-medium lowercase\">boleto banc√°rio</p>\n                <p className=\"text-xs text-muted-foreground lowercase\">pagamento via boleto com prazo de compensa√ß√£o</p>\n              </div>\n              <Switch\n                checked={settings.gateway_boleto_enabled === \"true\"}\n                onCheckedChange={(c) => toggleBool(\"gateway_boleto_enabled\", c)}\n                data-testid=\"switch-gateway-boleto\"\n              />\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6 space-y-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n              <Banknote className=\"h-5 w-5 opacity-60\" />\n            </div>\n            <div>\n              <h3 className=\"text-lg font-medium lowercase\" data-testid=\"text-installments-title\">parcelamento</h3>\n              <p className=\"text-sm text-muted-foreground lowercase\">configure as op√ß√µes de parcelamento no checkout</p>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">m√°ximo de parcelas</Label>\n              <Select\n                value={settings.gateway_max_installments}\n                onValueChange={(v) => updateSetting(\"gateway_max_installments\", v)}\n              >\n                <SelectTrigger data-testid=\"select-max-installments\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  {Array.from({ length: 12 }, (_, i) => i + 1).map((n) => (\n                    <SelectItem key={n} value={String(n)}>\n                      {n}x\n                    </SelectItem>\n                  ))}\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-muted-foreground lowercase\">n√∫mero m√°ximo de parcelas permitidas (1-12)</p>\n            </div>\n\n            <div className=\"space-y-2 p-3 rounded-lg bg-muted/30 border border-border/50\">\n              <Label className=\"text-sm font-medium lowercase\">parcelas sem juros</Label>\n              <p className=\"text-xs text-muted-foreground lowercase leading-relaxed\" data-testid=\"text-free-installments-info\">\n                as parcelas sem juros s√£o configuradas diretamente no painel do mercado pago, na se√ß√£o \"seu neg√≥cio &gt; custos\". l√° voc√™ define at√© quantas parcelas quer absorver os juros. essa configura√ß√£o n√£o √© feita pela API.\n              </p>\n              <a\n                href=\"https://www.mercadopago.com.br/costs-section/installments\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                className=\"inline-flex items-center gap-1.5 text-xs text-blue-600 dark:text-blue-400 hover:underline lowercase\"\n                data-testid=\"link-mp-installments-config\"\n              >\n                abrir configura√ß√£o no mercado pago\n                <svg className=\"h-3 w-3\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" strokeWidth={2}><path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" /></svg>\n              </a>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6 space-y-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n              <Clock className=\"h-5 w-5 opacity-60\" />\n            </div>\n            <div>\n              <h3 className=\"text-lg font-medium lowercase\" data-testid=\"text-checkout-behavior-title\">comportamento do checkout</h3>\n              <p className=\"text-sm text-muted-foreground lowercase\">controle o fluxo e validade do checkout</p>\n            </div>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">retorno autom√°tico</Label>\n              <Select\n                value={settings.gateway_auto_return}\n                onValueChange={(v) => updateSetting(\"gateway_auto_return\", v)}\n              >\n                <SelectTrigger data-testid=\"select-gateway-auto-return\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"approved\">approved - somente aprovados</SelectItem>\n                  <SelectItem value=\"all\">all - todos os pagamentos</SelectItem>\n                  <SelectItem value=\"none\">nenhum - desativado</SelectItem>\n                </SelectContent>\n              </Select>\n              <p className=\"text-xs text-muted-foreground lowercase\">quando redirecionar automaticamente para a loja ap√≥s o pagamento</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">validade do checkout (horas)</Label>\n              <Input\n                type=\"number\"\n                min={1}\n                max={72}\n                value={settings.gateway_expiration_hours}\n                onChange={(e) => updateSetting(\"gateway_expiration_hours\", e.target.value)}\n                data-testid=\"input-gateway-expiration-hours\"\n              />\n              <p className=\"text-xs text-muted-foreground lowercase\">tempo em horas at√© o link de pagamento expirar (1-72)</p>\n            </div>\n          </div>\n\n          <div className=\"h-px bg-border/50\" />\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">descritor na fatura</Label>\n              <Input\n                type=\"text\"\n                maxLength={16}\n                value={settings.gateway_statement_descriptor}\n                onChange={(e) => updateSetting(\"gateway_statement_descriptor\", e.target.value)}\n                placeholder=\"OUDLA\"\n                data-testid=\"input-gateway-statement-descriptor\"\n              />\n              <p className=\"text-xs text-muted-foreground lowercase\">nome exibido na fatura do cart√£o do cliente (m√°x. 16 caracteres)</p>\n            </div>\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">modo bin√°rio</Label>\n              <div className=\"flex items-center justify-between pt-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">aprovar ou rejeitar instantaneamente, sem status pendente</p>\n                <Switch\n                  checked={settings.gateway_binary_mode === \"true\"}\n                  onCheckedChange={(c) => toggleBool(\"gateway_binary_mode\", c)}\n                  data-testid=\"switch-gateway-binary-mode\"\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6 space-y-6\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n              <Ban className=\"h-5 w-5 opacity-60\" />\n            </div>\n            <div>\n              <h3 className=\"text-lg font-medium lowercase\" data-testid=\"text-exclusions-title\">exclus√µes avan√ßadas</h3>\n              <p className=\"text-sm text-muted-foreground lowercase\">exclua m√©todos ou tipos de pagamento espec√≠ficos</p>\n            </div>\n          </div>\n\n          <div className=\"space-y-4\">\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">m√©todos de pagamento exclu√≠dos</Label>\n              <Input\n                type=\"text\"\n                value={settings.gateway_excluded_methods}\n                onChange={(e) => updateSetting(\"gateway_excluded_methods\", e.target.value)}\n                placeholder=\"ex: visa, master, amex\"\n                data-testid=\"input-gateway-excluded-methods\"\n              />\n              <p className=\"text-xs text-muted-foreground lowercase\">IDs de m√©todos separados por v√≠rgula (ex: visa, master, pix, bolbradesco)</p>\n            </div>\n\n            <div className=\"h-px bg-border/50\" />\n\n            <div className=\"space-y-2\">\n              <Label className=\"text-sm font-medium lowercase\">tipos de pagamento exclu√≠dos</Label>\n              <Input\n                type=\"text\"\n                value={settings.gateway_excluded_types}\n                onChange={(e) => updateSetting(\"gateway_excluded_types\", e.target.value)}\n                placeholder=\"ex: ticket, atm, digital_currency\"\n                data-testid=\"input-gateway-excluded-types\"\n              />\n              <p className=\"text-xs text-muted-foreground lowercase\">IDs de tipos separados por v√≠rgula (ex: ticket para boleto, atm, digital_currency, digital_wallet)</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      <Card>\n        <CardContent className=\"pt-6 px-4 sm:px-6\">\n          <div className=\"flex items-center gap-3 mb-4\">\n            <div className=\"h-10 w-10 rounded-full bg-muted/50 flex items-center justify-center shrink-0\">\n              <FileText className=\"h-5 w-5 opacity-60\" />\n            </div>\n            <div>\n              <h3 className=\"text-lg font-medium lowercase\" data-testid=\"text-summary-title\">resumo das configura√ß√µes</h3>\n              <p className=\"text-sm text-muted-foreground lowercase\">vis√£o geral das configura√ß√µes atuais</p>\n            </div>\n          </div>\n\n          <div className=\"bg-muted/30 rounded-xl p-4 space-y-3\">\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">pix</p>\n                <Badge variant={settings.gateway_pix_enabled === \"true\" ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-summary-pix\">\n                  {settings.gateway_pix_enabled === \"true\" ? \"ativo\" : \"inativo\"}\n                </Badge>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">cr√©dito</p>\n                <Badge variant={settings.gateway_credit_card_enabled === \"true\" ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-summary-credit\">\n                  {settings.gateway_credit_card_enabled === \"true\" ? \"ativo\" : \"inativo\"}\n                </Badge>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">d√©bito</p>\n                <Badge variant={settings.gateway_debit_card_enabled === \"true\" ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-summary-debit\">\n                  {settings.gateway_debit_card_enabled === \"true\" ? \"ativo\" : \"inativo\"}\n                </Badge>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">boleto</p>\n                <Badge variant={settings.gateway_boleto_enabled === \"true\" ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-summary-boleto\">\n                  {settings.gateway_boleto_enabled === \"true\" ? \"ativo\" : \"inativo\"}\n                </Badge>\n              </div>\n            </div>\n\n            <div className=\"h-px bg-border/50\" />\n\n            <div className=\"grid grid-cols-2 sm:grid-cols-4 gap-3\">\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">parcelas</p>\n                <p className=\"text-sm font-medium lowercase\" data-testid=\"text-summary-installments\">at√© {settings.gateway_max_installments}x</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">sem juros</p>\n                <p className=\"text-sm font-medium lowercase\" data-testid=\"text-summary-free-installments\">via painel MP</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">validade</p>\n                <p className=\"text-sm font-medium lowercase\" data-testid=\"text-summary-expiration\">{settings.gateway_expiration_hours}h</p>\n              </div>\n              <div className=\"space-y-1\">\n                <p className=\"text-xs text-muted-foreground lowercase\">modo bin√°rio</p>\n                <Badge variant={settings.gateway_binary_mode === \"true\" ? \"default\" : \"secondary\"} className=\"lowercase\" data-testid=\"badge-summary-binary\">\n                  {settings.gateway_binary_mode === \"true\" ? \"ativo\" : \"inativo\"}\n                </Badge>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","path":null,"size_bytes":24681,"size_tokens":null}},"version":2}